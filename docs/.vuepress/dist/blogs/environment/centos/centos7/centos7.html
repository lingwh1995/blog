<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta name="keywords" content="å®‰è£…Linuxæ“ä½œç³»ç»Ÿ,Linuxæ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®,æ­å»ºåŸºç¡€å¼€å‘ç¯å¢ƒ,Centosæ­å»ºdocker,Centosæ­å»ºRancher,Centosæ­å»ºMinikube,kubeadmæ­å»ºKubernetes,äºŒè¿›åˆ¶åŒ…æ­å»ºKubernetes,"><meta property="og:url" content="https://vuepress-theme-hope-v2-demo.mrhope.site/blogs/environment/centos/centos7/centos7.html"><meta property="og:site_name" content="æ­¤ç”ŸæŒšçˆ±ä¸‡å®è·¯"><meta property="og:title" content="åœ¨Centos7ä¸Šæ­å»ºå¼€å‘ç¯å¢ƒ-ç« èŠ‚å†…å®¹åˆé›†"><meta property="og:description" content="æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼šå…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-08-16T18:20:23.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="linux"><meta property="article:tag" content="centos"><meta property="article:tag" content="ç¯å¢ƒæ­å»º"><meta property="article:tag" content="å®‰è£…linuxæ“ä½œç³»ç»Ÿ"><meta property="article:tag" content="yamlæº"><meta property="article:tag" content="è®¾ç½®ç¯å¢ƒå˜é‡"><meta property="article:tag" content="jdk"><meta property="article:tag" content="maven"><meta property="article:tag" content="mysql"><meta property="article:tag" content="docker"><meta property="article:tag" content="dockerç§æœ"><meta property="article:tag" content="harbor"><meta property="article:tag" content="dockerå¯è§†åŒ–"><meta property="article:tag" content="rancher"><meta property="article:tag" content="å®¹å™¨ç®¡ç†"><meta property="article:tag" content="minikube"><meta property="article:tag" content="k8sç½‘ç»œæ’ä»¶"><meta property="article:tag" content="k8så¯è§†åŒ–"><meta property="article:tag" content="kubeadmæ­å»ºk8sé›†ç¾¤"><meta property="article:tag" content="etcdé›†ç¾¤"><meta property="article:tag" content="kube-apiserver"><meta property="article:tag" content="kube-controller-manager"><meta property="article:tag" content="kube-scheduler"><meta property="article:tag" content="kubectl"><meta property="article:tag" content="nginx"><meta property="article:tag" content="keepalive"><meta property="article:tag" content="é«˜å¯ç”¨"><meta property="article:tag" content="äºŒè¿›åˆ¶æ­å»ºk8sé›†ç¾¤"><meta property="article:published_time" content="2021-03-01T00:00:00.000Z"><meta property="article:modified_time" content="2022-08-16T18:20:23.000Z"><link rel="icon" href="/images/headshot.jpg"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3564358_nrgvwqy4sv.css"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/images/pwa/128.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/images/pwa/128.png"><meta name="msapplication-TileColor" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>åœ¨Centos7ä¸Šæ­å»ºå¼€å‘ç¯å¢ƒ-ç« èŠ‚å†…å®¹åˆé›† | æ­¤ç”ŸæŒšçˆ±ä¸‡å®è·¯</title><meta name="description" content="æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼šå…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.e6085c44.css">
    <link rel="modulepreload" href="/assets/app.6952de04.js"><link rel="modulepreload" href="/assets/centos7.html.76ebadd9.js"><link rel="modulepreload" href="/assets/centos7.html.4fef3895.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/images/headshot.jpg" alt="æ­¤ç”ŸæŒšçˆ±ä¸‡å®è·¯"><!----><span class="site-name hide-in-pad">æ­¤ç”ŸæŒšçˆ±ä¸‡å®è·¯</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸ªäººä¸»é¡µ"><span class="icon iconfont icon-hacker"></span>ä¸ªäººä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog.html" class="nav-link" aria-label="åšå®¢ä¸»é¡µ"><span class="icon iconfont icon-blog"></span>åšå®¢ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/cinema.html" class="nav-link" aria-label="æ”¾æ˜ å…"><span class="icon iconfont icon-creative"></span>æ”¾æ˜ å…<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åç«¯"><span class="title"><span class="icon iconfont icon-java"></span>åç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>springboot</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/xxx" class="nav-link" aria-label="springboot"><span class="icon iconfont icon-leaf"></span>springboot<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>springcloud</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/backend/springcloud/springcloud-eureka.md" class="nav-link" aria-label="springcloud-eureka"><span class="icon iconfont icon-cache"></span>springcloud-eureka<!----></a></li><li class="dropdown-subitem"><a href="/backend/springcloud/article/article6" class="nav-link" aria-label="springcloud-zookeeper"><span class="icon iconfont icon-cache"></span>springcloud-zookeeper<!----></a></li><li class="dropdown-subitem"><a href="/backend/springcloud/article/article6" class="nav-link" aria-label="springcloud-consul"><span class="icon iconfont icon-cache"></span>springcloud-consul<!----></a></li><li class="dropdown-subitem"><a href="/backend/springcloud/article/article6" class="nav-link" aria-label="springcloud-alibaba"><span class="icon iconfont icon-cache"></span>springcloud-alibaba<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å‰ç«¯"><span class="title"><span class="icon iconfont icon-html"></span>å‰ç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/xxx" class="nav-link" aria-label="ECMAScript 5"><!---->ECMAScript 5<!----></a></li><li class="dropdown-item"><a href="/xxx" class="nav-link" aria-label="ECMAScript 6"><!---->ECMAScript 6<!----></a></li><li class="dropdown-item"><a href="/xxx" class="nav-link" aria-label="Framework"><!---->Framework<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="icon iconfont icon-database"></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å…³ç³»å‹æ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/relational/article1" class="nav-link" aria-label="mysql"><span class="icon iconfont icon-mysql"></span>mysql<!----></a></li><li class="dropdown-subitem"><a href="/database/relational/article2" class="nav-link" aria-label="oracle"><!---->oracle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>nosql</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/nosql/article/article5" class="nav-link" aria-label="monogodb"><!---->monogodb<!----></a></li><li class="dropdown-subitem"><a href="/database/nosql/article/article6" class="nav-link" aria-label="redis"><!---->redis<!----></a></li><li class="dropdown-subitem"><a href="/database/nosql/article/article6" class="nav-link" aria-label="etcd"><!---->etcd<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="ç¯å¢ƒæ­å»º"><span class="title"><span class="icon iconfont icon-shell"></span>ç¯å¢ƒæ­å»º</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>centos</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/environment/centos/centos7/shardings/centos7-chapter-0.%E5%8D%9A%E5%AE%A2%E5%86%85%E5%AE%B9%E4%BB%8B%E7%BB%8D.html" class="nav-link" aria-label="centos7"><span class="icon iconfont icon-centos"></span>centos7<!----></a></li></ul></li><li class="dropdown-item"><a href="/blogs/environment/windows/windows.md" class="nav-link" aria-label="windows"><span class="icon iconfont icon-windows"></span>windows<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åŸºç¡€æ”¯æŒ"><span class="title"><span class="icon iconfont icon-tool"></span>åŸºç¡€æ”¯æŒ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ç½‘ç«™æ”¶è—</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://javaguide.cn/" rel="noopener noreferrer" target="_blank" aria-label="çŸ¥è¯†ç±»ç½‘ç«™" class="nav-link"><span class="icon iconfont icon-centos"></span>çŸ¥è¯†ç±»ç½‘ç«™<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://javaguide.cn/" rel="noopener noreferrer" target="_blank" aria-label="å·¥å…·ç±»ç½‘ç«™" class="nav-link"><span class="icon iconfont icon-centos"></span>å·¥å…·ç±»ç½‘ç«™<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li><li class="dropdown-item"><a href="/blogs/environment/windows/windows.md" class="nav-link" aria-label="å·¥å…·è½¯ä»¶"><span class="icon iconfont icon-windows"></span>å·¥å…·è½¯ä»¶<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://github.com/lingwh1995" rel="noopener noreferrer" target="_blank" aria-label="GITHUB" class="nav-link"><span class="icon iconfont icon-github"></span>GITHUB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://gitee.com/lingwh1995" rel="noopener noreferrer" target="_blank" aria-label="GITEE" class="nav-link"><span class="icon iconfont icon-gitee"></span>GITEE<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="pure-button" href="javascript:void(0)" target="_self" rel="noopener noreferrer" aria-label="Github"><svg t="1660309811545" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1872" width="1.1rem" height="1.1rem" style="vertical-align:middle;border-radius:0.2rem;"><path d="M892.708571 0H131.291429A131.267048 131.267048 0 0 0 0 131.267048v761.417142A131.31581 131.31581 0 0 0 131.291429 1024h761.417142A131.31581 131.31581 0 0 0 1024 892.68419V131.267048A131.267048 131.267048 0 0 0 892.708571 0z" fill="#3eaf7c" p-id="1873"></path></svg></a><div class="popup"><div class="item"><div class="title">å½“å‰æ¨¡å¼</div><div class="content">å¸¸è§„æ¨¡å¼</div></div><div class="item"><div class="title">ğŸ˜„Â å¸¸è§„æ¨¡å¼</div><div class="content">é¡µé¢è‰²å½©ä¸°å¯Œ</div></div><div class="item"><div class="title">ğŸ€Â çº¯å‡€æ¨¡å¼</div><div class="content">é¡µé¢è‰²å½©ç®€å•</div></div></div></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-a-archivecatalogue-fill"></span><span class="title">åœ¨Centos7ä¸Šæ­å»ºå¼€å‘ç¯å¢ƒ</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-linux"></span>åœ¨Centos7ä¸Šæ­å»ºå¼€å‘ç¯å¢ƒ-ç« èŠ‚å†…å®¹åˆé›†</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down" localizeddate="2021å¹´3æœˆ1æ—¥" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/lingwh1995" target="_blank" rel="noopener noreferrer">lingwh</a></span><span property="author" content="lingwh"></span></span><span class="origin" localizeddate="2021å¹´3æœˆ1æ—¥" pageview="true" pure="false">åŸåˆ›</span><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2021å¹´3æœˆ1æ—¥</span><meta property="datePublished" content="2021-03-01T00:00:00.000Z"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" localizeddate="2021å¹´3æœˆ1æ—¥" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 68 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT68M"></span><span class="words-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down" localizeddate="2021å¹´3æœˆ1æ—¥" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 20471 å­—</span><meta property="wordCount" content="20471"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down" localizeddate="2021å¹´3æœˆ1æ—¥" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category7 clickable" role="navigation">ç¯å¢ƒæ­å»º</li><meta property="articleSection" content="ç¯å¢ƒæ­å»º"></ul></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down" localizeddate="2021å¹´3æœˆ1æ—¥" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag6 clickable" role="navigation">linux</li><li class="tag tag0 clickable" role="navigation">centos</li><li class="tag tag7 clickable" role="navigation">ç¯å¢ƒæ­å»º</li><li class="tag tag4 clickable" role="navigation">å®‰è£…linuxæ“ä½œç³»ç»Ÿ</li><li class="tag tag0 clickable" role="navigation">centos</li><li class="tag tag6 clickable" role="navigation">yamlæº</li><li class="tag tag2 clickable" role="navigation">è®¾ç½®ç¯å¢ƒå˜é‡</li><li class="tag tag7 clickable" role="navigation">jdk</li><li class="tag tag7 clickable" role="navigation">maven</li><li class="tag tag4 clickable" role="navigation">mysql</li><li class="tag tag2 clickable" role="navigation">docker</li><li class="tag tag7 clickable" role="navigation">dockerç§æœ</li><li class="tag tag5 clickable" role="navigation">harbor</li><li class="tag tag8 clickable" role="navigation">dockerå¯è§†åŒ–</li><li class="tag tag0 clickable" role="navigation">rancher</li><li class="tag tag4 clickable" role="navigation">å®¹å™¨ç®¡ç†</li><li class="tag tag6 clickable" role="navigation">minikube</li><li class="tag tag8 clickable" role="navigation">k8sç½‘ç»œæ’ä»¶</li><li class="tag tag8 clickable" role="navigation">k8så¯è§†åŒ–</li><li class="tag tag4 clickable" role="navigation">kubeadmæ­å»ºk8sé›†ç¾¤</li><li class="tag tag7 clickable" role="navigation">etcdé›†ç¾¤</li><li class="tag tag1 clickable" role="navigation">kube-apiserver</li><li class="tag tag3 clickable" role="navigation">kube-controller-manager</li><li class="tag tag8 clickable" role="navigation">kube-scheduler</li><li class="tag tag5 clickable" role="navigation">kubectl</li><li class="tag tag1 clickable" role="navigation">nginx</li><li class="tag tag4 clickable" role="navigation">keepalive</li><li class="tag tag2 clickable" role="navigation">é«˜å¯ç”¨</li><li class="tag tag5 clickable" role="navigation">äºŒè¿›åˆ¶æ­å»ºk8sé›†ç¾¤</li></ul><meta property="keywords" content="linux,centos,ç¯å¢ƒæ­å»º,å®‰è£…linuxæ“ä½œç³»ç»Ÿ,centos,yamlæº,è®¾ç½®ç¯å¢ƒå˜é‡,jdk,maven,mysql,docker,dockerç§æœ,harbor,dockerå¯è§†åŒ–,rancher,å®¹å™¨ç®¡ç†,minikube,k8sç½‘ç»œæ’ä»¶,k8så¯è§†åŒ–,kubeadmæ­å»ºk8sé›†ç¾¤,etcdé›†ç¾¤,kube-apiserver,kube-controller-manager,kube-scheduler,kubectl,nginx,keepalive,é«˜å¯ç”¨,äºŒè¿›åˆ¶æ­å»ºk8sé›†ç¾¤"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#intro" class="router-link-active router-link-exact-active toc-link level1">åšå®¢å†…å®¹ä»‹ç»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#åšå®¢å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">åšå®¢å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#åšå®¢å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">åšå®¢å†…å®¹å¤§çº²</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#ç®€å•ç‰ˆåšå®¢å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level3">ç®€å•ç‰ˆåšå®¢å†…å®¹å¤§çº²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#è¯¦ç»†ç‰ˆåšå®¢å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level3">è¯¦ç»†ç‰ˆåšå®¢å†…å®¹å¤§çº²</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#1." class="router-link-active router-link-exact-active toc-link level1">1.å®‰è£…Linuxæ“ä½œç³»ç»Ÿ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_1-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">1.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_1-2-ç« èŠ‚å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">1.2.ç« èŠ‚å†…å®¹å¤§çº²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_1-3-linuxé‡è¦ç›®å½•ä»‹ç»" class="router-link-active router-link-exact-active toc-link level2">1.3.Linuxé‡è¦ç›®å½•ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_1-4-centosé•œåƒä¸‹è½½" class="router-link-active router-link-exact-active toc-link level2">1.4.Centosé•œåƒä¸‹è½½</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_1-5-å®‰è£…å‰vmawareç›¸å…³è®¾ç½®" class="router-link-active router-link-exact-active toc-link level2">1.5.å®‰è£…å‰Vmawareç›¸å…³è®¾ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_1-6-å®‰è£…æ—¶åˆ†åŒºå¤§å°è®¾ç½®" class="router-link-active router-link-exact-active toc-link level2">1.6.å®‰è£…æ—¶åˆ†åŒºå¤§å°è®¾ç½®</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#2." class="router-link-active router-link-exact-active toc-link level1">2.Linuxæ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">2.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-2-ç« èŠ‚å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">2.2.ç« èŠ‚å†…å®¹å¤§çº²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-3-é…ç½®é™æ€ipåœ°å€" class="router-link-active router-link-exact-active toc-link level2">2.3.é…ç½®é™æ€IPåœ°å€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-4-è§£å†³è¿œç¨‹è¿æ¥æ— æ³•è¿æ¥çš„é—®é¢˜" class="router-link-active router-link-exact-active toc-link level2">2.4.è§£å†³è¿œç¨‹è¿æ¥æ— æ³•è¿æ¥çš„é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-5-è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡" class="router-link-active router-link-exact-active toc-link level2">2.5.è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-6-å®‰è£…curl" class="router-link-active router-link-exact-active toc-link level2">2.6.å®‰è£…curl</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-7-é…ç½®ymlæº" class="router-link-active router-link-exact-active toc-link level2">2.7.é…ç½®ymlæº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-8-å®‰è£…å¸¸ç”¨åŸºç¡€ç³»ç»Ÿè½¯ä»¶" class="router-link-active router-link-exact-active toc-link level2">2.8.å®‰è£…å¸¸ç”¨åŸºç¡€ç³»ç»Ÿè½¯ä»¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-8-1-æ‰‹åŠ¨å®‰è£…å¸¸ç”¨è½¯ä»¶" class="router-link-active router-link-exact-active toc-link level3">2.8.1.æ‰‹åŠ¨å®‰è£…å¸¸ç”¨è½¯ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_2-8-2-ä½¿ç”¨è„šæœ¬å®‰è£…å¸¸ç”¨è½¯ä»¶" class="router-link-active router-link-exact-active toc-link level3">2.8.2.ä½¿ç”¨è„šæœ¬å®‰è£…å¸¸ç”¨è½¯ä»¶</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#3." class="router-link-active router-link-exact-active toc-link level1">3.æ­å»ºåŸºç¡€å¼€å‘ç¯å¢ƒ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_3-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">3.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_3-2-ç« èŠ‚å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">3.2.ç« èŠ‚å†…å®¹å¤§çº²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_3-3-å®‰è£…jdk" class="router-link-active router-link-exact-active toc-link level2">3.3.å®‰è£…jdk</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_3-4-å®‰è£…maven" class="router-link-active router-link-exact-active toc-link level2">3.4.å®‰è£…maven</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_3-5-å®‰è£…mysql" class="router-link-active router-link-exact-active toc-link level2">3.5.å®‰è£…mysql</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#4." class="router-link-active router-link-exact-active toc-link level1">4.Centosæ­å»ºdocker</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">4.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-2-ç« èŠ‚å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">4.2.ç« èŠ‚å†…å®¹å¤§çº²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-3-å®‰è£…docker" class="router-link-active router-link-exact-active toc-link level2">4.3.å®‰è£…docker</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-3-1-åœ¨çº¿å®‰è£…docker" class="router-link-active router-link-exact-active toc-link level3">4.3.1.åœ¨çº¿å®‰è£…docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-3-2-äºŒè¿›åˆ¶åŒ…å®‰è£…docker" class="router-link-active router-link-exact-active toc-link level3">4.3.2.äºŒè¿›åˆ¶åŒ…å®‰è£…docker</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-4-dockerå¯åŠ¨æ•…éšœè§£å†³" class="router-link-active router-link-exact-active toc-link level2">4.4.dockerå¯åŠ¨æ•…éšœè§£å†³</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-5-dockerå®¹å™¨å¯è§†åŒ–" class="router-link-active router-link-exact-active toc-link level2">4.5.dockerå®¹å™¨å¯è§†åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-6-æ­å»ºdockeç§æœ" class="router-link-active router-link-exact-active toc-link level2">4.6.æ­å»ºdockeç§æœ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-6-1-æ­å»ºdockeå®˜æ–¹ç§æœ-ä¸å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒ" class="router-link-active router-link-exact-active toc-link level3">4.6.1.æ­å»ºdockeå®˜æ–¹ç§æœï¼ˆä¸å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-6-2-æ­å»ºdockeå®˜æ–¹ç§æœ-å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒ" class="router-link-active router-link-exact-active toc-link level3">4.6.2.æ­å»ºdockeå®˜æ–¹ç§æœï¼ˆå¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒï¼‰</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-6-3-æ­å»ºharborç§æœ" class="router-link-active router-link-exact-active toc-link level2">4.6.3.æ­å»ºharborç§æœ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-6-3-1-harborç®€ä»‹" class="router-link-active router-link-exact-active toc-link level3">4.6.3.1.harborç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-6-3-2-æ­å»ºdocker-compose" class="router-link-active router-link-exact-active toc-link level3">4.6.3.2.æ­å»ºdocker-compose</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_4-6-3-3-å®‰è£…harbor" class="router-link-active router-link-exact-active toc-link level3">4.6.3.3.å®‰è£…harbor</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#5." class="router-link-active router-link-exact-active toc-link level1">5.Centosæ­å»ºRancher</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_5-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">5.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_5-2-ç« èŠ‚å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">5.2.ç« èŠ‚å†…å®¹å¤§çº²</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#6." class="router-link-active router-link-exact-active toc-link level1">6.Centosæ­å»ºMinikube</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">6.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-2-ç« èŠ‚å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">6.2.ç« èŠ‚å†…å®¹å¤§çº²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-3-minikubeä»‹ç»" class="router-link-active router-link-exact-active toc-link level2">6.3.minikubeä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-4-ç‰ˆæœ¬è¯´æ˜" class="router-link-active router-link-exact-active toc-link level2">6.4.ç‰ˆæœ¬è¯´æ˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-5-å¼€å¯vmwareè™šæ‹ŸåŒ–" class="router-link-active router-link-exact-active toc-link level2">6.5.å¼€å¯Vmwareè™šæ‹ŸåŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-6-å®‰è£…kubectl" class="router-link-active router-link-exact-active toc-link level2">6.6.å®‰è£…kubectl</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-7-å®‰è£…minikube" class="router-link-active router-link-exact-active toc-link level2">6.7.å®‰è£…minikube</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-8-ä½¿ç”¨é˜¿é‡Œäº‘åŠ é€Ÿdocker-hub" class="router-link-active router-link-exact-active toc-link level2">6.8.ä½¿ç”¨é˜¿é‡Œäº‘åŠ é€Ÿdocker hub</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-9-å¯åŠ¨minikube" class="router-link-active router-link-exact-active toc-link level2">6.9.å¯åŠ¨minikube</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_6-10-minikubeå¸¸ç”¨å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level2">6.10.minikubeå¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#7." class="router-link-active router-link-exact-active toc-link level1">7.kubeadmæ­å»ºKubernetes</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">7.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-2-ç« èŠ‚å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">7.2.ç« èŠ‚å†…å®¹å¤§çº²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-3-ç‰¹åˆ«è¯´æ˜" class="router-link-active router-link-exact-active toc-link level2">7.3.ç‰¹åˆ«è¯´æ˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-4-æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¯¹åº”ä¸»æœºå" class="router-link-active router-link-exact-active toc-link level2">7.4.æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¯¹åº”ä¸»æœºå</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-5-æ‰€æœ‰èŠ‚ç‚¹ä¿®æ”¹hosts" class="router-link-active router-link-exact-active toc-link level2">7.5.æ‰€æœ‰èŠ‚ç‚¹ä¿®æ”¹hosts</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-6-æ‰€æœ‰èŠ‚ç‚¹å…³é—­selinux" class="router-link-active router-link-exact-active toc-link level2">7.6.æ‰€æœ‰èŠ‚ç‚¹å…³é—­SELinux</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-7-æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™" class="router-link-active router-link-exact-active toc-link level2">7.7.æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-8-æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker" class="router-link-active router-link-exact-active toc-link level2">7.8.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-9-æ‰€æœ‰èŠ‚ç‚¹å®‰è£…k8sæ‰€éœ€ç»„ä»¶" class="router-link-active router-link-exact-active toc-link level2">7.9.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…k8sæ‰€éœ€ç»„ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-10-æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨kubeletå’Œdocker" class="router-link-active router-link-exact-active toc-link level2">7.10.æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨kubeletå’Œdocker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-11-æ‰€æœ‰å…³é—­swap" class="router-link-active router-link-exact-active toc-link level2">7.11.æ‰€æœ‰å…³é—­swap</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-12-ç”¨kubeadm-åˆå§‹åŒ–é›†ç¾¤" class="router-link-active router-link-exact-active toc-link level2">7.12.ç”¨kubeadm åˆå§‹åŒ–é›†ç¾¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-13-å…¶ä»–èŠ‚ç‚¹è¿æ¥åˆ°masterèŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level2">7.13.å…¶ä»–èŠ‚ç‚¹è¿æ¥åˆ°MasterèŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-14-åœ¨masterèŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é›†ç¾¤" class="router-link-active router-link-exact-active toc-link level2">7.14.åœ¨masterèŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é›†ç¾¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-15-å®‰è£…ç½‘ç»œæ’ä»¶" class="router-link-active router-link-exact-active toc-link level2">7.15.å®‰è£…ç½‘ç»œæ’ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-16-åœ¨masterä¸ŠæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level2">7.16.åœ¨masterä¸ŠæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-17-å¯åŠ¨æ•…éšœè§£å†³" class="router-link-active router-link-exact-active toc-link level2">7.17.å¯åŠ¨æ•…éšœè§£å†³</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-18-åŸºç¡€å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level2">7.18.åŸºç¡€å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-19-éƒ¨ç½²ç¬¬ä¸€ä¸ªç¨‹åºåˆ°k8sä¸­" class="router-link-active router-link-exact-active toc-link level2">7.19.éƒ¨ç½²ç¬¬ä¸€ä¸ªç¨‹åºåˆ°k8sä¸­</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_7-20-å¯è§†åŒ–é¢æ¿kuboard" class="router-link-active router-link-exact-active toc-link level2">7.20.å¯è§†åŒ–é¢æ¿kuboard</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#8." class="router-link-active router-link-exact-active toc-link level1">8.äºŒè¿›åˆ¶åŒ…æ­å»ºKubernetes</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">8.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-2-ç« èŠ‚å†…å®¹å¤§çº²" class="router-link-active router-link-exact-active toc-link level2">8.2.ç« èŠ‚å†…å®¹å¤§çº²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-3-ç¯å¢ƒé…ç½®æ¸…å•" class="router-link-active router-link-exact-active toc-link level2">8.3.ç¯å¢ƒé…ç½®æ¸…å•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-4-æœåŠ¡å™¨è§„åˆ’å’Œipåœ°å€è§„åˆ’" class="router-link-active router-link-exact-active toc-link level2">8.4.æœåŠ¡å™¨è§„åˆ’å’ŒIPåœ°å€è§„åˆ’</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-4-1æœåŠ¡å™¨è§„åˆ’" class="router-link-active router-link-exact-active toc-link level3">8.4.1æœåŠ¡å™¨è§„åˆ’</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-4-2-ipåœ°å€è§„åˆ’" class="router-link-active router-link-exact-active toc-link level3">8.4.2.IPåœ°å€è§„åˆ’</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-5-å®‰è£…å‰å‡†å¤‡å·¥ä½œ" class="router-link-active router-link-exact-active toc-link level2">8.5.å®‰è£…å‰å‡†å¤‡å·¥ä½œ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-5-1æ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®" class="router-link-active router-link-exact-active toc-link level3">8.5.1æ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-5-2ä¸‹è½½æ‰€æœ‰ç”¨åˆ°çš„è½¯ä»¶åŒ…" class="router-link-active router-link-exact-active toc-link level3">8.5.2ä¸‹è½½æ‰€æœ‰ç”¨åˆ°çš„è½¯ä»¶åŒ…</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-6-å®‰è£…cfsslè¯ä¹¦ç”Ÿæˆå·¥å…·" class="router-link-active router-link-exact-active toc-link level2">8.6.å®‰è£…cfsslè¯ä¹¦ç”Ÿæˆå·¥å…·</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-7-æ­å»ºetcdé›†ç¾¤" class="router-link-active router-link-exact-active toc-link level2">8.7.æ­å»ºetcdé›†ç¾¤</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-7-1ç”Ÿæˆcaè¯ä¹¦å’Œhttpsè¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.7.1ç”ŸæˆCAè¯ä¹¦å’Œhttpsè¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-7-2-éƒ¨ç½²etcdé›†ç¾¤" class="router-link-active router-link-exact-active toc-link level3">8.7.2.éƒ¨ç½²etcdé›†ç¾¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-7-4-æ‹·è´etcdæ‰€éœ€è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.7.4.æ‹·è´etcdæ‰€éœ€è¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-7-5-è®©systemdç®¡ç†etcd" class="router-link-active router-link-exact-active toc-link level3">8.7.5.è®©systemdç®¡ç†etcd</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-7-6-æ‹·è´etcdå®‰è£…æ–‡ä»¶åˆ°worker-node" class="router-link-active router-link-exact-active toc-link level3">8.7.6.æ‹·è´etcdå®‰è£…æ–‡ä»¶åˆ°Worker Node</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-7-7-å¯åŠ¨ä¸‰ä¸ªetcdå¹¶è®¾ç½®å¼€æœºè‡ªå¯" class="router-link-active router-link-exact-active toc-link level3">8.7.7.å¯åŠ¨ä¸‰ä¸ªetcdå¹¶è®¾ç½®å¼€æœºè‡ªå¯</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-8-å®‰è£…é…ç½®docker" class="router-link-active router-link-exact-active toc-link level2">8.8.å®‰è£…é…ç½®Docker</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-8-1åœ¨master1ä¸Šå®‰è£…docker" class="router-link-active router-link-exact-active toc-link level3">8.8.1åœ¨Master1ä¸Šå®‰è£…docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-8-2åœ¨æ‰€æœ‰worker-nodeä¸Šå®‰è£…docker" class="router-link-active router-link-exact-active toc-link level3">8.8.2åœ¨æ‰€æœ‰Worker Nodeä¸Šå®‰è£…docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-8-3å¯åŠ¨ä¸‰å°æœºå™¨ä¸Šçš„docker" class="router-link-active router-link-exact-active toc-link level3">8.8.3å¯åŠ¨ä¸‰å°æœºå™¨ä¸Šçš„docker</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-9-æ­å»ºkube-apiserver" class="router-link-active router-link-exact-active toc-link level2">8.9.æ­å»ºkube-apiserver</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-9-1-ç”Ÿæˆcaè¯ä¹¦å’Œhttpsè¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.9.1.ç”ŸæˆCAè¯ä¹¦å’ŒHttpsè¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-9-2-åœ¨master-node1ä¸Šéƒ¨ç½²kube-apiserver" class="router-link-active router-link-exact-active toc-link level3">8.9.2.åœ¨Master Node1ä¸Šéƒ¨ç½²kube-apiserver</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-9-3-æ‹·è´æ‰€éœ€è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.9.3.æ‹·è´æ‰€éœ€è¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-9-4-å¯ç”¨tls-bootstrapping" class="router-link-active router-link-exact-active toc-link level3">8.9.4.å¯ç”¨TLS bootstrapping</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-9-5-è®©systemdç®¡ç†apiserver" class="router-link-active router-link-exact-active toc-link level3">8.9.5.è®©systemdç®¡ç†apiserver</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-9-6-å¯åŠ¨kube-apiserver" class="router-link-active router-link-exact-active toc-link level3">8.9.6.å¯åŠ¨kube-apiserver</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-10-åœ¨master-node1ä¸Šéƒ¨ç½²kube-controller-manager" class="router-link-active router-link-exact-active toc-link level2">8.10.åœ¨Master Node1ä¸Šéƒ¨ç½²kube-controller-manager</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-10-1-åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-controller-managerç›¸å…³æ–‡ä»¶åˆ°-opt-kubernetes-bin" class="router-link-active router-link-exact-active toc-link level3">8.10.1.åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-controller-managerç›¸å…³æ–‡ä»¶åˆ°/opt/kubernetes/bin</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-10-2-ç”Ÿæˆè¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.10.2.ç”Ÿæˆè¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-10-2-åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.10.2.åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-10-3-ç”Ÿæˆé…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.10.3.ç”Ÿæˆé…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-10-4-è®©systemdç®¡ç†controller-manager" class="router-link-active router-link-exact-active toc-link level3">8.10.4.è®©systemdç®¡ç†controller-manager</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-10-5-å¯åŠ¨kube-controller-manager" class="router-link-active router-link-exact-active toc-link level3">8.10.5.å¯åŠ¨kube-controller-manager</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-11-éƒ¨ç½²kube-scheduler" class="router-link-active router-link-exact-active toc-link level2">8.11.éƒ¨ç½²kube-scheduler</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-10-1-åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-dchedulerç›¸å…³æ–‡ä»¶åˆ°-opt-kubernetes-bin" class="router-link-active router-link-exact-active toc-link level3">8.10.1 åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-dchedulerç›¸å…³æ–‡ä»¶åˆ°/opt/kubernetes/bin</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-11-2-ç”Ÿæˆè¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.11.2.ç”Ÿæˆè¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-11-3-åˆ›å»ºkube-scheduler-confé…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.11.3.åˆ›å»ºkube-scheduler.confé…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-11-4-ç”Ÿæˆkube-scheduler-kubeconfigæ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.11.4.ç”Ÿæˆkube-scheduler.kubeconfigæ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-11-5-è®©systemdç®¡ç†kube-scheduler" class="router-link-active router-link-exact-active toc-link level3">8.11.5.è®©systemdç®¡ç†kube-scheduler</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-11-6-å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨" class="router-link-active router-link-exact-active toc-link level3">8.11.6.å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-12-ä½¿ç”¨kubectlæŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="router-link-active router-link-exact-active toc-link level2">8.12.ä½¿ç”¨kubectlæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-12-1-ç”Ÿæˆæ‰€éœ€è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.12.1.ç”Ÿæˆæ‰€éœ€è¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-12-2-åœ¨-kubeæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆconfigæ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.12.2.åœ¨.kubeæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆconfigæ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-12-3-é€šè¿‡kubectlå·¥å…·æŸ¥çœ‹é›†ç¾¤ç»„ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.12.3.é€šè¿‡kubectlå·¥å…·æŸ¥çœ‹é›†ç¾¤ç»„ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-12-4-æˆæƒkubelet-bootstrapç”¨æˆ·å…è®¸è¯·æ±‚è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.12.4.æˆæƒkubelet-bootstrapç”¨æˆ·å…è®¸è¯·æ±‚è¯ä¹¦</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-åœ¨master-node1ä¸Šéƒ¨ç½²ç¬¬ä¸€ä¸ªworker-node" class="router-link-active router-link-exact-active toc-link level2">8.13.åœ¨Master Node1ä¸Šéƒ¨ç½²ç¬¬ä¸€ä¸ªWorker Node</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-2-åœ¨master-node1éƒ¨ç½²kubelet" class="router-link-active router-link-exact-active toc-link level3">8.13.2.åœ¨Master Node1éƒ¨ç½²kubelet</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-2-1-åˆ›å»ºkubeleté…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level4">8.13.2.1.åˆ›å»ºkubeleté…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-2-2-åˆ›å»ºkubeletç¼–æ’æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level4">8.13.2.2.åˆ›å»ºkubeletç¼–æ’æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-2-3-ç”Ÿæˆkubeletåˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼kubeconfigæ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level4">8.13.2.3.ç”Ÿæˆkubeletåˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼kubeconfigæ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-2-4-systemdç®¡ç†kubelet" class="router-link-active router-link-exact-active toc-link level4">8.13.2.4.systemdç®¡ç†kubelet</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-3-5-å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨" class="router-link-active router-link-exact-active toc-link level4">8.13.3.5.å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-2-6-å…è®¸kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤" class="router-link-active router-link-exact-active toc-link level4">8.13.2.6.å…è®¸kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-3-éƒ¨ç½²kube-proxy" class="router-link-active router-link-exact-active toc-link level3">8.13.3.éƒ¨ç½²kube-proxy</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-3-1-åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level4">8.13.3.1.åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-3-2-é…ç½®å‚æ•°æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level4">8.13.3.2.é…ç½®å‚æ•°æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-3-3-ç”Ÿæˆkube-proxyè¯ä¹¦æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level4">8.13.3.3.ç”Ÿæˆkube-proxyè¯ä¹¦æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-3-4-ç”Ÿæˆkube-proxy-kubeconfigæ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level4">8.13.3.4.ç”Ÿæˆkube-proxy.kubeconfigæ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-3-5-systemdç®¡ç†kube-proxy" class="router-link-active router-link-exact-active toc-link level4">8.13.3.5.systemdç®¡ç†kube-proxy</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-12-3-6-å¯åŠ¨kube-proxyå¹¶è®¾ç½®å¼€æœºè‡ªå¯" class="router-link-active router-link-exact-active toc-link level4">8.12.3.6.å¯åŠ¨kube-proxyå¹¶è®¾ç½®å¼€æœºè‡ªå¯</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-4-éƒ¨ç½²ç½‘ç»œç»„ä»¶-calico" class="router-link-active router-link-exact-active toc-link level3">8.13.4.éƒ¨ç½²ç½‘ç»œç»„ä»¶(Calico)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-13-5-æˆæƒapiserverè®¿é—®kubelet" class="router-link-active router-link-exact-active toc-link level3">8.13.5.æˆæƒapiserverè®¿é—®kubelet</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-å¢åŠ worker-node" class="router-link-active router-link-exact-active toc-link level2">8.14.å¢åŠ Worker Node</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-1-åœ¨æ‰€æœ‰worker-nodeåˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.14.1.åœ¨æ‰€æœ‰Worker Nodeåˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-2æ‹·è´master-node1ä¸Šéƒ¨ç½²å¥½çš„æ–‡ä»¶åˆ°worker-node" class="router-link-active router-link-exact-active toc-link level3">8.14.2æ‹·è´Master Node1ä¸Šéƒ¨ç½²å¥½çš„æ–‡ä»¶åˆ°Worker Node</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-3-åˆ é™¤æ‰€æœ‰worker-nodeä¸­kubeletè¯ä¹¦å’Œkubeconfigæ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.14.3.åˆ é™¤æ‰€æœ‰Worker Nodeä¸­kubeletè¯ä¹¦å’Œkubeconfigæ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-4-ä¿®æ”¹worker-node1å’Œworker-node2ä¸»æœºå" class="router-link-active router-link-exact-active toc-link level3">8.14.4. ä¿®æ”¹Worker Node1å’ŒWorker Node2ä¸»æœºå</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-5-å¯åŠ¨worker-node1å’Œworker-node2ä¸­kubeletå¹¶è®¾ç½®å¼€æœºè‡ªå¯" class="router-link-active router-link-exact-active toc-link level3">8.14.5.å¯åŠ¨Worker Node1å’ŒWorker Node2ä¸­kubeletå¹¶è®¾ç½®å¼€æœºè‡ªå¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-6-åœ¨master1ä¸ŠåŒæ„æ–°çš„node-kubeletè¯ä¹¦ç”³è¯·" class="router-link-active router-link-exact-active toc-link level3">8.14.6.åœ¨Master1ä¸ŠåŒæ„æ–°çš„Node kubeletè¯ä¹¦ç”³è¯·</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-7-åœ¨master1ä¸Šéƒ¨ç½²kubernetes-dashboard" class="router-link-active router-link-exact-active toc-link level3">8.14.7.åœ¨Master1ä¸Šéƒ¨ç½²kubernetes-dashboard</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-14-8-åœ¨master1ä¸Šéƒ¨ç½²coredns" class="router-link-active router-link-exact-active toc-link level3">8.14.8.åœ¨Master1ä¸Šéƒ¨ç½²CoreDNS</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-15-å¢åŠ master2èŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level2">8.15.å¢åŠ Master2èŠ‚ç‚¹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-15-1-kubernetesé›†ç¾¤æ¶æ„ç®€ä»‹" class="router-link-active router-link-exact-active toc-link level3">8.15.1.Kubernetesé›†ç¾¤æ¶æ„ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-15-2-ç»™master-node2å®‰è£…docker" class="router-link-active router-link-exact-active toc-link level3">8.15.2.ç»™Master Node2å®‰è£…Docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-15-5-ç»™master-node2èŠ‚ç‚¹æ‹·è´æ‰€æœ‰éœ€è¦çš„è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">8.15.5.ç»™Master Node2èŠ‚ç‚¹æ‹·è´æ‰€æœ‰éœ€è¦çš„è¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-15-6-å¯åŠ¨masteræ‰€æœ‰æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯" class="router-link-active router-link-exact-active toc-link level3">8.15.6.å¯åŠ¨Masteræ‰€æœ‰æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-15-7-åœ¨masteræŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€" class="router-link-active router-link-exact-active toc-link level3">8.15.7.åœ¨MasteræŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-15-8-å®¡æ‰¹æ‰€æœ‰worker-nodeä¸Šçš„kubeletè¯ä¹¦ç”³è¯·" class="router-link-active router-link-exact-active toc-link level3">8.15.8.å®¡æ‰¹æ‰€æœ‰Worker  Nodeä¸Šçš„kubeletè¯ä¹¦ç”³è¯·</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-éƒ¨ç½²nginx-keepalivedé«˜å¯ç”¨è´Ÿè½½å‡è¡¡å™¨" class="router-link-active router-link-exact-active toc-link level2">8.16.éƒ¨ç½²Nginx+Keepalivedé«˜å¯ç”¨è´Ÿè½½å‡è¡¡å™¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-1-nginxå’Œkeepalivedç®€ä»‹" class="router-link-active router-link-exact-active toc-link level3">8.16.1.Nginxå’ŒKeepalivedç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-2-åœ¨ä¸¤å°master-nodeä¸Šå®‰è£…è½¯ä»¶" class="router-link-active router-link-exact-active toc-link level3">8.16.2.åœ¨ä¸¤å°Master Nodeä¸Šå®‰è£…è½¯ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-3-nginxå¢åŠ steamæ¨¡å—" class="router-link-active router-link-exact-active toc-link level3">8.16.3.Nginxå¢åŠ Steamæ¨¡å—</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-3-1-æŸ¥çœ‹nginxç‰ˆæœ¬æ¨¡å—" class="router-link-active router-link-exact-active toc-link level4">8.16.3.1.æŸ¥çœ‹Nginxç‰ˆæœ¬æ¨¡å—</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-3-2-master1å’Œmaster2å®‰è£…streamæ¨¡å—" class="router-link-active router-link-exact-active toc-link level4">8.16.3.2.Master1å’ŒMaster2å®‰è£…Streamæ¨¡å—</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-4-å¯åŠ¨nginxã€keepalivedå¹¶è®¾ç½®å¼€æœºè‡ªå¯-master1-master2" class="router-link-active router-link-exact-active toc-link level3">8.16.4.å¯åŠ¨nginxã€keepalivedå¹¶è®¾ç½®å¼€æœºè‡ªå¯(master1/master2)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-5-æŸ¥çœ‹keepalivedå·¥ä½œçŠ¶æ€" class="router-link-active router-link-exact-active toc-link level3">8.16.5.æŸ¥çœ‹keepalivedå·¥ä½œçŠ¶æ€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-6-nginx-keepalivedé«˜å¯ç”¨æµ‹è¯•" class="router-link-active router-link-exact-active toc-link level3">8.16.6.Nginx+keepalivedé«˜å¯ç”¨æµ‹è¯•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-7-æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨" class="router-link-active router-link-exact-active toc-link level3">8.16.7.æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-16-8-ä¿®æ”¹æ‰€æœ‰çš„worker-nodeè¿æ¥lb-vip" class="router-link-active router-link-exact-active toc-link level3">8.16.8.ä¿®æ”¹æ‰€æœ‰çš„Worker Nodeè¿æ¥LB VIP</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-17-éƒ¨ç½²å¸¸è§é—®é¢˜" class="router-link-active router-link-exact-active toc-link level2">8.17.éƒ¨ç½²å¸¸è§é—®é¢˜</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-17-1ç³»ç»Ÿæ–­ç”µå-æŸä¸ªetcdèŠ‚ç‚¹æ— æ³•å¯åŠ¨" class="router-link-active router-link-exact-active toc-link level3">8.17.1ç³»ç»Ÿæ–­ç”µå,æŸä¸ªetcdèŠ‚ç‚¹æ— æ³•å¯åŠ¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-17-2-the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port" class="router-link-active router-link-exact-active toc-link level3">8.17.2 The connection to the server localhost:8080 was refused - did you specify the right host or port?</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/environment/centos/centos7/centos7.html#_8-18-éƒ¨ç½²æµ‹è¯•ç¨‹åº" class="router-link-active router-link-exact-active toc-link level2">8.18.éƒ¨ç½²æµ‹è¯•ç¨‹åº</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><div><iframe src="/banner/particles/particles.html" width="100%" height="400rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h1 id="intro" tabindex="-1"><a class="header-anchor" href="#intro" aria-hidden="true">#</a> åšå®¢å†…å®¹ä»‹ç»</h1><h2 id="åšå®¢å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#åšå®¢å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> åšå®¢å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç¯‡åšå®¢æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 1.å®‰è£…Linuxæ“ä½œç³»ç»Ÿ
 2.Linuxæ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®
 3.æ­å»ºåŸºç¡€å¼€å‘ç¯å¢ƒ
 4.Centosæ­å»ºdocker
 5.Centosæ­å»ºRancher
 6.Centosæ­å»ºMinikube
 7.kubeadmæ­å»ºKubernetes
 8.äºŒè¿›åˆ¶åŒ…æ­å»ºKubernetes
å…·ä½“æ¯ä¸ªç« èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢åšå®¢å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œåšå®¢å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="åšå®¢å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#åšå®¢å†…å®¹å¤§çº²" aria-hidden="true">#</a> åšå®¢å†…å®¹å¤§çº²</h2><h3 id="ç®€å•ç‰ˆåšå®¢å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#ç®€å•ç‰ˆåšå®¢å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/centos7-outline2.html" target="_blank">ç®€å•ç‰ˆåšå®¢å†…å®¹å¤§çº²</a></h3><div><iframe src="/enhance/markmap/environment/centos/centos7/centos7-outline2.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><blockquote></blockquote><h3 id="è¯¦ç»†ç‰ˆåšå®¢å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#è¯¦ç»†ç‰ˆåšå®¢å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/centos7-outline3.html" target="_blank">è¯¦ç»†ç‰ˆåšå®¢å†…å®¹å¤§çº²</a></h3><div><iframe src="/enhance/markmap/environment/centos/centos7/centos7-outline3.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><blockquote></blockquote><h1 id="1." tabindex="-1"><a class="header-anchor" href="#1." aria-hidden="true">#</a> 1.å®‰è£…Linuxæ“ä½œç³»ç»Ÿ</h1><h2 id="_1-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_1-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> 1.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 1.1.ç« èŠ‚å†…å®¹æ¦‚è¿°
 1.2.ç« èŠ‚å†…å®¹å¤§çº²
 1.3.Linuxé‡è¦ç›®å½•ä»‹ç»
 1.4.Centosé•œåƒä¸‹è½½
 1.5.å®‰è£…å‰Vmawareç›¸å…³è®¾ç½®
 1.6.å®‰è£…æ—¶åˆ†åŒºå¤§å°è®¾ç½®
å…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="_1-2-ç« èŠ‚å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#_1-2-ç« èŠ‚å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter1.html" target="_blank">1.2.ç« èŠ‚å†…å®¹å¤§çº²</a></h2><div><iframe src="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter1.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h2 id="_1-3-linuxé‡è¦ç›®å½•ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-3-linuxé‡è¦ç›®å½•ä»‹ç»" aria-hidden="true">#</a> 1.3.Linuxé‡è¦ç›®å½•ä»‹ç»</h2><pre><code>/usr â†’ C:/Windows/ /*ç³»ç»Ÿçº§çš„ç›®å½•
/usr/lib â†’ C:/Windows/System32
/usr/local â†’ C:/Progrem Files/ /*ç”¨æˆ·çº§çš„ç¨‹åºç›®å½•ï¼Œç”¨æˆ·è‡ªå·±ç¼–è¯‘çš„è½¯ä»¶é»˜è®¤ä¼šå®‰è£…åˆ°è¿™ä¸ªç›®å½•ä¸‹
/opt â†’ D:/Software /*é¢å¤–å®‰è£…çš„å¯é€‰åº”ç”¨ç¨‹åºåŒ…æ‰€æ”¾ç½®çš„ä½ç½®ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠtomcatç­‰éƒ½å®‰è£…åˆ°è¿™é‡Œã€‚
/usr/src /*ç³»ç»Ÿçº§çš„æºç ç›®å½•ï¼Œlinuxå†…æ ¸çš„æºä»£ç å°±æ”¾åœ¨/usr/src/linuxé‡Œã€‚
/home å­˜æ”¾æ‰€æœ‰ç”¨æˆ·æ–‡ä»¶çš„æ ¹ç›®å½•ï¼Œæ˜¯ç”¨æˆ·ä¸»ç›®å½•çš„åŸºç‚¹ï¼Œæ¯”å¦‚ç”¨æˆ·userçš„ä¸»ç›®å½•å°±æ˜¯/home/userï¼Œå¯ä»¥ç”¨~userè¡¨ç¤º
/root è¶…çº§ç”¨æˆ·ï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰çš„ä¸»ç›®å½•ï¼ˆç‰¹æƒé˜¶çº§^o^ï¼‰
/mnt ç³»ç»Ÿç®¡ç†å‘˜å®‰è£…ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ç‚¹ï¼Œç³»ç»Ÿæä¾›è¿™ä¸ªç›®å½•æ˜¯è®©ç”¨æˆ·ä¸´æ—¶æŒ‚è½½å…¶ä»–çš„æ–‡ä»¶ç³»ç»Ÿã€‚
/boot å­˜æ”¾ç”¨äºç³»ç»Ÿå¼•å¯¼æ—¶ä½¿ç”¨çš„å„ç§æ–‡ä»¶
/tmp ç”¨äºå­˜æ”¾å„ç§ä¸´æ—¶æ–‡ä»¶ï¼Œæ˜¯å…¬ç”¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç‚¹ã€‚
/var å­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚å„ç§æœåŠ¡çš„æ—¥å¿—æ–‡ä»¶ã€‚
</code></pre><h2 id="_1-4-centosé•œåƒä¸‹è½½" tabindex="-1"><a class="header-anchor" href="#_1-4-centosé•œåƒä¸‹è½½" aria-hidden="true">#</a> 1.4.Centosé•œåƒä¸‹è½½</h2><pre><code>å¦‚æœæ˜¯å­¦ä¹ ç¯å¢ƒï¼Œå»ºè®®å®‰è£…centos miniç‰ˆé•œåƒï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥å®‰è£…å®Œæ•´   

ä¸‹è½½åœ°å€
</code></pre><p><a href="http://ftp.sjtu.edu.cn/centos/">xxx</a></p><h2 id="_1-5-å®‰è£…å‰vmawareç›¸å…³è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_1-5-å®‰è£…å‰vmawareç›¸å…³è®¾ç½®" aria-hidden="true">#</a> 1.5.å®‰è£…å‰Vmawareç›¸å…³è®¾ç½®</h2><pre><code>è™šæ‹Ÿæœºè”ç½‘è®¾ç½®
å¯¼èˆªæ -&gt;ç¼–è¾‘-&gt;è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨-&gt;VMnet8NATæ¨¡å¼-&gt;æ›´æ”¹è®¾ç½®-&gt;VMnet8NATæ¨¡å¼
	-&gt;æ›´æ”¹åº•éƒ¨å­ç½‘:192.168.0.0ï¼Œå­ç½‘æ©ç :255.255.255.0-&gt;NATè®¾ç½®-&gt;ç½‘å…³IP:192.168.0.2   

Vmwareç½‘å¡è¯´æ˜  
VMnet0ï¼šç”¨äºè™šæ‹Ÿæ¡¥æ¥ç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœº
VMnet1ï¼šç”¨äºè™šæ‹ŸHost-Onlyç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœº
VMnet8ï¼šç”¨äºè™šæ‹ŸNATç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœº
VMware NetworkAdepter VMnet1ï¼šHostç”¨äºä¸Host-Onlyè™šæ‹Ÿç½‘ç»œè¿›è¡Œé€šä¿¡çš„è™šæ‹Ÿç½‘å¡
VMware NetworkAdepter VMnet8ï¼šHostç”¨äºä¸NATè™šæ‹Ÿç½‘ç»œè¿›è¡Œé€šä¿¡çš„è™šæ‹Ÿç½‘å¡
</code></pre><h2 id="_1-6-å®‰è£…æ—¶åˆ†åŒºå¤§å°è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_1-6-å®‰è£…æ—¶åˆ†åŒºå¤§å°è®¾ç½®" aria-hidden="true">#</a> 1.6.å®‰è£…æ—¶åˆ†åŒºå¤§å°è®¾ç½®</h2><pre><code>/boot	/*å­˜æ”¾ç³»ç»Ÿå¯åŠ¨å¼•å¯¼æ–‡ä»¶ï¼Œå»ºè®®å¤§å°ï¼š512mb
/swap 	/*äº¤æ¢åŒºï¼Œå»ºè®®å¤§å°ï¼š2g
/*ä¸»åˆ†åŒºï¼Œå‰©ä¸‹çš„ç©ºé—´å…¨éƒ¨åˆ†ç»™è¿™ä¸ªåˆ†åŒº
</code></pre><h1 id="2." tabindex="-1"><a class="header-anchor" href="#2." aria-hidden="true">#</a> 2.Linuxæ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®</h1><h2 id="_2-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_2-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> 2.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 2.1.ç« èŠ‚å†…å®¹æ¦‚è¿°
 2.2.ç« èŠ‚å†…å®¹å¤§çº²
 2.3.é…ç½®é™æ€IPåœ°å€
 2.4.è§£å†³è¿œç¨‹è¿æ¥æ— æ³•è¿æ¥çš„é—®é¢˜
 2.5.è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡
 2.6.å®‰è£…curl
 2.7.é…ç½®ymlæº
 2.8.å®‰è£…å¸¸ç”¨åŸºç¡€ç³»ç»Ÿè½¯ä»¶
å…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="_2-2-ç« èŠ‚å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#_2-2-ç« èŠ‚å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter2.html" target="_blank">2.2.ç« èŠ‚å†…å®¹å¤§çº²</a></h2><div><iframe src="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter2.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h2 id="_2-3-é…ç½®é™æ€ipåœ°å€" tabindex="-1"><a class="header-anchor" href="#_2-3-é…ç½®é™æ€ipåœ°å€" aria-hidden="true">#</a> 2.3.é…ç½®é™æ€IPåœ°å€</h2><pre><code>ä¿®æ”¹ç½‘ç»œé…ç½®	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /etc/sysconfig/network-scripts/ifcfg-ens32(æœ€åä¸€ä¸ªä¸ºç½‘å¡åç§°)	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹åå†…å®¹å¦‚ä¸‹
bootproto=static
onboot=yes
#åœ¨æœ€ååŠ ä¸Šå‡ è¡Œï¼ŒIPåœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³ã€dnsæœåŠ¡å™¨ï¼Œæ³¨æ„ï¼šå’Œç½‘å…³IPå¤„äºåŒä¸€ä¸ªç½‘æ®µ
IPADDR=192.168.0.4
NETMASK=255.255.255.0
#å’Œä¸Šé¢ç½‘å…³IPä¿æŒ ä¸€è‡´
GATEWAY=192.168.0.2
DNS1=8.8.8.8
DNS2=8.8.4.4   

é‡å¯ç½‘ç»œ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl restart network
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-4-è§£å†³è¿œç¨‹è¿æ¥æ— æ³•è¿æ¥çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-4-è§£å†³è¿œç¨‹è¿æ¥æ— æ³•è¿æ¥çš„é—®é¢˜" aria-hidden="true">#</a> 2.4.è§£å†³è¿œç¨‹è¿æ¥æ— æ³•è¿æ¥çš„é—®é¢˜</h2><pre><code>ä¿®æ”¹sshdé…ç½®æ–‡ä»¶
è¯´æ˜ï¼šsshd_configé‡Œé¢çš„UseDNS=noã€åŸæœ¬ä¸ºyesã€‘
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim /etc/ssh/sshd_config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é‡å¯sshæœåŠ¡
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl restart sshd.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-5-è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#_2-5-è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡" aria-hidden="true">#</a> 2.5.è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>echo <span class="token string">&quot;export LC_ALL=en_US.UTF-8&quot;</span>  <span class="token operator">&gt;&gt;</span>  <span class="token operator">/</span>etc<span class="token operator">/</span>profile <span class="token operator">&amp;&amp;</span>
source <span class="token operator">/</span>etc<span class="token operator">/</span>profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-6-å®‰è£…curl" tabindex="-1"><a class="header-anchor" href="#_2-6-å®‰è£…curl" aria-hidden="true">#</a> 2.6.å®‰è£…curl</h2><pre><code>åé¢çš„æ“ä½œéœ€è¦curlï¼Œæ‰€ä»¥é¦–å…ˆå®‰è£…curl
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install curl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-7-é…ç½®ymlæº" tabindex="-1"><a class="header-anchor" href="#_2-7-é…ç½®ymlæº" aria-hidden="true">#</a> 2.7.é…ç½®ymlæº</h2><pre><code>ä¸‹è½½é˜¿é‡Œæºï¼Œå¹¶ä¸Šä¼ åˆ°/opt/software/package
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl http://mirrors.aliyun.com/repo/Centos-7.repo -o Centos-7.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è¿›å…¥/etc/yum.repos.dç›®å½•ä¸­ï¼Œå¤‡ä»½CentOS-Base.repo
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /etc/yum.repos.d &amp;&amp; cp CentOS-Base.repo CentOS-Base.repo.bak
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¤åˆ¶/opt/software/package/Centos-7.repoåˆ°å½“å‰ç›®å½•å¹¶é‡å‘½åä¸ºCentOS-Base.repo
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp /opt/software/package/Centos-7.repo /CentOS-Base.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç”Ÿæˆyumæºç¼“å­˜å¹¶æ›´æ–°yumæº
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum makecache &amp;&amp; yum update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-8-å®‰è£…å¸¸ç”¨åŸºç¡€ç³»ç»Ÿè½¯ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-8-å®‰è£…å¸¸ç”¨åŸºç¡€ç³»ç»Ÿè½¯ä»¶" aria-hidden="true">#</a> 2.8.å®‰è£…å¸¸ç”¨åŸºç¡€ç³»ç»Ÿè½¯ä»¶</h2><h3 id="_2-8-1-æ‰‹åŠ¨å®‰è£…å¸¸ç”¨è½¯ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-8-1-æ‰‹åŠ¨å®‰è£…å¸¸ç”¨è½¯ä»¶" aria-hidden="true">#</a> 2.8.1.æ‰‹åŠ¨å®‰è£…å¸¸ç”¨è½¯ä»¶</h3><p><strong>vim</strong></p><pre><code>å®‰è£…vim
</code></pre><p><code>yum -y install vim*</code></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install vim*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é…ç½®vim	
set nu         # è®¾ç½®æ˜¾ç¤ºè¡Œå·
set showmode   #è®¾ç½®åœ¨å‘½ä»¤è¡Œç•Œé¢æœ€ä¸‹é¢æ˜¾ç¤ºå½“å‰æ¨¡å¼ç­‰
set ruler      #åœ¨å³ä¸‹è§’æ˜¾ç¤ºå…‰æ ‡æ‰€åœ¨çš„è¡Œæ•°ç­‰ä¿¡æ¯
set autoindent #è®¾ç½®æ¯æ¬¡å•å‡»Enteré”®åï¼Œå…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œæ—¶ä¸ä¸Šä¸€è¡Œçš„èµ·å§‹å­—ç¬¦å¯¹é½
syntax on      #å³è®¾ç½®è¯­æ³•æ£€æµ‹ï¼Œå½“ç¼–è¾‘Cæˆ–è€…Shellè„šæœ¬æ—¶ï¼Œå…³é”®å­—ä¼šç”¨ç‰¹æ®Šé¢œè‰²æ˜¾ç¤º		
</code></pre><p><strong>wget</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install wget
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>telnet</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install telnet
yum -y install telnet-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>git</strong></p><pre><code>å¸è½½æ—§ç‰ˆæœ¬	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum remove git
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£… yum æºçš„ Git ç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum install -y git
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹ç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>git version 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-8-2-ä½¿ç”¨è„šæœ¬å®‰è£…å¸¸ç”¨è½¯ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-8-2-ä½¿ç”¨è„šæœ¬å®‰è£…å¸¸ç”¨è½¯ä»¶" aria-hidden="true">#</a> 2.8.2.ä½¿ç”¨è„šæœ¬å®‰è£…å¸¸ç”¨è½¯ä»¶</h3><pre><code>è„šæœ¬ä»‹ç»
è¿™ä¸ªè„šæœ¬ä¸­åŒ…å«äº†centosè®¾ç½®yumæºå¹¶ä¸”å®‰è£…äº†ä¸€äº›çš„å¸¸ç”¨è½¯ä»¶ï¼Œå¦‚vimã€gitã€wgetã€curlã€ç­‰ï¼Œä¼šå®šæ—¶æ›´æ–°

å®‰è£…curl
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install curl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä¸‹è½½è„šæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl https://gitee.com/lingwh1995/config-center/raw/master/centos/centos-init.sh -o centos-init.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>èµ‹äºˆå¯è¿è¡Œæƒé™å¹¶è¿è¡Œè¯¥è„šæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>chmod +x centos-init.sh &amp;&amp;
./centos-init.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="3." tabindex="-1"><a class="header-anchor" href="#3." aria-hidden="true">#</a> 3.æ­å»ºåŸºç¡€å¼€å‘ç¯å¢ƒ</h1><h2 id="_3-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_3-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> 3.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 3.1.ç« èŠ‚å†…å®¹æ¦‚è¿°
 3.2.ç« èŠ‚å†…å®¹å¤§çº²
 3.3.å®‰è£…jdk
 3.4.å®‰è£…maven
 3.5.å®‰è£…mysql
å…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="_3-2-ç« èŠ‚å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#_3-2-ç« èŠ‚å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter3.html" target="_blank">3.2.ç« èŠ‚å†…å®¹å¤§çº²</a></h2><div><iframe src="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter3.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h2 id="_3-3-å®‰è£…jdk" tabindex="-1"><a class="header-anchor" href="#_3-3-å®‰è£…jdk" aria-hidden="true">#</a> 3.3.å®‰è£…jdk</h2><pre><code>æŸ¥çœ‹å½“å‰å®‰è£…çš„javaç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum list installed | grep java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¸è½½æ—§ç‰ˆæœ¬jdk
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y remove xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆ›å»ºå­˜æ”¾å®‰è£…åŒ…çš„ç›®å½•-&gt;åˆ‡æ¢åˆ°è¯¥ç›®å½•-&gt;åœ¨è¯¥ç›®å½•ä¸­ä¸‹è½½jdk
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/software/package &amp;&amp;
cd /opt/software/package &amp;&amp;
curl -fL -u software-1659088335906:c2e556a8a52386cbe0c6361ee3a7d8a21d3c9ca0 \
&quot;https://lingwh-generic.pkg.coding.net/coding-drive/software/jdk-8u181-linux-x64.tar.gz?\
version=latest&quot; -o jdk-8u181-linux-x64.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>è§£å‹jdkåèµ‹äºˆæƒé™å¹¶æ”¾å…¥æŒ‡å®šç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tar -zxvf jdk-8u181-linux-x64.tar.gz &amp;&amp;
chmod +x jdk1.8.0_181
mv jdk1.8.0_181 /usr/local/bin/jdk1.8.0_181
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®ç¯å¢ƒå˜é‡
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ·»åŠ å¦‚ä¸‹å†…å®¹
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>export JAVA_HOME=/usr/local/bin/jdk1.8.0_181
export JRE_HOME=${JAVA_HOME}/jre
export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib
export PATH=${JAVA_HOME}/bin:$PATH
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ·æ–°ç¯å¢ƒå˜é‡æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>source /etc/profile	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹javaç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>java -version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_3-4-å®‰è£…maven" tabindex="-1"><a class="header-anchor" href="#_3-4-å®‰è£…maven" aria-hidden="true">#</a> 3.4.å®‰è£…maven</h2><pre><code>æ³¨æ„
maven linuxç‰ˆå’Œwindowsç‰ˆå¹¶ä¸é€šç”¨

åˆ›å»ºå­˜æ”¾å®‰è£…åŒ…çš„ç›®å½•-&gt;å¹¶åˆ‡æ¢åˆ°è¯¥ç›®å½•-&gt;åœ¨è¯¥ç›®å½•ä¸­ä¸‹è½½maven
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/software/package &amp;&amp;
cd /opt/software/package &amp;&amp;
curl -fL -u software-1659088796431:ba211676fbe4a719c3b40b22083cd70388d41acc \
&quot;https://lingwh-generic.pkg.coding.net/coding-drive/software/apache-maven-3.8.6-bin.tar.gz\
?version=latest&quot; -o apache-maven-3.8.6-bin.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>è§£å‹åˆ°/usr/local/bin/ç›®å½•ä¸‹
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tar -zxvf apache-maven-3.8.6-bin.tar.gz -C /usr/local/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é…ç½®ç¯å¢ƒå˜é‡	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim  /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ·»åŠ å¦‚ä¸‹å†…å®¹
æ³¨æ„äº‹é¡¹
ä¸è¦ä¿®æ”¹åŸæ¥çš„pathï¼Œç›´æ¥åœ¨ä¸‹é¢æ·»åŠ æ–°çš„PATHé…ç½®ï¼Œä½¿ç”¨$PATHå¼•ç”¨ä¸Šé¢çš„PATH
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>export M2_HOME=/usr/local/bin/apache-maven-3.8.6
export PATH=$PATH:$M2_HOME/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ·æ–°é…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>source /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹mavenç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mvn -v
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹mavençš„settings.xmlï¼Œä»“åº“æº&lt;mirrors&gt;&lt;/mirrors&gt;ä¸­æ·»åŠ å¦‚ä¸‹ä¿¡æ¯:
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim /usr/local/bin/apache-maven-3.8.6/conf/settings.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;mirror&gt;
	&lt;id&gt;alimaven&lt;/id&gt;
	&lt;name&gt;aliyun maven&lt;/name&gt;
	&lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;
	&lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
&lt;/mirror&gt;	
&lt;mirror&gt;
	&lt;id&gt;repo2&lt;/id&gt;
	&lt;name&gt;Mirror from Maven Repo2&lt;/name&gt;
	&lt;url&gt;http://repo2.maven.org/maven2/&lt;/url&gt;
	&lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
&lt;/mirror&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-5-å®‰è£…mysql" tabindex="-1"><a class="header-anchor" href="#_3-5-å®‰è£…mysql" aria-hidden="true">#</a> 3.5.å®‰è£…mysql</h2><pre><code>å®‰è£…å»ºè®®
ä½¿ç”¨mysqlå®˜æ–¹yumæºåœ¨çº¿å®‰è£…(ä¸è¦ä½¿ç”¨rpmæ–¹å¼å®‰è£…ï¼Œéå¸¸éš¾ä»¥å®‰è£…æˆåŠŸ)

æŸ¥çœ‹å½“å‰å®‰è£…çš„mysqlç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum list installed | grep mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æˆ–
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rpm -qa | grep mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¸è½½æ—§ç‰ˆæœ¬mysql
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y remove xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>Centosç»ˆç«¯è·å–yumæºå®‰è£…åŒ…ï¼š
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/software/package &amp;&amp;
wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å®‰è£…mysqlçš„yumæºï¼šï¼ˆäºŒé€‰ä¸€ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rpm -Uvh mysql80-community-release-el7-3.noarch.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rpm -ivh mysql80-community-release-el7-3.noarch.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹åˆšæ‰ä¸‹è½½çš„mysqlå®‰è£…æºï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢çš„ä¸¤ä¸ªmysqlæº
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ls /etc/yum.repos.d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@localhost package]# ls /etc/yum.repos.d
CentOS-Base.repo      CentOS-Debuginfo.repo  CentOS-Vault.repo          mysql-community-source.repo
CentOS-Base.repo.bak  CentOS-Media.repo      CentOS-fasttrack.repo      mysql-community.repo
CentOS-CR.repo        CentOS-Sources.repo    CentOS-x86_64-kernel.repo

ä¿®æ”¹æºä¸­çš„é…ç½®ï¼Œå°†æ‰€æœ‰çš„gpgkeyçš„å€¼ä¿®æ”¹ä¸ºhttps://repo.mysql.com/RPM-GPG-KEY-mysql-2022
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s#file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql#https://repo.mysql.com/\
RPM-GPG-KEY-mysql-2022#g&#39; /etc/yum.repos.d/mysql-community.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨yumåœ¨çº¿å®‰è£…mysql
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install mysql-community-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨mysql-server
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl start mysqld.service &amp;&amp;
systemctl enable mysqld.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹mysql-serverå¯åŠ¨çŠ¶æ€ï¼š
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status mysqld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆå§‹åŒ–mysql
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mysqld --initialize
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹mysql8ç™»å½•å¯†ç 
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/mysqld.log | grep &#39;temporary password&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š
2022-07-18T18:31:57.277661Z 6 [Note] [MY-010454] [Server]
	A temporary password is generated for root@localhost: %)4(26e++jaK
</code></pre><p>ç™»å½•mysql</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mysql -uroot -p&#39;%)4(26e++jaK&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹mysqlåˆå§‹å¯†ç ï¼Œè§„åˆ™å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šç¬¦å·ï¼Œæœ€å°‘8ä½
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ALTER USER USER() IDENTIFIED BY &#39;Mysql123456_&#39;;
FLUSH PRIVILEGES;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æ‰©å±•æˆ–è€…æ·»åŠ è¿œç¨‹ç”¨æˆ·æƒé™:
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>use mysql;	
update user set host=&#39;%&#39; where user=&#39;root&#39;;
flush privileges;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="4." tabindex="-1"><a class="header-anchor" href="#4." aria-hidden="true">#</a> 4.Centosæ­å»ºdocker</h1><h2 id="_4-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_4-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> 4.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 4.1.ç« èŠ‚å†…å®¹æ¦‚è¿°
 4.2.ç« èŠ‚å†…å®¹å¤§çº²
 4.3.å®‰è£…docker
 4.4.dockerå¯åŠ¨æ•…éšœè§£å†³		
 4.5.dockerå®¹å™¨å¯è§†åŒ–	
 4.6.æ­å»ºdockeç§æœ
 4.6.3.æ­å»ºharborç§æœ
 4.7.dockerå®˜æ–¹ç§æœå¯è§†åŒ–
 4.8.åˆ¶ä½œdockeré•œåƒå¹¶ä¸Šä¼ åˆ°ç§æœ
 4.9.Dockerä¸­å®‰è£…å¸¸ç”¨è½¯ä»¶
å…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="_4-2-ç« èŠ‚å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#_4-2-ç« èŠ‚å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter4.html" target="_blank">4.2.ç« èŠ‚å†…å®¹å¤§çº²</a></h2><div><iframe src="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter4.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h2 id="_4-3-å®‰è£…docker" tabindex="-1"><a class="header-anchor" href="#_4-3-å®‰è£…docker" aria-hidden="true">#</a> 4.3.å®‰è£…docker</h2><h3 id="_4-3-1-åœ¨çº¿å®‰è£…docker" tabindex="-1"><a class="header-anchor" href="#_4-3-1-åœ¨çº¿å®‰è£…docker" aria-hidden="true">#</a> 4.3.1.åœ¨çº¿å®‰è£…docker</h3><pre><code>ä»¥rootèº«ä»½æ›´æ–°yumï¼Œå°†yumåŒ…æ›´æ–°åˆ°æœ€æ–°
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å½“å‰å®‰è£…çš„dockerç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum list installed | grep docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>containerd.io.x86_64 	           1.6.6-3.1.el7                  @docker-ce-stable				
docker-ce.x86_64                   3:20.10.17-3.el7               @docker-ce-stable
docker-ce-cli.x86_64               1:20.10.17-3.el7               @docker-ce-stable
docker-ce-rootless-extras.x86_64   20.10.17-3.el7                 @docker-ce-stable
docker-scan-plugin.x86_64          0.17.0-3.el7                   @docker-ce-stable

å¸è½½æ—§ç‰ˆæœ¬docker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y remove docker-ce.x86_64
yum -y remove docker-scan-plugin.x86_64
yum -y remove docker-ce-cli.x86_64
yum -y remove docker-ce-rootless-extras.x86_64_64
yum -y remove containerd.io.x86_64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum install -y yum-utils device-mapper-persistent-data lvm2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é…ç½®ä½¿ç”¨é˜¿é‡Œçš„yumæº
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹é˜¿é‡Œäº‘ä»“åº“ä¸­æ‰€æœ‰dockerç‰ˆæœ¬ï¼Œå¹¶é€‰æ‹©ç‰¹å®šç‰ˆæœ¬å®‰è£…
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum list docker-ce --showduplicates | sort -r
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£…æœ€æ–°ç‰ˆæœ¬docker-ce(dockerç¤¾åŒºã€eeä¼ä¸šç‰ˆ ceä¸ºç¤¾åŒºç‰ˆ)
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install docker-ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å®‰è£…çš„dockerç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç»™dockeré…ç½®å›½å†…é•œåƒæº
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo mkdir -p /etc/docker &amp;&amp;
sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;
{
    &quot;registry-mirrors&quot;: [
        &quot;https://5pfmrxk8.mirror.aliyuncs.com&quot;,
        &quot;http://hub-mirror.c.163.com&quot;,
        &quot;https://docker.mirrors.ustc.edu.cn&quot;,
        &quot;https://registry.docker-cn.com&quot;
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>daemon.jsoné…ç½®è¯´æ˜
registry-mirrorsï¼šdockerå›½å†…é•œåƒæºåœ°å€

åˆ·æ–°daemon.jsoné…ç½®å¯åŠ¨dockerå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start docker &amp;&amp;
systemctl enable docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœæ’æŸ¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æµ‹è¯•docker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run hello-world
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£…æˆåŠŸåˆ™è¿”å›ä¸‹é¢ä¿¡æ¯
[root@localhost ~]# docker run hello-world
Unable to find image &#39;hello-world:latest&#39; locally
latest: Pulling from library/hello-world
2db29710123e: Pull complete 
Digest: sha256:2498fce14358aa50ead0cc6c19990fc6ff866ce72aeb5546e1d59caac3d0d60f
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
1. The Docker client contacted the Docker daemon.
2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
	(amd64)
3. The Docker daemon created a new container from that image which runs the
	executable that produces the output you are currently reading.
4. The Docker daemon streamed that output to the Docker client, which sent it
	to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
$ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
https://hub.docker.com/

For more examples and ideas, visit:
https://docs.docker.com/get-started/
</code></pre><h3 id="_4-3-2-äºŒè¿›åˆ¶åŒ…å®‰è£…docker" tabindex="-1"><a class="header-anchor" href="#_4-3-2-äºŒè¿›åˆ¶åŒ…å®‰è£…docker" aria-hidden="true">#</a> 4.3.2.äºŒè¿›åˆ¶åŒ…å®‰è£…docker</h3><pre><code>åˆ›å»ºå­˜æ”¾dockerå®‰è£…åŒ…çš„ç›®å½•-&gt;åˆ‡æ¢ç›®å½•-&gt;åœ¨è¯¥ç›®å½•ä¸­ä¸‹è½½dockeräºŒè¿›åˆ¶å®‰è£…åŒ…-&gt;è§£å‹åˆ°/usr/bin/
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p  /opt/software/package/ &amp;&amp;
cd /opt/software/package/ &amp;&amp;
curl -fL -u software-1659095503164:3316a6a052e6f17880d37a00d38454342aceffdf \
&quot;https://lingwh-generic.pkg.coding.net/coding-drive/software/docker-20.10.9.tgz?version=latest&quot; \
-o docker-20.10.9.tgz &amp;&amp;
tar -xf docker-20.10.9.tgz &amp;&amp; mv docker/* /usr/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®dockerç§æœ‰é•œåƒ	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo mkdir -p /etc/docker &amp;&amp;
sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;
{
    &quot;registry-mirrors&quot;: [
        &quot;https://5pfmrxk8.mirror.aliyuncs.com&quot;,
        &quot;http://hub-mirror.c.163.com&quot;,
        &quot;https://docker.mirrors.ustc.edu.cn&quot;,
        &quot;https://registry.docker-cn.com&quot;
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®docker.serviceæ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/docker.service &lt;&lt; EOF
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target firewalld.service
Wants=network-online.target
 
[Service]
Type=notify
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
LimitNOFILE=infinity
LimitNPROC=infinity
TimeoutStartSec=0
Delegate=yes
KillMode=process
Restart=on-failure
StartLimitBurst=3
StartLimitInterval=60s
 
[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ·æ–°é…ç½®æ–‡ä»¶åå¯åŠ¨ä¸‰å°æœºå™¨ä¸Šçš„dockerå¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start docker &amp;&amp;
systemctl enable docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœæ’æŸ¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æµ‹è¯•docker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run hello-world
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£…æˆåŠŸåˆ™è¿”å›ä¸‹é¢ä¿¡æ¯
[root@localhost ~]# docker run hello-world
Unable to find image &#39;hello-world:latest&#39; locally
latest: Pulling from library/hello-world
2db29710123e: Pull complete 
Digest: sha256:2498fce14358aa50ead0cc6c19990fc6ff866ce72aeb5546e1d59caac3d0d60f
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
1. The Docker client contacted the Docker daemon.
2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
	(amd64)
3. The Docker daemon created a new container from that image which runs the
	executable that produces the output you are currently reading.
4. The Docker daemon streamed that output to the Docker client, which sent it
	to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
$ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
https://hub.docker.com/

For more examples and ideas, visit:
https://docs.docker.com/get-started/
</code></pre><h2 id="_4-4-dockerå¯åŠ¨æ•…éšœè§£å†³" tabindex="-1"><a class="header-anchor" href="#_4-4-dockerå¯åŠ¨æ•…éšœè§£å†³" aria-hidden="true">#</a> 4.4.dockerå¯åŠ¨æ•…éšœè§£å†³</h2><pre><code>é”™è¯¯ä¿¡æ¯
Job for docker.service failed because the control process exited with error code. 
See &quot;systemctl status docker.service&quot; and &quot;journalctl -xe&quot; for details.

è§£å†³æ–¹å¼1ï¼šä½¿dockerä¸firewallå…±å­˜
å…³é—­docker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl stop docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è®¾ç½®firewallä¸æ‹¦æˆªdocker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>firewall-cmd --zone=trusted --remove-interface=docker0 --permanent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>firewall-cmd --reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é‡æ–°å¯åŠ¨é˜²ç«å¢™
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl restart firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é‡æ–°å¯åŠ¨docker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl restart docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è§£å†³æ–¹å¼2ï¼šæ£€æŸ¥daemon.jsoné…ç½®æ˜¯å¦æ­£ç¡®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /etc/docker/daemon.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>çœ‹é…ç½®çš„registry-mirrorsæ˜¯å¦æ­£ç¡®ï¼Œå¦‚ç§æœå‰æ˜¯å¦å¿˜è®°äº†åŠ http://
</code></pre><h2 id="_4-5-dockerå®¹å™¨å¯è§†åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-5-dockerå®¹å™¨å¯è§†åŒ–" aria-hidden="true">#</a> 4.5.dockerå®¹å™¨å¯è§†åŒ–</h2><pre><code>æŸ¥è¯¢å½“å‰æœ‰å“ªäº›portaineré•œåƒ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker search portainer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä¸‹è½½portaineré•œåƒ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker pull portainer/portainer:1.24.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨å•æœºç‰ˆportainer(é’ˆå¯¹å•æœºç‰ˆdocker)
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -d --name portainer \
	-p 9000:9000 \
	--restart=always \
	-v /var/run/docker.sock:/var/run/docker.sock \
	--privileged=true \
	portainer/portainer:1.24.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç™»å½•portainer
ç™»å½•åœ°å€ï¼šhttp://192.168.0.4:9000/
ç”¨æˆ·å/å¯†ç ï¼šadmin/portainer
å•æœºç‰ˆé€‰æ‹©localå³å¯
</code></pre><h2 id="_4-6-æ­å»ºdockeç§æœ" tabindex="-1"><a class="header-anchor" href="#_4-6-æ­å»ºdockeç§æœ" aria-hidden="true">#</a> 4.6.æ­å»ºdockeç§æœ</h2><h3 id="_4-6-1-æ­å»ºdockeå®˜æ–¹ç§æœ-ä¸å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#_4-6-1-æ­å»ºdockeå®˜æ–¹ç§æœ-ä¸å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒ" aria-hidden="true">#</a> 4.6.1.æ­å»ºdockeå®˜æ–¹ç§æœï¼ˆä¸å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒï¼‰</h3><pre><code>æ‹‰å–ä»“åº“é•œåƒ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker pull registry
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ³¨å†Œä»“åº“æœåŠ¡å™¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -d --name registry_official \
	-p 5000:5000 \
	--restart=always \
	-v /registry/public/repos:/var/lib/registry \
	--privileged=true \
	registry
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®ç§æœåœ°å€å’Œé•œåƒæºåœ°å€å¹¶ä¸”å°†ç§æœåœ°å€åŠ å…¥åˆ°é•œåƒæºåˆ—è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥ä»ç§æœä¸­æ‹‰å–é•œåƒäº†

ç»™dockeré…ç½®ç§æœ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim /etc/docker/daemon.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ·»åŠ å¦‚ä¸‹å†…å®¹
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
	&quot;insecure-registries&quot;:[&quot;192.168.0.4:5000&quot;,&quot;192.168.0.4:5001&quot;],
	&quot;registry-mirrors&quot;: [
			&quot;https://5pfmrxk8.mirror.aliyuncs.com&quot;,
			&quot;http://hub-mirror.c.163.com&quot;,
			&quot;https://docker.mirrors.ustc.edu.cn&quot;,
			&quot;https://registry.docker-cn.com&quot;,
			&quot;http://192.168.0.4:5000&quot;,
			&quot;http://192.168.0.4:5001&quot;
	]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æˆ–
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo mkdir -p /etc/docker &amp;&amp;
sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;
{
	&quot;insecure-registries&quot;:[&quot;192.168.0.4:5000&quot;,&quot;192.168.0.4:5001&quot;],
	&quot;registry-mirrors&quot;: [
			&quot;https://5pfmrxk8.mirror.aliyuncs.com&quot;,
			&quot;http://hub-mirror.c.163.com&quot;,
			&quot;https://docker.mirrors.ustc.edu.cn&quot;,
			&quot;https://registry.docker-cn.com&quot;,
			&quot;http://192.168.0.4:5000&quot;,
			&quot;http://192.168.0.4:5001&quot;
	]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>daemon.jsoné…ç½®è¯´æ˜
insecure-registriesï¼šdockerä¿¡ä»»çš„ç§æœåœ°å€
registry-mirrorsï¼šdockerå›½å†…é•œåƒæºåœ°å€

daemon.jsoné…ç½®æ³¨æ„äº‹é¡¹ï¼šæŠŠç§æœé…ç½®åˆ°registry-mirrorsæ—¶ï¼Œä¸€å®šè¦æ­£ç¡®çš„åŠ ä¸Š http://å‰ç¼€ï¼š	
æ­£ç¡®æ ¼å¼: http://192.168.0.4:5000
é”™è¯¯æ ¼å¼: 192.168.0.4:5001

æ”¾è¡Œ5000ç«¯å£å¹¶ä¿è¯5000ç«¯å£ç¡®å®è¢«æ”¾å¼€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>firewall-cmd --permanent --add-port=5000/tcp &amp;&amp;
firewall-cmd --reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ·æ–°daemonå¹¶é‡å¯docker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp; 
systemctl restart docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>éªŒè¯ä»“åº“æ˜¯å¦æ­å»ºæˆåŠŸ
è®¿é—®:http://192.168.0.4:5000/v2/_catalogï¼Œçœ‹åˆ°{&quot;repositories&quot;:[]}è¡¨ç¤ºç§æœ‰ä»“åº“æ­å»ºæˆåŠŸä¸”å†…å®¹ä¸ºç©º

å½»åº•åˆ é™¤ç§æœä¸­çš„é•œåƒ:æ³¨æ„è¿™ä¸ªè·¯å¾„æ˜¯è¦çœ‹registryå…·ä½“æŒ‚è½½åˆ°linuxä¸Šä»€ä¹ˆä½ç½®çš„
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -rf /registry/public/repos/docker/registry/v2/repositories/springcloud-eureka/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-6-2-æ­å»ºdockeå®˜æ–¹ç§æœ-å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#_4-6-2-æ­å»ºdockeå®˜æ–¹ç§æœ-å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒ" aria-hidden="true">#</a> 4.6.2.æ­å»ºdockeå®˜æ–¹ç§æœï¼ˆå¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒï¼‰</h3><pre><code>æ‹‰å–ä»“åº“é•œåƒ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker pull registry
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åŠ å¯†è®¤è¯é…ç½®
åˆ›å»ºå­˜æ”¾åŠ å¯†åç”¨æˆ·ä¿¡æ¯çš„ç”¨æˆ·åå¯†ç 
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/docker/auth/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£…httpdå·¥å…·
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install httpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç”Ÿæˆå¸¦æœ‰åŠ å¯†åç”¨æˆ·ä¿¡æ¯çš„ç”¨æˆ·åå¯†ç 
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>htpasswd -Bbn docker 123456  &gt;/opt/docker/auth/htpasswd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ³¨å†Œä»“åº“æœåŠ¡å™¨(-p:ç¬¬ä¸€ä¸ª5000æ˜¯æœ¬åœ°æœºå™¨ç«¯å£,ç¬¬äºŒä¸ª5000æ˜¯dockerå®¹å™¨ä¸­ç«¯å£)
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -d --name registry_official_auth  \
	-p 5000:5000 --restart=always \
	-v `pwd`/opt/docker/auth:/opt/docker/auth  \
	-v /opt/docker/registry:/var/lib/registry  \
	-e &quot;REGISTRY_AUTH=htpasswd&quot;  \
	-e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot;  \
	-e REGISTRY_AUTH_HTPASSWD_PATH=/opt/docker/auth/htpasswd \
	registry:latest	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç»™dockeré…ç½®ç§æœ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim /etc/docker/daemon.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ·»åŠ ä»¥ä¸‹å†…å®¹
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
    &quot;insecure-registries&quot;:[&quot;192.168.0.4:5000&quot;,&quot;192.168.0.4:5001&quot;],
    &quot;registry-mirrors&quot;: [
        &quot;https://5pfmrxk8.mirror.aliyuncs.com&quot;,
        &quot;http://hub-mirror.c.163.com&quot;,
        &quot;https://docker.mirrors.ustc.edu.cn&quot;,
        &quot;https://registry.docker-cn.com&quot;,
        &quot;http://192.168.0.4:5000&quot;,
        &quot;http://192.168.0.4:5001&quot;
    ]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>daemon.jsoné…ç½®è¯´æ˜
insecure-registriesï¼šdockerä¿¡ä»»çš„ç§æœåœ°å€
registry-mirrorsï¼šdockerå›½å†…é•œåƒæºåœ°å€

daemon.jsoné…ç½®æ³¨æ„äº‹é¡¹ï¼šæŠŠç§æœé…ç½®åˆ°registry-mirrorsæ—¶ï¼Œä¸€å®šè¦æ­£ç¡®çš„åŠ ä¸Š http://å‰ç¼€ï¼š	
æ­£ç¡®æ ¼å¼: http://192.168.0.4:5000
é”™è¯¯æ ¼å¼: 192.168.0.4:5001
æ”¾è¡Œ5000ç«¯å£å¹¶ä¿è¯5000ç«¯å£ç¡®å®è¢«æ”¾å¼€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>firewall-cmd --permanent --add-port=5000/tcp &amp;&amp;
firewall-cmd --reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ·æ–°docker daemonå¹¶é‡å¯docker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl restart docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>éªŒè¯ä»“åº“æ˜¯å¦æ­å»ºæˆåŠŸ
è®¿é—®:http://192.168.0.4:5000/v2/_catalogï¼Œçœ‹åˆ°{&quot;repositories&quot;:[]}è¡¨ç¤ºç§æœ‰ä»“åº“æ­å»ºæˆåŠŸä¸”å†…å®¹ä¸ºç©º

å½»åº•åˆ é™¤ç§æœä¸­çš„é•œåƒ:æ³¨æ„è¿™ä¸ªè·¯å¾„æ˜¯è¦çœ‹registryå…·ä½“æŒ‚è½½åˆ°linuxä¸Šä»€ä¹ˆä½ç½®çš„
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -rf /registry/public/repos/docker/registry/v2/repositories/springcloud-eureka/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_4-6-3-æ­å»ºharborç§æœ" tabindex="-1"><a class="header-anchor" href="#_4-6-3-æ­å»ºharborç§æœ" aria-hidden="true">#</a> 4.6.3.æ­å»ºharborç§æœ</h2><h3 id="_4-6-3-1-harborç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_4-6-3-1-harborç®€ä»‹" aria-hidden="true">#</a> 4.6.3.1.harborç®€ä»‹</h3><pre><code>Harboræ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘Dockeré•œåƒçš„ä¼ä¸šçº§RegistryæœåŠ¡å™¨ï¼Œè™½ç„¶Dockerå®˜æ–¹ä¹Ÿæä¾›äº†å…¬å…±çš„é•œåƒä»“åº“ï¼Œä½†æ˜¯
ä»å®‰å…¨å’Œæ•ˆç‡ç­‰æ–¹é¢è€ƒè™‘ï¼Œéƒ¨ç½²ä¼ä¸šå†…éƒ¨çš„ç§æœ‰ç¯å¢ƒRegistryæ˜¯éå¸¸å¿…è¦çš„ï¼Œharborå’Œdockerä¸­å¤®ä»“åº“çš„å…³ç³»å°±ç±»ä¼¼äº
nexuså’ŒMavenä¸­å¤®ä»“åº“çš„å…³ç³»ï¼Œharboré™¤äº†å­˜å‚¨å’Œåˆ†å‘é•œåƒå¤–è¿˜å…·æœ‰ç”¨æˆ·ç®¡ç†ï¼Œé¡¹ç›®ç®¡ç†ï¼Œé…ç½®ç®¡ç†å’Œæ—¥å¿—æŸ¥è¯¢ï¼Œé«˜å¯
ç”¨éƒ¨ç½²ç­‰ä¸»è¦åŠŸèƒ½ã€‚		
</code></pre><h3 id="_4-6-3-2-æ­å»ºdocker-compose" tabindex="-1"><a class="header-anchor" href="#_4-6-3-2-æ­å»ºdocker-compose" aria-hidden="true">#</a> 4.6.3.2.æ­å»ºdocker-compose</h3><pre><code>ç‰ˆæœ¬è¯´æ˜
æœ¬æ¬¡ä½¿ç”¨çš„docker-composeç‰ˆæœ¬ä¸º2.6.1   

å®˜æ–¹ç½‘å€
</code></pre><p><a href="https://github.com/docker/compose/">Â Â docker-compose</a></p><pre><code>åˆ›å»ºè¿è¡Œæ–‡ä»¶å¤¹-&gt;ä¸‹è½½docker-compose-&gt;è§£å‹å¹¶é‡å‘½ådocker-compose-&gt;èµ‹äºˆè¿è¡Œæƒé™å¹¶å¤åˆ¶åˆ°/usr/local/bin/docker-compose
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/software/package &amp;&amp;
cd /opt/software/package &amp;&amp;
curl -fL -u software-1660487881889:0c063752f28333a6e3bfb5e4e0e983835640aa5c \
&quot;https://lingwh-generic.pkg.coding.net/coding-drive/software/docker-compose-2.6-linux-x86_64?version=latest&quot; \
-o docker-compose-2.6-linux-x86_64 &amp;&amp;
sudo chmod +x docker-compose-2.6-linux-x86_64 &amp;&amp;
cp docker-compose-2.6-linux-x86_64 /usr/local/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker-compose --version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-6-3-3-å®‰è£…harbor" tabindex="-1"><a class="header-anchor" href="#_4-6-3-3-å®‰è£…harbor" aria-hidden="true">#</a> 4.6.3.3.å®‰è£…harbor</h3><pre><code>ç‰¹åˆ«æ³¨æ„
æ³¨æ„dockerçš„ç‰ˆæœ¬,ä½ç‰ˆæœ¬çš„dockerä¸èƒ½è¿è¡Œharbor2.5
	
ç‰ˆæœ¬è¯´æ˜
	2.5
	
åœ¨githubä¸‹è½½harbor2.5.2ï¼Œä¸Šä¼ åˆ°/opt/software/package
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/software/package
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è§£å‹åˆ°/opt/software/install
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tar -zxvf harbor-offline-installer-v2.5.2.tgz -C /opt/software/install
cd /opt/software/install/harbor
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å¤åˆ¶ä¸€ä»½harbor.yml.tmplï¼Œé‡å‘½åä¸ºharbor.ymlå¹¶ä¿®æ”¹harbor.yml
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp harbor.yml.tmpl harbor.yml &amp;&amp;
vim harbor.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹harbor.yml
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å…·ä½“ä¿®æ”¹ä»¥ä¸‹å†…å®¹
	ä¿®æ”¹hostname
	hostname: 192.168.0.4
	ä¿®æ”¹ç«¯å£
	port:5001
	æ³¨é‡Šæ‰httpsç›¸å…³éƒ¨åˆ†
	#https:
		# https port for harbor, default is 443
		# port: 443
		# The path of cert and key files for nginx
		#certificate: /your/certificate/path
		#private_key: /your/private/key/path
	ä¿®æ”¹å¯†ç 
		harbor_admin_password: 123456
	
	å®‰è£…docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>./install.sh</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	æ‰§è¡Œå®Œæˆåï¼Œä½¿ç”¨docker imagesæŸ¥çœ‹harborç›¸å…³é•œåƒ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>docker images</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å¯åŠ¨harbor
	ä¸€æ¬¡æ€§å¯åŠ¨æ‰€æœ‰harborç›¸å…³çš„å®¹å™¨,ä¸€èˆ¬æ‰§è¡Œå®Œ./install.shå°±å·²ç»å¯åŠ¨äº†ç›¸å…³çš„å®¹å™¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>docker-compose up -d</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	è®©dockerä¿¡ä»»harborç§æœ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>vim /etc/docker/daemon.json,æ·»åŠ ä»¥ä¸‹å†…å®¹:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	é…ç½®Docker(Register)æ³¨å†Œä»“åº“æœåŠ¡å™¨ä¿¡ä»»192.168.0.4:5001:
	{&quot;insecure-registries&quot;:[&quot;192.168.0.4:5001&quot;]}
	
	é‡æ–°åŠ è½½docker daemoné…ç½®æ–‡ä»¶å¹¶é‡å¯docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>systemctl daemon-reload &amp;&amp; systemctl restart docker</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	ç™»å½•harboré¦–é¡µ(å¯†ç å¯ä»¥å»harbor.ymlä¸­æŸ¥çœ‹)
	è®¿é—®åœ°å€ï¼šhttp://192.168.0.4:5001/
	ç”¨æˆ·å/å¯†ç ï¼šadmin/123456
		
	åœ¨Harborä¸­åˆ›å»ºé¡¹ç›®,æ¨é€çš„æ—¶å€™å¯ä»¥ç”¨
	å¦‚:springcloud-eureka	

## 4.7.dockerå®˜æ–¹ç§æœå¯è§†åŒ–
### 4.7.1docker-registry-webæ–¹æ¡ˆ
	ä¸‹è½½docker pull hyper/docker-registry-webé•œåƒ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker pull hyper/docker-registry-web</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å¯åŠ¨docker-registry-web
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>docker run -d --restart=always <br> -p 9002:8080 <br> --name registry-web <br> --link registry_default <br> -e REGISTRY_URL=http://192.168.0.4:5000/v2 <br> -e REGISTRY_NAME=192.168.0.4:5000 <br> hyper/docker-registry-web:latest</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
## 4.8.åˆ¶ä½œdockeré•œåƒå¹¶ä¸Šä¼ åˆ°ç§æœ

### 4.8.1.åˆ¶ä½œDokceré•œåƒ		
	è¿›å…¥/opt/software/packageï¼Œå¹¶åœ¨è¿™ä¸ªç›®å½•ä¸­ä¸‹è½½jdk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cd /opt/software/package &amp;&amp; wget https://repo.huaweicloud.com/java/jdk/8u181-b13/jdk-8u181-linux-x64.tar.gz</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	ç¼–å†™Dockerfile(Dockerfileå†…å®¹å¦‚ä¸‹)	
	
	#åŸºäºcentosåŸºç¡€é•œåƒæ„å»º
	FROM centos	
	#ä½œè€…
	MAINTAINER lingwh
	#å°†jdkæ·»åŠ åˆ°åŸºç¡€é•œåƒä¸­
	ADD jdk-8u181-linux-x64.tar.gz /usr/local
	#è®¾ç½®javaç›¸å…³çš„ç¯å¢ƒå˜é‡
	ENV JAVA_HOME /usr/local/jdk1.8.0_181
	ENV JRE_HOME ${JAVA_HOME}/jre
	ENV CLASSPATH .:${JAVA_HOME}/lib:${JRE_HOME}/lib
	ENV PATH ${JAVA_HOME}/bin:$PATH
	#è¾“å‡ºJavaç‰ˆæœ¬ä¿¡æ¯
	CMD [&quot;java&quot;,&quot;-version&quot;]		
					
	åœ¨å½“å‰ç›®å½•ä¸­æ‰§è¡Œæ„å»ºé•œåƒçš„å‘½ä»¤
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker build -t=&#39;jdk/jdk1.8.0_181&#39; .</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	æŸ¥çœ‹åˆ°åˆšæ‰åˆ¶ä½œå¥½çš„é•œåƒ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>docker images</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	åˆ›å»ºå®¹å™¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>docker run -it --name=myjdk8 é•œåƒid /bin/bash</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
### 4.8.2.ä¸Šä¼ æœ¬åœ°jdké•œåƒåˆ°ç§æœ
	ç»™é•œåƒæ‰“æ ‡ç­¾
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker tag jdk/jdk1.8.0_181 192.168.0.4:5000/jdk/jdk1.8.0_181:latest #æ›´æ”¹é•œåƒçš„TAGæ ‡ç­¾</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	ä¸Šä¼ æ ‡è®°çš„é•œåƒ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>docker push 192.168.0.4:5000/jdk/jdk1.8.0_181:latest</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	æŸ¥çœ‹æ¨é€åˆ°ç§æœä¸­çš„é•œåƒ
	è®¿é—®:http://192.168.0.4:5000/v2/_catalog,çœ‹åˆ°:{&quot;repositories&quot;:[&quot;jdk/jdk1.8.0_181&quot;]}

## 4.9.Dockerä¸­å®‰è£…å¸¸ç”¨è½¯ä»¶
### 4.9.1.Dockerå®‰è£…mysql
	ä¸‹è½½mysqlé•œåƒ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker pull mysql</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å¯åŠ¨mysqlå®¹å™¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>docker run -di --name mysql -p 3306:3306 --restart=always -e MYSQL_ROOT_PASSWORD=123456 mysql</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å…³é—­dockerä¸­çš„mysqlå®¹å™¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>myqldocker exec -it mysql bash</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>### 4.9.2.Dockerä¸­å®‰è£…consul
	ä¸‹è½½consulé•œåƒ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>docker pull consul</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å¯åŠ¨consulå®¹å™¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>docker run -d --name=consul <br> -p 8500:8500 <br> --restart=always <br> agent -server -bootstrap -ui -node=1 -client=&#39;0.0.0.0&#39; <br> consul:latest</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
### 4.9.3.Dockerå®¹å™¨ä¸­å®‰è£…vim	 
	è¿›å…¥å®¹å™¨å†…éƒ¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker exec -it å®¹å™¨id /bin/bash</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å¤‡ä»½æ—§çš„æº
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>mv /etc/apt/sources.list /etc/apt/sources.list.bak</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å†™å…¥æ–°çš„æº
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>echo &quot;deb http://mirrors.163.com/debian/ jessie main non-free contrib&quot; <br> &gt;&gt; /etc/apt/sources.list &amp;&amp; echo &quot;deb http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot; <br> &gt;&gt;/etc/apt/sources.list &amp;&amp; echo &quot;deb-src http://mirrors.163.com/debian/ jessie main non-free contrib&quot; <br> &gt;&gt;/etc/apt/sources.list &amp;&amp; echo &quot;deb-src http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot; <br> &gt;&gt;/etc/apt/sources.list</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
	æ›´æ–°æº
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>apt update</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å®‰è£…vim
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>apt-get install vim</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
### 4.9.3.dockerå®‰è£…elk
	ä¸‹è½½elké•œåƒ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker pull sebp/elk:6.8.22</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å¯åŠ¨ELKå®¹å™¨ï¼ŒæŒ‡å®šæœ€å°å†…å­˜å’Œæœ€å¤§å†…å­˜ï¼Œå¹¶æ˜ å°„ç›¸å…³ç«¯å£
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>docker run -d --name elk <br> --restart always <br> -p 5601:5601 <br> -p 9200:9200 <br> -p 5044:5044 <br> -e ES_MIN_MEM=1024m <br> -e ES_MAX_MEM=2048 <br> sebp/elk:6.8.22</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	å¼€æ”¾elkéœ€è¦ç”¨çš„ç«¯å£,å¹¶ä¸”é‡æ–°è½½å…¥ç«¯å£
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>firewall-cmd --add-port=5601/tcp --permanent &amp;&amp; firewall-cmd --reload &amp;&amp; firewall-cmd --add-port=9200/tcp --permanent &amp;&amp; firewall-cmd --reload &amp;&amp; firewall-cmd --add-port=5044/tcp --permanent &amp;&amp; firewall-cmd --reload</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	è®¿é—®Kibana
	192.168.0.4:5601
	
	è¿›å…¥ELKä¸­è¿›è¡Œé…ç½®
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker exec -it elk /bin/bash</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	ä¿®æ”¹logstashé…ç½®,æŠŠä¸‹é¢å†…å®¹ç²˜è´´è¿›å»
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>vim /etc/logstash/conf.d/02-beats-input.conf</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code></code></pre><div class="line-numbers" aria-hidden="true"></div></div><p>input{ tcp{ host =&gt; &quot;0.0.0.0&quot; port =&gt; 5044 codec=&gt; json_lines } } output{ elasticsearch{ hosts =&gt; [&quot;192.168.0.4:9200&quot;] action =&gt; &quot;index&quot; index =&gt; &quot;%{[appName]}-%{+YYYY.MM.dd}&quot; } }</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	é…ç½®è¯´æ˜:
	inputä»£è¡¨æ•°æ®è¾“å…¥é…ç½® ï¼Œ logstatshçš„å¼€æ”¾ç«¯å£æ˜¯ 5044
	outputä»£è¡¨æ•°æ®è¾“å‡ºé…ç½®ï¼Œè¾“å‡ºåˆ°elasticsearch, hostsæ˜¯esçš„åœ°å€192.168.0.4:9200
	
	é€€å‡ºå®¹å™¨
``	
exit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é‡å¯ELKå®¹å™¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker restart elk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ³¨æ„äº‹é¡¹	
å½“æŠŠdockerå’Œcentos7çš„å†²çªè§£å†³å,éœ€è¦è®©centosæ”¾è¡Œelk(å…·ä½“æ˜¯es)çš„éƒ¨ç½²åœ°å€

æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker inspect å®¹å™¨id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥æ‰¾åˆ°elk(å…·ä½“æ˜¯es)å®¹å™¨çš„ip,å‡è®¾ä¸º172.17.0.2

æ‰§è¡Œæ”¾è¡Œæ“ä½œ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>firewall-cmd --zone=trusted --add-source=172.17.0.2/16 --permanent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é‡æ–°è½½å…¥é˜²ç«å¢™é…ç½®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>firewall-cmd --reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é‡å¯é˜²ç«å¢™
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl restart firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>dockerå¯åŠ¨elkæŠ¥é”™/æˆ–ä¸€ç›´é‡å¯æ•…éšœè§£å†³
é”™è¯¯æ—¥å¿—ï¼š
max virtual memory areas vm.max_map_count [65530] is too low, increase to at least
è§£å†³æ–¹å¼ï¼Œåœ¨å®¿ä¸»æœºæ‰§è¡Œ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo sysctl -w vm.max_map_count=262144
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="5." tabindex="-1"><a class="header-anchor" href="#5." aria-hidden="true">#</a> 5.Centosæ­å»ºRancher</h1><h2 id="_5-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_5-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> 5.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 5.1.ç« èŠ‚å†…å®¹æ¦‚è¿°
 5.2.ç« èŠ‚å†…å®¹å¤§çº²

å…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="_5-2-ç« èŠ‚å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#_5-2-ç« èŠ‚å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter5.html" target="_blank">5.2.ç« èŠ‚å†…å®¹å¤§çº²</a></h2><div><iframe src="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter5.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><pre><code>ä¸‹è½½rancher
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker pull rancher/server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨rancher
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -di --name=rancher -p9003:8080 rancher/server:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨rancheræ‰©å®¹/ç¼©å®¹æ³¨æ„äº‹é¡¹
å¦‚æœè¦ä½¿ç”¨æ‰©å®¹æˆ–è€…ç¼©å®¹åŠŸèƒ½,ä¸è¦é…ç½®eurekaçš„å¦‚ä¸‹ä¿¡æ¯
eureka:
  instance:
	#ä½¿ç”¨rancheræ‰©å®¹ä¸èƒ½é…ç½®instance-id,å¦åˆ™ä¼šå‡ºé—®é¢˜
	#instance-id: ${spring.application.name} 
	#ä½¿ç”¨rancheræ‰©å®¹ä¸èƒ½é…ç½®iip-address,å¦åˆ™ä¼šå‡ºé—®é¢˜
	#ip-address: 192.168.0.4				
</code></pre><h1 id="6." tabindex="-1"><a class="header-anchor" href="#6." aria-hidden="true">#</a> 6.Centosæ­å»ºMinikube</h1><h2 id="_6-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_6-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> 6.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 6.1.ç« èŠ‚å†…å®¹æ¦‚è¿°
 6.2.ç« èŠ‚å†…å®¹å¤§çº²
 6.3.minikubeä»‹ç»
 6.4.ç‰ˆæœ¬è¯´æ˜
 6.5.å¼€å¯Vmwareè™šæ‹ŸåŒ–
 6.6.å®‰è£…kubectl	
 6.7.å®‰è£…minikube
 6.8.ä½¿ç”¨é˜¿é‡Œäº‘åŠ é€Ÿdocker hub
 6.9.å¯åŠ¨minikube
 6.10.minikubeå¸¸ç”¨å‘½ä»¤	
å…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="_6-2-ç« èŠ‚å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#_6-2-ç« èŠ‚å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter6.html" target="_blank">6.2.ç« èŠ‚å†…å®¹å¤§çº²</a></h2><div><iframe src="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter6.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h2 id="_6-3-minikubeä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_6-3-minikubeä»‹ç»" aria-hidden="true">#</a> 6.3.minikubeä»‹ç»</h2><pre><code>Minikubeè¿™ä¸ªå·¥å…·æ”¯æŒåœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œä¸€å¥—å•èŠ‚ç‚¹çš„k8sé›†ç¾¤
</code></pre><h2 id="_6-4-ç‰ˆæœ¬è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_6-4-ç‰ˆæœ¬è¯´æ˜" aria-hidden="true">#</a> 6.4.ç‰ˆæœ¬è¯´æ˜</h2><pre><code>minikube:1.2.6 kubectl client:1.18.0
</code></pre><h2 id="_6-5-å¼€å¯vmwareè™šæ‹ŸåŒ–" tabindex="-1"><a class="header-anchor" href="#_6-5-å¼€å¯vmwareè™šæ‹ŸåŒ–" aria-hidden="true">#</a> 6.5.å¼€å¯Vmwareè™šæ‹ŸåŒ–</h2><pre><code>æŸ¥çœ‹æ˜¯å¦æ”¯æŒè™šæ‹ŸåŒ–ï¼Œå¼€å§‹å®‰è£…å‰ï¼Œå…ˆæŸ¥çœ‹æœ¬åœ°æœºå™¨æ˜¯å¦æ”¯æŒè™šæ‹ŸåŒ–ï¼Œæœ‰è¾“å‡ºå°±æ”¯æŒ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>grep -E --color &#39;vmx|svm&#39; /proc/cpuinfo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¼€å¯è™šæ‹ŸåŒ–
Vmware Workstation -&gt;Centos 64å³é”®èœå• â€”&gt; è®¾ç½® 
	-&gt; å¤„ç†å™¨ -&gt;å‹¾é€‰ è™šæ‹ŸåŒ–IntelVT-x/EPT æˆ– ADM-V/RVI(V)

è®¾ç½®å¤„ç†å™¨æ•°é‡è®¾ç½®ä¸ºå¤§äºç­‰äº2,å†…å­˜å¤§äºç­‰äº2G
</code></pre><h2 id="_6-6-å®‰è£…kubectl" tabindex="-1"><a class="header-anchor" href="#_6-6-å®‰è£…kubectl" aria-hidden="true">#</a> 6.6.å®‰è£…kubectl</h2><pre><code>ç®€ä»‹
kubectl æ˜¯ä¸€ä¸ªç”¨æ¥è·Ÿ K8S é›†ç¾¤è¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…·
	
ä¸‹è½½kubectlï¼Œä¸Šä¼ åˆ°/opt/software/packageï¼Œèµ‹äºˆå¯è¿è¡Œæƒé™,å¹¶æ”¾å…¥/usr/local/bin/ç›®å½•ä¸‹
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>chmod +x ./kubectl &amp;&amp; cp ./kubectl /usr/local/bin/kubectl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹kubectlç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl version --client
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_6-7-å®‰è£…minikube" tabindex="-1"><a class="header-anchor" href="#_6-7-å®‰è£…minikube" aria-hidden="true">#</a> 6.7.å®‰è£…minikube</h2><pre><code>ä¸‹è½½minikube
åˆ° https://github.com/kubernetes/minikube/releases æ‰¾åˆ°minikube-linux-amd64å¹¶ä¸‹è½½

ä¸Šä¼ åˆ°/opt/software/package

èµ‹äºˆè¿è¡Œæƒé™å¹¶å¤åˆ¶åˆ°/usr/local/bin/minikube
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>chmod +x ./minikube-linux-amd64 &amp;&amp; cp ./minikube-linux-amd64 /usr/local/bin/minikube
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_6-8-ä½¿ç”¨é˜¿é‡Œäº‘åŠ é€Ÿdocker-hub" tabindex="-1"><a class="header-anchor" href="#_6-8-ä½¿ç”¨é˜¿é‡Œäº‘åŠ é€Ÿdocker-hub" aria-hidden="true">#</a> 6.8.ä½¿ç”¨é˜¿é‡Œäº‘åŠ é€Ÿdocker hub</h2><pre><code>ç™»å½•é˜¿é‡Œäº‘dockerç›¸å…³é¡µé¢
è®¿é—®ï¼šhttps://cr.console.aliyun.com/cn-hangzhou/instances/mirrors
ç™»é™†-&gt;å·¦ä¾§èœå•é€‰ä¸­é•œåƒåŠ é€Ÿå™¨-&gt;æŸ¥çœ‹åŠ é€Ÿé•œåƒåœ°å€ https://ngviu28h.mirror.aliyuncs.com
</code></pre><h2 id="_6-9-å¯åŠ¨minikube" tabindex="-1"><a class="header-anchor" href="#_6-9-å¯åŠ¨minikube" aria-hidden="true">#</a> 6.9.å¯åŠ¨minikube</h2><pre><code>æ³¨æ„äº‹é¡¹
å¯åŠ¨minikubeä¹‹å‰éœ€è¦å…ˆå¯åŠ¨dockerï¼Œå¦‚æ— æ³•å¯åŠ¨åŠ ä¸Š--kubernetes-version=vå…·ä½“ç‰ˆæœ¬å·

ä½¿ç”¨dockerä½œä¸ºè™šæ‹ŸåŒ–å¼•æ“(éœ€è¦å…ˆå®‰è£…Docker)
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube start --driver=docker --force \
	--image-mirror-country=&#39;cn&#39; \
	--image-repository=&#39;registry.cn-hangzhou.aliyuncs.com/google_containers&#39; \
	--registry-mirror=&#39;https://ngviu28h.mirror.aliyuncs.com&#39; \
	--kubernetes-version=v1.23.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨virtualboxä½œä¸ºè™šæ‹ŸåŒ–å¼•æ“(éœ€è¦å…ˆå®‰è£…Virtualbox)

ä¸‹è½½Centos7ç‰ˆVirtualBox
è®¿é—®ï¼šhttps://www.virtualbox.org/wiki/Downloadsï¼Œé€‰æ‹©AMD64ç‰ˆæœ¬ä¸‹è½½
ä¸Šä¼ åˆ°/opt/software/packageä¸­
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>VirtualBox-6.1-6.1.34_150636_el7-2.x86_64.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£…é—®é¢˜è§£å†³(virtualboxå†…æ ¸æ— æ³•ç¼–è¯‘)
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo yum install gcc kernel kernel-devel -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é‡å¯æœºå™¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl reboot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£…VirtualBox
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum install VirtualBox-6.1-6.1.34_150636_el7-2.x86_64.rpm -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è¡¥å……å†…å®¹ï¼šCentosç‰ˆVirtualBoxæ“ä½œå‘½ä»¤						
VBoxManage list runningvms //æŸ¥çœ‹æœºå™¨åˆ—è¡¨
VBoxHeadless -startvm &quot;è™šæ‹Ÿæœºå&quot; //å¯åŠ¨è™šæ‹Ÿæœº
æµ‹è¯•VirtualBoxæ˜¯å¦å®‰è£…æˆåŠŸ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>virtualbox
rcvboxdrv setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨virtualboxä½œä¸ºè™šæ‹ŸåŒ–å¼•æ“
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube start --driver=virtualbox --force \
	--image-mirror-country=&#39;cn&#39; \
	--image-repository=&#39;registry.cn-hangzhou.aliyuncs.com/google_containers&#39; \
	--registry-mirror=&#39;https://ngviu28h.mirror.aliyuncs.com&#39; \
	--kubernetes-version=v1.23.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-10-minikubeå¸¸ç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_6-10-minikubeå¸¸ç”¨å‘½ä»¤" aria-hidden="true">#</a> 6.10.minikubeå¸¸ç”¨å‘½ä»¤</h2><pre><code>æŸ¥çœ‹minikubeæ—¥å¿—
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube logs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹minikubeçŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube status								
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹èŠ‚ç‚¹				
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube kubectl -- get po -A
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åœæ­¢é›†ç¾¤
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ¸…ç©ºé›†ç¾¤
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube delete --all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£…é›†ç¾¤å¯è§†åŒ– Web UI æ§åˆ¶å°
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube dashboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¸è½½minikube
åœæ­¢è¿è¡Œ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ‰§è¡Œå¸è½½å‘½ä»¤
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>minikube delete
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆ é™¤ ~/.minikube ç›®å½•ç¼“å­˜çš„æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -rf ~/.minikube	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="7." tabindex="-1"><a class="header-anchor" href="#7." aria-hidden="true">#</a> 7.kubeadmæ­å»ºKubernetes</h1><h2 id="_7-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_7-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> 7.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 7.1.ç« èŠ‚å†…å®¹æ¦‚è¿°
 7.2.ç« èŠ‚å†…å®¹å¤§çº²
 7.3.ç‰¹åˆ«è¯´æ˜
 7.4.æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¯¹åº”ä¸»æœºå
 7.5.æ‰€æœ‰èŠ‚ç‚¹ä¿®æ”¹hosts
 7.6.æ‰€æœ‰èŠ‚ç‚¹å…³é—­SELinux
 7.7.æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™
 7.8.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker
 7.9.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…k8sæ‰€éœ€ç»„ä»¶
 7.10.æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨kubeletå’Œdocker
 7.11.æ‰€æœ‰å…³é—­swap
 7.12.ç”¨kubeadm åˆå§‹åŒ–é›†ç¾¤
 7.13.å…¶ä»–èŠ‚ç‚¹è¿æ¥åˆ°MasterèŠ‚ç‚¹
 7.14.åœ¨masterèŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é›†ç¾¤
 7.15.å®‰è£…ç½‘ç»œæ’ä»¶
 7.16.åœ¨masterä¸ŠæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹			
 7.17.å¯åŠ¨æ•…éšœè§£å†³
 7.18.åŸºç¡€å‘½ä»¤
 7.19.éƒ¨ç½²ç¬¬ä¸€ä¸ªç¨‹åºåˆ°k8sä¸­
 7.20.å¯è§†åŒ–é¢æ¿kuboard
å…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="_7-2-ç« èŠ‚å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#_7-2-ç« èŠ‚å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter7.html" target="_blank">7.2.ç« èŠ‚å†…å®¹å¤§çº²</a></h2><div><iframe src="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter7.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h2 id="_7-3-ç‰¹åˆ«è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_7-3-ç‰¹åˆ«è¯´æ˜" aria-hidden="true">#</a> 7.3.ç‰¹åˆ«è¯´æ˜</h2><pre><code>ä½¿ç”¨kubeadmæ­å»ºKubernetes
</code></pre><h2 id="_7-4-æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¯¹åº”ä¸»æœºå" tabindex="-1"><a class="header-anchor" href="#_7-4-æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¯¹åº”ä¸»æœºå" aria-hidden="true">#</a> 7.4.æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¯¹åº”ä¸»æœºå</h2><pre><code>masterèŠ‚ç‚¹
hostnamectl set-hostname master
slave1èŠ‚ç‚¹
hostnamectl set-hostname slave1
slave2èŠ‚ç‚¹	
hostnamectl set-hostname slave2
</code></pre><h2 id="_7-5-æ‰€æœ‰èŠ‚ç‚¹ä¿®æ”¹hosts" tabindex="-1"><a class="header-anchor" href="#_7-5-æ‰€æœ‰èŠ‚ç‚¹ä¿®æ”¹hosts" aria-hidden="true">#</a> 7.5.æ‰€æœ‰èŠ‚ç‚¹ä¿®æ”¹hosts</h2><pre><code>vim /etc/hosts
192.168.0.6 master
192.168.0.7 slave1
192.168.0.8 slave2
</code></pre><h2 id="_7-6-æ‰€æœ‰èŠ‚ç‚¹å…³é—­selinux" tabindex="-1"><a class="header-anchor" href="#_7-6-æ‰€æœ‰èŠ‚ç‚¹å…³é—­selinux" aria-hidden="true">#</a> 7.6.æ‰€æœ‰èŠ‚ç‚¹å…³é—­SELinux</h2><pre><code>æš‚æ—¶å…³é—­
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>setenforce 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ°¸ä¹…å…³é—­
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i --follow-symlinks &#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39; \
/etc/sysconfig/selinux
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-7-æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™" tabindex="-1"><a class="header-anchor" href="#_7-7-æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™" aria-hidden="true">#</a> 7.7.æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl stop firewalld &amp;&amp;
systemctl disable firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-8-æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker" tabindex="-1"><a class="header-anchor" href="#_7-8-æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker" aria-hidden="true">#</a> 7.8.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker</h2><pre><code>å®‰è£…docker
è¯¦ç»†å‚è€ƒ4.1&gt;.å®‰è£…docker

ä¿®æ”¹dockeré…ç½®
vim /etc/docker/daemon.jsonï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š
#kuberneteså®˜æ–¹æ¨è dockerç­‰ä½¿ç”¨systemdä½œä¸ºcgroupdriverï¼Œå¦åˆ™ kubelet å¯åŠ¨ä¸äº†
&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]&quot;

é‡æ–°è½½å…¥dockeré…ç½®å¹¶é‡å¯docker
systemctl daemon-reload &amp;&amp; systemctl restart docker
</code></pre><h2 id="_7-9-æ‰€æœ‰èŠ‚ç‚¹å®‰è£…k8sæ‰€éœ€ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-9-æ‰€æœ‰èŠ‚ç‚¹å®‰è£…k8sæ‰€éœ€ç»„ä»¶" aria-hidden="true">#</a> 7.9.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…k8sæ‰€éœ€ç»„ä»¶</h2><pre><code>æ·»åŠ k8så®‰è£…æº
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &lt;&lt;EOF &gt; kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg 
https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨k8så®‰è£…æº
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mv kubernetes.repo /etc/yum.repos.d/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å®‰è£…æ‰€éœ€ç»„ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum install -y kubelet-1.22.4 kubectl-1.22.4 kubeadm-1.22.4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å„ç»„ä»¶ç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubelet --version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl	--version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubeadm --version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_7-10-æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨kubeletå’Œdocker" tabindex="-1"><a class="header-anchor" href="#_7-10-æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨kubeletå’Œdocker" aria-hidden="true">#</a> 7.10.æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨kubeletå’Œdocker</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl enable kubelet &amp;&amp; 
systemctl start kubelet &amp;&amp;
systemctl enable docker &amp;&amp;
systemctl start docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-11-æ‰€æœ‰å…³é—­swap" tabindex="-1"><a class="header-anchor" href="#_7-11-æ‰€æœ‰å…³é—­swap" aria-hidden="true">#</a> 7.11.æ‰€æœ‰å…³é—­swap</h2><pre><code>ä¸´æ—¶å…³é—­swapåˆ†åŒº
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>swapoff /mnt/swap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ°¸ä¹…å…³é—­swapåˆ†åŒº
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab &amp;&amp; systemctl reboot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹swapåˆ†åŒºæ˜¯å¦å…³é—­	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>free -m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_7-12-ç”¨kubeadm-åˆå§‹åŒ–é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_7-12-ç”¨kubeadm-åˆå§‹åŒ–é›†ç¾¤" aria-hidden="true">#</a> 7.12.ç”¨kubeadm åˆå§‹åŒ–é›†ç¾¤</h2><pre><code>ç‰¹åˆ«æ³¨æ„
åªåœ¨MasterèŠ‚ç‚¹æ“ä½œ

åˆå§‹åŒ–é›†ç¾¤æ§åˆ¶å° Control planeï¼Œå¤±è´¥äº†å¯ä»¥ç”¨ kubeadm reset é‡ç½®

åˆå§‹åŒ–é›†ç¾¤å‘½ä»¤
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubeadm init \
	--apiserver-advertise-address=192.168.0.6 \
	--image-repository registry.aliyuncs.com/google_containers \
	--kubernetes-version v1.22.4 \
	--service-cidr=10.96.0.0/12 \
	--pod-network-cidr=10.244.0.0/16 \
	--ignore-preflight-errors=all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å‘½ä»¤è¯´æ˜ï¼š	
è¿™ä¸ªå‚æ•°å°±æ˜¯masterä¸»æœºçš„IPåœ°å€ï¼Œä¾‹å¦‚æˆ‘çš„Masterä¸»æœºçš„IPæ˜¯ï¼š192.168.181.131	
--apiserver-advertise-address=192.168.181.131    
è¿™ä¸ªæ˜¯é•œåƒåœ°å€ï¼Œç”±äºå›½å¤–åœ°å€æ— æ³•è®¿é—®ï¼Œæ•…ä½¿ç”¨çš„é˜¿é‡Œäº‘ä»“åº“åœ°å€ï¼š		
registry.aliyuncs.com/google_containers
--image-repository=registry.aliyuncs.com/google_containers
è¿™ä¸ªå‚æ•°æ˜¯ä¸‹è½½çš„k8sè½¯ä»¶ç‰ˆæœ¬å·ï¼Œå¯ä½¿ç”¨kubeadm config images listæŸ¥è¯¢
--kubernetes-version=v1.17.4   
è¿™ä¸ªå‚æ•°åçš„IPåœ°å€ç›´æ¥å°±å¥—ç”¨10.96.0.0/12 ,ä»¥åå®‰è£…æ—¶ä¹Ÿå¥—ç”¨å³å¯ï¼Œä¸è¦æ›´æ”¹
--service-cidr=10.96.0.0/12
k8så†…éƒ¨çš„podèŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå¯ä»¥ä½¿ç”¨çš„IPæ®µï¼Œä¸èƒ½å’Œservice-cidrå†™ä¸€æ ·ï¼Œå¦‚æœä¸çŸ¥é“æ€ä¹ˆé…ï¼Œå°±å…ˆ
	ç”¨è¿™ä¸ª10.244.0.0/16
--pod-network-cidr=10.244.0.0/16

å¯åŠ¨æˆåŠŸåæ§åˆ¶å°è¾“å‡ºå…¶ä»–èŠ‚ç‚¹åŠ å…¥ä¸»èŠ‚ç‚¹çš„ç§˜é’¥:æ¯æ¬¡æ‰§è¡Œ kubeadm initåè¿™ä¸ªç§˜é’¥ä¼šå‘ç”Ÿå˜åŒ–
å¦‚ï¼škubeadm join 192.168.0.6:6443 \
	--token e60qrb.6321jolakk1aix90 \
	--discovery-token-ca-cert-hash \
	sha256:02829b33a24eef53805ffedef79c0371cb4d9ac0d04bfad7fe26eb022cb638ac
æ³¨æ„
å¯ä»¥ä¿å­˜ç§˜é’¥ï¼Œæ–¹ä¾¿åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šä½¿ç”¨ 
é‡æ–°è·å–kubeadm join...
kubeadm token create --print-join-command	
					
å¤åˆ¶æˆæƒæ–‡ä»¶ï¼Œä»¥ä¾¿ kubectl å¯ä»¥æœ‰æƒé™è®¿é—®é›†ç¾¤
å¦‚æœå…¶ä»–èŠ‚ç‚¹éœ€è¦è®¿é—®é›†ç¾¤ï¼Œéœ€è¦ä»ä¸»èŠ‚ç‚¹å¤åˆ¶è¿™ä¸ªæ–‡ä»¶è¿‡å»å…¶ä»–èŠ‚ç‚¹
mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre><h2 id="_7-13-å…¶ä»–èŠ‚ç‚¹è¿æ¥åˆ°masterèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_7-13-å…¶ä»–èŠ‚ç‚¹è¿æ¥åˆ°masterèŠ‚ç‚¹" aria-hidden="true">#</a> 7.13.å…¶ä»–èŠ‚ç‚¹è¿æ¥åˆ°MasterèŠ‚ç‚¹</h2><pre><code>åœ¨ä¸¤ä¸ªä¸ŠSlaveèŠ‚ç‚¹è¾“å…¥ç¬¬9&gt;&gt;.æ­¥éª¤åœ¨ä¸»èŠ‚ç‚¹ä¸Šè·å–çš„ç§˜é’¥
å¦‚ï¼škubeadm join 192.168.0.6:6443 \
	--token e60qrb.6321jolakk1aix90 \
	--discovery-token-ca-cert-hash \
	sha256:02829b33a24eef53805ffedef79c0371cb4d9ac0d04bfad7fe26eb022cb638ac
	
åŠ å…¥æˆåŠŸåçœ‹åˆ°:
	This node has joined the cluster
</code></pre><h2 id="_7-14-åœ¨masterèŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_7-14-åœ¨masterèŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é›†ç¾¤" aria-hidden="true">#</a> 7.14.åœ¨masterèŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é›†ç¾¤</h2><pre><code>materèŠ‚ç‚¹å’Œä¸¤ä¸ªslaveèŠ‚ç‚¹STATUSæ˜¯NOTReady
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@master ~]# kubectl get nodes
NAME     STATUS     ROLES                  AGE     VERSION
master   NotReady      control-plane,master   9m32s   v1.22.4
slave1   NotReady   &lt;none&gt;                 5m51s   v1.22.4
slave2   NotReady      &lt;none&gt;                 2m31s   v1.22.4
</code></pre><h2 id="_7-15-å®‰è£…ç½‘ç»œæ’ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-15-å®‰è£…ç½‘ç»œæ’ä»¶" aria-hidden="true">#</a> 7.15.å®‰è£…ç½‘ç»œæ’ä»¶</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f \
	https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-16-åœ¨masterä¸ŠæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_7-16-åœ¨masterä¸ŠæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹" aria-hidden="true">#</a> 7.16.åœ¨masterä¸ŠæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</h2><pre><code>å†æ¬¡æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹é›†ç¾¤å‘½ä»¤ï¼ŒmaterèŠ‚ç‚¹STATUSæ˜¯Readyï¼Œä¸¤ä¸ªslaveèŠ‚ç‚¹STATUSæ˜¯éƒ½æ˜¯Ready
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@master ~]# kubectl get nodes
NAME     STATUS     ROLES                  AGE     VERSION
master   Ready      control-plane,master   9m32s   v1.22.4
slave1   Ready   &lt;none&gt;                 5m51s   v1.22.4
slave2   Ready      &lt;none&gt;                 2m31s   v1.22.4	
æ³¨æ„äº‹é¡¹
å¦‚æœä¸¤ä¸ªä»èŠ‚ç‚¹ä¸­æœ‰ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€æ˜¯NotReadyï¼Œå¦ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€æ˜¯Readyï¼Œä¸è¦ç€æ€¥ï¼Œè¦å¤šç­‰ä¸€ä¼šå„¿
å†ä½¿ç”¨å‘½ä»¤kubectl get nodesæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯Ready
</code></pre><h2 id="_7-17-å¯åŠ¨æ•…éšœè§£å†³" tabindex="-1"><a class="header-anchor" href="#_7-17-å¯åŠ¨æ•…éšœè§£å†³" aria-hidden="true">#</a> 7.17.å¯åŠ¨æ•…éšœè§£å†³</h2><pre><code>æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´çš„æ‰€æœ‰çš„pod
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -o wide --all-namespaces
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨å¤±è´¥çš„podçš„æ—¥å¿—ï¼Œå…¶ä¸­PODNAMEä¸ºå¯åŠ¨å¤±è´¥çš„podçš„name
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl -n kube-system logs PODNAME
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>é‡ç½®kubeadm
å¯ä½¿ç”¨kubeadm resetå‘½ä»¤é‡å¯kubeadmï¼Œå†ä»ç¬¬9&gt;&gt;.æ­¥éª¤å¼€å§‹é‡æ–°æ‰§è¡Œ
</code></pre><h2 id="_7-18-åŸºç¡€å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_7-18-åŸºç¡€å‘½ä»¤" aria-hidden="true">#</a> 7.18.åŸºç¡€å‘½ä»¤</h2><pre><code>æŸ¥çœ‹kubeadméœ€è¦çš„ç»„ä»¶çš„ç‰ˆæœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubeadm config images list
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹pod
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´çš„æ‰€æœ‰pod
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -o wide --all-namespaces
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹podæ—¥å¿—
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl describe pod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_7-19-éƒ¨ç½²ç¬¬ä¸€ä¸ªç¨‹åºåˆ°k8sä¸­" tabindex="-1"><a class="header-anchor" href="#_7-19-éƒ¨ç½²ç¬¬ä¸€ä¸ªç¨‹åºåˆ°k8sä¸­" aria-hidden="true">#</a> 7.19.éƒ¨ç½²ç¬¬ä¸€ä¸ªç¨‹åºåˆ°k8sä¸­</h2><pre><code>å¼€å§‹è¿è¡Œ guestbook
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create deployment guestbook --image=ibmcom/guestbook:v1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥è¯¢podè¿è¡ŒçŠ¶æ€ï¼ŒçŠ¶æ€åº”è¯¥æ˜¾ç¤ºä¸ºRunningè¡¨ç¤ºpodè¿è¡ŒæˆåŠŸ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯¹å¤–æš´éœ²ç«¯å£
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl expose deployment guestbook --type=NodePort --port=3000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥è¯¢ç«¯å£æ˜ å°„	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get service guestbook
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>NAME        TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
guestbook   NodePort   10.10.10.253   &lt;none&gt;        3000:31208/TCP   1m

è®¿é—®æœåŠ¡ï¼ˆä¸»èŠ‚ç‚¹å’Œä¸¤ä¸ªå·¥ä½œèŠ‚ç‚¹éƒ½å¯è®¿é—®åˆ°è¿™ä¸ªæœåŠ¡ï¼‰
http://192.168.0.6:31208
http://192.168.0.7:31208
http://192.168.0.8:31208
</code></pre><h2 id="_7-20-å¯è§†åŒ–é¢æ¿kuboard" tabindex="-1"><a class="header-anchor" href="#_7-20-å¯è§†åŒ–é¢æ¿kuboard" aria-hidden="true">#</a> 7.20.å¯è§†åŒ–é¢æ¿kuboard</h2><pre><code>å®‰è£…
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼Œæ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€éƒ½æ˜¯Readyè¡¨ç¤ºå®‰è£…æˆåŠŸ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -n kuboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç™»å½•kuboard-v3
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>http://192.168.0.6:30080	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç”¨æˆ·å/å¯†ç ï¼š admin/Kuboard123

æŸ¥çœ‹kuboardæ‰€æœ‰ç›¸å…³çš„podæ˜¯å¦æˆåŠŸè¿è¡Œ,çŠ¶æ€ä¸ºRUNNINGä»£è¡¨æˆåŠŸè¿è¡Œ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>watch kubectl get pods -n kuboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
è·å–kuboardå‘½åç©ºé—´ä¸­ç›¸å…³podçš„name
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>watch kubectl get pods -n kuboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ ¹æ®podåç§°æŸ¥çœ‹podæ—¥å¿—
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl logs -n kuboard kuboard-v3-5fc46b5557-jlsrj
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœæ’æŸ¥
æŸ¥çœ‹dockerä¸­éƒ¨ç½²çš„kuboardç›¸å…³å®¹å™¨æ˜¯å¦éƒ½æˆåŠŸå¯åŠ¨äº†ï¼Œå¦‚æœç›¸å…³å®¹å™¨æ²¡æœ‰é‡æ–°å¯åŠ¨ï¼Œå¯é‡å¯ä¸€ä¸‹docker
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker ps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç‰¹åˆ«æ³¨æ„
è¿™ä¸ªkuboardéƒ¨åˆ†podå¯åŠ¨ï¼ˆå°±ç»ªï¼‰çš„å¯èƒ½å¾ˆæ…¢ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ï¼Œç­‰å¾…ä¸€å®šæ—¶é—´åå†ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æ˜¯å¦éƒ½å¯åŠ¨æˆåŠŸäº†
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>watch kubectl get pods -n kuboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¸è½½kuboard-v3
æ‰§è¡Œå¸è½½å‘½ä»¤
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	kubectl delete -f https://addons.kuboard.cn/kuboard/kuboard-v3.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ¸…ç†é—ç•™æ•°æ®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -rf /usr/share/kuboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="8." tabindex="-1"><a class="header-anchor" href="#8." aria-hidden="true">#</a> 8.äºŒè¿›åˆ¶åŒ…æ­å»ºKubernetes</h1><h2 id="_8-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_8-1-ç« èŠ‚å†…å®¹æ¦‚è¿°" aria-hidden="true">#</a> 8.1.ç« èŠ‚å†…å®¹æ¦‚è¿°</h2><pre><code>æœ¬ç« èŠ‚æ¶‰åŠä¸»è¦å†…å®¹æœ‰ï¼š
 8.1.ç« èŠ‚å†…å®¹æ¦‚è¿°
 8.2.ç« èŠ‚å†…å®¹å¤§çº²
 8.3.ç¯å¢ƒé…ç½®æ¸…å•
 8.4.æœåŠ¡å™¨è§„åˆ’å’ŒIPåœ°å€è§„åˆ’
 8.5.å®‰è£…å‰å‡†å¤‡å·¥ä½œ
 8.6.å®‰è£…cfsslè¯ä¹¦ç”Ÿæˆå·¥å…·
 8.7.æ­å»ºetcdé›†ç¾¤
 8.8.å®‰è£…é…ç½®Docker
 8.9.æ­å»ºkube-apiserver
 8.10.åœ¨Master Node1ä¸Šéƒ¨ç½²kube-controller-manager
 8.11.éƒ¨ç½²kube-scheduler
 8.12.ä½¿ç”¨kubectlæŸ¥çœ‹é›†ç¾¤çŠ¶æ€
 8.13.åœ¨Master Node1ä¸Šéƒ¨ç½²ç¬¬ä¸€ä¸ªWorker Node
 8.14.å¢åŠ Worker Node
 8.15.å¢åŠ Master2èŠ‚ç‚¹
 8.16.éƒ¨ç½²Nginx+Keepalivedé«˜å¯ç”¨è´Ÿè½½å‡è¡¡å™¨
 8.17.éƒ¨ç½²å¸¸è§é—®é¢˜
 8.18.éƒ¨ç½²æµ‹è¯•ç¨‹åº
å…·ä½“æ¯ä¸ªå°èŠ‚ä¸­åŒ…å«çš„å†…å®¹å¯ä½¿é€šè¿‡ä¸‹é¢çš„ç« èŠ‚å†…å®¹å¤§çº²è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ¬ç« èŠ‚å†…å®¹ä¸­å›¾ç‰‡è¾ƒå°‘ï¼Œä¸»è¦ä»¥å®ç”¨ä¸ºä¸»ï¼Œæ‰€æœ‰ä»£ç å‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œå³å¯ã€‚
</code></pre><h2 id="_8-2-ç« èŠ‚å†…å®¹å¤§çº²" tabindex="-1"><a class="header-anchor" href="#_8-2-ç« èŠ‚å†…å®¹å¤§çº²" aria-hidden="true">#</a> <a href="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter8.html" target="_blank">8.2.ç« èŠ‚å†…å®¹å¤§çº²</a></h2><div><iframe src="/enhance/markmap/environment/centos/centos7/chapter/centos7-outline5-chapter8.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h2 id="_8-3-ç¯å¢ƒé…ç½®æ¸…å•" tabindex="-1"><a class="header-anchor" href="#_8-3-ç¯å¢ƒé…ç½®æ¸…å•" aria-hidden="true">#</a> 8.3.ç¯å¢ƒé…ç½®æ¸…å•</h2><pre><code>æ“ä½œç³»ç»Ÿ									centos7
å†…æ ¸ç‰ˆæœ¬									3.10.0-1160.71.1.el7.x86_64
dockerç‰ˆæœ¬
etcdç‰ˆæœ¬
Kubernetesç‰ˆæœ¬
kube-apiserverç‰ˆæœ¬
kube-controller-managerç‰ˆæœ¬
kube-schedulerç‰ˆæœ¬
nginxç‰ˆæœ¬
keepaliveç‰ˆæœ¬
corednsç‰ˆæœ¬
è¯´æ˜
Kubernetesè§£å‹å
</code></pre><h2 id="_8-4-æœåŠ¡å™¨è§„åˆ’å’Œipåœ°å€è§„åˆ’" tabindex="-1"><a class="header-anchor" href="#_8-4-æœåŠ¡å™¨è§„åˆ’å’Œipåœ°å€è§„åˆ’" aria-hidden="true">#</a> 8.4.æœåŠ¡å™¨è§„åˆ’å’ŒIPåœ°å€è§„åˆ’</h2><h3 id="_8-4-1æœåŠ¡å™¨è§„åˆ’" tabindex="-1"><a class="header-anchor" href="#_8-4-1æœåŠ¡å™¨è§„åˆ’" aria-hidden="true">#</a> 8.4.1æœåŠ¡å™¨è§„åˆ’</h3><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>å¦‚æœè¦æ­å»ºä¸€ä¸»å¤šä»éé«˜å¯ç”¨Kubernetesé›†ç¾¤ï¼Œä½¿ç”¨æœåŠ¡å™¨è§„åˆ’1<br> å¦‚æœè¦æ­å»ºå¤šä¸»å¤šä»é«˜å¯ç”¨Kubernetesé›†ç¾¤ï¼Œä½¿ç”¨æœåŠ¡å™¨è§„åˆ’2</p></div><pre><code>æœåŠ¡å™¨è§„åˆ’1ï¼šä¸€ä¸»å¤šä»æœåŠ¡å™¨è§„åˆ’
</code></pre><table><thead><tr><th style="text-align:left;">è§’è‰²</th><th style="text-align:left;">IP</th><th style="text-align:center;">ç»„ä»¶</th></tr></thead><tbody><tr><td style="text-align:left;">binary-k8s-master1</td><td style="text-align:left;">192.168.0.9</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler<br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">binary-k8s-worker1</td><td style="text-align:left;">192.168.0.10</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">binary-k8s-worker1</td><td style="text-align:left;">192.168.0.11</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr></tbody></table><pre><code>æœåŠ¡å™¨è§„åˆ’2ï¼šå¤šä¸»å¤šä»é«˜å¯ç”¨æœåŠ¡å™¨è§„åˆ’
</code></pre><table><thead><tr><th style="text-align:left;">è§’è‰²</th><th style="text-align:left;">IP</th><th style="text-align:center;">ç»„ä»¶</th></tr></thead><tbody><tr><td style="text-align:left;">binary-k8s-master1</td><td style="text-align:left;">192.168.0.9</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler <br> kubelet kube-proxy <br> nginx keepalived</td></tr><tr><td style="text-align:left;">binary-k8s-master2</td><td style="text-align:left;">192.168.0.12</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler <br> kubelet kube-proxy <br> nginx keepalived</td></tr><tr><td style="text-align:left;">binary-k8s-worker1</td><td style="text-align:left;">192.168.0.10</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">binary-k8s-worker2</td><td style="text-align:left;">192.168.0.11</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">è´Ÿè½½å‡è¡¡å™¨(è™šæ‹ŸIP)</td><td style="text-align:left;">192.168.0.88</td><td style="text-align:center;"></td></tr></tbody></table><h3 id="_8-4-2-ipåœ°å€è§„åˆ’" tabindex="-1"><a class="header-anchor" href="#_8-4-2-ipåœ°å€è§„åˆ’" aria-hidden="true">#</a> 8.4.2.IPåœ°å€è§„åˆ’</h3><pre><code>IPåœ°å€è§„åˆ’
kubernetesè‡ªèº«ä½¿ç”¨çš„ClusterIPï¼š10.0.0.1
æœ¬åœ°å›ç¯åœ°å€ï¼š127.0.0.1
Master1:192.168.0.9
worker1:192.168.0.10
worker2:192.168.0.11
Master2:168.168.0.12
keepaliveè™šæ‹ŸIP: 192.168.0.88
é¢„ç•™IPä½ç½®1ï¼š168.168.0.13
é¢„ç•™IPä½ç½®2ï¼š168.168.0.14
é¢„ç•™IPä½ç½®3ï¼š168.168.0.15
é¢„ç•™IPä½ç½®4ï¼š168.168.0.17
é¢„ç•™IPä½ç½®5ï¼š168.168.0.18
é¢„ç•™IPä½ç½®6ï¼š168.168.0.19
é¢„ç•™IPä½ç½®7ï¼š168.168.0.20
é¢„ç•™IPä½ç½®8ï¼š168.168.0.100
é¢„ç•™IPä½ç½®9ï¼š168.168.0.101
é¢„ç•™IPä½ç½®10ï¼š168.168.0.102
é¢„ç•™IPä½ç½®11ï¼š168.168.0.103
é¢„ç•™IPä½ç½®12ï¼š168.168.0.104
é¢„ç•™IPä½ç½®13ï¼š168.168.0.105

æ³¨æ„äº‹é¡¹
1.å¯ä»¥å°†è¿™äº›IPåœ°å€è¿›è¡Œåˆ†ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆæœ¬æ¬¡ä¸ºäº†å­¦ä¹ ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œè¯¦ç»†è§„åˆ’ï¼‰
Etcd Cluster: 192.168.0.xxx
Master Node : 192.168.1.xxx
Worker Node : 192.168.2.xxx
keepalive   : 192.168.3.xx
2.ä¸€å®šè¦å¤šé¢„ç•™ä¸€äº›IPåœ°å€ï¼Œå…¨éƒ¨å®‰è£…å¥½ä¹‹åï¼Œå†ç»™kube-apiserveræ·»åŠ IPåœ°å€å¾ˆéº»çƒ¦	
</code></pre><h2 id="_8-5-å®‰è£…å‰å‡†å¤‡å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#_8-5-å®‰è£…å‰å‡†å¤‡å·¥ä½œ" aria-hidden="true">#</a> 8.5.å®‰è£…å‰å‡†å¤‡å·¥ä½œ</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>8.3ç« èŠ‚æ¶‰åŠåˆ°çš„æ“ä½œæ‰€æœ‰çš„MasterèŠ‚ç‚¹å’ŒWorker Nodeéƒ½è¦æ‰§è¡Œï¼Œä¸‹è½½æ‰€æœ‰ç”¨åˆ°çš„è½¯ä»¶åŒ…åŒ…åªéœ€è¦åœ¨Mater Node1è¿›è¡Œå°±å¯ä»¥äº†</p></div><h3 id="_8-5-1æ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_8-5-1æ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®" aria-hidden="true">#</a> 8.5.1æ“ä½œç³»ç»Ÿåˆå§‹è®¾ç½®</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl stop firewalld &amp;&amp; systemctl disable firewalld #å…³é—­ç³»ç»Ÿé˜²ç«å¢™
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s/enforcing/disabled/&#39; /etc/selinux/config #æ°¸ä¹…å…³é—­selinux
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab #æ°¸ä¹…å…³é—­swap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ ¹æ®è§„åˆ’è®¾ç½®ä¸»æœºå</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname binary-k8s-master1 &amp;&amp; systemctl reboot #binary-k8s-master1ï¼ˆ192.168.0.9ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname binary-k8s-worker1  &amp;&amp; systemctl reboot #binary-k8s-worker1 ï¼ˆ192.168.0.10ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname binary-k8s-worker2  &amp;&amp; systemctl reboot #binary-k8s-worker2 ï¼ˆ192.168.0.11ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname binary-k8s-master2 &amp;&amp; systemctl reboot #binary-k8s-master2ï¼ˆ192.168.0.12ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æ·»åŠ hosts
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.0.9 binary-k8s-master1
192.168.0.10 binary-k8s-worker1
192.168.0.11 binary-k8s-worker2
192.168.0.12 binary-k8s-master2
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å°†æ¡¥æ¥çš„IPV4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>è®©é…ç½®ç”Ÿæ•ˆ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sysctl --system  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨é˜¿é‡Œäº‘æ—¶é—´æœåŠ¡å™¨è¿›è¡Œä¸´æ—¶åŒæ­¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ntpdate ntp.aliyun.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è¡¥å……å‘½ä»¤
setenforce 0  #ä¸´æ—¶å…³é—­selinux
swapoff -a	#ä¸´æ—¶å…³é—­swap
</code></pre><h3 id="_8-5-2ä¸‹è½½æ‰€æœ‰ç”¨åˆ°çš„è½¯ä»¶åŒ…" tabindex="-1"><a class="header-anchor" href="#_8-5-2ä¸‹è½½æ‰€æœ‰ç”¨åˆ°çš„è½¯ä»¶åŒ…" aria-hidden="true">#</a> 8.5.2ä¸‹è½½æ‰€æœ‰ç”¨åˆ°çš„è½¯ä»¶åŒ…</h3><pre><code>å®‰è£…curl
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install curl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆ›å»ºç›®å½•ååˆ‡æ¢åˆ°è¯¥ç›®å½•ä¸­ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸­ä¸‹è½½æœ¬æ¬¡å®‰è£…æ‰€æœ‰ç”¨åˆ°çš„è½¯ä»¶åŒ…
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/k8s &amp;&amp;
cd /opt/k8s &amp;&amp;
curl -fL -u software-1658989668964:1db7b96a6698ef06009de91348cb797dfd87fc99 \
&quot;https://lingwh-generic.pkg.coding.net/coding-drive/software/kubernetes-all-2022.7.28.tar.gz?version=latest&quot; \
-o kubernetes-all.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>è§£å‹taråŒ…å¹¶é‡å‘½å
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tar -zxvf kubernetes-all.tar.gz &amp;&amp;
mv kubernetes package
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-6-å®‰è£…cfsslè¯ä¹¦ç”Ÿæˆå·¥å…·" tabindex="-1"><a class="header-anchor" href="#_8-6-å®‰è£…cfsslè¯ä¹¦ç”Ÿæˆå·¥å…·" aria-hidden="true">#</a> 8.6.å®‰è£…cfsslè¯ä¹¦ç”Ÿæˆå·¥å…·</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>8.4ç« èŠ‚æ¶‰åŠåˆ°çš„æ“ä½œåªåœ¨Master Node1èŠ‚ç‚¹ä¸Šè¿›è¡Œæ“ä½œ</p></div><pre><code>cfsslç®€ä»‹
cfsslæ˜¯ä¸€ä¸ªå¼€æºçš„è¯ä¹¦ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨jsonæ–‡ä»¶ç”Ÿæˆè¯ä¹¦ï¼Œç›¸æ¯”opensslæ›´æ–¹ä¾¿ä½¿ç”¨,è¿™é‡Œåœ¨Master Node1èŠ‚ç‚¹æ“ä½œåå¤
åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œä¸éœ€è¦åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ“ä½œã€‚

åˆ‡æ¢åˆ°å­˜æ”¾cfssl-utilsçš„ç›®å½•ä¸­ï¼Œç»™cfssl-utilsèµ‹äºˆè¿è¡Œæƒé™å¹¶æ‹·è´ä¸€ä»½åˆ°/usr/bin/ç›®å½•ä¸­
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/cfssl-utils &amp;&amp; chmod +x * &amp;&amp;
cp cfssl_linux-amd64 /usr/local/bin/cfssl &amp;&amp;
cp cfssljson_linux-amd64 /usr/local/bin/cfssljson &amp;&amp;
cp cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-7-æ­å»ºetcdé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_8-7-æ­å»ºetcdé›†ç¾¤" aria-hidden="true">#</a> 8.7.æ­å»ºetcdé›†ç¾¤</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>8.5ç« èŠ‚æ¶‰åŠåˆ°çš„æ“ä½œä¸è¦ä¸€æ¬¡æ€§åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ“ä½œï¼Œåœ¨Master1æ“ä½œåå¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œè¿™æ ·æ¯”ç›´æ¥åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ“ä½œè¦å¿«</p></div><h3 id="_8-7-1ç”Ÿæˆcaè¯ä¹¦å’Œhttpsè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-7-1ç”Ÿæˆcaè¯ä¹¦å’Œhttpsè¯ä¹¦" aria-hidden="true">#</a> 8.7.1ç”ŸæˆCAè¯ä¹¦å’Œhttpsè¯ä¹¦</h3><pre><code>åˆ›å»ºå­˜æ”¾etcdè¯ä¹¦é…ç½®æ–‡ä»¶å’Œç”Ÿæˆè¯ä¹¦çš„ç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p ~/TLS/{etcd,k8s} &amp;&amp; cd /root/TLS/etcd/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è®¾ç½®è‡ªç­¾è¯ä¹¦é¢å‘æœºæ„(CA)
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; ca-config.json &lt;&lt; EOF
{
  &quot;signing&quot;: {
    &quot;default&quot;: {
      &quot;expiry&quot;: &quot;87600h&quot;
    },
    &quot;profiles&quot;: {
      &quot;www&quot;: {
         &quot;expiry&quot;: &quot;87600h&quot;,
         &quot;usages&quot;: [
            &quot;signing&quot;,
            &quot;key encipherment&quot;,
            &quot;server auth&quot;,
            &quot;client auth&quot;
        ]
      }
    }
  }
}
EOF

cat &gt; ca-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;etcd CA&quot;,
    &quot;key&quot;: {
        &quot;algo&quot;: &quot;rsa&quot;,
        &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
        {
            &quot;C&quot;: &quot;CN&quot;,
            &quot;L&quot;: &quot;YuMingYu&quot;,
            &quot;ST&quot;: &quot;YuMingYu&quot;
        }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç”Ÿæˆè‡ªç­¾CAè¯ä¹¦ï¼ˆå½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆ ca.pemå’Œca-key.pemæ–‡ä»¶ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨è‡ªç­¾CAç­¾å‘etcd httpsè¯ä¹¦	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; server-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;etcd&quot;,
    &quot;hosts&quot;: [
    &quot;192.168.0.9&quot;,
    &quot;192.168.0.10&quot;,
    &quot;192.168.0.11&quot;,
    &quot;192.168.0.12&quot;
    ],
    &quot;key&quot;: {
        &quot;algo&quot;: &quot;rsa&quot;,
        &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
        {
            &quot;C&quot;: &quot;CN&quot;,
            &quot;L&quot;: &quot;YuMingYu&quot;,
            &quot;ST&quot;: &quot;YuMingYu&quot;
        }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç”Ÿæˆhttpsè¯ä¹¦ï¼ˆhostså­—æ®µä¸­ipä¸ºæ‰€æœ‰etcdèŠ‚ç‚¹çš„é›†ç¾¤å†…éƒ¨é€šä¿¡ip,ä¸€ä¸ªéƒ½ä¸èƒ½å°‘,å¯ä»¥å¤šå†™å‡ ä¸ªé¢„ç•™çš„ipï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
	-config=ca-config.json -profile=www server-csr.json | cfssljson -bare server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-7-2-éƒ¨ç½²etcdé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_8-7-2-éƒ¨ç½²etcdé›†ç¾¤" aria-hidden="true">#</a> 8.7.2.éƒ¨ç½²etcdé›†ç¾¤</h3><pre><code>etcdç®€ä»‹
Etcd æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼ŒKubernetesä½¿ç”¨Etcdè¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ‰€ä»¥å…ˆå‡†å¤‡ä¸€ä¸ªEtcdæ•°æ®åº“ï¼Œä¸ºè§£å†³Etcdå•ç‚¹
æ•…éšœï¼Œåº”é‡‡ç”¨é›†ç¾¤æ–¹å¼éƒ¨ç½²ï¼Œè¿™é‡Œä½¿ç”¨3å°ç»„å»ºé›†ç¾¤ï¼Œå¯å®¹å¿1å°æœºå™¨æ•…éšœï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨5å°ç»„å»ºé›†ç¾¤ï¼Œå¯å®¹å¿2å°
æœºå™¨æ•…éšœ
				
æœåŠ¡å™¨è§„åˆ’
èŠ‚ç‚¹åç§°	IP
etcd-1	192.168.0.9
etcd-2	192.168.0.10
etcd-2	192.168.0.11
ç‰¹åˆ«è¯´æ˜
ä¸ºäº†èŠ‚çœæœºå™¨,è¿™é‡Œä¸k8sèŠ‚ç‚¹å¤ç”¨,ä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨k8sæœºå™¨ä¹‹å¤–,åªè¦apiserverèƒ½è¿æ¥åˆ°å°±è¡Œã€‚

åœ¨Master Node1ä¸Šåˆ›å»ºetcdå·¥ä½œç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	mkdir /opt/etcd/{bin,cfg,ssl} -p
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆ‡æ¢åˆ°å­˜æ”¾etcdå®‰è£…åŒ…å·¥ä½œçš„ç›®å½•å¹¶è§£å‹etcdäºŒè¿›åˆ¶åŒ…å®‰è£…åŒ…åˆ°æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package &amp;&amp;
tar -xf etcd-v3.4.9-linux-amd64.tar.gz &amp;&amp;
mv etcd-v3.4.9-linux-amd64/{etcd,etcdctl} /opt/etcd/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ›å»ºetcdé…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/etcd/cfg/etcd.conf &lt;&lt; EOF
#[Member]
ETCD_NAME=&quot;etcd-1&quot;
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.9:2380&quot;
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.9:2379&quot;

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.9:2380&quot;
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.9:2379&quot;
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,\
etcd-2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>etcdé…ç½®è¯´æ˜:
ETCD_NAMEï¼š èŠ‚ç‚¹åç§°,é›†ç¾¤ä¸­å”¯ä¸€
ETCD_DATA_DIRï¼šæ•°æ®ç›®å½•
ETCD_LISTEN_PEER_URLSï¼šé›†ç¾¤é€šè®¯ç›‘å¬åœ°å€
ETCD_LISTEN_CLIENT_URLSï¼šå®¢æˆ·ç«¯è®¿é—®ç›‘å¬åœ°å€
ETCD_INITIAL_CLUSTERï¼šé›†ç¾¤èŠ‚ç‚¹åœ°å€
ETCD_INITIALCLUSTER_TOKENï¼šé›†ç¾¤Token
ETCD_INITIALCLUSTER_STATEï¼šåŠ å…¥é›†ç¾¤çš„çŠ¶æ€ï¼šnewæ˜¯æ–°é›†ç¾¤,existingè¡¨ç¤ºåŠ å…¥å·²æœ‰é›†ç¾¤
</code></pre><h3 id="_8-7-4-æ‹·è´etcdæ‰€éœ€è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-7-4-æ‹·è´etcdæ‰€éœ€è¯ä¹¦" aria-hidden="true">#</a> 8.7.4.æ‹·è´etcdæ‰€éœ€è¯ä¹¦</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp ~/TLS/etcd/{server.pem,server-key.pem,ca.pem} /opt/etcd/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-7-5-è®©systemdç®¡ç†etcd" tabindex="-1"><a class="header-anchor" href="#_8-7-5-è®©systemdç®¡ç†etcd" aria-hidden="true">#</a> 8.7.5.è®©systemdç®¡ç†etcd</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/etcd.service &lt;&lt; EOF
[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
EnvironmentFile=/opt/etcd/cfg/etcd.conf
ExecStart=/opt/etcd/bin/etcd \
--cert-file=/opt/etcd/ssl/server.pem \
--key-file=/opt/etcd/ssl/server-key.pem \
--peer-cert-file=/opt/etcd/ssl/server.pem \
--peer-key-file=/opt/etcd/ssl/server-key.pem \
--trusted-ca-file=/opt/etcd/ssl/ca.pem \
--peer-trusted-ca-file=/opt/etcd/ssl/ca.pem \
--logger=zap
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-7-6-æ‹·è´etcdå®‰è£…æ–‡ä»¶åˆ°worker-node" tabindex="-1"><a class="header-anchor" href="#_8-7-6-æ‹·è´etcdå®‰è£…æ–‡ä»¶åˆ°worker-node" aria-hidden="true">#</a> 8.7.6.æ‹·è´etcdå®‰è£…æ–‡ä»¶åˆ°Worker Node</h3><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>åœ¨Master1 Nodeä¸Šæ‰§è¡Œä¸‹é¢æ“ä½œï¼Œåªéœ€è¦æ‹·è´åˆ°Worker Node1å’ŒWorker Node2å³å¯ï¼Œä¸éœ€è¦æ‹·è´åˆ°Master Node2</p></div><pre><code>åœ¨Worker Node1ä¸Šå’ŒWorker Node2ä¸Šåˆ›å»ºetcdå·¥ä½œç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	mkdir /opt/etcd/{bin,cfg,ssl} -p
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¤åˆ¶etcdå®‰è£…æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶åˆ°192.168.0.10æœºå™¨ä¸Š
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/etcd/ root@192.168.0.10:/opt &amp;&amp;
scp /usr/lib/systemd/system/etcd.service root@192.168.0.10:/usr/lib/systemd/system/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å¤åˆ¶etcdå®‰è£…æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶åˆ°192.168.0.11æœºå™¨ä¸Š
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/etcd/ root@192.168.0.11:/opt &amp;&amp;
scp /usr/lib/systemd/system/etcd.service root@192.168.0.11:/usr/lib/systemd/system/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹Worker Node1ï¼ˆ192.168.0.10ï¼‰ä¸­etcd.confé…ç½®ï¼Œä¸‹é¢å‘½ä»¤ä¼šç›´æ¥è¦†ç›–æ‹·è´è¿‡æ¥çš„é…ç½®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/etcd/cfg/etcd.conf &lt;&lt; EOF
#[Member]
ETCD_NAME=&quot;etcd-2&quot;
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.10:2380&quot;
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.10:2379&quot;

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.10:2380&quot;
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.10:2379&quot;
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,\
etcd-2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹åå†…å®¹	
ETCD_NAME=&quot;etcd-2&quot;	#æ­¤å¤„éœ€è¦ä¿®æ”¹
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.10:2380&quot; 	#æ­¤å¤„éœ€è¦ä¿®æ”¹
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.10:2379&quot; 	#æ­¤å¤„éœ€è¦ä¿®æ”¹

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.10:2380&quot; #æ­¤å¤„éœ€è¦ä¿®æ”¹
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.10:2379&quot; #æ­¤å¤„éœ€è¦ä¿®æ”¹
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,etcd-
2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
						
ä¿®æ”¹Worker Node2ï¼ˆ192.168.0.11ï¼‰ä¸­etcd.confé…ç½®ï¼Œä¸‹é¢å‘½ä»¤ä¼šç›´æ¥è¦†ç›–æ‹·è´è¿‡æ¥çš„é…ç½®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/etcd/cfg/etcd.conf &lt;&lt; EOF
#[Member]
ETCD_NAME=&quot;etcd-3&quot;
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.11:2380&quot;
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.11:2379&quot;

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.11:2380&quot;
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.11:2379&quot;
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,\
etcd-2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹åå†…å®¹
ETCD_NAME=&quot;etcd-3&quot;	#æ­¤å¤„éœ€è¦ä¿®æ”¹
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.11:2380&quot; 	#æ­¤å¤„éœ€è¦ä¿®æ”¹
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.11:2379&quot; 	#æ­¤å¤„éœ€è¦ä¿®æ”¹

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.11:2380&quot; #æ­¤å¤„éœ€è¦ä¿®æ”¹
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.11:2379&quot; #æ­¤å¤„éœ€è¦ä¿®æ”¹
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,etcd-
2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
</code></pre><h3 id="_8-7-7-å¯åŠ¨ä¸‰ä¸ªetcdå¹¶è®¾ç½®å¼€æœºè‡ªå¯" tabindex="-1"><a class="header-anchor" href="#_8-7-7-å¯åŠ¨ä¸‰ä¸ªetcdå¹¶è®¾ç½®å¼€æœºè‡ªå¯" aria-hidden="true">#</a> 8.7.7.å¯åŠ¨ä¸‰ä¸ªetcdå¹¶è®¾ç½®å¼€æœºè‡ªå¯</h3><pre><code>å¯åŠ¨å¤šä¸ªèŠ‚ç‚¹çš„etcd
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start etcd &amp;&amp;
systemctl enable etcd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æ³¨æ„äº‹é¡¹	
etcdé¡»å¤šä¸ªèŠ‚ç‚¹åŒæ—¶å¯åŠ¨,ä¸ç„¶æ‰§è¡Œsystemctl start etcdä¼šä¸€ç›´å¡åœ¨å‰å°,è¿æ¥å…¶ä»–èŠ‚ç‚¹,å»ºè®®é€šè¿‡æ‰¹é‡ç®¡ç†å·¥
å…·,æˆ–è€…è„šæœ¬åŒæ—¶å¯åŠ¨etcdã€‚

æ£€æŸ¥etcdé›†ç¾¤çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ETCDCTL_API=3 /opt/etcd/bin/etcdctl \
--cacert=/opt/etcd/ssl/ca.pem \
--cert=/opt/etcd/ssl/server.pem \
--key=/opt/etcd/ssl/server-key.pem \
--endpoints=&quot;https://192.168.0.9:2379,https://192.168.0.10:2379,https://192.168.0.11:2379&quot; \
endpoint health --write-out=table
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å¦‚æœå¯åŠ¨æˆåŠŸä¼šæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹:
+---------------------------+--------+-------------+-------+
|         ENDPOINT          | HEALTH |    TOOK     | ERROR |
+---------------------------+--------+-------------+-------+
|  https://192.168.0.9:2379 |   true | 44.421035ms |       |
| https://192.168.0.10:2379 |   true | 44.433731ms |       |
| https://192.168.0.11:2379 |   true | 50.266126ms |       |
+---------------------------+--------+-------------+-------+

etcdå¯åŠ¨é—®é¢˜æ’æŸ¥
å‘½ä»¤1
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>journalctl -u etcd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-8-å®‰è£…é…ç½®docker" tabindex="-1"><a class="header-anchor" href="#_8-8-å®‰è£…é…ç½®docker" aria-hidden="true">#</a> 8.8.å®‰è£…é…ç½®Docker</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…dockerï¼Œå¯ä»¥å…ˆåœ¨Master Node1ä¸Šå®‰è£…ï¼Œæ‹·è´ä¸€éƒ¨åˆ†å®‰è£…å†…å®¹åˆ°Worker Node1å’ŒWorker Node2ï¼Œå†åœ¨Worker Node1å’ŒWorker Node2å®Œæˆå‰©ä½™çš„å®‰è£…æ“ä½œï¼Œè¿™æ ·æ¯”ç›´æ¥åœ¨ä¸‰å°æœºå™¨ä¸Šå®Œæˆå…¨éƒ¨æ“ä½œè¦å¿«å¾ˆå¤š</p></div><h3 id="_8-8-1åœ¨master1ä¸Šå®‰è£…docker" tabindex="-1"><a class="header-anchor" href="#_8-8-1åœ¨master1ä¸Šå®‰è£…docker" aria-hidden="true">#</a> 8.8.1åœ¨Master1ä¸Šå®‰è£…docker</h3><pre><code>åˆ‡æ¢ç›®å½•å¹¶åœ¨è¯¥ç›®å½•å¹¶å°†è¯¥ç›®å½•ä¸­çš„dockeräºŒè¿›åˆ¶å®‰è£…æ–‡ä»¶è§£å‹åˆ°æŒ‡å®šç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/ &amp;&amp;
tar -xf docker-19.03.9.tgz &amp;&amp; mv docker/* /usr/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®dockerç§æœ‰é•œåƒ	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo mkdir -p /etc/docker &amp;&amp;
sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;
{
  &quot;registry-mirrors&quot;: [&quot;https://3s9106.mirror.alncs.com&quot;]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®docker.serviceæ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/docker.service &lt;&lt; EOF
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target firewalld.service
Wants=network-online.target
 
[Service]
Type=notify
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
LimitNOFILE=infinity
LimitNPROC=infinity
TimeoutStartSec=0
Delegate=yes
KillMode=process
Restart=on-failure
StartLimitBurst=3
StartLimitInterval=60s
 
[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-8-2åœ¨æ‰€æœ‰worker-nodeä¸Šå®‰è£…docker" tabindex="-1"><a class="header-anchor" href="#_8-8-2åœ¨æ‰€æœ‰worker-nodeä¸Šå®‰è£…docker" aria-hidden="true">#</a> 8.8.2åœ¨æ‰€æœ‰Worker Nodeä¸Šå®‰è£…docker</h3><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>åªéœ€è¦åœ¨Master Node1ä¸Šå®‰è£…Dockerï¼Œç„¶åå°†æ‰€æœ‰å®‰è£…æ–‡ä»¶ä»Master Node1ä¸Šæ‹·è´åˆ°Worker Node1å’ŒWorker Node2ä¸Š</p></div><pre><code>åœ¨Worker Node1å’ŒWorker Node2ä¸Šåˆ›å»ºå­˜æ”¾dockerå®‰è£…æ–‡ä»¶çš„ç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/k8s/package &amp;&amp;
mkdir -p /etc/docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä»Mater1ä¸Šå¤åˆ¶Dockerå®‰è£…æ–‡ä»¶åˆ°Worker Node1å’ŒWorker Node2
Worker Node1ï¼ˆ192.168.0.10ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp /usr/bin/docker* root@192.168.0.10:/usr/bin &amp;&amp;
scp /usr/bin/runc root@192.168.0.10:/usr/bin &amp;&amp;
scp /usr/bin/containerd* root@192.168.0.10:/usr/bin &amp;&amp;
scp /usr/lib/systemd/system/docker.service \
root@192.168.0.10:/usr/lib/systemd/system &amp;&amp;
scp -r /etc/docker root@192.168.0.10:/etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Worker Node2ï¼ˆ192.168.0.11ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp /usr/bin/docker* root@192.168.0.11:/usr/bin &amp;&amp;
scp /usr/bin/runc root@192.168.0.11:/usr/bin &amp;&amp;
scp /usr/bin/containerd* root@192.168.0.11:/usr/bin &amp;&amp;
scp /usr/lib/systemd/system/docker.service \
root@192.168.0.11:/usr/lib/systemd/system &amp;&amp;
scp -r /etc/docker root@192.168.0.11:/etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-8-3å¯åŠ¨ä¸‰å°æœºå™¨ä¸Šçš„docker" tabindex="-1"><a class="header-anchor" href="#_8-8-3å¯åŠ¨ä¸‰å°æœºå™¨ä¸Šçš„docker" aria-hidden="true">#</a> 8.8.3å¯åŠ¨ä¸‰å°æœºå™¨ä¸Šçš„docker</h3><pre><code>åˆ·æ–°é…ç½®æ–‡ä»¶åå¯åŠ¨ä¸‰å°æœºå™¨ä¸Šçš„dockerå¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start docker &amp;&amp;
systemctl enable docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœæ’æŸ¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-9-æ­å»ºkube-apiserver" tabindex="-1"><a class="header-anchor" href="#_8-9-æ­å»ºkube-apiserver" aria-hidden="true">#</a> 8.9.æ­å»ºkube-apiserver</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>8.7ç« èŠ‚æ‰€æœ‰æ“ä½œåªåœ¨Master Node1èŠ‚ç‚¹æ“ä½œï¼Œä¸éœ€è¦åœ¨å…¶ä»–èŠ‚ç‚¹æ“ä½œï¼Œå› ä¸ºkube-apiserveræ˜¯MasterèŠ‚ç‚¹çš„ä¸“ç”¨ç»„ä»¶ï¼ŒWorker Nodeä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªç»„ä»¶</p></div><h3 id="_8-9-1-ç”Ÿæˆcaè¯ä¹¦å’Œhttpsè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-9-1-ç”Ÿæˆcaè¯ä¹¦å’Œhttpsè¯ä¹¦" aria-hidden="true">#</a> 8.9.1.ç”ŸæˆCAè¯ä¹¦å’ŒHttpsè¯ä¹¦</h3><pre><code>åˆ‡æ¢ç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è®¾ç½®CAè‡ªç­¾æœºæ„
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; ca-config.json &lt;&lt; EOF
{
  &quot;signing&quot;: {
    &quot;default&quot;: {
      &quot;expiry&quot;: &quot;87600h&quot;
    },
    &quot;profiles&quot;: {
      &quot;kubernetes&quot;: {
         &quot;expiry&quot;: &quot;87600h&quot;,
         &quot;usages&quot;: [
            &quot;signing&quot;,
            &quot;key encipherment&quot;,
            &quot;server auth&quot;,
            &quot;client auth&quot;
        ]
      }
    }
  }
}
EOF

cat &gt; ca-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;kubernetes&quot;,
    &quot;key&quot;: {
        &quot;algo&quot;: &quot;rsa&quot;,
        &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
        {
            &quot;C&quot;: &quot;CN&quot;,
            &quot;L&quot;: &quot;Beijing&quot;,
            &quot;ST&quot;: &quot;Beijing&quot;,
            &quot;O&quot;: &quot;k8s&quot;,
            &quot;OU&quot;: &quot;System&quot;
        }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç”Ÿæˆè‡ªç­¾CAè¯ä¹¦ï¼ˆç”ŸæˆæˆåŠŸç›®å½•ä¸‹å›å¤šca-key.pem  ca.csr  ca.pemï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨è‡ªç­¾CAç­¾å‘kube-apiserver https
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; server-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;kubernetes&quot;,
    &quot;hosts&quot;: [
      &quot;10.0.0.1&quot;,
      &quot;127.0.0.1&quot;,
      &quot;192.168.0.9&quot;,
      &quot;192.168.0.10&quot;,
      &quot;192.168.0.11&quot;,
      &quot;192.168.0.12&quot;,
      &quot;192.168.0.88&quot;,
      &quot;192.168.0.13&quot;,
      &quot;192.168.0.14&quot;,
      &quot;192.168.0.15&quot;,
      &quot;192.168.0.16&quot;,
      &quot;192.168.0.17&quot;,
      &quot;192.168.0.18&quot;,
      &quot;192.168.0.19&quot;,
      &quot;192.168.0.20&quot;,
      &quot;192.168.0.100&quot;,
      &quot;192.168.0.101&quot;,
      &quot;192.168.0.102&quot;,
      &quot;192.168.0.103&quot;,
      &quot;192.168.0.104&quot;,
      &quot;192.168.0.105&quot;,
      &quot;kubernetes&quot;,
      &quot;kubernetes.default&quot;,
      &quot;kubernetes.default.svc&quot;,
      &quot;kubernetes.default.svc.cluster&quot;,
      &quot;kubernetes.default.svc.cluster.local&quot;
    ],
    &quot;key&quot;: {
        &quot;algo&quot;: &quot;rsa&quot;,
        &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
        {
            &quot;C&quot;: &quot;CN&quot;,
            &quot;L&quot;: &quot;BeiJing&quot;,
            &quot;ST&quot;: &quot;BeiJing&quot;,
            &quot;O&quot;: &quot;k8s&quot;,
            &quot;OU&quot;: &quot;System&quot;
        }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å…³äºIPåœ°å€çš„è¯´æ˜
IPåœ°å€åˆ—è¡¨
	kubernetesè‡ªèº«ä½¿ç”¨çš„ClusterIPï¼š10.0.0.1
	æœ¬åœ°å›ç¯åœ°å€ï¼š127.0.0.1
	Master1:192.168.0.9
	worker1:192.168.0.10
	worker2:192.168.0.11
	Master2:168.168.0.12
	keepaliveè™šæ‹ŸIP: 192.168.0.88
	é¢„ç•™IPä½ç½®1ï¼š168.168.0.13
	é¢„ç•™IPä½ç½®2ï¼š168.168.0.14
	é¢„ç•™IPä½ç½®3ï¼š168.168.0.15
	é¢„ç•™IPä½ç½®4ï¼š168.168.0.17
	é¢„ç•™IPä½ç½®5ï¼š168.168.0.18
	é¢„ç•™IPä½ç½®6ï¼š168.168.0.19
	é¢„ç•™IPä½ç½®7ï¼š168.168.0.20
	é¢„ç•™IPä½ç½®8ï¼š168.168.0.100
	é¢„ç•™IPä½ç½®9ï¼š168.168.0.101
	é¢„ç•™IPä½ç½®10ï¼š168.168.0.102
	é¢„ç•™IPä½ç½®11ï¼š168.168.0.103
	é¢„ç•™IPä½ç½®12ï¼š168.168.0.104
	é¢„ç•™IPä½ç½®13ï¼š168.168.0.105

æ³¨æ„äº‹é¡¹
	å¦‚æœè¦éƒ¨ç½²ä¸€ä¸»å¤šä»éé«˜å¯ç”¨ä¸ç”¨åŠ keepaliveè™šæ‹ŸIP
	å¦‚æœè¦éƒ¨ç½²å¤šä¸»å¤šä»é«˜å¯ç”¨ä¸€å®šè¦åŠ ä¸Škeepaliveè™šæ‹ŸIP
	ä¸€å®šè¦å¤šé¢„ç•™å‡ ä¸ªIPåœ°å€ï¼Œè¿™ä¸ªIPåœ°å€æ˜¯ç•™ç»™ä»¥åé›†ç¾¤æ‰©å±•æ—¶Master Nodeæˆ–è€…Worker Nodeä½¿ç”¨çš„
	å¯ä»¥åˆ†ä¸€ä¸‹:ç›®å‰æ²¡æœ‰åˆ†åªæ˜¯ä¸ºäº†å­¦ä¹ ä½¿ç”¨
		Master Node:192.168.0.xxx
		Worker Node:192.168.1.xxx
		VIP		:192.168.3.xxx
</code></pre><p>â€‹ â€‹ ç”Ÿæˆhttpsè¯ä¹¦ï¼ˆå½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆserver.pem å’Œ server-key.pemæ–‡ä»¶ï¼‰</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \
-profile=kubernetes server-csr.json | cfssljson -bare server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-9-2-åœ¨master-node1ä¸Šéƒ¨ç½²kube-apiserver" tabindex="-1"><a class="header-anchor" href="#_8-9-2-åœ¨master-node1ä¸Šéƒ¨ç½²kube-apiserver" aria-hidden="true">#</a> 8.9.2.åœ¨Master Node1ä¸Šéƒ¨ç½²kube-apiserver</h3><pre><code>åˆ›å»ºkube-apiserverå·¥ä½œç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/kubernetes/{bin,cfg,ssl,logs}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆ‡æ¢ç›®å½•å¹¶è§£å‹kubernetesè½¯ä»¶åŒ…å¹¶å°†kube-apiserveræ‹·è´åˆ°æŒ‡å®šç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package &amp;&amp;
tar -zxvf kubernetes-server-linux-amd64.tar.gz &amp;&amp;
cd /opt/k8s/package/kubernetes/server/bin &amp;&amp;
cp kube-apiserver /opt/kubernetes/bin &amp;&amp;
cp kubectl /usr/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ›å»ºkube-apiserveré…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-apiserver.conf &lt;&lt; EOF
KUBE_APISERVER_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--etcd-servers=https://192.168.0.9:2379,https://192.168.0.10:2379,\
https://192.168.0.11:2379 \\
--bind-address=192.168.0.9 \\
--secure-port=6443 \\
--advertise-address=192.168.0.9 \\
--allow-privileged=true \\
--service-cluster-ip-range=10.0.0.0/24 \\
--enable-admission-plugins=NamespaceLifecycle,\
LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\
--authorization-mode=RBAC,Node \\
--enable-bootstrap-token-auth=true \\
--token-auth-file=/opt/kubernetes/cfg/token.csv \\
--service-node-port-range=30000-32767 \\
--kubelet-client-certificate=/opt/kubernetes/ssl/server.pem \\
--kubelet-client-key=/opt/kubernetes/ssl/server-key.pem \\
--tls-cert-file=/opt/kubernetes/ssl/server.pem  \\
--tls-private-key-file=/opt/kubernetes/ssl/server-key.pem \\
--client-ca-file=/opt/kubernetes/ssl/ca.pem \\
--service-account-key-file=/opt/kubernetes/ssl/ca-key.pem \\
--service-account-issuer=api \\
--service-account-signing-key-file=/opt/kubernetes/ssl/server-key.pem \\
--etcd-cafile=/opt/etcd/ssl/ca.pem \\
--etcd-certfile=/opt/etcd/ssl/server.pem \\
--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\
--requestheader-client-ca-file=/opt/kubernetes/ssl/ca.pem \\
--proxy-client-cert-file=/opt/kubernetes/ssl/server.pem \\
--proxy-client-key-file=/opt/kubernetes/ssl/server-key.pem \\
--requestheader-allowed-names=kubernetes \\
--requestheader-extra-headers-prefix=X-Remote-Extra- \\
--requestheader-group-headers=X-Remote-Group \\
--requestheader-username-headers=X-Remote-User \\
--enable-aggregator-routing=true \\
--audit-log-maxage=30 \\
--audit-log-maxbackup=3 \\
--audit-log-maxsize=100 \\
--audit-log-path=/opt/kubernetes/logs/k8s-audit.log&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®è¯´æ˜:
ä¸Šé¢ä¸¤ä¸ª\\ç¬¬ä¸€ä¸ªæ˜¯è½¬ä¹‰ç¬¦,ç¬¬äºŒä¸ªæ˜¯æ¢è¡Œç¬¦,ä½¿ç”¨è½¬ä¹‰ç¬¦æ˜¯ä¸ºäº†ä½¿ç”¨EOFä¿ç•™æ¢è¡Œç¬¦ã€‚
--logtostderr ï¼šå¯ç”¨æ—¥å¿—
--v ï¼šæ—¥å¿—ç­‰çº§
--log-dir ï¼šæ—¥å¿—ç›®å½•
--etcd-servers ï¼šetcdé›†ç¾¤åœ°å€
--bind-address ï¼šç›‘å¬åœ°å€
--secure-port ï¼šhttpså®‰å…¨ç«¯å£
--advertise-address ï¼šé›†ç¾¤é€šå‘Šåœ°å€
--allow-privileged ï¼šå¯åŠ¨æˆæƒ
--service-cluster-ip-range ï¼šServiceè™šæ‹ŸIPåœ°å€æ®µ
--enable-admission-plugins ï¼š å‡†å…¥æ§åˆ¶æ¨¡å—
--authorization-mode ï¼šè®¤è¯æˆæƒ,å¯ç”¨RBACæˆæƒå’ŒèŠ‚ç‚¹è‡ªç®¡ç†
--enable-bootstrap-token-auth ï¼šå¯ç”¨TLS bootstrapæœºåˆ¶
--token-auth-file ï¼šbootstrap tokenæ–‡ä»¶
--service-node-port-range ï¼šService nodeportç±»å‹é»˜è®¤åˆ†é…ç«¯å£èŒƒå›´
--kubelet-client-xxx ï¼šapiserverè®¿é—®kubeletå®¢æˆ·ç«¯è¯ä¹¦
--tls-xxx-file ï¼šapiserver httpsè¯ä¹¦
--etcd-xxxfile ï¼šè¿æ¥etcdé›†ç¾¤è¯ä¹¦
--audit-log-xxx ï¼šå®¡è®¡æ—¥å¿—
æ³¨æ„äº‹é¡¹
1.20ç‰ˆæœ¬å¿…é¡»åŠ çš„å‚æ•°ï¼š
--service-account-issuer
--service-account-signing-key-file
å¯åŠ¨èšåˆå±‚ç½‘å…³é…ç½®ï¼š
--requestheader-client-ca-file
--proxy-client-cert-file
--proxy-client-key-file
--requestheader-allowed-names
--requestheader-extra-headers-prefix
--requestheader-group-headers
--requestheader-username-headers
--enable-aggregator-routing
</code></pre><h3 id="_8-9-3-æ‹·è´æ‰€éœ€è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-9-3-æ‹·è´æ‰€éœ€è¯ä¹¦" aria-hidden="true">#</a> 8.9.3.æ‹·è´æ‰€éœ€è¯ä¹¦</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp ~/TLS/k8s/ca*pem ~/TLS/k8s/server*pem /opt/kubernetes/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-9-4-å¯ç”¨tls-bootstrapping" tabindex="-1"><a class="header-anchor" href="#_8-9-4-å¯ç”¨tls-bootstrapping" aria-hidden="true">#</a> 8.9.4.å¯ç”¨TLS bootstrapping</h3><pre><code>TLS Bootstrapingä»‹ç»
Master apiserverå¯ç”¨TLSè®¤è¯åï¼ŒNodeèŠ‚ç‚¹kubeletå’Œkube-proxyè¦ä¸kube-apiserverè¿›
è¡Œé€šä¿¡ï¼Œå¿…é¡»ä½¿ç”¨CAç­¾å‘çš„æœ‰æ•ˆè¯ä¹¦æ‰å¯ä»¥ï¼Œå½“NodeèŠ‚ç‚¹å¾ˆå¤šæ—¶ï¼Œè¿™ç§å®¢æˆ·ç«¯è¯ä¹¦é¢å‘éœ€è¦å¤§é‡å·¥ä½œï¼ŒåŒæ ·ä¹Ÿä¼šå¢åŠ é›†ç¾¤
æ‰©å±•å¤æ‚åº¦ã€‚ä¸ºäº†ç®€åŒ–æµç¨‹ï¼ŒKuberneteså¼•å…¥äº†TLS bootstrapingæœºåˆ¶æ¥è‡ªåŠ¨é¢å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œkubeletä¼šä»¥ä¸€ä¸ªä½
æƒé™ç”¨æˆ·è‡ªåŠ¨å‘apiserverç”³è¯·è¯ä¹¦ï¼Œkubeletçš„è¯ä¹¦ç”±apiserveråŠ¨æ€ç­¾ç½²ã€‚æ‰€ä»¥å¼ºçƒˆå»ºè®®åœ¨Nodeä¸Šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç›®
å‰ä¸»è¦ç”¨äºkubeletï¼Œkube-proxyè¿˜æ˜¯ç”±æˆ‘ä»¬ç»Ÿä¸€é¢å‘ä¸€ä¸ªè¯ä¹¦ã€‚

åˆ›å»ºä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­tokenæ–‡ä»¶ï¼šï¼ˆæ ¼å¼ï¼štoken,ç”¨æˆ·å,UID,ç”¨æˆ·ç»„ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/token.csv &lt;&lt; EOF
4136692876ad4b01bb9dd0988480ebba,kubelet-bootstrap,10001,&quot;system:node-bootstrapper&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æ³¨æ„äº‹é¡¹ï¼štokenä¹Ÿå¯è‡ªè¡Œç”Ÿæˆæ›¿æ¢
head -c 16 /dev/urandom | od -An -t x | tr -d &#39; &#39;
</code></pre><h3 id="_8-9-5-è®©systemdç®¡ç†apiserver" tabindex="-1"><a class="header-anchor" href="#_8-9-5-è®©systemdç®¡ç†apiserver" aria-hidden="true">#</a> 8.9.5.è®©systemdç®¡ç†apiserver</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; EOF
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf
ExecStart=/opt/kubernetes/bin/kube-apiserver \$KUBE_APISERVER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-9-6-å¯åŠ¨kube-apiserver" tabindex="-1"><a class="header-anchor" href="#_8-9-6-å¯åŠ¨kube-apiserver" aria-hidden="true">#</a> 8.9.6.å¯åŠ¨kube-apiserver</h3><pre><code>åˆ·æ–°é…ç½®æ–‡ä»¶åå¯åŠ¨kube-apiserverå¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-apiserver &amp;&amp;
systemctl enable kube-apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kube-apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœæ’æŸ¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kube-apiserver|grep -i error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-10-åœ¨master-node1ä¸Šéƒ¨ç½²kube-controller-manager" tabindex="-1"><a class="header-anchor" href="#_8-10-åœ¨master-node1ä¸Šéƒ¨ç½²kube-controller-manager" aria-hidden="true">#</a> 8.10.åœ¨Master Node1ä¸Šéƒ¨ç½²kube-controller-manager</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>8.8ç« èŠ‚æ‰€æœ‰æ“ä½œåªåœ¨Master Node1èŠ‚ç‚¹æ“ä½œï¼Œä¸éœ€è¦åœ¨å…¶ä»–èŠ‚ç‚¹æ“ä½œï¼Œå› ä¸ºkube-controller-manageræ˜¯MasterèŠ‚ç‚¹çš„ä¸“ç”¨ç»„ä»¶ï¼ŒWorker Nodeä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªç»„ä»¶</p></div><h3 id="_8-10-1-åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-controller-managerç›¸å…³æ–‡ä»¶åˆ°-opt-kubernetes-bin" tabindex="-1"><a class="header-anchor" href="#_8-10-1-åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-controller-managerç›¸å…³æ–‡ä»¶åˆ°-opt-kubernetes-bin" aria-hidden="true">#</a> 8.10.1.åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-controller-managerç›¸å…³æ–‡ä»¶åˆ°/opt/kubernetes/bin</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp /opt/k8s/package/kubernetes/server/bin/kube-controller-manager /opt/kubernetes/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-10-2-ç”Ÿæˆè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-10-2-ç”Ÿæˆè¯ä¹¦" aria-hidden="true">#</a> 8.10.2.ç”Ÿæˆè¯ä¹¦</h3><pre><code>åˆ‡æ¢å·¥ä½œç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç”ŸæˆCAè‡ªç­¾ç­¾è¯
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; kube-controller-manager-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;system:kube-controller-manager&quot;,
    &quot;hosts&quot;: [],
    &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
    {
        &quot;C&quot;: &quot;CN&quot;,
        &quot;L&quot;: &quot;BeiJing&quot;, 
        &quot;ST&quot;: &quot;BeiJing&quot;,
        &quot;O&quot;: &quot;system:masters&quot;,
        &quot;OU&quot;: &quot;System&quot;
    }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨CAè‡ªç­¾è¯ä¹¦ç­¾å‘kube-controller-manager
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
-config=ca-config.json -profile=kubernetes \
kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-10-2-åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-10-2-åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 8.10.2.åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-controller-manager.conf &lt;&lt; EOF
KUBE_CONTROLLER_MANAGER_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--leader-elect=true \\
--kubeconfig=/opt/kubernetes/cfg/kube-controller-manager.kubeconfig \\
--bind-address=127.0.0.1 \\
--allocate-node-cidrs=true \\
--cluster-cidr=10.244.0.0/16 \\
--service-cluster-ip-range=10.0.0.0/24 \\
--cluster-signing-cert-file=/opt/kubernetes/ssl/ca.pem \\
--cluster-signing-key-file=/opt/kubernetes/ssl/ca-key.pem  \\
--root-ca-file=/opt/kubernetes/ssl/ca.pem \\
--service-account-private-key-file=/opt/kubernetes/ssl/ca-key.pem \\
--cluster-signing-duration=87600h0m0s&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®æ–‡ä»¶è¯´æ˜		
--kubeconfig ï¼šè¿æ¥apiserveré…ç½®æ–‡ä»¶ã€‚
--leader-elect ï¼šå½“è¯¥ç»„ä»¶å¯åŠ¨å¤šä¸ªæ—¶,è‡ªåŠ¨é€‰ä¸¾(HA)
--cluster-signing-cert-file ï¼šè‡ªåŠ¨ä¸ºkubeleté¢å‘è¯ä¹¦çš„CA,apiserverä¿æŒä¸€è‡´
--cluster-signing-key-file ï¼šè‡ªåŠ¨ä¸ºkubeleté¢å‘è¯ä¹¦çš„CA,apiserverä¿æŒä¸€è‡´	
</code></pre><h3 id="_8-10-3-ç”Ÿæˆé…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-10-3-ç”Ÿæˆé…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 8.10.3.ç”Ÿæˆé…ç½®æ–‡ä»¶</h3><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>ä»¥ä¸‹æ˜¯shellå‘½ä»¤,ç›´æ¥åœ¨shellç»ˆç«¯æ‰§è¡Œ</p></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KUBE_CONFIG=&quot;/opt/kubernetes/cfg/kube-controller-manager.kubeconfig&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot;

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-controller-manager \
  --client-certificate=./kube-controller-manager.pem \
  --client-key=./kube-controller-manager-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-controller-manager \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-10-4-è®©systemdç®¡ç†controller-manager" tabindex="-1"><a class="header-anchor" href="#_8-10-4-è®©systemdç®¡ç†controller-manager" aria-hidden="true">#</a> 8.10.4.è®©systemdç®¡ç†controller-manager</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Controller Manager
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf
ExecStart=/opt/kubernetes/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-10-5-å¯åŠ¨kube-controller-manager" tabindex="-1"><a class="header-anchor" href="#_8-10-5-å¯åŠ¨kube-controller-manager" aria-hidden="true">#</a> 8.10.5.å¯åŠ¨kube-controller-manager</h3><pre><code>åˆ·æ–°é…ç½®æ–‡ä»¶åå¯åŠ¨kube-controller-managerå¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-controller-manager &amp;&amp;
systemctl enable kube-controller-manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹kube-controller-managerå¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kube-controller-manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœæ’æŸ¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kube-controller-manager|grep -i error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-11-éƒ¨ç½²kube-scheduler" tabindex="-1"><a class="header-anchor" href="#_8-11-éƒ¨ç½²kube-scheduler" aria-hidden="true">#</a> 8.11.éƒ¨ç½²kube-scheduler</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>8.9ç« èŠ‚æ‰€æœ‰æ“ä½œåªåœ¨Master Node1èŠ‚ç‚¹æ“ä½œï¼Œä¸éœ€è¦åœ¨å…¶ä»–èŠ‚ç‚¹æ“ä½œï¼Œå› ä¸ºkube-scheduleræ˜¯MasterèŠ‚ç‚¹çš„ä¸“ç”¨ç»„ä»¶ï¼ŒWorker Nodeä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªç»„ä»¶</p></div><h3 id="_8-10-1-åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-dchedulerç›¸å…³æ–‡ä»¶åˆ°-opt-kubernetes-bin" tabindex="-1"><a class="header-anchor" href="#_8-10-1-åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-dchedulerç›¸å…³æ–‡ä»¶åˆ°-opt-kubernetes-bin" aria-hidden="true">#</a> 8.10.1 åˆ‡æ¢ç›®å½•å¹¶æ‹·è´kube-dchedulerç›¸å…³æ–‡ä»¶åˆ°/opt/kubernetes/bin</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp /opt/k8s/package/kubernetes/server/bin/kube-scheduler /opt/kubernetes/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-11-2-ç”Ÿæˆè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-11-2-ç”Ÿæˆè¯ä¹¦" aria-hidden="true">#</a> 8.11.2.ç”Ÿæˆè¯ä¹¦</h3><pre><code>åˆ‡æ¢å·¥ä½œç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆ›å»ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; kube-scheduler-csr.json &lt;&lt; EOF
{
  &quot;CN&quot;: &quot;system:kube-scheduler&quot;,
  &quot;hosts&quot;: [],
  &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  },
  &quot;names&quot;: [
    {
      &quot;C&quot;: &quot;CN&quot;,
      &quot;L&quot;: &quot;BeiJing&quot;,
      &quot;ST&quot;: &quot;BeiJing&quot;,
      &quot;O&quot;: &quot;system:masters&quot;,
      &quot;OU&quot;: &quot;System&quot;
    }
  ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç”Ÿæˆè¯ä¹¦
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
-config=ca-config.json -profile=kubernetes \
kube-scheduler-csr.json | cfssljson -bare kube-scheduler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-11-3-åˆ›å»ºkube-scheduler-confé…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-11-3-åˆ›å»ºkube-scheduler-confé…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 8.11.3.åˆ›å»ºkube-scheduler.confé…ç½®æ–‡ä»¶</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-scheduler.conf &lt;&lt; EOF
KUBE_SCHEDULER_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--leader-elect \\
--kubeconfig=/opt/kubernetes/cfg/kube-scheduler.kubeconfig \\
--bind-address=127.0.0.1&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®æ–‡ä»¶è¯´æ˜
--kubeconfig ï¼šè¿æ¥apiserveré…ç½®æ–‡ä»¶
--leader-elect ï¼šå½“è¯¥ç»„ä»¶å¯åŠ¨å¤šä¸ªæ—¶,è‡ªåŠ¨é€‰ä¸¾(HA)ã€‚
</code></pre><h3 id="_8-11-4-ç”Ÿæˆkube-scheduler-kubeconfigæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-11-4-ç”Ÿæˆkube-scheduler-kubeconfigæ–‡ä»¶" aria-hidden="true">#</a> 8.11.4.ç”Ÿæˆkube-scheduler.kubeconfigæ–‡ä»¶</h3><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>åœ¨shellä¸­æ‰§è¡Œç›´æ¥æ‰§è¡Œä¸‹é¢å‘½ä»¤</p></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	mkdir ~/.kube
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KUBE_CONFIG=&quot;/opt/kubernetes/cfg/kube-scheduler.kubeconfig&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot;

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-scheduler \
  --client-certificate=./kube-scheduler.pem \
  --client-key=./kube-scheduler-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-scheduler \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-11-5-è®©systemdç®¡ç†kube-scheduler" tabindex="-1"><a class="header-anchor" href="#_8-11-5-è®©systemdç®¡ç†kube-scheduler" aria-hidden="true">#</a> 8.11.5.è®©systemdç®¡ç†kube-scheduler</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kube-scheduler.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Scheduler
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf
ExecStart=/opt/kubernetes/bin/kube-scheduler \$KUBE_SCHEDULER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-11-6-å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_8-11-6-å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨" aria-hidden="true">#</a> 8.11.6.å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h3><pre><code>åˆ·æ–°é…ç½®æ–‡ä»¶åå¯åŠ¨kube-schedulerå¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-scheduler &amp;&amp;
systemctl enable kube-scheduler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kube-scheduler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœæ’æŸ¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kube-scheduler|grep -i error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-12-ä½¿ç”¨kubectlæŸ¥çœ‹é›†ç¾¤çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#_8-12-ä½¿ç”¨kubectlæŸ¥çœ‹é›†ç¾¤çŠ¶æ€" aria-hidden="true">#</a> 8.12.ä½¿ç”¨kubectlæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>8.10ç« èŠ‚æ‰€æœ‰æ“ä½œåªåœ¨Master1èŠ‚ç‚¹æ“ä½œï¼Œä¸éœ€è¦åœ¨å…¶ä»–èŠ‚ç‚¹æ“ä½œï¼Œå› ä¸ºkubectlæ˜¯MasterèŠ‚ç‚¹çš„ä¸“ç”¨ç»„ä»¶ï¼ŒWorker Nodeä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªç»„ä»¶</p></div><h3 id="_8-12-1-ç”Ÿæˆæ‰€éœ€è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-12-1-ç”Ÿæˆæ‰€éœ€è¯ä¹¦" aria-hidden="true">#</a> 8.12.1.ç”Ÿæˆæ‰€éœ€è¯ä¹¦</h3><pre><code>åˆ‡æ¢å·¥ä½œç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨è‡ªç­¾CAç­¾å‘kubectlè¿æ¥é›†ç¾¤çš„è¯ä¹¦	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; admin-csr.json &lt;&lt;EOF
{
    &quot;CN&quot;: &quot;admin&quot;,
    &quot;hosts&quot;: [],
    &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
    {
        &quot;C&quot;: &quot;CN&quot;,
        &quot;L&quot;: &quot;BeiJing&quot;,
        &quot;ST&quot;: &quot;BeiJing&quot;,
        &quot;O&quot;: &quot;system:masters&quot;,
        &quot;OU&quot;: &quot;System&quot;
    }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç”Ÿæˆè¯ä¹¦
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
-config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-12-2-åœ¨-kubeæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆconfigæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-12-2-åœ¨-kubeæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆconfigæ–‡ä»¶" aria-hidden="true">#</a> 8.12.2.åœ¨.kubeæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆconfigæ–‡ä»¶</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir /root/.kube

KUBE_CONFIG=&quot;/root/.kube/config&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot;

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials cluster-admin \
  --client-certificate=./admin.pem \
  --client-key=./admin-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=cluster-admin \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-12-3-é€šè¿‡kubectlå·¥å…·æŸ¥çœ‹é›†ç¾¤ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-12-3-é€šè¿‡kubectlå·¥å…·æŸ¥çœ‹é›†ç¾¤ç»„ä»¶" aria-hidden="true">#</a> 8.12.3.é€šè¿‡kubectlå·¥å…·æŸ¥çœ‹é›†ç¾¤ç»„ä»¶</h3><pre><code>å‘½ä»¤
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get cs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>Master1èŠ‚ç‚¹ç»„ä»¶è¿è¡Œæ­£å¸¸ä¼šæ˜¾ç¤ºå¦‚ä¸‹ç»“æœ
NAME                 STATUS    MESSAGE             ERROR
controller-manager   Healthy   ok                  
scheduler            Healthy   ok                  
etcd-0               Healthy   {&quot;health&quot;:&quot;true&quot;}   
etcd-2               Healthy   {&quot;health&quot;:&quot;true&quot;}   
etcd-1               Healthy   {&quot;health&quot;:&quot;true&quot;} 
</code></pre><h3 id="_8-12-4-æˆæƒkubelet-bootstrapç”¨æˆ·å…è®¸è¯·æ±‚è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-12-4-æˆæƒkubelet-bootstrapç”¨æˆ·å…è®¸è¯·æ±‚è¯ä¹¦" aria-hidden="true">#</a> 8.12.4.æˆæƒkubelet-bootstrapç”¨æˆ·å…è®¸è¯·æ±‚è¯ä¹¦</h3><pre><code>åˆ›å»ºæˆæƒç”¨æˆ·kubelet-bootstrap
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create clusterrolebinding kubelet-bootstrap \
--clusterrole=system:node-bootstrapper \
--user=kubelet-bootstrap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¸Šé¢å¦‚æœä¸è¡Œç”¨è¿™ä¸ª
kubectl create clusterrolebinding kubelet-bootstrap \
--clusterrole=system:node-bootstrapper --user=kubelet-bootstrap --group=system:bootstrappers

è¡¥å……å‘½ä»¤
åˆ é™¤æˆæƒkubelet-bootstrapç”¨æˆ·ï¼šç¬¬ä¸€æ­¥
kubectl delete clusterrolebinding kubelet-bootstrap
åˆ é™¤æˆæƒkubelet-bootstrapç”¨æˆ·ï¼šç¬¬äºŒæ­¥
find / -name bootstrap.kubeconfig
rm -rf /opt/kubernetes/cfg/bootstrap.kubeconfig
åˆ é™¤æˆæƒkubelet-bootstrapç”¨æˆ·ï¼šç¬¬ä¸‰æ­¥
systemctl restart kubelet
</code></pre><h2 id="_8-13-åœ¨master-node1ä¸Šéƒ¨ç½²ç¬¬ä¸€ä¸ªworker-node" tabindex="-1"><a class="header-anchor" href="#_8-13-åœ¨master-node1ä¸Šéƒ¨ç½²ç¬¬ä¸€ä¸ªworker-node" aria-hidden="true">#</a> 8.13.åœ¨Master Node1ä¸Šéƒ¨ç½²ç¬¬ä¸€ä¸ªWorker Node</h2><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>8.11.ç« èŠ‚æ‰€æœ‰æ“ä½œåªåœ¨Master Node1èŠ‚ç‚¹æ“ä½œï¼Œå³å½“Master Node1æ—¢å……å½“Master Node,ä¹Ÿå½“Worker Node</p></div><pre><code>å°†Master Node1èŠ‚ç‚¹çš„k8s-serverè½¯ä»¶åŒ…æ‹·è´åˆ°æ‰€æœ‰Worker Node
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/kubernetes/server/bin/
cp kubelet  kube-proxy /opt/kubernetes/bin/ &amp;&amp;
scp kubelet  kube-proxy root@192.168.0.10:/opt/kubernetes/bin/ &amp;&amp;
scp kubelet  kube-proxy root@192.168.0.11:/opt/kubernetes/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-13-2-åœ¨master-node1éƒ¨ç½²kubelet" tabindex="-1"><a class="header-anchor" href="#_8-13-2-åœ¨master-node1éƒ¨ç½²kubelet" aria-hidden="true">#</a> 8.13.2.åœ¨Master Node1éƒ¨ç½²kubelet</h3><h4 id="_8-13-2-1-åˆ›å»ºkubeleté…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-13-2-1-åˆ›å»ºkubeleté…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 8.13.2.1.åˆ›å»ºkubeleté…ç½®æ–‡ä»¶</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kubelet.conf &lt;&lt; EOF
KUBELET_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--hostname-override=binary-k8s-master1 \\
--network-plugin=cni \\
--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\
--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\
--config=/opt/kubernetes/cfg/kubelet-config.yml \\
--cert-dir=/opt/kubernetes/ssl \\
--pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®è¯´æ˜
--hostname-override ï¼šæ˜¾ç¤ºåç§°,é›†ç¾¤å”¯ä¸€(ä¸å¯é‡å¤)ã€‚
--network-plugin ï¼šå¯ç”¨CNIã€‚
--kubeconfig ï¼š ç©ºè·¯å¾„,ä¼šè‡ªåŠ¨ç”Ÿæˆ,åé¢ç”¨äºè¿æ¥apiserverã€‚
--bootstrap-kubeconfig ï¼šé¦–æ¬¡å¯åŠ¨å‘apiserverç”³è¯·è¯ä¹¦ã€‚
--config ï¼šé…ç½®æ–‡ä»¶å‚æ•°ã€‚
--cert-dir ï¼škubeletè¯ä¹¦ç›®å½•ã€‚
--pod-infra-container-image ï¼šç®¡ç†Podç½‘ç»œå®¹å™¨çš„é•œåƒ init container
</code></pre><h4 id="_8-13-2-2-åˆ›å»ºkubeletç¼–æ’æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-13-2-2-åˆ›å»ºkubeletç¼–æ’æ–‡ä»¶" aria-hidden="true">#</a> 8.13.2.2.åˆ›å»ºkubeletç¼–æ’æ–‡ä»¶</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kubelet-config.yml &lt;&lt; EOF
kind: KubeletConfiguration
apiVersion: kubelet.config.k8s.io/v1beta1
address: 0.0.0.0
port: 10250
readOnlyPort: 10255
cgroupDriver: cgroupfs
clusterDNS:
- 10.0.0.2
clusterDomain: cluster.local 
failSwapOn: false
authentication:
  anonymous:
    enabled: false
  webhook:
    cacheTTL: 2m0s
    enabled: true
  x509:
    clientCAFile: /opt/kubernetes/ssl/ca.pem 
authorization:
  mode: Webhook
  webhook:
    cacheAuthorizedTTL: 5m0s
    cacheUnauthorizedTTL: 30s
evictionHard:
  imagefs.available: 15%
  memory.available: 100Mi
  nodefs.available: 10%
  nodefs.inodesFree: 5%
maxOpenFiles: 1000000
maxPods: 110
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-2-3-ç”Ÿæˆkubeletåˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼kubeconfigæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-13-2-3-ç”Ÿæˆkubeletåˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼kubeconfigæ–‡ä»¶" aria-hidden="true">#</a> 8.13.2.3.ç”Ÿæˆkubeletåˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼kubeconfigæ–‡ä»¶</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KUBE_CONFIG=&quot;/opt/kubernetes/cfg/bootstrap.kubeconfig&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot; # apiserver IP:PORT
TOKEN=&quot;4136692876ad4b01bb9dd0988480ebba&quot; # ä¸token.csvé‡Œä¿æŒä¸€è‡´  /opt/kubernetes/cfg/token.csv 

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials &quot;kubelet-bootstrap&quot; \
  --token=${TOKEN} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=&quot;kubelet-bootstrap&quot; \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-2-4-systemdç®¡ç†kubelet" tabindex="-1"><a class="header-anchor" href="#_8-13-2-4-systemdç®¡ç†kubelet" aria-hidden="true">#</a> 8.13.2.4.systemdç®¡ç†kubelet</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kubelet
After=docker.service

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-5-å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_8-13-3-5-å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨" aria-hidden="true">#</a> 8.13.3.5.å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h4><pre><code>åˆ·æ–°é…ç½®æ–‡ä»¶åå¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kubelet &amp;&amp;
systemctl enable kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœæ’æŸ¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_8-13-2-6-å…è®¸kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_8-13-2-6-å…è®¸kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤" aria-hidden="true">#</a> 8.13.2.6.å…è®¸kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤</h4><pre><code>æŸ¥çœ‹kubeletè¯ä¹¦ç­¾åè¯·æ±‚
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 bin]# kubectl get csr
NAME                                                   AGE	CONDITIO	...              
node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI   16s	Pending		...

æ‰‹åŠ¨æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl certificate approve node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å†æ¬¡ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹ç”³è¯·æ˜¯å¦é€šè¿‡
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 bin]# kubectl get csr
NAME                                                   AGE	CONDITIO	...              
node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI   16s	Approved	...

è¡¥å……å‘½ä»¤
æ‰‹åŠ¨æ‹’ç»è¯ä¹¦ç­¾åè¯·æ±‚
kubectl certificate deny node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI
åˆ é™¤å¤šä½™çš„csr
kubectl delete csr node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI

æŸ¥çœ‹èŠ‚ç‚¹ï¼ˆå¦‚æœä¸Šé¢æ­¥éª¤éƒ½æ²¡æœ‰é”™è¯¯è¿™ä¸ªæ­¥éª¤å¯ä»¥æŸ¥çœ‹åˆ°MasterèŠ‚ç‚¹ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 bin]# kubectl get nodes
NAME          STATUS     ROLES    AGE     VERSION
binary-k8s-master1   NotReady   &lt;none&gt;   2m10s   v1.20.0

æ³¨æ„äº‹é¡¹
ç”±äºç½‘ç»œæ’ä»¶è¿˜æ²¡æœ‰éƒ¨ç½²,èŠ‚ç‚¹ä¼šæ²¡æœ‰å‡†å¤‡å°±ç»ªNotReady
</code></pre><h3 id="_8-13-3-éƒ¨ç½²kube-proxy" tabindex="-1"><a class="header-anchor" href="#_8-13-3-éƒ¨ç½²kube-proxy" aria-hidden="true">#</a> 8.13.3.éƒ¨ç½²kube-proxy</h3><h4 id="_8-13-3-1-åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-13-3-1-åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 8.13.3.1.åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-proxy.conf &lt;&lt; EOF
KUBE_PROXY_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--config=/opt/kubernetes/cfg/kube-proxy-config.yml&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-2-é…ç½®å‚æ•°æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-13-3-2-é…ç½®å‚æ•°æ–‡ä»¶" aria-hidden="true">#</a> 8.13.3.2.é…ç½®å‚æ•°æ–‡ä»¶</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-proxy-config.yml &lt;&lt; EOF
kind: KubeProxyConfiguration
apiVersion: kubeproxy.config.k8s.io/v1alpha1
bindAddress: 0.0.0.0
metricsBindAddress: 0.0.0.0:10249
clientConnection:
  kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig
hostnameOverride: binary-k8s-master1
clusterCIDR: 10.244.0.0/16
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-3-ç”Ÿæˆkube-proxyè¯ä¹¦æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-13-3-3-ç”Ÿæˆkube-proxyè¯ä¹¦æ–‡ä»¶" aria-hidden="true">#</a> 8.13.3.3.ç”Ÿæˆkube-proxyè¯ä¹¦æ–‡ä»¶</h4><pre><code>åˆ‡æ¢å·¥ä½œç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆ›å»ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; kube-proxy-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;system:kube-proxy&quot;,
    &quot;hosts&quot;: [],
    &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
    {
        &quot;C&quot;: &quot;CN&quot;,
        &quot;L&quot;: &quot;BeiJing&quot;,
        &quot;ST&quot;: &quot;BeiJing&quot;,
        &quot;O&quot;: &quot;k8s&quot;,
        &quot;OU&quot;: &quot;System&quot;
    }
   ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç”Ÿæˆè¯ä¹¦
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
-config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-4-ç”Ÿæˆkube-proxy-kubeconfigæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-13-3-4-ç”Ÿæˆkube-proxy-kubeconfigæ–‡ä»¶" aria-hidden="true">#</a> 8.13.3.4.ç”Ÿæˆkube-proxy.kubeconfigæ–‡ä»¶</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KUBE_CONFIG=&quot;/opt/kubernetes/cfg/kube-proxy.kubeconfig&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot;

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-proxy \
  --client-certificate=./kube-proxy.pem \
  --client-key=./kube-proxy-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-proxy \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-5-systemdç®¡ç†kube-proxy" tabindex="-1"><a class="header-anchor" href="#_8-13-3-5-systemdç®¡ç†kube-proxy" aria-hidden="true">#</a> 8.13.3.5.systemdç®¡ç†kube-proxy</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Proxy
After=network.target

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-12-3-6-å¯åŠ¨kube-proxyå¹¶è®¾ç½®å¼€æœºè‡ªå¯" tabindex="-1"><a class="header-anchor" href="#_8-12-3-6-å¯åŠ¨kube-proxyå¹¶è®¾ç½®å¼€æœºè‡ªå¯" aria-hidden="true">#</a> 8.12.3.6.å¯åŠ¨kube-proxyå¹¶è®¾ç½®å¼€æœºè‡ªå¯</h4><pre><code>åˆ·æ–°é…ç½®æ–‡ä»¶åå¯åŠ¨kube-proxyå¹¶è®¾ç½®å¼€æœºå¯åŠ¨
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-proxy &amp;&amp;
systemctl enable kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å¯åŠ¨çŠ¶æ€æŸ¥è¯¢
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	systemctl status kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-13-4-éƒ¨ç½²ç½‘ç»œç»„ä»¶-calico" tabindex="-1"><a class="header-anchor" href="#_8-13-4-éƒ¨ç½²ç½‘ç»œç»„ä»¶-calico" aria-hidden="true">#</a> 8.13.4.éƒ¨ç½²ç½‘ç»œç»„ä»¶(Calico)</h3><pre><code>Calicoç®€ä»‹
Calicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼Œæ˜¯ç›®å‰Kubernetesä¸»æµçš„ç½‘ç»œæ–¹æ¡ˆã€‚

åˆ‡æ¢ç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /root/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è·å–Calico.yamlæ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>wget http://docs.projectcalico.org/v3.8/manifests/calico.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¤‡ä»½calico.yamlå¹¶ä¿®æ”¹calico.yaml
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp calico.yaml calico.yaml.bak &amp;&amp; 
sed -i &#39;s/192.168.0.0/10.244.0.0/g&#39; calico.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥è¯¢ä¿®æ”¹ç»“æœ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>grep &quot;IPV4POOL_CIDR&quot; calico.yaml  -A 1 \
		- name: CALICO_IPV4POOL_CIDR	\
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æ­£å¸¸ä¼šæ˜¾ç¤ºçº¿é¢å€¼
value: &quot;10.244.0.0/16&quot;

éƒ¨ç½²Calico
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f calico.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç­‰å¾…8åˆ†é’Ÿå·¦å³åæŸ¥çœ‹Calicoçš„Podè¿è¡ŒçŠ¶æ€ï¼ˆæ­£å¸¸æ˜¯STATUSæ˜¯Runningï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 k8s]# kubectl get pods -n kube-system
NAME                                      READY   STATUS    RESTARTS   AGE
calico-kube-controllers-bcc6f659f-r28g7   1/1     Running   0          18m
calico-node-dkjn6                         1/1     Running   6          18m

æ³¨æ„äº‹é¡¹
calicoéƒ¨ç½²å¾ˆæ…¢ï¼Œä¸è¿‡ä¸ç”¨ç­‰8åˆ†é’Ÿï¼Œæ‰§è¡Œkubectl applyå‘½ä»¤åç¨ç­‰ä¸€ä¼šå„¿å°±å¯ä»¥é€šè¿‡kubectl get nodes
æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€äº†

æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ï¼ˆæ­£å¸¸æ˜¯STATUSæ˜¯Readyï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 k8s]# kubectl get nodes
NAME          		  STATUS   ROLES    AGE   VERSION
binary-k8s-master1    Ready    &lt;none&gt;   34m   v1.20.0
</code></pre><h3 id="_8-13-5-æˆæƒapiserverè®¿é—®kubelet" tabindex="-1"><a class="header-anchor" href="#_8-13-5-æˆæƒapiserverè®¿é—®kubelet" aria-hidden="true">#</a> 8.13.5.æˆæƒapiserverè®¿é—®kubelet</h3><pre><code>åº”ç”¨åœºæ™¯ï¼šå¦‚kubectl logs

åˆ›å»ºé…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; apiserver-to-kubelet-rbac.yaml &lt;&lt; EOF
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: &quot;true&quot;
  labels:
    kubernetes.io/bootstrapping: rbac-defaults
  name: system:kube-apiserver-to-kubelet
rules:
  - apiGroups:
      - &quot;&quot;
    resources:
      - nodes/proxy
      - nodes/stats
      - nodes/log
      - nodes/spec
      - nodes/metrics
      - pods/log
    verbs:
      - &quot;*&quot;
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: system:kube-apiserver
  namespace: &quot;&quot;
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:kube-apiserver-to-kubelet
subjects:
  - apiGroup: rbac.authorization.k8s.io
    kind: User
    name: kubernetes
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åº”ç”¨é…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f apiserver-to-kubelet-rbac.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-14-å¢åŠ worker-node" tabindex="-1"><a class="header-anchor" href="#_8-14-å¢åŠ worker-node" aria-hidden="true">#</a> 8.14.å¢åŠ Worker Node</h2><h3 id="_8-14-1-åœ¨æ‰€æœ‰worker-nodeåˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-14-1-åœ¨æ‰€æœ‰worker-nodeåˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶" aria-hidden="true">#</a> 8.14.1.åœ¨æ‰€æœ‰Worker Nodeåˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶</h3><pre><code>åœ¨æ‰€æœ‰Worker Node1å’ŒWorker Node2ä¸­åˆ›å»ºå·¥ä½œç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/kubernetes/bin &amp;&amp;
mkdir -p /opt/kubernetes/cfg &amp;&amp;
mkdir -p /opt/kubernetes/ssl &amp;&amp;
mkdir -p /opt/kubernetes/logs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-14-2æ‹·è´master-node1ä¸Šéƒ¨ç½²å¥½çš„æ–‡ä»¶åˆ°worker-node" tabindex="-1"><a class="header-anchor" href="#_8-14-2æ‹·è´master-node1ä¸Šéƒ¨ç½²å¥½çš„æ–‡ä»¶åˆ°worker-node" aria-hidden="true">#</a> 8.14.2æ‹·è´Master Node1ä¸Šéƒ¨ç½²å¥½çš„æ–‡ä»¶åˆ°Worker Node</h3><pre><code>è¿›å…¥Master Node1ï¼Œæ‰§è¡Œä¸‹é¢æ“ä½œï¼Œé•œç›¸å…³æ–‡ä»¶æ‹·è´åˆ°Worker Node1å’ŒWorker Node2
æ‹·è´åˆ°Worker Node1ï¼ˆ192.168.0.10ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/kubernetes root@192.168.0.10:/opt/ &amp;&amp;
scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service \
root@192.168.0.10:/usr/lib/systemd/system &amp;&amp;
scp -r /opt/kubernetes/ssl/ca.pem root@192.168.0.10:/opt/kubernetes/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æ‹·è´åˆ°Worker Node2ï¼ˆ192.168.0.11ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/kubernetes root@192.168.0.11:/opt/ &amp;&amp;
scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service \
root@192.168.0.11:/usr/lib/systemd/system &amp;&amp;
scp -r /opt/kubernetes/ssl/ca.pem root@192.168.0.11:/opt/kubernetes/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-14-3-åˆ é™¤æ‰€æœ‰worker-nodeä¸­kubeletè¯ä¹¦å’Œkubeconfigæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-14-3-åˆ é™¤æ‰€æœ‰worker-nodeä¸­kubeletè¯ä¹¦å’Œkubeconfigæ–‡ä»¶" aria-hidden="true">#</a> 8.14.3.åˆ é™¤æ‰€æœ‰Worker Nodeä¸­kubeletè¯ä¹¦å’Œkubeconfigæ–‡ä»¶</h3><pre><code>Worker Node1èŠ‚ç‚¹ï¼ˆ192.168.0.10ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -f /opt/kubernetes/cfg/kubelet.kubeconfig &amp;&amp;
rm -f /opt/kubernetes/ssl/kubelet*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Worker Node2èŠ‚ç‚¹ï¼ˆ192.168.0.11ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -f /opt/kubernetes/cfg/kubelet.kubeconfig &amp;&amp;
rm -f /opt/kubernetes/ssl/kubelet*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>è¯´æ˜:
è¿™å‡ ä¸ªæ–‡ä»¶æ˜¯è¯ä¹¦ç”³è¯·å®¡æ‰¹åè‡ªåŠ¨ç”Ÿæˆçš„,æ¯ä¸ªNodeä¸åŒ,å¿…é¡»åˆ é™¤
</code></pre><h3 id="_8-14-4-ä¿®æ”¹worker-node1å’Œworker-node2ä¸»æœºå" tabindex="-1"><a class="header-anchor" href="#_8-14-4-ä¿®æ”¹worker-node1å’Œworker-node2ä¸»æœºå" aria-hidden="true">#</a> 8.14.4. ä¿®æ”¹Worker Node1å’ŒWorker Node2ä¸»æœºå</h3><pre><code>Worker Node1ï¼ˆ192.168.0.10ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s/--hostname-override=binary-k8s-master1/--hostname-override=binary-k8s-worker1/g&#39; \
/opt/kubernetes/cfg/kubelet.conf #ä¿®æ”¹--hostname-overrideçš„å€¼ä¸ºbinary-k8s-worker1
sed -i &#39;s/hostnameOverride: binary-k8s-master1/hostnameOverride: binary-k8s-worker1/g&#39; \
/opt/kubernetes/cfg/kube-proxy-config.yml #ä¿®æ”¹hostnameOverrideçš„å€¼binary-k8s-worker1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Worker Node2ï¼ˆ192.168.0.11ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s/--hostname-override=binary-k8s-master1/--hostname-override=binary-k8s-worker2/g&#39; \
/opt/kubernetes/cfg/kubelet.conf #ä¿®æ”¹--hostname-overrideçš„å€¼ä¸ºbinary-k8s-worker2
sed -i &#39;s/hostnameOverride: binary-k8s-master1/hostnameOverride: binary-k8s-worker2/g&#39; \
/opt/kubernetes/cfg/kube-proxy-config.yml #ä¿®æ”¹hostnameOverrideçš„å€¼binary-k8s-worker2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-14-5-å¯åŠ¨worker-node1å’Œworker-node2ä¸­kubeletå¹¶è®¾ç½®å¼€æœºè‡ªå¯" tabindex="-1"><a class="header-anchor" href="#_8-14-5-å¯åŠ¨worker-node1å’Œworker-node2ä¸­kubeletå¹¶è®¾ç½®å¼€æœºè‡ªå¯" aria-hidden="true">#</a> 8.14.5.å¯åŠ¨Worker Node1å’ŒWorker Node2ä¸­kubeletå¹¶è®¾ç½®å¼€æœºè‡ªå¯</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp; 
systemctl start kubelet kube-proxy &amp;&amp; 
systemctl enable kubelet kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯åŠ¨æ•…éšœè§£å†³
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-14-6-åœ¨master1ä¸ŠåŒæ„æ–°çš„node-kubeletè¯ä¹¦ç”³è¯·" tabindex="-1"><a class="header-anchor" href="#_8-14-6-åœ¨master1ä¸ŠåŒæ„æ–°çš„node-kubeletè¯ä¹¦ç”³è¯·" aria-hidden="true">#</a> 8.14.6.åœ¨Master1ä¸ŠåŒæ„æ–°çš„Node kubeletè¯ä¹¦ç”³è¯·</h3><pre><code>æŸ¥çœ‹è¯ä¹¦è¯·æ±‚
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 k8s]# kubectl get csr

NAME                                                    ... CONDITION         ...
node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI    ... Approved,Issued   ...
node-csr-TlSHYrzacOBQbJyQcfVwuArXPKRbjcoMESZykQ3Qr0w   ... Pending            ...
node-csr-vb-rAPL-grn0NxFGBs-_5pScCDkICmvHRnbhn_bRdsc    ... Pending           ...

æ‰‹åŠ¨æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl certificate approve node-csr-TlSHYrzacOBQbJyQcfVwuArXPKRbjcoMESZykQ3Qr0w
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl certificate approve node-csr-vb-rAPL-grn0NxFGBs-_5pScCDkICmvHRnbhn_bRdsc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹æ‰€æœ‰NodeçŠ¶æ€(è¦ç¨ç­‰ä¼šæ‰ä¼šå˜æˆready,ä¼šä¸‹è½½ä¸€äº›åˆå§‹åŒ–é•œåƒ)
æ³¨æ„äº‹é¡¹
åˆšåŠ å…¥Worker Node1å’ŒWorker Node2æ—¶ä½¿ç”¨kubectl get nodesæŸ¥çœ‹å¯èƒ½ä¼šå‡ºç°Worker Node NotReadyçŠ¶æ€ï¼Œç­‰
å¾…å¤§æ¦‚ä¸‰åˆ†é’Ÿå·¦å³å†ä½¿ç”¨kubectl get nodeså°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€éƒ½å·²ç»å°±ç»ªäº†
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# kubectl get nodes
NAME                  STATUS   ROLES    AGE   VERSION
binary-k8s-master1    Ready    &lt;none&gt;   79s   v1.20.0
binary-k8s-worker1    Ready    &lt;none&gt;   26m   v1.20.0
binary-k8s-worker2    Ready    &lt;none&gt;   26m   v1.20.0

è¡¥å……å‘½ä»¤
åˆ é™¤å¤šä½™çš„csr
kubectl delete csr node-csr-Rd_0WEaOFSkRT7geRKfz__I1v6E-CQfJpYwMTDEK-mw
</code></pre><h3 id="_8-14-7-åœ¨master1ä¸Šéƒ¨ç½²kubernetes-dashboard" tabindex="-1"><a class="header-anchor" href="#_8-14-7-åœ¨master1ä¸Šéƒ¨ç½²kubernetes-dashboard" aria-hidden="true">#</a> 8.14.7.åœ¨Master1ä¸Šéƒ¨ç½²kubernetes-dashboard</h3><pre><code>åˆ‡æ¢ç›®å½•å¹¶åœ¨è¯¥ç›®å½•ä¸­ä¸‹è½½kubernetes-dashboardå®‰è£…æ‰€éœ€è¦çš„yamlæ–‡ä»¶	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package &amp;&amp;
wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.4.0/aio/deploy/recommended.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹é…ç½®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim recommended.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç»™åç§°ä¸ºkubernetes-dashboardçš„Serviceä¸­æ·»åŠ type: NodePortå‚æ•°ï¼Œå¤§æ¦‚åœ¨245è¡Œå·¦å³
kind: Service
name: kubernetes-dashboard
spec:
  type: NodePort
  
å®‰è£…kubernetes-dashboard
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f recommended.yaml	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹éƒ¨ç½²æƒ…å†µ
æ³¨æ„äº‹é¡¹ï¼Œç­‰å¾…å¤§çº¦2åˆ†é’Ÿä½¿ç”¨kubectl get pods,svc -n kubernetes-dashboardæ‰èƒ½çœ‹åˆ°æ‰€æœ‰pods,svcçŠ¶æ€æ­£å¸¸
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods,svc -n kubernetes-dashboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 package]# kubectl get pods,svc -n kubernetes-dashboard
NAME                                             READY   STATUS    RESTARTS   AGE
pod/dashboard-metrics-scraper-5b8896d7fc-jj8vp   1/1     Running   0          60m
pod/kubernetes-dashboard-897c7599f-pdk9g         1/1     Running   0          60m

NAME                                TYPE        CLUSTER-IP  	 PORT(S)         AGE
service/dashboard-metrics-scraper   ClusterIP   10.0.0.254       8000/TCP        60m
service/kubernetes-dashboard        NodePort    10.0.0.173       443:30441/TCP   60m

åˆ›å»ºdashboard-adminä½¿ç”¨çš„service accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜é›†ç¾¤è§’è‰²
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create serviceaccount dashboard-admin -n kube-system
kubectl create clusterrolebinding dashboard-admin \
	--clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin
kubectl describe secrets -n kube-system \
$(kubectl -n kube-system get secret | awk &#39;/dashboard-admin/{print $1}&#39;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æŸ¥è¯¢token
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl describe secrets -n kube-system \
$(kubectl -n kube-system get secret | awk &#39;/dashboard-admin/{print $1}&#39;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>è®¿é—®kubernetes-dashboard,è¾“å…¥åˆšæ‰è·å¾—çš„tokenç™»å½•kubernetes-dashboard
https://192.168.0.9:30441/
https://192.168.0.10:30441/
https://192.168.0.11:30441/
</code></pre><h3 id="_8-14-8-åœ¨master1ä¸Šéƒ¨ç½²coredns" tabindex="-1"><a class="header-anchor" href="#_8-14-8-åœ¨master1ä¸Šéƒ¨ç½²coredns" aria-hidden="true">#</a> 8.14.8.åœ¨Master1ä¸Šéƒ¨ç½²CoreDNS</h3><pre><code>ä»‹ç»
CoreDNSä¸»è¦ç”¨äºé›†ç¾¤å†…éƒ¨Serviceåç§°è§£æã€‚

ä»kubernetesæºç åŒ…ä¸­è·å–coredns.yaml
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/kubernetes &amp;&amp; 
mkdir  kubernetes-src &amp;&amp;
tar fx kubernetes-src.tar.gz -C ./kubernetes-src &amp;&amp;
cd kubernetes-src/cluster/addons/dns/coredns/ &amp;&amp;
cp coredns.yaml.base coredns.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹coredns.yamlé…ç½®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CLUSTER_DNS_DOMAIN=&quot;cluster.local&quot;
CLUSTER_DNS_SVC_IP=&quot;10.0.0.2&quot;
CLUSTER_DNS_LIMIT_MEMORY=&quot;170Mi&quot;

sed -i -e &quot;s@__DNS__DOMAIN__@${CLUSTER_DNS_DOMAIN}@&quot; \
		-e &quot;s@__DNS__SERVER__@${CLUSTER_DNS_SVC_IP}@&quot; \
		-e &quot;s@__DNS__MEMORY__LIMIT__@${CLUSTER_DNS_LIMIT_MEMORY}@&quot; \
		coredns.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æ³¨æ„ï¼šCLUSTER_DNS_DOMAINå’ŒCLUSTER_DNS_SVC_IPçš„å€¼è¦å’Œåœ¨nodeèŠ‚ç‚¹çš„kubelet-config.yaml/kubelet-
config.yalä¸­clusterDNSå’ŒclusterDomainçš„å€¼ä¿æŒä¸€è‡´

ä¿®æ”¹coredns.yamlä¸­corednsé•œåƒä»“åº“åœ°å€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim coredns.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å°†135è¡Œk8s.gcr.io/coredns:1.6.7ä¿®æ”¹ä¸ºregistry.aliyuncs.com/google_containers/coredns:v1.8.6

åˆ›å»ºcorednsä½¿ç”¨çš„service accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜é›†ç¾¤è§’è‰²
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create serviceaccount coredns -n kube-system
kubectl create clusterrolebinding coredns \
	--clusterrole=cluster-admin --serviceaccount=kube-system:coredns
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>éƒ¨ç½²coredns
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f coredns.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹corednsçš„podæ˜¯å¦æ­£å¸¸
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@k8s-master1 yaml]# kubectl get pods -n kube-system
NAME                                      READY   STATUS    RESTARTS   AGE
calico-kube-controllers-97769f7c7-zcz5d   1/1     Running   1          47h
calico-node-5tnll                         1/1     Running   1          47h
calico-node-m8sdg                         1/1     Running   0          42m
calico-node-pqvk9                         1/1     Running   0          56m
coredns-6cc56c94bd-5hvfb                  1/1     Running   0          37s

å¯åŠ¨æ•…éšœæ’æŸ¥
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl logs PODNAME -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ç»™corednså¢åŠ å‰¯æœ¬ï¼Œå¢å¼ºé«˜å¯ç”¨æ€§ï¼ˆä¹Ÿå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl scale deployment coredns --replicas=2 -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åˆ›å»º kubernetesç”¨æˆ·
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create clusterrolebinding kube-apiserver:kubelet-apis \
--clusterrole=system:kubelet-api-admin --user kubernetes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨busyboxæµ‹è¯•è§£ææ˜¯å¦æ­£å¸¸

éƒ¨ç½²busybox
ç¼–å†™busyboxç¼–æ’æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; busybox.yaml &lt;&lt; EOF
apiVersion: v1
kind: Pod
metadata:
  name: busybox
  namespace: default
spec:
  containers:
  - name: busybox
    image: busybox:1.28.4
    command:
      - sleep
      - &quot;3600&quot;
    imagePullPolicy: IfNotPresent
  restartPolicy: Always
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ›å»ºbusybox
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create -f busybox.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>è¿›å…¥busyboxä¸­
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl exec -it busybox -- sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>ä½¿ç”¨busyboxæµ‹è¯•corednsæ˜¯å¦éƒ¨ç½²æˆåŠŸ
If you don&#39;t see a command prompt, try pressing enter.
/ # ns
nsenter   nslookup
/ # nslookup kubernetes
Server:    10.0.0.2
Address 1: 10.0.0.2 kube-dns.kube-system.svc.cluster.local

æŸ¥çœ‹corednsä¸€å…±éƒ¨ç½²äº†å‡ ä¸ªå‰¯æœ¬
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get deployments -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master2 ~]# kubectl get deployments -n kube-system
NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
calico-kube-controllers   1/1     1            1           168m
coredns                   2/2     2            2           147m
</code></pre><h2 id="_8-15-å¢åŠ master2èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_8-15-å¢åŠ master2èŠ‚ç‚¹" aria-hidden="true">#</a> 8.15.å¢åŠ Master2èŠ‚ç‚¹</h2><div class="custom-container danger"><p class="custom-container-title">ç‰¹åˆ«ç‰¹åˆ«æ³¨æ„</p><p>ä¸€å®šè¦å…ˆæ‰§è¡Œæœ€å¼€å§‹çš„8.1ç« èŠ‚å…¬å…±æ­¥éª¤ï¼Œå¦‚å…³é—­é˜²ç«å¢™ç­‰æ“ä½œï¼Œå¦åˆ™æ˜¯æˆåŠŸæ·»åŠ Master2èŠ‚ç‚¹çš„</p></div><h3 id="_8-15-1-kubernetesé›†ç¾¤æ¶æ„ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_8-15-1-kubernetesé›†ç¾¤æ¶æ„ç®€ä»‹" aria-hidden="true">#</a> 8.15.1.Kubernetesé›†ç¾¤æ¶æ„ç®€ä»‹</h3><pre><code>Kubernetesä½œä¸ºå®¹å™¨é›†ç¾¤ç³»ç»Ÿï¼Œé€šè¿‡å¥åº·æ£€æŸ¥+é‡å¯ç­–ç•¥å®ç°äº†Podæ•…éšœè‡ªæˆ‘ä¿®å¤èƒ½åŠ›ï¼Œé€šè¿‡è°ƒåº¦ç®—æ³•
å®ç°å°†Podåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¹¶ä¿æŒé¢„æœŸå‰¯æœ¬æ•°ï¼Œæ ¹æ®Nodeå¤±æ•ˆçŠ¶æ€è‡ªåŠ¨åœ¨å…¶ä»–Nodeæ‹‰èµ·Podï¼Œå®ç°äº†åº”ç”¨
å±‚çš„é«˜å¯ç”¨æ€§ã€‚é’ˆå¯¹Kubernetesé›†ç¾¤ï¼Œé«˜å¯ç”¨æ€§è¿˜åº”åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªå±‚é¢çš„è€ƒè™‘ï¼šEtcdæ•°æ®åº“çš„é«˜å¯ç”¨
æ€§å’ŒKubernetes Masterç»„ä»¶çš„é«˜å¯ç”¨æ€§ã€‚ è€ŒEtcdæˆ‘ä»¬å·²ç»é‡‡ç”¨3ä¸ªèŠ‚ç‚¹ç»„å»ºé›†ç¾¤å®ç°é«˜å¯ç”¨ï¼Œæœ¬
èŠ‚å°†å¯¹MasterèŠ‚ç‚¹é«˜å¯ç”¨è¿›è¡Œè¯´æ˜å’Œå®æ–½ã€‚MasterèŠ‚ç‚¹æ‰®æ¼”ç€æ€»æ§ä¸­å¿ƒçš„è§’è‰²ï¼Œé€šè¿‡ä¸æ–­ä¸å·¥ä½œèŠ‚ç‚¹
ä¸Šçš„Kubeletå’Œkube-proxyè¿›è¡Œé€šä¿¡æ¥ç»´æŠ¤æ•´ä¸ªé›†ç¾¤çš„å¥åº·å·¥ä½œçŠ¶æ€ã€‚å¦‚æœMasterèŠ‚ç‚¹æ•…éšœï¼Œå°†æ— 
æ³•ä½¿ç”¨kubectlå·¥å…·æˆ–è€…APIåšä»»ä½•é›†ç¾¤ç®¡ç†ã€‚MasterèŠ‚ç‚¹æœ‰ä¸‰ä¸ªé¢å¤–çš„ç»„ä»¶ï¼Œè¿™ä¸ªä¸‰ä¸ªç»„ä»¶å·¥ä½œèŠ‚
ç‚¹kubeapiserverã€kube-controller-managerå’Œkube-schedulerï¼Œå…¶ä¸­kube-controller-
managerå’Œkube-schedulerç»„ä»¶è‡ªèº«é€šè¿‡é€‰æ‹©æœºåˆ¶å·²ç»å®ç°äº†é«˜å¯ç”¨ï¼Œæ‰€ä»¥Masteré«˜å¯ç”¨ä¸»è¦é’ˆå¯¹
kube-apiserverç»„ä»¶ï¼Œè€Œè¯¥ç»„ä»¶æ˜¯ä»¥HTTP APIæä¾›æœåŠ¡ï¼Œå› æ­¤å¯¹ä»–é«˜å¯ç”¨ä¸WebæœåŠ¡å™¨ç±»ä¼¼ï¼Œå¢åŠ 
è´Ÿè½½å‡è¡¡å™¨å¯¹å…¶è´Ÿè½½å‡è¡¡å³å¯ï¼Œå¹¶ä¸”å¯æ°´å¹³æ‰©å®¹ã€‚	

å¤šä¸»å¤šä»æ¶æ„æ¶æ„æœåŠ¡å™¨è§„åˆ’	
</code></pre><table><thead><tr><th style="text-align:left;">è§’è‰²</th><th style="text-align:left;">IP</th><th style="text-align:center;">ç»„ä»¶</th></tr></thead><tbody><tr><td style="text-align:left;">binary-k8s-master1</td><td style="text-align:left;">192.168.0.9</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler <br> kubelet kube-proxy <br> nginx keepalived</td></tr><tr><td style="text-align:left;">binary-k8s-master2</td><td style="text-align:left;">192.168.0.12</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler <br> kubelet kube-proxy <br> nginx keepalived</td></tr><tr><td style="text-align:left;">binary-k8s-worker1</td><td style="text-align:left;">192.168.0.10</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">binary-k8s-worker2</td><td style="text-align:left;">192.168.0.11</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">è´Ÿè½½å‡è¡¡å™¨(è™šæ‹ŸIP)</td><td style="text-align:left;">192.168.0.88</td><td style="text-align:center;"></td></tr></tbody></table><div class="custom-container tip"><p class="custom-container-title">ç‰¹åˆ«è¯´æ˜</p><p>ç°åœ¨éœ€è¦å†å¢åŠ ä¸€å°æ–°æœåŠ¡å™¨ï¼Œä½œä¸ºMaster2 Nodeï¼ŒIPæ˜¯192.168.0.12ã€‚Master Node2 ä¸å·²éƒ¨ç½²çš„ Master Node1æ‰€æœ‰æ“ä½œä¸€è‡´ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€å°†Master1æ‰€æœ‰K8sæ–‡ä»¶æ‹·è´è¿‡æ¥ï¼Œå†ä¿®æ”¹ä¸‹æœåŠ¡å™¨IPå’Œä¸»æœºå å¯åŠ¨å³å¯ã€‚</p></div><h3 id="_8-15-2-ç»™master-node2å®‰è£…docker" tabindex="-1"><a class="header-anchor" href="#_8-15-2-ç»™master-node2å®‰è£…docker" aria-hidden="true">#</a> 8.15.2.ç»™Master Node2å®‰è£…Docker</h3><pre><code>è¿›å…¥Master Node1ï¼Œå°†dockerå®‰è£…æ–‡ä»¶æ‹·è´åˆ°Master Node2
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp /usr/bin/docker* root@192.168.0.12:/usr/bin &amp;&amp;
scp /usr/bin/runc root@192.168.0.12:/usr/bin &amp;&amp;
scp /usr/bin/containerd* root@192.168.0.12:/usr/bin &amp;&amp;
scp /usr/lib/systemd/system/docker.service \
root@192.168.0.12:/usr/lib/systemd/system &amp;&amp;
scp -r /etc/docker root@192.168.0.12:/etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>å¯åŠ¨Mater Node2ä¸Šçš„Dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp; systemctl start docker &amp;&amp; systemctl enable docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-15-5-ç»™master-node2èŠ‚ç‚¹æ‹·è´æ‰€æœ‰éœ€è¦çš„è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_8-15-5-ç»™master-node2èŠ‚ç‚¹æ‹·è´æ‰€æœ‰éœ€è¦çš„è¯ä¹¦" aria-hidden="true">#</a> 8.15.5.ç»™Master Node2èŠ‚ç‚¹æ‹·è´æ‰€æœ‰éœ€è¦çš„è¯ä¹¦</h3><pre><code>åœ¨Master Node2ä¸Šåˆ›å»ºetcdè¯ä¹¦ç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/etcd/ssl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>åœ¨Master1ä¸Šæ‹·è´Master1ä¸Šæ‰€æœ‰k8sæ–‡ä»¶å’Œetcdè¯ä¹¦åˆ°Master2
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/kubernetes root@192.168.0.12:/opt &amp;&amp;
scp -r /opt/etcd/ssl root@192.168.0.12:/opt/etcd &amp;&amp;
scp /usr/lib/systemd/system/kube* \
root@192.168.0.12:/usr/lib/systemd/system &amp;&amp;
scp /usr/bin/kubectl  root@192.168.0.12:/usr/bin &amp;&amp;
scp -r ~/.kube root@192.168.0.12:~
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åœ¨Master Node2ä¸Šåˆ é™¤æ—§çš„è¯ä¹¦ï¼ˆåˆ é™¤kubeletå’Œkubeconfigæ–‡ä»¶ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -f /opt/kubernetes/cfg/kubelet.kubeconfig &amp;&amp;
rm -f /opt/kubernetes/ssl/kubelet*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹Master2ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œä¸»æœºå
ä¿®æ”¹apiserverã€kubeletå’Œkube-proxyé…ç½®æ–‡ä»¶ä¸ºæœ¬åœ°IP
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kube-apiserver.conf 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>...
--bind-address=192.168.0.12 \
--advertise-address=192.168.0.12 \
...

ä¿®æ”¹kube-controller-manageré…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kube-controller-manager.kubeconfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>server: https://192.168.0.12:6443

ä¿®æ”¹kube-scheduleré…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kube-scheduler.kubeconfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>server: https://192.168.0.12:6443
ä¿®æ”¹kubeleté…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kubelet.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>--hostname-override=binary-k8s-master2

ä¿®æ”¹kube-proxyé…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kube-proxy-config.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>hostnameOverride: binary-k8s-master2
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi ~/.kube/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>...
server: https://192.168.0.12:6443
</code></pre><h3 id="_8-15-6-å¯åŠ¨masteræ‰€æœ‰æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯" tabindex="-1"><a class="header-anchor" href="#_8-15-6-å¯åŠ¨masteræ‰€æœ‰æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯" aria-hidden="true">#</a> 8.15.6.å¯åŠ¨Masteræ‰€æœ‰æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-apiserver &amp;&amp;
systemctl start kube-controller-manager &amp;&amp;
systemctl start kube-scheduler &amp;&amp;
systemctl start kubelet kube-proxy &amp;&amp;
systemctl enable kube-apiserver &amp;&amp;
systemctl enable kube-controller-manager &amp;&amp;
systemctl enable kube-scheduler &amp;&amp;
systemctl enable kubelet &amp;&amp;
systemctl enable kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-15-7-åœ¨masteræŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#_8-15-7-åœ¨masteræŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€" aria-hidden="true">#</a> 8.15.7.åœ¨MasteræŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€</h3><pre><code>æ³¨æ„ï¼šå¦‚æœä¸Šé¢æ“ä½œæ— è¯¯åˆ™è¿™ä¸€æ­¥å°±å¯ä»¥æŸ¥çœ‹åˆ°é›†ç¾¤ä¸­ç»„ä»¶çš„è¿è¡ŒçŠ¶æ€äº†

æŸ¥çœ‹ç»„ä»¶çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get cs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@localhost ~]# kubectl get cs
Warning: v1 ComponentStatus is deprecated in v1.19+
NAME                 STATUS    MESSAGE             ERROR
controller-manager   Healthy   ok 
scheduler            Healthy   ok   
etcd-2               Healthy   {&quot;health&quot;:&quot;true&quot;}
etcd-1               Healthy   {&quot;health&quot;:&quot;true&quot;}
etcd-0               Healthy   {&quot;health&quot;:&quot;true&quot;}
</code></pre><h3 id="_8-15-8-å®¡æ‰¹æ‰€æœ‰worker-nodeä¸Šçš„kubeletè¯ä¹¦ç”³è¯·" tabindex="-1"><a class="header-anchor" href="#_8-15-8-å®¡æ‰¹æ‰€æœ‰worker-nodeä¸Šçš„kubeletè¯ä¹¦ç”³è¯·" aria-hidden="true">#</a> 8.15.8.å®¡æ‰¹æ‰€æœ‰Worker Nodeä¸Šçš„kubeletè¯ä¹¦ç”³è¯·</h3><pre><code>æŸ¥çœ‹è¯ä¹¦ç”³è¯·
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@localhost ~]# kubectl get csr
NAME                                                   ... CONDITION ...
node-csr-Pkp1fPd9NZApJVRqRFlIIjskZ_gL_qDmcSWGvSuN-VQ   ... Pending	 ...

åŒæ„è¯ä¹¦ç”³è¯·
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl certificate approve node-csr-Pkp1fPd9NZApJVRqRFlIIjskZ_gL_qDmcSWGvSuN-VQ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å†æ¬¡æŸ¥çœ‹è¯ä¹¦ç”³è¯·
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@localhost ~]# kubectl get csr
NAME                                                  ... CONDITION 	  ...
node-csr-Pkp1fPd9NZApJVRqRFlIIjskZ_gL_qDmcSWGvSuN-VQ  ... Approved,Issued ...	

æŸ¥çœ‹èŠ‚ç‚¹åŠ å…¥çŠ¶æ€æ²¡ç­‰åˆ°æ‰€æœ‰podsçŠ¶æ€éƒ½å·²ç»å˜ä¸ºRunningï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# kubectl get pods -n kube-system
NAME                                      READY   STATUS     RESTARTS   AGE
calico-kube-controllers-bcc6f659f-7mf9n   1/1     Running    1          141m
calico-node-768sf                         1/1     Running    0          97m
calico-node-crhh4                         0/1     Init:2/3   0          2m7s
calico-node-hwbm9                         1/1     Running    0          98m
calico-node-vl4db                         1/1     Running    1          141m
coredns-7c878fc47b-n9nfd                  1/1     Running    0          75m
coredns-7c878fc47b-sxvz2                  1/1     Running    0          76m

æŸ¥çœ‹Node
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>binary-k8s-master1   Ready    &lt;none&gt;   153m   v1.20.0
binary-k8s-master2   Ready    &lt;none&gt;   17m    v1.20.0
binary-k8s-worker1   Ready    &lt;none&gt;   142m   v1.20.0
binary-k8s-worker2   Ready    &lt;none&gt;   141m   v1.20.0

è‡³æ­¤ä¸€ä¸ªåŒMasterèŠ‚ç‚¹k8sé›†ç¾¤å·²ç»éƒ¨ç½²å®Œæ¯•ï¼Œå†æ·»åŠ æ–°çš„MasterèŠ‚ç‚¹æ­¥éª¤å’Œä¸Šé¢çš„æ˜¯ç›¸åŒçš„
</code></pre><h2 id="_8-16-éƒ¨ç½²nginx-keepalivedé«˜å¯ç”¨è´Ÿè½½å‡è¡¡å™¨" tabindex="-1"><a class="header-anchor" href="#_8-16-éƒ¨ç½²nginx-keepalivedé«˜å¯ç”¨è´Ÿè½½å‡è¡¡å™¨" aria-hidden="true">#</a> 8.16.éƒ¨ç½²Nginx+Keepalivedé«˜å¯ç”¨è´Ÿè½½å‡è¡¡å™¨</h2><h3 id="_8-16-1-nginxå’Œkeepalivedç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_8-16-1-nginxå’Œkeepalivedç®€ä»‹" aria-hidden="true">#</a> 8.16.1.Nginxå’ŒKeepalivedç®€ä»‹</h3><pre><code>Nginxæ˜¯ä¸€ä¸ªä¸»æµWebæœåŠ¡å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œè¿™é‡Œç”¨å››å±‚å®ç°å¯¹apiserverå®ç°è´Ÿè½½å‡è¡¡ã€‚Keepalivedæ˜¯ä¸€ä¸ªä¸»æµé«˜å¯
ç”¨è½¯ä»¶ï¼ŒåŸºäºVIPç»‘å®šå®ç°æœåŠ¡å™¨åŒæœºçƒ­å¤‡ï¼Œåœ¨ä¸Šè¿°æ‹“æ‰‘ä¸­ï¼ŒKeepalivedä¸»è¦æ ¹æ®Nginxè¿è¡ŒçŠ¶æ€åˆ¤æ–­æ˜¯å¦éœ€è¦æ•…éšœè½¬ç§»
ï¼ˆæ¼‚ç§»VIPï¼‰ï¼Œä¾‹å¦‚å½“Nginxä¸»èŠ‚ç‚¹æŒ‚æ‰ï¼ŒVIPä¼šè‡ªåŠ¨ç»‘å®šåœ¨Nginxå¤‡èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯VIPä¸€ç›´å¯ç”¨ï¼Œå®ç°Nginxé«˜å¯ç”¨ã€‚
å¦‚æœä½ æ˜¯åœ¨å…¬æœ‰äº‘ä¸Šï¼Œä¸€èˆ¬éƒ½ä¸æ”¯æŒkeepalivedï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ç”¨å®ƒä»¬çš„è´Ÿè½½å‡è¡¡å™¨äº§å“ï¼Œç›´æ¥è´Ÿè½½å‡è¡¡å¤šå°Master 
kube-apiserverï¼Œæ¶æ„ä¸ä¸Šé¢ä¸€æ ·ã€‚
</code></pre><h3 id="_8-16-2-åœ¨ä¸¤å°master-nodeä¸Šå®‰è£…è½¯ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-16-2-åœ¨ä¸¤å°master-nodeä¸Šå®‰è£…è½¯ä»¶" aria-hidden="true">#</a> 8.16.2.åœ¨ä¸¤å°Master Nodeä¸Šå®‰è£…è½¯ä»¶</h3><pre><code>ä¸‹è½½nginxå’Œkeepalived
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum install epel-release -y &amp;&amp;
yum install nginx keepalived -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Nginxé…ç½®æ–‡ä»¶ï¼ˆMaster Node1å’ŒMaster Node2ç›¸åŒï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/nginx/nginx.conf &lt;&lt; &quot;EOF&quot;
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

stream {

    log_format main &#39;$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent&#39;;

    access_log  /var/log/nginx/k8s-access.log  main;

    upstream k8s-apiserver {
       server 192.168.0.9:6443;   # Master1 APISERVER IP:PORT
       server 192.168.0.12:6443;   # Master2 APISERVER IP:PORT
    }
    
    server {
       listen 16443; # ç”±äºnginxä¸masterèŠ‚ç‚¹å¤ç”¨ï¼Œè¿™ä¸ªç›‘å¬ç«¯å£ä¸èƒ½æ˜¯6443ï¼Œå¦åˆ™ä¼šå†²çª
       proxy_pass k8s-apiserver;
    }
}

http {
    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    server {
        listen       80 default_server;
        server_name  _;

        location / {
        }
    }
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Master Node1ä¸Šçš„keepalivedé…ç½®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; EOF
global_defs { 
   notification_email { 
     acassen@firewall.loc 
     failover@firewall.loc 
     sysadmin@firewall.loc 
   } 
   notification_email_from Alexandre.Cassen@firewall.loc  
   smtp_server 127.0.0.1 
   smtp_connect_timeout 30 
   router_id NGINX_MASTER
} 

vrrp_script check_nginx {
    script &quot;/etc/keepalived/check_nginx.sh&quot;
}

vrrp_instance VI_1 { 
    state MASTER 
    interface ens33  # ä¿®æ”¹ä¸ºå®é™…ç½‘å¡å
    virtual_router_id 51 # VRRP è·¯ç”± IDå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹æ˜¯å”¯ä¸€çš„ 
    priority 100    # ä¼˜å…ˆçº§ï¼Œå¤‡æœåŠ¡å™¨è®¾ç½® 90 
    advert_int 1    # æŒ‡å®šVRRP å¿ƒè·³åŒ…é€šå‘Šé—´éš”æ—¶é—´ï¼Œé»˜è®¤1ç§’ 
    authentication { 
        auth_type PASS      
        auth_pass 1111 
    }  
    # è™šæ‹ŸIP
    virtual_ipaddress { 
        192.168.0.88/24
    } 
    track_script {
        check_nginx
    } 
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ â€‹ Master Node2çš„keepalivedé…ç½®æ–‡ä»¶</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; EOF
global_defs { 
   notification_email { 
     acassen@firewall.loc 
     failover@firewall.loc 
     sysadmin@firewall.loc 
   } 
   notification_email_from Alexandre.Cassen@firewall.loc  
   smtp_server 127.0.0.1 
   smtp_connect_timeout 30 
   router_id NGINX_BACKUP
} 

vrrp_script check_nginx {
    script &quot;/etc/keepalived/check_nginx.sh&quot;
}

vrrp_instance VI_1 { 
    state BACKUP 
    interface ens33
    virtual_router_id 51 # VRRP è·¯ç”± IDå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹æ˜¯å”¯ä¸€çš„ 
    priority 90
    advert_int 1
    authentication { 
        auth_type PASS      
        auth_pass 1111 
    }  
    virtual_ipaddress { 
        192.168.0.88/24
    } 
    track_script {
        check_nginx
    } 
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>é…ç½®è¯´æ˜
â€‹vrrp_scriptï¼šæŒ‡å®šæ£€æŸ¥nginxå·¥ä½œçŠ¶æ€è„šæœ¬ï¼ˆæ ¹æ®nginxçŠ¶æ€åˆ¤æ–­æ˜¯å¦æ•…éšœè½¬ç§»ï¼‰
â€‹virtual_ipaddressï¼šè™šæ‹ŸIPï¼ˆVIPï¼‰
â€‹
â€‹å‡†å¤‡ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­æ£€æŸ¥nginxè¿è¡ŒçŠ¶æ€çš„è„šæœ¬ï¼ˆMaster Node1å’ŒMaster Node2ç›¸åŒï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/keepalived/check_nginx.sh  &lt;&lt; &quot;EOF&quot;
#!/bin/bash
count=$(ss -antp |grep 16443 |egrep -cv &quot;grep|$$&quot;)

if [ &quot;$count&quot; -eq 0 ];then
    exit 1
else
    exit 0
fi
EOF

chmod +x /etc/keepalived/check_nginx.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ é…ç½®è¯´æ˜ â€‹ keepalivedæ ¹æ®è„šæœ¬è¿”å›çŠ¶æ€ç ï¼ˆ0ä¸ºå·¥ä½œæ­£å¸¸ï¼Œé0ä¸æ­£å¸¸ï¼‰åˆ¤æ–­æ˜¯å¦æ•…éšœè½¬ç§»ã€‚</p><h3 id="_8-16-3-nginxå¢åŠ steamæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_8-16-3-nginxå¢åŠ steamæ¨¡å—" aria-hidden="true">#</a> 8.16.3.Nginxå¢åŠ Steamæ¨¡å—</h3><h4 id="_8-16-3-1-æŸ¥çœ‹nginxç‰ˆæœ¬æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_8-16-3-1-æŸ¥çœ‹nginxç‰ˆæœ¬æ¨¡å—" aria-hidden="true">#</a> 8.16.3.1.æŸ¥çœ‹Nginxç‰ˆæœ¬æ¨¡å—</h4><pre><code>nginx -V
æ³¨æ„ï¼šå¦‚æœå·²ç»å®‰è£… --with-streamæ¨¡å—,åé¢çš„æ­¥éª¤å¯ä»¥è·³è¿‡
</code></pre><h4 id="_8-16-3-2-master1å’Œmaster2å®‰è£…streamæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_8-16-3-2-master1å’Œmaster2å®‰è£…streamæ¨¡å—" aria-hidden="true">#</a> 8.16.3.2.Master1å’ŒMaster2å®‰è£…Streamæ¨¡å—</h4><pre><code>å¤‡ä»½Master Node1å’ŒMaster Node2ä¸ŠåŸæ¥çš„Nginxæ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mv /usr/sbin/nginx /usr/sbin/nginx.bak &amp;&amp;
cp -r /etc/nginx{,.bak}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>åˆ‡æ¢ç›®å½•å¹¶åœ¨è¯¥ç›®å½•ä¸­ä¸‹è½½nginxï¼ˆæ³¨æ„è¿™é‡Œä¸‹è½½çš„nginxç‰ˆæœ¬è¦å’Œä¹‹å‰nginx -væŸ¥çœ‹çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹‹å‰å·²ç»ä¸‹è½½
å¥½äº†ï¼Œå­˜æ”¾åœ¨Master Node1ä¸Šï¼Œç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ï¼‰

åœ¨Master Node1ä¸Šåˆ‡æ¢ç›®å½•
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>Master Node1ç¼–è¯‘ç¯å¢ƒå‡†å¤‡
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install libxml2 libxml2-dev libxslt-devel 
yum -y install gd-devel 
yum -y install perl-devel perl-ExtUtils-Embed 
yum -y install GeoIP GeoIP-devel GeoIP-data
yum -y install pcre-devel
yum -y install openssl openssl-devel
yum -y install gcc make
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ç¼–è¯‘nginxï¼ŒåŠ ä¸Šæœ¬æ¬¡éœ€æ–°å¢çš„æ¨¡å—: --with-stream
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tar -xf nginx-1.20.1.tar.gz
cd nginx-1.20.1/
./configure --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx \
--modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf  --with-stream
make
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>è¯´æ˜:
makeå®Œæˆåä¸è¦ç»§ç»­è¾“å…¥â€œmake installâ€ï¼Œä»¥å…ç°åœ¨çš„nginxå‡ºç°é—®é¢˜
ä»¥ä¸Šå®Œæˆåï¼Œä¼šåœ¨objsç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªnginxæ–‡ä»¶ï¼Œå…ˆéªŒè¯
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./objs/nginx -t
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 nginx-1.20.1]# ./objs/nginx -t
nginx: [alert] could not open error log file: open() &quot;/usr/share/nginx/logs/error.log&quot; failed (2: No such file or directory)
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

æ›¿æ¢nginxåˆ°Master1/Master2
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp ./objs/nginx /usr/sbin/ &amp;&amp;
scp objs/nginx root@192.168.0.12:/usr/sbin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>ä¿®æ”¹nginxæœåŠ¡æ–‡ä»¶ï¼ˆMaster Node1å’ŒMaster Node2ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -rf /usr/lib/systemd/system/nginx.service &amp;&amp;
cat &gt;&gt; /usr/lib/systemd/system/nginx.service &lt;&lt; EOF
[Unit]
Description=The nginx HTTP and reverse proxy server
After=network.target remote-fs.target nss-lookup.target
[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/bin/rm -rf /run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t
ExecStart=/usr/sbin/nginx
ExecStop=/usr/sbin/nginx -s stop
ExecReload=/usr/sbin/nginx -s reload
PrivateTmp=true
[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-16-4-å¯åŠ¨nginxã€keepalivedå¹¶è®¾ç½®å¼€æœºè‡ªå¯-master1-master2" tabindex="-1"><a class="header-anchor" href="#_8-16-4-å¯åŠ¨nginxã€keepalivedå¹¶è®¾ç½®å¼€æœºè‡ªå¯-master1-master2" aria-hidden="true">#</a> 8.16.4.å¯åŠ¨nginxã€keepalivedå¹¶è®¾ç½®å¼€æœºè‡ªå¯(master1/master2)</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start nginx keepalived &amp;&amp;
systemctl enable nginx keepalived
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-16-5-æŸ¥çœ‹keepalivedå·¥ä½œçŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#_8-16-5-æŸ¥çœ‹keepalivedå·¥ä½œçŠ¶æ€" aria-hidden="true">#</a> 8.16.5.æŸ¥çœ‹keepalivedå·¥ä½œçŠ¶æ€</h3><pre><code>æŸ¥çœ‹Master1ç½‘å¡è¯¦ç»†ä¿¡æ¯
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ip addr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# ip addr
...
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast 
		  state UP group default qlen 1000
    link/ether 00:0c:29:8d:76:8c brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.9/24 brd 192.168.0.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet 192.168.0.88/24 scope global ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::5c3d:f3b3:1254:f87b/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
...

æŸ¥çœ‹Master2ç½‘å¡è¯¦ç»†ä¿¡æ¯
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ip addr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# ip addr
...
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state 
		 UP group default qlen 1000
    link/ether 00:50:56:2d:95:d6 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.12/24 brd 192.168.0.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::fe5b:93a6:43c0:3e2e/64 scope link tentative 
	    noprefixroute dadfailed 
       valid_lft forever preferred_lft forever
    inet6 fe80::5c3d:f3b3:1254:f87b/64 scope link tentative 
	    noprefixroute dadfailed 
       valid_lft forever preferred_lft forever
    inet6 fe80::7bd2:e647:9e81:ef45/64 scope link tentative
	     noprefixroute dadfailed 
       valid_lft forever preferred_lft forever
...

å¦‚ä½•ç¡®å®šæ˜¯å¦é…ç½®æˆåŠŸ
å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Master1ä¸Šçš„ens33ç½‘å¡ç»‘å®šäº†192.168.242.55 è™šæ‹ŸIPï¼Œè¯´æ˜å·¥ä½œæ­£å¸¸ã€‚
inet 192.168.242.55/24 scope global ens33ï¼Œè€ŒMaster2ä¸Šçš„ens33ç½‘å¡æ²¡æœ‰ç»‘å®šè™šæ‹ŸIP
</code></pre><h3 id="_8-16-6-nginx-keepalivedé«˜å¯ç”¨æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_8-16-6-nginx-keepalivedé«˜å¯ç”¨æµ‹è¯•" aria-hidden="true">#</a> 8.16.6.Nginx+keepalivedé«˜å¯ç”¨æµ‹è¯•</h3><pre><code>åœ¨ä¸»èŠ‚ç‚¹Master Node1èŠ‚ç‚¹æ‰§è¡Œå…³é—­nginx
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pkill nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥çœ‹è™šæ‹ŸIPæ˜¯å¦æ¼‚ç§»åˆ°å¤‡èŠ‚ç‚¹æœåŠ¡å™¨ï¼ˆMaster Node2ï¼‰
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ip addr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# ip addr
...
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast 
	state UP group default qlen 1000
link/ether 00:50:56:2d:95:d6 brd ff:ff:ff:ff:ff:ff
inet 192.168.0.12/24 brd 192.168.0.255 scope global noprefixroute ens33
   valid_lft forever preferred_lft forever
inet 192.168.0.88/24 scope global ens33
   valid_lft forever preferred_lft forever
inet6 fe80::fe5b:93a6:43c0:3e2e/64 scope link tentative 
    noprefixroute dadfailed valid_lft forever preferred_lft forever
inet6 fe80::5c3d:f3b3:1254:f87b/64 scope link tentative 
    noprefixroute dadfailed valid_lft forever preferred_lft forever
inet6 fe80::7bd2:e647:9e81:ef45/64 scope link tentative 
    noprefixroute dadfailed valid_lft forever preferred_lft forever
...

å¦‚ä½•ç¡®å®šè™šæ‹ŸIPæ˜¯å¦å‘ç”Ÿé£˜ç§»
å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Master2ä¸Šçš„ens33ç½‘å¡ç»‘å®šäº†192.168.242.55 è™šæ‹ŸIPï¼Œè¯´æ˜å·¥ä½œæ­£å¸¸ã€‚

æµ‹è¯•å®Œæˆåé‡æ–°å¯åŠ¨Master Node1ä¸Šçš„nginx
systemctl start nginx
</code></pre><h3 id="_8-16-7-æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨" tabindex="-1"><a class="header-anchor" href="#_8-16-7-æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨" aria-hidden="true">#</a> 8.16.7.æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨</h3><pre><code>æ‰¾K8sé›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½¿ç”¨curlæŸ¥çœ‹K8sç‰ˆæœ¬æµ‹è¯•ï¼Œä½¿ç”¨VIPè®¿é—®
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -k https://192.168.0.88:16443/version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>Master Node1æœºå™¨
[root@binary-k8s-master1 ~]# curl -k https://192.168.0.88:16443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;20&quot;,
  &quot;gitVersion&quot;: &quot;v1.20.10&quot;,
  &quot;gitCommit&quot;: &quot;8152330a2b6ca3621196e62966ef761b8f5a61bb&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2021-08-11T18:00:37Z&quot;,
  &quot;goVersion&quot;: &quot;go1.15.15&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}

Master Node2æœºå™¨
[root@binary-k8s-master2 ~]# curl -k https://192.168.0.88:16443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;20&quot;,
  &quot;gitVersion&quot;: &quot;v1.20.10&quot;,
  &quot;gitCommit&quot;: &quot;8152330a2b6ca3621196e62966ef761b8f5a61bb&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2021-08-11T18:00:37Z&quot;,
  &quot;goVersion&quot;: &quot;go1.15.15&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}

Worker Node1æœºå™¨
[root@binary-k8s-worker1 ~]# curl -k https://192.168.0.88:16443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;20&quot;,
  &quot;gitVersion&quot;: &quot;v1.20.10&quot;,
  &quot;gitCommit&quot;: &quot;8152330a2b6ca3621196e62966ef761b8f5a61bb&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2021-08-11T18:00:37Z&quot;,
  &quot;goVersion&quot;: &quot;go1.15.15&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}

Worker Node2æœºå™¨
[root@binary-k8s-worker2 ~]# curl -k https://192.168.0.88:16443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;20&quot;,
  &quot;gitVersion&quot;: &quot;v1.20.10&quot;,
  &quot;gitCommit&quot;: &quot;8152330a2b6ca3621196e62966ef761b8f5a61bb&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2021-08-11T18:00:37Z&quot;,
  &quot;goVersion&quot;: &quot;go1.15.15&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}

å¦‚ä½•ç¡®å®šè´Ÿè½½å‡è¡¡å™¨æ˜¯å¦æ­å»ºæ­£å¸¸
å¦‚æœæ‰€æœ‰èŠ‚ç‚¹å¯ä»¥æ­£ç¡®è·å–åˆ°K8sç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜è´Ÿè½½å‡è¡¡å™¨æ­å»ºæ­£å¸¸ã€‚
è¯¥è¯·æ±‚æ•°æ®æµç¨‹ï¼šcurl -&gt; vip(nginx) -&gt; apiserver

é€šè¿‡æŸ¥çœ‹Nginxæ—¥å¿—ä¹Ÿå¯ä»¥çœ‹åˆ°è½¬å‘apiserver IPï¼š
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tailf /var/log/nginx/k8s-access.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# tailf /var/log/nginx/k8s-access.log 
192.168.242.55 192.168.0.9:6443 - [26/Jul/2022:01:28:51 -0400] 200 428
192.168.211.128 192.168.0.9:6443 - [26/Jul/2022:01:28:58 -0400] 200 428
192.168.95.192 192.168.0.12:6443 - [26/Jul/2022:01:30:12 -0400] 200 428
192.168.63.192 192.168.0.9:6443 - [26/Jul/2022:01:30:14 -0400] 200 428
192.168.242.55 192.168.0.9:6443 - [26/Jul/2022:01:30:36 -0400] 200 428
192.168.242.55 192.168.0.12:6443 - [26/Jul/2022:01:30:42 -0400] 200 428
</code></pre><h3 id="_8-16-8-ä¿®æ”¹æ‰€æœ‰çš„worker-nodeè¿æ¥lb-vip" tabindex="-1"><a class="header-anchor" href="#_8-16-8-ä¿®æ”¹æ‰€æœ‰çš„worker-nodeè¿æ¥lb-vip" aria-hidden="true">#</a> 8.16.8.ä¿®æ”¹æ‰€æœ‰çš„Worker Nodeè¿æ¥LB VIP</h3><pre><code>ä¸ºä»€ä¹ˆè¦æ”¹ä¸ºè¿æ¥LB VIP
è¯•æƒ³ä¸‹ï¼Œè™½ç„¶æˆ‘ä»¬å¢åŠ äº†Master2 Nodeå’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯ä»å•Masteræ¶æ„æ‰©å®¹çš„ï¼Œä¹Ÿå°±æ˜¯
è¯´ç›®å‰æ‰€æœ‰çš„Worker Nodeç»„ä»¶è¿æ¥éƒ½è¿˜æ˜¯Master1 Nodeï¼Œå¦‚æœä¸æ”¹ä¸ºè¿æ¥VIPèµ°è´Ÿè½½å‡è¡¡å™¨ï¼Œé‚£ä¹ˆ
Masterè¿˜æ˜¯å•ç‚¹æ•…éšœã€‚å› æ­¤æ¥ä¸‹æ¥å°±æ˜¯è¦æ”¹æ‰€æœ‰Worker Nodeï¼ˆkubectl get nodeå‘½ä»¤æŸ¥çœ‹åˆ°çš„èŠ‚
ç‚¹ï¼‰ç»„ä»¶é…ç½®æ–‡ä»¶ï¼Œç”±åŸæ¥192.168.0.9ä¿®æ”¹ä¸º192.168.242.55ï¼ˆVIPï¼‰ã€‚

åœ¨æ‰€æœ‰Worker Nodeæ‰§è¡Œ
æ³¨æ„äº‹é¡¹
è¿™é‡Œé™¤äº†Worker Node1å’ŒWorker Node2ï¼ŒMaster Node1å’ŒMaster Node2è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¹Ÿå……å½“äº†Worker Nodeï¼Œæ‰€ä»¥æ‰€æœ‰çš„å››ä¸ªèŠ‚ç‚¹
ä¸Šéƒ½è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s#192.168.0.9:6443#192.168.0.88:16443#&#39; /opt/kubernetes/cfg/* &amp;&amp;
systemctl restart kubelet kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 cfg]# kubectl get nodes
NAME                 STATUS   ROLES    AGE     VERSION
binary-k8s-master1   Ready    &lt;none&gt;   5h13m   v1.20.0
binary-k8s-master2   Ready    &lt;none&gt;   177m    v1.20.0
binary-k8s-worker1    Ready    &lt;none&gt;   5h1m    v1.20.0
binary-k8s-worker2    Ready    &lt;none&gt;   5h1m    v1.20.0

ä¸ºäº†ç¡®ä¿é…ç½®æˆåŠŸï¼Œé‡å¯é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ï¼Œå†æ¬¡åœ¨Master Node1å’ŒMaster Node2ä¸­æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚ä¸€åˆ‡éƒ¨ç½²æ— è¯¯ç»“æœå¦‚ä¸‹æ‰€ç¤º
[root@binary-k8s-master1 cfg]# kubectl get nodes
NAME                 STATUS   ROLES    AGE     VERSION
binary-k8s-master1   Ready    &lt;none&gt;   5h13m   v1.20.0
binary-k8s-master2   Ready    &lt;none&gt;   177m    v1.20.0
binary-k8s-worker1    Ready    &lt;none&gt;   5h1m    v1.20.0
binary-k8s-worker2    Ready    &lt;none&gt;   5h1m    v1.20.0

è‡³æ­¤,ä¸€å¥—é«˜å¯ç”¨çš„k8säºŒè¿›åˆ¶å¯ç”¨é›†ç¾¤å°±éƒ¨ç½²å®Œæˆäº†~
^_^
</code></pre><h2 id="_8-17-éƒ¨ç½²å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_8-17-éƒ¨ç½²å¸¸è§é—®é¢˜" aria-hidden="true">#</a> 8.17.éƒ¨ç½²å¸¸è§é—®é¢˜</h2><h3 id="_8-17-1ç³»ç»Ÿæ–­ç”µå-æŸä¸ªetcdèŠ‚ç‚¹æ— æ³•å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_8-17-1ç³»ç»Ÿæ–­ç”µå-æŸä¸ªetcdèŠ‚ç‚¹æ— æ³•å¯åŠ¨" aria-hidden="true">#</a> 8.17.1ç³»ç»Ÿæ–­ç”µå,æŸä¸ªetcdèŠ‚ç‚¹æ— æ³•å¯åŠ¨</h3><pre><code>æŠ¥é”™ä¿¡æ¯
publish error: etcdserver: request timed out

è§£å†³æ–¹æ³•(å¦‚æœæ²¡æœ‰é‡è¦æ•°æ®,æˆ–è€…åˆšè¿›è¡Œå®Œåˆå§‹åŒ–)
æ£€æŸ¥æ—¥å¿—å‘ç°å¹¶æ²¡æœ‰ç‰¹åˆ«æ˜æ˜¾çš„é”™è¯¯ï¼Œæ ¹æ®ç»éªŒæ¥è®²ï¼Œetcd èŠ‚ç‚¹åæ‰ä¸€ä¸ªå…¶å®å¯¹é›†ç¾¤æ²¡æœ‰å¤§çš„å½±å“ï¼Œ
è¿™æ—¶é›†ç¾¤å·²ç»å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼Œä½†æ˜¯è¿™ä¸ªåæ‰çš„ etcd èŠ‚ç‚¹å¹¶æ²¡æœ‰å¯åŠ¨

#è¿›å…¥ etcd çš„æ•°æ®å­˜å‚¨ç›®å½•è¿›è¡Œå¤‡ä»½ å¤‡ä»½åŸæœ‰æ•°æ®ï¼š
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /var/lib/etcd/default.etcd/member/ &amp;&amp;
cp * /data/bak/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>#åˆ é™¤è¿™ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ•°æ®æ–‡ä»¶
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -rf /var/lib/etcd/default.etcd/member/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>#åœæ­¢å¦å¤–ä¸¤å° etcd èŠ‚ç‚¹ï¼Œå› ä¸º etcd èŠ‚ç‚¹å¯åŠ¨æ—¶éœ€è¦æ‰€æœ‰èŠ‚ç‚¹ä¸€èµ·å¯åŠ¨ï¼Œå¯åŠ¨æˆåŠŸåå³å¯ä½¿ç”¨ã€‚
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl stop etcd &amp;&amp;
systemctl restart etcd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-17-2-the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port" tabindex="-1"><a class="header-anchor" href="#_8-17-2-the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port" aria-hidden="true">#</a> 8.17.2 The connection to the server localhost:8080 was refused - did you specify the right host or port?</h3><pre><code>8.10.ä½¿ç”¨kubectlæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ç« èŠ‚æ²¡æœ‰æ­£ç¡®æ‰§è¡Œä¼šæŠ¥è¿™ä¸ªé”™
</code></pre><h2 id="_8-18-éƒ¨ç½²æµ‹è¯•ç¨‹åº" tabindex="-1"><a class="header-anchor" href="#_8-18-éƒ¨ç½²æµ‹è¯•ç¨‹åº" aria-hidden="true">#</a> 8.18.éƒ¨ç½²æµ‹è¯•ç¨‹åº</h2><pre><code>åˆ›å»ºguestbook
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create deployment guestbook --image=ibmcom/guestbook:v1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥è¯¢podè¿è¡ŒçŠ¶æ€ï¼ŒçŠ¶æ€åº”è¯¥æ˜¾ç¤ºä¸ºRunningè¡¨ç¤ºpodè¿è¡ŒæˆåŠŸ
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>å¯¹å¤–æš´éœ²ç«¯å£
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl expose deployment guestbook --type=NodePort --port=3000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>æŸ¥è¯¢ç«¯å£æ˜ å°„
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get service guestbook
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>NAME        TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
guestbook   NodePort   10.10.10.253   &lt;none&gt;        3000:31208/TCP   1m

è®¿é—®æœåŠ¡ï¼ˆä¸»èŠ‚ç‚¹å’Œä¸¤ä¸ªå·¥ä½œèŠ‚ç‚¹éƒ½å¯è®¿é—®åˆ°è¿™ä¸ªæœåŠ¡ï¼‰
http://192.168.0.6:31208
http://192.168.0.7:31208
http://192.168.0.8:31208
</code></pre></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/8/17 02:20:23</span></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: LRwq942133">lingwh</span><!--]--><!--]--></div></footer><!----><div class="waline-wrapper" style="display:block;" darkmode="false"><div data-waline provider="Waline"><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><!-- eslint-disable-next-line vue/no-v-html --><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noreferrer"><svg width="16" height="16" ariahidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewbox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button class="wl-action" title="é¢„è§ˆ"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button class="wl-btn">ç™»å½•</button><button class="wl-btn primary" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><div class="wl-gallery" style="gap:6px;"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewbox="0 0 100 100" preserveaspectratio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokewidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributename="transform" type="rotate" repeatcount="indefinite" dur="1s" values="0 50 50;360 50 50" keytimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-count"><!--v-if--> è¯„è®º</div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewbox="0 0 100 100" preserveaspectratio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokewidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributename="transform" type="rotate" repeatcount="indefinite" dur="1s" values="0 50 50;360 50 50" keytimes="0;1"></animateTransform></circle></svg></div><!--]--><!-- Copyright Information --><!--v-if--></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Copyright 2021 Â© lingwh æ¬¢è¿è®¿é—®</div><!----></footer><!--]--></div><!--]--><!----><div id="pwa-install"><!----><div id="install-modal-wrapper" style="display:none;"><div class="background"></div><div class="install-modal"><div class="header"><button class="close-button" aria-label="å…³é—­"><svg xmlns="http://www.w3.org/2000/svg" class="icon close-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="close icon"><path d="M589.654 511.965 1007.212 84.22a49.777 49.777 0 0 0-.73-70.02 49.046 49.046 0 0 0-69.687.665L519.967 441.946 85.882 14.2a49.08 49.08 0 0 0-69.687.664 49.777 49.777 0 0 0 .664 70.019l433.454 427.082L16.859 939.048a49.777 49.777 0 0 0-.664 70.019 49.013 49.013 0 0 0 69.687.663l434.085-427.746 416.828 427.083A49.013 49.013 0 0 0 972.037 1024a48.416 48.416 0 0 0 34.512-14.27 49.777 49.777 0 0 0 .73-70.019z"></path></svg></button><div class="logo"><!----><div class="title"><h1></h1><p class="desc">è¯¥åº”ç”¨å¯ä»¥å®‰è£…åœ¨ä½ çš„ PC æˆ–ç§»åŠ¨è®¾å¤‡ä¸Šã€‚è¿™å°†ä½¿è¯¥ Web åº”ç”¨ç¨‹åºå¤–è§‚å’Œè¡Œä¸ºä¸å…¶ä»–åº”ç”¨ç¨‹åºç›¸åŒã€‚å®ƒå°†åœ¨å‡ºç°åœ¨åº”ç”¨ç¨‹åºåˆ—è¡¨ä¸­ï¼Œå¹¶å¯ä»¥å›ºå®šåˆ°ä¸»å±å¹•ï¼Œå¼€å§‹èœå•æˆ–ä»»åŠ¡æ ã€‚æ­¤ Web åº”ç”¨ç¨‹åºè¿˜å°†èƒ½å¤Ÿä¸å…¶ä»–åº”ç”¨ç¨‹åºå’Œä½ çš„æ“ä½œç³»ç»Ÿå®‰å…¨åœ°è¿›è¡Œäº¤äº’ã€‚</p></div></div></div><div class="content"><div class="highlight"><!----><!----></div><div class="description"><h3>è¯¦æƒ…</h3><p></p></div></div><div class="button-wrapper"><button class="install-button">å®‰è£…<span></span></button><button class="cancel-button">å–æ¶ˆ</button></div></div></div></div><!----><!--]--></div>
    <script type="module" src="/assets/app.6952de04.js" defer></script>
  </body>
</html>
