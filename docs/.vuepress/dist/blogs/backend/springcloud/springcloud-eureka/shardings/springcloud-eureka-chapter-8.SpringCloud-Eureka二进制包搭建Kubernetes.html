<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta name="keywords" content="本章节涉及主要内容有：环境配置清单,服务器规划和IP地址规划,安装前准备工作,安装cfssl证书生成工具,搭建etcd集群,安装配置Docker,搭建kube-apiserver,在Master Node1上部署kube-controller-manager,部署kube-scheduler,使用kubectl查看集群状态,在Master Node1上部署第一个Worker Node,增加Worker Node,增加Master2节点,部署Nginx+Keepalived高可用负载均衡器,部署常见问题,部署测试程序,具体每个小节中包含的内容可使通过下面的章节内容大纲进行查看，本章节内容中图片较少，主要以实用为主，所有代码均经过严格测试，可直接复制运行即可。"><meta property="og:url" content="https://vuepress-theme-hope-v2-demo.mrhope.site/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html"><meta property="og:site_name" content="此生挚爱万宝路"><meta property="og:title" content="springcloud-eureka合集-8.SpringCloud-Eureka二进制包搭建Kubernetes"><meta property="og:description" content="本章节涉及主要内容有：环境配置清单,服务器规划和IP地址规划,安装前准备工作,安装cfssl证书生成工具,搭建etcd集群,安装配置Docker,搭建kube-apiserver,在Master Node1上部署kube-controller-manager,部署kube-scheduler,使用kubectl查看集群状态,在Master Node1上部署第一个Worker Node,增加Worker Node,增加Master2节点,部署Nginx+Keepalived高可用负载均衡器,部署常见问题,部署测试程序,具体每个小节中包含的内容可使通过下面的章节内容大纲进行查看，本章节内容中图片较少，主要以实用为主，所有代码均经过严格测试，可直接复制运行即可。"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-08-09T13:52:51.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="二进制搭建k8s集群"><meta property="article:tag" content="docker"><meta property="article:tag" content="k8s网络插件"><meta property="article:tag" content="k8s可视化"><meta property="article:tag" content="etcd集群"><meta property="article:tag" content="kube-apiserver"><meta property="article:tag" content="kube-controller-manager"><meta property="article:tag" content="kube-scheduler"><meta property="article:tag" content="kubectl"><meta property="article:tag" content="nginx"><meta property="article:tag" content="keepalive"><meta property="article:tag" content="高可用"><meta property="article:published_time" content="2020-02-27T00:00:00.000Z"><meta property="article:modified_time" content="2022-08-09T13:52:51.000Z"><link rel="icon" href="/images/headshot.jpg"><title>springcloud-eureka合集-8.SpringCloud-Eureka二进制包搭建Kubernetes | 此生挚爱万宝路</title><meta name="description" content="本章节涉及主要内容有：环境配置清单,服务器规划和IP地址规划,安装前准备工作,安装cfssl证书生成工具,搭建etcd集群,安装配置Docker,搭建kube-apiserver,在Master Node1上部署kube-controller-manager,部署kube-scheduler,使用kubectl查看集群状态,在Master Node1上部署第一个Worker Node,增加Worker Node,增加Master2节点,部署Nginx+Keepalived高可用负载均衡器,部署常见问题,部署测试程序,具体每个小节中包含的内容可使通过下面的章节内容大纲进行查看，本章节内容中图片较少，主要以实用为主，所有代码均经过严格测试，可直接复制运行即可。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.f659ba58.css">
    <link rel="modulepreload" href="/assets/app.d6e2c9d0.js"><link rel="modulepreload" href="/assets/springcloud-eureka-chapter-8.SpringCloud-Eureka二进制包搭建Kubernetes.html.3903f11f.js"><link rel="modulepreload" href="/assets/springcloud-eureka-chapter-8.SpringCloud-Eureka二进制包搭建Kubernetes.html.38e54b89.js"><link rel="prefetch" href="/assets/blog.html.092982c4.js"><link rel="prefetch" href="/assets/cinema.html.92a4d179.js"><link rel="prefetch" href="/assets/index.html.5dc141d1.js"><link rel="prefetch" href="/assets/index.html.22d5fc82.js"><link rel="prefetch" href="/assets/README-springclou-eureka.html.e174ccbe.js"><link rel="prefetch" href="/assets/index.html.6527d841.js"><link rel="prefetch" href="/assets/index.html.487036fc.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-8.Ubuntu二进制包搭建Kubernetes.html.31ea831f.js"><link rel="prefetch" href="/assets/springcloud-eureka.html.33b4aecc.js"><link rel="prefetch" href="/assets/centos7.html.de129a57.js"><link rel="prefetch" href="/assets/ubuntu2012.html.747965cc.js"><link rel="prefetch" href="/assets/index.html.e84b57f2.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-0.博客内容介绍.html.cb753871.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-1.安装SpringCloud-Eureka操作系统.html.9c0fcb24.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-2.SpringCloud-Eureka操作系统初始设置.html.9992d476.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-3.SpringCloud-Eureka搭建基础开发环境.html.75c0313b.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-4.SpringCloud-EurekaCentos搭建docker.html.e2b3298d.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-5.SpringCloud-EurekaCentos搭建Rancher.html.5da76072.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-6.SpringCloud-EurekaCentos搭建Minikube.html.615beca2.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-7.SpringCloud-Eurekakubeadm搭建Kubernetes.html.152a3922.js"><link rel="prefetch" href="/assets/404.html.62775fc8.js"><link rel="prefetch" href="/assets/index.html.d1f84df9.js"><link rel="prefetch" href="/assets/index.html.6de1677c.js"><link rel="prefetch" href="/assets/index.html.14a29c14.js"><link rel="prefetch" href="/assets/index.html.023f3067.js"><link rel="prefetch" href="/assets/index.html.0ffb4294.js"><link rel="prefetch" href="/assets/index.html.9ba4533e.js"><link rel="prefetch" href="/assets/index.html.36019b5c.js"><link rel="prefetch" href="/assets/index.html.af41ed0b.js"><link rel="prefetch" href="/assets/index.html.e27f1e23.js"><link rel="prefetch" href="/assets/index.html.1e2682fb.js"><link rel="prefetch" href="/assets/index.html.b5aa6fb8.js"><link rel="prefetch" href="/assets/index.html.29a9489f.js"><link rel="prefetch" href="/assets/index.html.8b2a7dd2.js"><link rel="prefetch" href="/assets/index.html.a71ece83.js"><link rel="prefetch" href="/assets/index.html.ea7a83bd.js"><link rel="prefetch" href="/assets/index.html.d3817010.js"><link rel="prefetch" href="/assets/index.html.f59f1b18.js"><link rel="prefetch" href="/assets/index.html.712796bb.js"><link rel="prefetch" href="/assets/index.html.9823a8f9.js"><link rel="prefetch" href="/assets/index.html.9443e722.js"><link rel="prefetch" href="/assets/index.html.b4d7d44d.js"><link rel="prefetch" href="/assets/index.html.6d9259be.js"><link rel="prefetch" href="/assets/index.html.18c57462.js"><link rel="prefetch" href="/assets/index.html.b6a8d45e.js"><link rel="prefetch" href="/assets/index.html.e469160d.js"><link rel="prefetch" href="/assets/index.html.e86af06c.js"><link rel="prefetch" href="/assets/index.html.b0fdde85.js"><link rel="prefetch" href="/assets/index.html.0ddc822b.js"><link rel="prefetch" href="/assets/index.html.9be463c4.js"><link rel="prefetch" href="/assets/index.html.bb39cca4.js"><link rel="prefetch" href="/assets/index.html.98e8adb9.js"><link rel="prefetch" href="/assets/index.html.7d30658a.js"><link rel="prefetch" href="/assets/index.html.a2fe93f4.js"><link rel="prefetch" href="/assets/index.html.3a7dec45.js"><link rel="prefetch" href="/assets/index.html.b8df33e8.js"><link rel="prefetch" href="/assets/blog.html.6b363042.js"><link rel="prefetch" href="/assets/cinema.html.13b784a0.js"><link rel="prefetch" href="/assets/index.html.a483d547.js"><link rel="prefetch" href="/assets/index.html.5797f47b.js"><link rel="prefetch" href="/assets/README-springclou-eureka.html.6cea4acb.js"><link rel="prefetch" href="/assets/index.html.b6bc68e2.js"><link rel="prefetch" href="/assets/index.html.2a99f424.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-8.Ubuntu二进制包搭建Kubernetes.html.2b25b8f9.js"><link rel="prefetch" href="/assets/springcloud-eureka.html.17c36308.js"><link rel="prefetch" href="/assets/centos7.html.3e643516.js"><link rel="prefetch" href="/assets/ubuntu2012.html.edcc4d99.js"><link rel="prefetch" href="/assets/index.html.3c1281be.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-0.博客内容介绍.html.7875cd1c.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-1.安装SpringCloud-Eureka操作系统.html.e071b529.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-2.SpringCloud-Eureka操作系统初始设置.html.5ef65d8d.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-3.SpringCloud-Eureka搭建基础开发环境.html.df17e452.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-4.SpringCloud-EurekaCentos搭建docker.html.ddf7d658.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-5.SpringCloud-EurekaCentos搭建Rancher.html.d15194a5.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-6.SpringCloud-EurekaCentos搭建Minikube.html.ae008cf7.js"><link rel="prefetch" href="/assets/springcloud-eureka-chapter-7.SpringCloud-Eurekakubeadm搭建Kubernetes.html.ac2dc3f7.js"><link rel="prefetch" href="/assets/404.html.df9ebb1d.js"><link rel="prefetch" href="/assets/index.html.b2c65f97.js"><link rel="prefetch" href="/assets/index.html.304d9c51.js"><link rel="prefetch" href="/assets/index.html.29c91d2f.js"><link rel="prefetch" href="/assets/index.html.d881f8c0.js"><link rel="prefetch" href="/assets/index.html.9d4c8fac.js"><link rel="prefetch" href="/assets/index.html.f4b85847.js"><link rel="prefetch" href="/assets/index.html.e9a13bde.js"><link rel="prefetch" href="/assets/index.html.904c4717.js"><link rel="prefetch" href="/assets/index.html.b41fc017.js"><link rel="prefetch" href="/assets/index.html.41ec9861.js"><link rel="prefetch" href="/assets/index.html.5b1530d0.js"><link rel="prefetch" href="/assets/index.html.15f43f0d.js"><link rel="prefetch" href="/assets/index.html.bcae3bc9.js"><link rel="prefetch" href="/assets/index.html.4c42fac2.js"><link rel="prefetch" href="/assets/index.html.0efdf5f2.js"><link rel="prefetch" href="/assets/index.html.ef9448dc.js"><link rel="prefetch" href="/assets/index.html.d247cb80.js"><link rel="prefetch" href="/assets/index.html.fa73a258.js"><link rel="prefetch" href="/assets/index.html.fc0b1da8.js"><link rel="prefetch" href="/assets/index.html.a1eb0850.js"><link rel="prefetch" href="/assets/index.html.adef9450.js"><link rel="prefetch" href="/assets/index.html.43329ceb.js"><link rel="prefetch" href="/assets/index.html.03834284.js"><link rel="prefetch" href="/assets/index.html.1e34568e.js"><link rel="prefetch" href="/assets/index.html.e0ae39eb.js"><link rel="prefetch" href="/assets/index.html.226a0196.js"><link rel="prefetch" href="/assets/index.html.8587ea3b.js"><link rel="prefetch" href="/assets/index.html.35c6404d.js"><link rel="prefetch" href="/assets/index.html.19aa8f9a.js"><link rel="prefetch" href="/assets/index.html.7621c64c.js"><link rel="prefetch" href="/assets/index.html.387177ea.js"><link rel="prefetch" href="/assets/index.html.75fa1872.js"><link rel="prefetch" href="/assets/index.html.64c2c40e.js"><link rel="prefetch" href="/assets/index.html.bd5e266f.js"><link rel="prefetch" href="/assets/index.html.ee4229ff.js"><link rel="prefetch" href="/assets/404.5249c88e.js"><link rel="prefetch" href="/assets/Layout.cf033beb.js"><link rel="prefetch" href="/assets/Slide.bf19948a.js"><link rel="prefetch" href="/assets/Blog.d36df0c2.js"><link rel="prefetch" href="/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/assets/photoswipe.esm.218074cd.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/images/headshot.jpg" alt="此生挚爱万宝路"><!----><span class="site-name hide-in-pad">此生挚爱万宝路</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="个人主页"><span class="icon iconfont icon-hacker"></span>个人主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog.html" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-blog"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/cinema.html" class="nav-link" aria-label="放映厅"><span class="icon iconfont icon-creative"></span>放映厅<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="后端"><span class="title"><span class="icon iconfont icon-java"></span>后端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>springboot</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/xxx" class="nav-link" aria-label="springboot"><span class="icon iconfont icon-leaf"></span>springboot<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>springcloud</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/backend/springcloud/springcloud-eureka.md" class="nav-link" aria-label="springcloud-eureka"><span class="icon iconfont icon-cache"></span>springcloud-eureka<!----></a></li><li class="dropdown-subitem"><a href="/backend/springcloud/article/article6" class="nav-link" aria-label="springcloud-zookeeper"><span class="icon iconfont icon-cache"></span>springcloud-zookeeper<!----></a></li><li class="dropdown-subitem"><a href="/backend/springcloud/article/article6" class="nav-link" aria-label="springcloud-consul"><span class="icon iconfont icon-cache"></span>springcloud-consul<!----></a></li><li class="dropdown-subitem"><a href="/backend/springcloud/article/article6" class="nav-link" aria-label="springcloud-alibaba"><span class="icon iconfont icon-cache"></span>springcloud-alibaba<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端"><span class="title"><span class="icon iconfont icon-html"></span>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/xxx" class="nav-link" aria-label="ECMAScript 5"><!---->ECMAScript 5<!----></a></li><li class="dropdown-item"><a href="/xxx" class="nav-link" aria-label="ECMAScript 6"><!---->ECMAScript 6<!----></a></li><li class="dropdown-item"><a href="/xxx" class="nav-link" aria-label="Framework"><!---->Framework<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title"><span class="icon iconfont icon-database"></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>关系型数据库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/relational/article1" class="nav-link" aria-label="mysql"><span class="icon iconfont icon-mysql"></span>mysql<!----></a></li><li class="dropdown-subitem"><a href="/database/relational/article2" class="nav-link" aria-label="oracle"><!---->oracle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>nosql</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/nosql/article/article5" class="nav-link" aria-label="monogodb"><!---->monogodb<!----></a></li><li class="dropdown-subitem"><a href="/database/nosql/article/article6" class="nav-link" aria-label="redis"><!---->redis<!----></a></li><li class="dropdown-subitem"><a href="/database/nosql/article/article6" class="nav-link" aria-label="etcd"><!---->etcd<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="环境搭建"><span class="title"><span class="icon iconfont icon-shell"></span>环境搭建</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>centos</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/environment/centos/centos7/shardings/centos7-chapter-0.博客内容介绍.md" class="nav-link" aria-label="centos7"><span class="icon iconfont icon-centos"></span>centos7<!----></a></li></ul></li><li class="dropdown-item"><a href="/blogs/environment/windows/windows.md" class="nav-link" aria-label="windows"><span class="icon iconfont icon-windows"></span>windows<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://github.com/lingwh1995" rel="noopener noreferrer" target="_blank" aria-label="GITHUB" class="nav-link"><span class="icon iconfont icon-github"></span>GITHUB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://gitee.com/lingwh1995" rel="noopener noreferrer" target="_blank" aria-label="GITEE" class="nav-link"><span class="icon iconfont icon-gitee"></span>GITEE<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-a-archivecatalogue-fill"></span><span class="title">在Centos7上搭建开发环境</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-a-archivecatalogue-fill"></span><span class="title">在Ubuntu2012上搭建开发环境</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-a-archivecatalogue-fill"></span><span class="title">springcloud-eureka合集</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-repo"></span><span class="title">按照章节阅读</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-0.%E5%8D%9A%E5%AE%A2%E5%86%85%E5%AE%B9%E4%BB%8B%E7%BB%8D.html" class="nav-link sidebar-link sidebar-page" aria-label="博客内容介绍"><span class="icon iconfont icon-note"></span>博客内容介绍<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-1.%E5%AE%89%E8%A3%85SpringCloud-Eureka%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html" class="nav-link sidebar-link sidebar-page" aria-label="1.安装SpringCloud-Eureka操作系统"><span class="icon iconfont icon-article"></span>1.安装SpringCloud-Eureka操作系统<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-2.SpringCloud-Eureka%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E8%AE%BE%E7%BD%AE.html" class="nav-link sidebar-link sidebar-page" aria-label="2.SpringCloud-Eureka操作系统初始设置"><span class="icon iconfont icon-article"></span>2.SpringCloud-Eureka操作系统初始设置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-3.SpringCloud-Eureka%E6%90%AD%E5%BB%BA%E5%9F%BA%E7%A1%80%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html" class="nav-link sidebar-link sidebar-page" aria-label="3.SpringCloud-Eureka搭建基础开发环境"><span class="icon iconfont icon-article"></span>3.SpringCloud-Eureka搭建基础开发环境<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-4.SpringCloud-EurekaCentos%E6%90%AD%E5%BB%BAdocker.html" class="nav-link sidebar-link sidebar-page" aria-label="4.SpringCloud-EurekaCentos搭建docker"><span class="icon iconfont icon-article"></span>4.SpringCloud-EurekaCentos搭建docker<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-5.SpringCloud-EurekaCentos%E6%90%AD%E5%BB%BARancher.html" class="nav-link sidebar-link sidebar-page" aria-label="5.SpringCloud-EurekaCentos搭建Rancher"><span class="icon iconfont icon-article"></span>5.SpringCloud-EurekaCentos搭建Rancher<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-6.SpringCloud-EurekaCentos%E6%90%AD%E5%BB%BAMinikube.html" class="nav-link sidebar-link sidebar-page" aria-label="6.SpringCloud-EurekaCentos搭建Minikube"><span class="icon iconfont icon-article"></span>6.SpringCloud-EurekaCentos搭建Minikube<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-7.SpringCloud-Eurekakubeadm%E6%90%AD%E5%BB%BAKubernetes.html" class="nav-link sidebar-link sidebar-page" aria-label="7.SpringCloud-Eurekakubeadm搭建Kubernetes"><span class="icon iconfont icon-article"></span>7.SpringCloud-Eurekakubeadm搭建Kubernetes<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="8.SpringCloud-Eureka二进制包搭建Kubernetes"><span class="icon iconfont icon-article"></span>8.SpringCloud-Eureka二进制包搭建Kubernetes<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-1-章节内容概述" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.1.章节内容概述"><!---->8.1.章节内容概述<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-2-章节内容大纲" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.2.章节内容大纲"><!---->8.2.章节内容大纲<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-3-环境配置清单" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.3.环境配置清单"><!---->8.3.环境配置清单<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-4-服务器规划和ip地址规划" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.4.服务器规划和IP地址规划"><!---->8.4.服务器规划和IP地址规划<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-4-1服务器规划" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.4.1服务器规划"><!---->8.4.1服务器规划<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-4-2-ip地址规划" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.4.2.IP地址规划"><!---->8.4.2.IP地址规划<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-5-安装前准备工作" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.5.安装前准备工作"><!---->8.5.安装前准备工作<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-5-1操作系统初始设置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.5.1操作系统初始设置"><!---->8.5.1操作系统初始设置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-5-2下载所有用到的软件包" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.5.2下载所有用到的软件包"><!---->8.5.2下载所有用到的软件包<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-6-安装cfssl证书生成工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.6.安装cfssl证书生成工具"><!---->8.6.安装cfssl证书生成工具<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-搭建etcd集群" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.7.搭建etcd集群"><!---->8.7.搭建etcd集群<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-1生成ca证书和https证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.7.1生成CA证书和https证书"><!---->8.7.1生成CA证书和https证书<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-2-部署etcd集群" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.7.2.部署etcd集群"><!---->8.7.2.部署etcd集群<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-4-拷贝etcd所需证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.7.4.拷贝etcd所需证书"><!---->8.7.4.拷贝etcd所需证书<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-5-让systemd管理etcd" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.7.5.让systemd管理etcd"><!---->8.7.5.让systemd管理etcd<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-6-拷贝etcd安装文件到worker-node" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.7.6.拷贝etcd安装文件到Worker Node"><!---->8.7.6.拷贝etcd安装文件到Worker Node<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-7-启动三个etcd并设置开机自启" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.7.7.启动三个etcd并设置开机自启"><!---->8.7.7.启动三个etcd并设置开机自启<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-8-安装配置docker" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.8.安装配置Docker"><!---->8.8.安装配置Docker<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-8-1在master1上安装docker" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.8.1在Master1上安装docker"><!---->8.8.1在Master1上安装docker<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-8-2在所有worker-node上安装docker" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.8.2在所有Worker Node上安装docker"><!---->8.8.2在所有Worker Node上安装docker<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-8-3启动三台机器上的docker" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.8.3启动三台机器上的docker"><!---->8.8.3启动三台机器上的docker<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-搭建kube-apiserver" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.9.搭建kube-apiserver"><!---->8.9.搭建kube-apiserver<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-1-生成ca证书和https证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.9.1.生成CA证书和Https证书"><!---->8.9.1.生成CA证书和Https证书<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-2-在master-node1上部署kube-apiserver" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.9.2.在Master Node1上部署kube-apiserver"><!---->8.9.2.在Master Node1上部署kube-apiserver<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-3-拷贝所需证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.9.3.拷贝所需证书"><!---->8.9.3.拷贝所需证书<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-4-启用tls-bootstrapping" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.9.4.启用TLS bootstrapping"><!---->8.9.4.启用TLS bootstrapping<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-5-让systemd管理apiserver" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.9.5.让systemd管理apiserver"><!---->8.9.5.让systemd管理apiserver<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-6-启动kube-apiserver" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.9.6.启动kube-apiserver"><!---->8.9.6.启动kube-apiserver<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-在master-node1上部署kube-controller-manager" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.10.在Master Node1上部署kube-controller-manager"><!---->8.10.在Master Node1上部署kube-controller-manager<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-1-切换目录并拷贝kube-controller-manager相关文件到-opt-kubernetes-bin" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.10.1.切换目录并拷贝kube-controller-manager相关文件到/opt/kubernetes/bin"><!---->8.10.1.切换目录并拷贝kube-controller-manager相关文件到/opt/kubernetes/bin<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-2-生成证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.10.2.生成证书"><!---->8.10.2.生成证书<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-2-创建kube-controller-manager配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.10.2.创建kube-controller-manager配置文件"><!---->8.10.2.创建kube-controller-manager配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-3-生成配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.10.3.生成配置文件"><!---->8.10.3.生成配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-4-让systemd管理controller-manager" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.10.4.让systemd管理controller-manager"><!---->8.10.4.让systemd管理controller-manager<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-5-启动kube-controller-manager" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.10.5.启动kube-controller-manager"><!---->8.10.5.启动kube-controller-manager<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-部署kube-scheduler" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.11.部署kube-scheduler"><!---->8.11.部署kube-scheduler<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-1-切换目录并拷贝kube-dcheduler相关文件到-opt-kubernetes-bin" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.10.1 切换目录并拷贝kube-dcheduler相关文件到/opt/kubernetes/bin"><!---->8.10.1 切换目录并拷贝kube-dcheduler相关文件到/opt/kubernetes/bin<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-2-生成证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.11.2.生成证书"><!---->8.11.2.生成证书<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-3-创建kube-scheduler-conf配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.11.3.创建kube-scheduler.conf配置文件"><!---->8.11.3.创建kube-scheduler.conf配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-4-生成kube-scheduler-kubeconfig文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.11.4.生成kube-scheduler.kubeconfig文件"><!---->8.11.4.生成kube-scheduler.kubeconfig文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-5-让systemd管理kube-scheduler" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.11.5.让systemd管理kube-scheduler"><!---->8.11.5.让systemd管理kube-scheduler<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-6-启动并设置开机启动" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.11.6.启动并设置开机启动"><!---->8.11.6.启动并设置开机启动<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-使用kubectl查看集群状态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.12.使用kubectl查看集群状态"><!---->8.12.使用kubectl查看集群状态<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-1-生成所需证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.12.1.生成所需证书"><!---->8.12.1.生成所需证书<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-2-在-kube文件夹中生成config文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.12.2.在.kube文件夹中生成config文件"><!---->8.12.2.在.kube文件夹中生成config文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-3-通过kubectl工具查看集群组件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.12.3.通过kubectl工具查看集群组件"><!---->8.12.3.通过kubectl工具查看集群组件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-4-授权kubelet-bootstrap用户允许请求证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.12.4.授权kubelet-bootstrap用户允许请求证书"><!---->8.12.4.授权kubelet-bootstrap用户允许请求证书<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-在master-node1上部署第一个worker-node" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.在Master Node1上部署第一个Worker Node"><!---->8.13.在Master Node1上部署第一个Worker Node<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-在master-node1部署kubelet" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.2.在Master Node1部署kubelet"><!---->8.13.2.在Master Node1部署kubelet<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-1-创建kubelet配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.2.1.创建kubelet配置文件"><!---->8.13.2.1.创建kubelet配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-2-创建kubelet编排文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.2.2.创建kubelet编排文件"><!---->8.13.2.2.创建kubelet编排文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-3-生成kubelet初次加入集群引导kubeconfig文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.2.3.生成kubelet初次加入集群引导kubeconfig文件"><!---->8.13.2.3.生成kubelet初次加入集群引导kubeconfig文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-4-systemd管理kubelet" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.2.4.systemd管理kubelet"><!---->8.13.2.4.systemd管理kubelet<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-5-启动kubelet并设置开机启动" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.3.5.启动kubelet并设置开机启动"><!---->8.13.3.5.启动kubelet并设置开机启动<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-6-允许kubelet证书申请并加入集群" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.2.6.允许kubelet证书申请并加入集群"><!---->8.13.2.6.允许kubelet证书申请并加入集群<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-部署kube-proxy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.3.部署kube-proxy"><!---->8.13.3.部署kube-proxy<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-1-创建kube-proxy配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.3.1.创建kube-proxy配置文件"><!---->8.13.3.1.创建kube-proxy配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-2-配置参数文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.3.2.配置参数文件"><!---->8.13.3.2.配置参数文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-3-生成kube-proxy证书文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.3.3.生成kube-proxy证书文件"><!---->8.13.3.3.生成kube-proxy证书文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-4-生成kube-proxy-kubeconfig文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.3.4.生成kube-proxy.kubeconfig文件"><!---->8.13.3.4.生成kube-proxy.kubeconfig文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-5-systemd管理kube-proxy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.3.5.systemd管理kube-proxy"><!---->8.13.3.5.systemd管理kube-proxy<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-3-6-启动kube-proxy并设置开机自启" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.12.3.6.启动kube-proxy并设置开机自启"><!---->8.12.3.6.启动kube-proxy并设置开机自启<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-4-部署网络组件-calico" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.4.部署网络组件(Calico)"><!---->8.13.4.部署网络组件(Calico)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-5-授权apiserver访问kubelet" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.13.5.授权apiserver访问kubelet"><!---->8.13.5.授权apiserver访问kubelet<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-增加worker-node" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.增加Worker Node"><!---->8.14.增加Worker Node<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-1-在所有worker-node创建工作目录并拷贝二进制文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.1.在所有Worker Node创建工作目录并拷贝二进制文件"><!---->8.14.1.在所有Worker Node创建工作目录并拷贝二进制文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-2拷贝master-node1上部署好的文件到worker-node" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.2拷贝Master Node1上部署好的文件到Worker Node"><!---->8.14.2拷贝Master Node1上部署好的文件到Worker Node<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-3-删除所有worker-node中kubelet证书和kubeconfig文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.3.删除所有Worker Node中kubelet证书和kubeconfig文件"><!---->8.14.3.删除所有Worker Node中kubelet证书和kubeconfig文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-4-修改worker-node1和worker-node2主机名" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.4. 修改Worker Node1和Worker Node2主机名"><!---->8.14.4. 修改Worker Node1和Worker Node2主机名<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-5-启动worker-node1和worker-node2中kubelet并设置开机自启" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.5.启动Worker Node1和Worker Node2中kubelet并设置开机自启"><!---->8.14.5.启动Worker Node1和Worker Node2中kubelet并设置开机自启<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-6-在master1上同意新的node-kubelet证书申请" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.6.在Master1上同意新的Node kubelet证书申请"><!---->8.14.6.在Master1上同意新的Node kubelet证书申请<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-7-在master1上部署kubernetes-dashboard" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.7.在Master1上部署kubernetes-dashboard"><!---->8.14.7.在Master1上部署kubernetes-dashboard<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-8-在master1上部署coredns" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.14.8.在Master1上部署CoreDNS"><!---->8.14.8.在Master1上部署CoreDNS<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-增加master2节点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.15.增加Master2节点"><!---->8.15.增加Master2节点<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-1-kubernetes集群架构简介" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.15.1.Kubernetes集群架构简介"><!---->8.15.1.Kubernetes集群架构简介<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-2-给master-node2安装docker" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.15.2.给Master Node2安装Docker"><!---->8.15.2.给Master Node2安装Docker<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-5-给master-node2节点拷贝所有需要的证书" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.15.5.给Master Node2节点拷贝所有需要的证书"><!---->8.15.5.给Master Node2节点拷贝所有需要的证书<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-6-启动master所有服务并设置开机自启" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.15.6.启动Master所有服务并设置开机自启"><!---->8.15.6.启动Master所有服务并设置开机自启<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-7-在master查看集群组件状态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.15.7.在Master查看集群组件状态"><!---->8.15.7.在Master查看集群组件状态<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-8-审批所有worker-node上的kubelet证书申请" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.15.8.审批所有Worker  Node上的kubelet证书申请"><!---->8.15.8.审批所有Worker  Node上的kubelet证书申请<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-部署nginx-keepalived高可用负载均衡器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.部署Nginx+Keepalived高可用负载均衡器"><!---->8.16.部署Nginx+Keepalived高可用负载均衡器<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-1-nginx和keepalived简介" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.1.Nginx和Keepalived简介"><!---->8.16.1.Nginx和Keepalived简介<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-2-在两台master-node上安装软件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.2.在两台Master Node上安装软件"><!---->8.16.2.在两台Master Node上安装软件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-3-nginx增加steam模块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.3.Nginx增加Steam模块"><!---->8.16.3.Nginx增加Steam模块<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-3-1-查看nginx版本模块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.3.1.查看Nginx版本模块"><!---->8.16.3.1.查看Nginx版本模块<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-3-2-master1和master2安装stream模块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.3.2.Master1和Master2安装Stream模块"><!---->8.16.3.2.Master1和Master2安装Stream模块<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-4-启动nginx、keepalived并设置开机自启-master1-master2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.4.启动nginx、keepalived并设置开机自启(master1/master2)"><!---->8.16.4.启动nginx、keepalived并设置开机自启(master1/master2)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-5-查看keepalived工作状态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.5.查看keepalived工作状态"><!---->8.16.5.查看keepalived工作状态<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-6-nginx-keepalived高可用测试" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.6.Nginx+keepalived高可用测试"><!---->8.16.6.Nginx+keepalived高可用测试<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-7-测试负载均衡器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.7.测试负载均衡器"><!---->8.16.7.测试负载均衡器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-8-修改所有的worker-node连接lb-vip" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.16.8.修改所有的Worker Node连接LB VIP"><!---->8.16.8.修改所有的Worker Node连接LB VIP<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-17-部署常见问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.17.部署常见问题"><!---->8.17.部署常见问题<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-17-1系统断电后-某个etcd节点无法启动" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.17.1系统断电后,某个etcd节点无法启动"><!---->8.17.1系统断电后,某个etcd节点无法启动<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-17-2-the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.17.2 The connection to the server localhost:8080 was refused - did you specify the right host or port?"><!---->8.17.2 The connection to the server localhost:8080 was refused - did you specify the right host or port?<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-18-部署测试程序" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.18.部署测试程序"><!---->8.18.部署测试程序<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-repo"></span><span class="title">章节内容合集</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->springcloud-eureka合集-8.SpringCloud-Eureka二进制包搭建Kubernetes</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2020年2月27日" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/lingwh1995" target="_blank" rel="noopener noreferrer">lingwh</a></span><span property="author" content="lingwh"></span></span><span class="origin" localizeddate="2020年2月27日" pageview="true" pure="false">原创</span><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2020年2月27日</span><meta property="datePublished" content="2020-02-27T00:00:00.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" localizeddate="2020年2月27日" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category7 clickable" role="navigation">环境搭建</li><meta property="articleSection" content="环境搭建"></ul></span><span aria-label="标签🏷" data-balloon-pos="down" localizeddate="2020年2月27日" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag5 clickable" role="navigation">二进制搭建k8s集群</li><li class="tag tag2 clickable" role="navigation">docker</li><li class="tag tag8 clickable" role="navigation">k8s网络插件</li><li class="tag tag8 clickable" role="navigation">k8s可视化</li><li class="tag tag7 clickable" role="navigation">etcd集群</li><li class="tag tag1 clickable" role="navigation">kube-apiserver</li><li class="tag tag3 clickable" role="navigation">kube-controller-manager</li><li class="tag tag8 clickable" role="navigation">kube-scheduler</li><li class="tag tag5 clickable" role="navigation">kubectl</li><li class="tag tag1 clickable" role="navigation">nginx</li><li class="tag tag4 clickable" role="navigation">keepalive</li><li class="tag tag2 clickable" role="navigation">高可用</li></ul><meta property="keywords" content="二进制搭建k8s集群,docker,k8s网络插件,k8s可视化,etcd集群,kube-apiserver,kube-controller-manager,kube-scheduler,kubectl,nginx,keepalive,高可用"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2020年2月27日" isoriginal="true" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 44 分钟</span><meta property="timeRequired" content="PT44M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-springcloud-eureka二进制包搭建kubernetes" class="router-link-active router-link-exact-active toc-link level1">8.SpringCloud-Eureka二进制包搭建Kubernetes</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-1-章节内容概述" class="router-link-active router-link-exact-active toc-link level2">8.1.章节内容概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-2-章节内容大纲" class="router-link-active router-link-exact-active toc-link level2">8.2.章节内容大纲</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-3-环境配置清单" class="router-link-active router-link-exact-active toc-link level2">8.3.环境配置清单</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-4-服务器规划和ip地址规划" class="router-link-active router-link-exact-active toc-link level2">8.4.服务器规划和IP地址规划</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-4-1服务器规划" class="router-link-active router-link-exact-active toc-link level3">8.4.1服务器规划</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-4-2-ip地址规划" class="router-link-active router-link-exact-active toc-link level3">8.4.2.IP地址规划</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-5-安装前准备工作" class="router-link-active router-link-exact-active toc-link level2">8.5.安装前准备工作</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-5-1操作系统初始设置" class="router-link-active router-link-exact-active toc-link level3">8.5.1操作系统初始设置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-5-2下载所有用到的软件包" class="router-link-active router-link-exact-active toc-link level3">8.5.2下载所有用到的软件包</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-6-安装cfssl证书生成工具" class="router-link-active router-link-exact-active toc-link level2">8.6.安装cfssl证书生成工具</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-搭建etcd集群" class="router-link-active router-link-exact-active toc-link level2">8.7.搭建etcd集群</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-1生成ca证书和https证书" class="router-link-active router-link-exact-active toc-link level3">8.7.1生成CA证书和https证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-2-部署etcd集群" class="router-link-active router-link-exact-active toc-link level3">8.7.2.部署etcd集群</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-4-拷贝etcd所需证书" class="router-link-active router-link-exact-active toc-link level3">8.7.4.拷贝etcd所需证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-5-让systemd管理etcd" class="router-link-active router-link-exact-active toc-link level3">8.7.5.让systemd管理etcd</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-6-拷贝etcd安装文件到worker-node" class="router-link-active router-link-exact-active toc-link level3">8.7.6.拷贝etcd安装文件到Worker Node</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-7-7-启动三个etcd并设置开机自启" class="router-link-active router-link-exact-active toc-link level3">8.7.7.启动三个etcd并设置开机自启</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-8-安装配置docker" class="router-link-active router-link-exact-active toc-link level2">8.8.安装配置Docker</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-8-1在master1上安装docker" class="router-link-active router-link-exact-active toc-link level3">8.8.1在Master1上安装docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-8-2在所有worker-node上安装docker" class="router-link-active router-link-exact-active toc-link level3">8.8.2在所有Worker Node上安装docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-8-3启动三台机器上的docker" class="router-link-active router-link-exact-active toc-link level3">8.8.3启动三台机器上的docker</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-搭建kube-apiserver" class="router-link-active router-link-exact-active toc-link level2">8.9.搭建kube-apiserver</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-1-生成ca证书和https证书" class="router-link-active router-link-exact-active toc-link level3">8.9.1.生成CA证书和Https证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-2-在master-node1上部署kube-apiserver" class="router-link-active router-link-exact-active toc-link level3">8.9.2.在Master Node1上部署kube-apiserver</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-3-拷贝所需证书" class="router-link-active router-link-exact-active toc-link level3">8.9.3.拷贝所需证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-4-启用tls-bootstrapping" class="router-link-active router-link-exact-active toc-link level3">8.9.4.启用TLS bootstrapping</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-5-让systemd管理apiserver" class="router-link-active router-link-exact-active toc-link level3">8.9.5.让systemd管理apiserver</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-9-6-启动kube-apiserver" class="router-link-active router-link-exact-active toc-link level3">8.9.6.启动kube-apiserver</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-在master-node1上部署kube-controller-manager" class="router-link-active router-link-exact-active toc-link level2">8.10.在Master Node1上部署kube-controller-manager</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-1-切换目录并拷贝kube-controller-manager相关文件到-opt-kubernetes-bin" class="router-link-active router-link-exact-active toc-link level3">8.10.1.切换目录并拷贝kube-controller-manager相关文件到/opt/kubernetes/bin</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-2-生成证书" class="router-link-active router-link-exact-active toc-link level3">8.10.2.生成证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-2-创建kube-controller-manager配置文件" class="router-link-active router-link-exact-active toc-link level3">8.10.2.创建kube-controller-manager配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-3-生成配置文件" class="router-link-active router-link-exact-active toc-link level3">8.10.3.生成配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-4-让systemd管理controller-manager" class="router-link-active router-link-exact-active toc-link level3">8.10.4.让systemd管理controller-manager</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-5-启动kube-controller-manager" class="router-link-active router-link-exact-active toc-link level3">8.10.5.启动kube-controller-manager</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-部署kube-scheduler" class="router-link-active router-link-exact-active toc-link level2">8.11.部署kube-scheduler</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-10-1-切换目录并拷贝kube-dcheduler相关文件到-opt-kubernetes-bin" class="router-link-active router-link-exact-active toc-link level3">8.10.1 切换目录并拷贝kube-dcheduler相关文件到/opt/kubernetes/bin</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-2-生成证书" class="router-link-active router-link-exact-active toc-link level3">8.11.2.生成证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-3-创建kube-scheduler-conf配置文件" class="router-link-active router-link-exact-active toc-link level3">8.11.3.创建kube-scheduler.conf配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-4-生成kube-scheduler-kubeconfig文件" class="router-link-active router-link-exact-active toc-link level3">8.11.4.生成kube-scheduler.kubeconfig文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-5-让systemd管理kube-scheduler" class="router-link-active router-link-exact-active toc-link level3">8.11.5.让systemd管理kube-scheduler</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-11-6-启动并设置开机启动" class="router-link-active router-link-exact-active toc-link level3">8.11.6.启动并设置开机启动</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-使用kubectl查看集群状态" class="router-link-active router-link-exact-active toc-link level2">8.12.使用kubectl查看集群状态</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-1-生成所需证书" class="router-link-active router-link-exact-active toc-link level3">8.12.1.生成所需证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-2-在-kube文件夹中生成config文件" class="router-link-active router-link-exact-active toc-link level3">8.12.2.在.kube文件夹中生成config文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-3-通过kubectl工具查看集群组件" class="router-link-active router-link-exact-active toc-link level3">8.12.3.通过kubectl工具查看集群组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-4-授权kubelet-bootstrap用户允许请求证书" class="router-link-active router-link-exact-active toc-link level3">8.12.4.授权kubelet-bootstrap用户允许请求证书</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-在master-node1上部署第一个worker-node" class="router-link-active router-link-exact-active toc-link level2">8.13.在Master Node1上部署第一个Worker Node</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-在master-node1部署kubelet" class="router-link-active router-link-exact-active toc-link level3">8.13.2.在Master Node1部署kubelet</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-1-创建kubelet配置文件" class="router-link-active router-link-exact-active toc-link level4">8.13.2.1.创建kubelet配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-2-创建kubelet编排文件" class="router-link-active router-link-exact-active toc-link level4">8.13.2.2.创建kubelet编排文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-3-生成kubelet初次加入集群引导kubeconfig文件" class="router-link-active router-link-exact-active toc-link level4">8.13.2.3.生成kubelet初次加入集群引导kubeconfig文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-4-systemd管理kubelet" class="router-link-active router-link-exact-active toc-link level4">8.13.2.4.systemd管理kubelet</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-5-启动kubelet并设置开机启动" class="router-link-active router-link-exact-active toc-link level4">8.13.3.5.启动kubelet并设置开机启动</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-2-6-允许kubelet证书申请并加入集群" class="router-link-active router-link-exact-active toc-link level4">8.13.2.6.允许kubelet证书申请并加入集群</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-部署kube-proxy" class="router-link-active router-link-exact-active toc-link level3">8.13.3.部署kube-proxy</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-1-创建kube-proxy配置文件" class="router-link-active router-link-exact-active toc-link level4">8.13.3.1.创建kube-proxy配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-2-配置参数文件" class="router-link-active router-link-exact-active toc-link level4">8.13.3.2.配置参数文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-3-生成kube-proxy证书文件" class="router-link-active router-link-exact-active toc-link level4">8.13.3.3.生成kube-proxy证书文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-4-生成kube-proxy-kubeconfig文件" class="router-link-active router-link-exact-active toc-link level4">8.13.3.4.生成kube-proxy.kubeconfig文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-3-5-systemd管理kube-proxy" class="router-link-active router-link-exact-active toc-link level4">8.13.3.5.systemd管理kube-proxy</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-12-3-6-启动kube-proxy并设置开机自启" class="router-link-active router-link-exact-active toc-link level4">8.12.3.6.启动kube-proxy并设置开机自启</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-4-部署网络组件-calico" class="router-link-active router-link-exact-active toc-link level3">8.13.4.部署网络组件(Calico)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-13-5-授权apiserver访问kubelet" class="router-link-active router-link-exact-active toc-link level3">8.13.5.授权apiserver访问kubelet</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-增加worker-node" class="router-link-active router-link-exact-active toc-link level2">8.14.增加Worker Node</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-1-在所有worker-node创建工作目录并拷贝二进制文件" class="router-link-active router-link-exact-active toc-link level3">8.14.1.在所有Worker Node创建工作目录并拷贝二进制文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-2拷贝master-node1上部署好的文件到worker-node" class="router-link-active router-link-exact-active toc-link level3">8.14.2拷贝Master Node1上部署好的文件到Worker Node</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-3-删除所有worker-node中kubelet证书和kubeconfig文件" class="router-link-active router-link-exact-active toc-link level3">8.14.3.删除所有Worker Node中kubelet证书和kubeconfig文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-4-修改worker-node1和worker-node2主机名" class="router-link-active router-link-exact-active toc-link level3">8.14.4. 修改Worker Node1和Worker Node2主机名</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-5-启动worker-node1和worker-node2中kubelet并设置开机自启" class="router-link-active router-link-exact-active toc-link level3">8.14.5.启动Worker Node1和Worker Node2中kubelet并设置开机自启</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-6-在master1上同意新的node-kubelet证书申请" class="router-link-active router-link-exact-active toc-link level3">8.14.6.在Master1上同意新的Node kubelet证书申请</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-7-在master1上部署kubernetes-dashboard" class="router-link-active router-link-exact-active toc-link level3">8.14.7.在Master1上部署kubernetes-dashboard</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-14-8-在master1上部署coredns" class="router-link-active router-link-exact-active toc-link level3">8.14.8.在Master1上部署CoreDNS</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-增加master2节点" class="router-link-active router-link-exact-active toc-link level2">8.15.增加Master2节点</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-1-kubernetes集群架构简介" class="router-link-active router-link-exact-active toc-link level3">8.15.1.Kubernetes集群架构简介</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-2-给master-node2安装docker" class="router-link-active router-link-exact-active toc-link level3">8.15.2.给Master Node2安装Docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-5-给master-node2节点拷贝所有需要的证书" class="router-link-active router-link-exact-active toc-link level3">8.15.5.给Master Node2节点拷贝所有需要的证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-6-启动master所有服务并设置开机自启" class="router-link-active router-link-exact-active toc-link level3">8.15.6.启动Master所有服务并设置开机自启</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-7-在master查看集群组件状态" class="router-link-active router-link-exact-active toc-link level3">8.15.7.在Master查看集群组件状态</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-15-8-审批所有worker-node上的kubelet证书申请" class="router-link-active router-link-exact-active toc-link level3">8.15.8.审批所有Worker  Node上的kubelet证书申请</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-部署nginx-keepalived高可用负载均衡器" class="router-link-active router-link-exact-active toc-link level2">8.16.部署Nginx+Keepalived高可用负载均衡器</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-1-nginx和keepalived简介" class="router-link-active router-link-exact-active toc-link level3">8.16.1.Nginx和Keepalived简介</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-2-在两台master-node上安装软件" class="router-link-active router-link-exact-active toc-link level3">8.16.2.在两台Master Node上安装软件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-3-nginx增加steam模块" class="router-link-active router-link-exact-active toc-link level3">8.16.3.Nginx增加Steam模块</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-3-1-查看nginx版本模块" class="router-link-active router-link-exact-active toc-link level4">8.16.3.1.查看Nginx版本模块</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-3-2-master1和master2安装stream模块" class="router-link-active router-link-exact-active toc-link level4">8.16.3.2.Master1和Master2安装Stream模块</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-4-启动nginx、keepalived并设置开机自启-master1-master2" class="router-link-active router-link-exact-active toc-link level3">8.16.4.启动nginx、keepalived并设置开机自启(master1/master2)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-5-查看keepalived工作状态" class="router-link-active router-link-exact-active toc-link level3">8.16.5.查看keepalived工作状态</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-6-nginx-keepalived高可用测试" class="router-link-active router-link-exact-active toc-link level3">8.16.6.Nginx+keepalived高可用测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-7-测试负载均衡器" class="router-link-active router-link-exact-active toc-link level3">8.16.7.测试负载均衡器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-16-8-修改所有的worker-node连接lb-vip" class="router-link-active router-link-exact-active toc-link level3">8.16.8.修改所有的Worker Node连接LB VIP</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-17-部署常见问题" class="router-link-active router-link-exact-active toc-link level2">8.17.部署常见问题</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-17-1系统断电后-某个etcd节点无法启动" class="router-link-active router-link-exact-active toc-link level3">8.17.1系统断电后,某个etcd节点无法启动</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-17-2-the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port" class="router-link-active router-link-exact-active toc-link level3">8.17.2 The connection to the server localhost:8080 was refused - did you specify the right host or port?</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-8.SpringCloud-Eureka%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E6%90%AD%E5%BB%BAKubernetes.html#_8-18-部署测试程序" class="router-link-active router-link-exact-active toc-link level2">8.18.部署测试程序</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="_8-springcloud-eureka二进制包搭建kubernetes" tabindex="-1"><a class="header-anchor" href="#_8-springcloud-eureka二进制包搭建kubernetes" aria-hidden="true">#</a> 8.SpringCloud-Eureka二进制包搭建Kubernetes</h1><h2 id="_8-1-章节内容概述" tabindex="-1"><a class="header-anchor" href="#_8-1-章节内容概述" aria-hidden="true">#</a> 8.1.章节内容概述</h2><pre><code>本章节涉及主要内容有：
 8.1.环境配置清单
 8.2.服务器规划和IP地址规划
 8.3.安装前准备工作
 8.4.安装cfssl证书生成工具
 8.5.搭建etcd集群
 8.6.安装配置Docker
 8.7.搭建kube-apiserver
 8.8.在Master Node1上部署kube-controller-manager
 8.9.部署kube-scheduler
 8.10.使用kubectl查看集群状态
 8.11.在Master Node1上部署第一个Worker Node
 8.12.增加Worker Node
 8.13.增加Master2节点
 8.14.部署Nginx+Keepalived高可用负载均衡器
 8.15.部署常见问题
 8.16.部署测试程序
具体每个小节中包含的内容可使通过下面的章节内容大纲进行查看，本章节内容中图片较少，主要以实用为主，所有代码
均经过严格测试，可直接复制运行即可。
</code></pre><h2 id="_8-2-章节内容大纲" tabindex="-1"><a class="header-anchor" href="#_8-2-章节内容大纲" aria-hidden="true">#</a> 8.2.章节内容大纲</h2><div><iframe src="/enhance/markmap/backend/springcloud/springcloud-eureka/chapter/springcloud-eureka-outline5-chapter8.html" width="100%" height="600rm" frameborder="0" scrolling="No" leftmargin="0" topmargin="0"></iframe></div><h2 id="_8-3-环境配置清单" tabindex="-1"><a class="header-anchor" href="#_8-3-环境配置清单" aria-hidden="true">#</a> 8.3.环境配置清单</h2><pre><code>操作系统									centos7
内核版本									3.10.0-1160.71.1.el7.x86_64
docker版本
etcd版本
Kubernetes版本
kube-apiserver版本
kube-controller-manager版本
kube-scheduler版本
nginx版本
keepalive版本
coredns版本
说明
Kubernetes解压后
</code></pre><h2 id="_8-4-服务器规划和ip地址规划" tabindex="-1"><a class="header-anchor" href="#_8-4-服务器规划和ip地址规划" aria-hidden="true">#</a> 8.4.服务器规划和IP地址规划</h2><h3 id="_8-4-1服务器规划" tabindex="-1"><a class="header-anchor" href="#_8-4-1服务器规划" aria-hidden="true">#</a> 8.4.1服务器规划</h3><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>如果要搭建一主多从非高可用Kubernetes集群，使用服务器规划1<br> 如果要搭建多主多从高可用Kubernetes集群，使用服务器规划2</p></div><pre><code>服务器规划1：一主多从服务器规划
</code></pre><table><thead><tr><th style="text-align:left;">角色</th><th style="text-align:left;">IP</th><th style="text-align:center;">组件</th></tr></thead><tbody><tr><td style="text-align:left;">binary-k8s-master1</td><td style="text-align:left;">192.168.0.9</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler<br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">binary-k8s-worker1</td><td style="text-align:left;">192.168.0.10</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">binary-k8s-worker1</td><td style="text-align:left;">192.168.0.11</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr></tbody></table><pre><code>服务器规划2：多主多从高可用服务器规划
</code></pre><table><thead><tr><th style="text-align:left;">角色</th><th style="text-align:left;">IP</th><th style="text-align:center;">组件</th></tr></thead><tbody><tr><td style="text-align:left;">binary-k8s-master1</td><td style="text-align:left;">192.168.0.9</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler <br> kubelet kube-proxy <br> nginx keepalived</td></tr><tr><td style="text-align:left;">binary-k8s-master2</td><td style="text-align:left;">192.168.0.12</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler <br> kubelet kube-proxy <br> nginx keepalived</td></tr><tr><td style="text-align:left;">binary-k8s-worker1</td><td style="text-align:left;">192.168.0.10</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">binary-k8s-worker2</td><td style="text-align:left;">192.168.0.11</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">负载均衡器(虚拟IP)</td><td style="text-align:left;">192.168.0.88</td><td style="text-align:center;"></td></tr></tbody></table><h3 id="_8-4-2-ip地址规划" tabindex="-1"><a class="header-anchor" href="#_8-4-2-ip地址规划" aria-hidden="true">#</a> 8.4.2.IP地址规划</h3><pre><code>IP地址规划
kubernetes自身使用的ClusterIP：10.0.0.1
本地回环地址：127.0.0.1
Master1:192.168.0.9
worker1:192.168.0.10
worker2:192.168.0.11
Master2:168.168.0.12
keepalive虚拟IP: 192.168.0.88
预留IP位置1：168.168.0.13
预留IP位置2：168.168.0.14
预留IP位置3：168.168.0.15
预留IP位置4：168.168.0.17
预留IP位置5：168.168.0.18
预留IP位置6：168.168.0.19
预留IP位置7：168.168.0.20
预留IP位置8：168.168.0.100
预留IP位置9：168.168.0.101
预留IP位置10：168.168.0.102
预留IP位置11：168.168.0.103
预留IP位置12：168.168.0.104
预留IP位置13：168.168.0.105

注意事项
1.可以将这些IP地址进行分类，如下所示（本次为了学习使用，并没有进行详细规划）
Etcd Cluster: 192.168.0.xxx
Master Node : 192.168.1.xxx
Worker Node : 192.168.2.xxx
keepalive   : 192.168.3.xx
2.一定要多预留一些IP地址，全部安装好之后，再给kube-apiserver添加IP地址很麻烦	
</code></pre><h2 id="_8-5-安装前准备工作" tabindex="-1"><a class="header-anchor" href="#_8-5-安装前准备工作" aria-hidden="true">#</a> 8.5.安装前准备工作</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>8.3章节涉及到的操作所有的Master节点和Worker Node都要执行，下载所有用到的软件包包只需要在Mater Node1进行就可以了</p></div><h3 id="_8-5-1操作系统初始设置" tabindex="-1"><a class="header-anchor" href="#_8-5-1操作系统初始设置" aria-hidden="true">#</a> 8.5.1操作系统初始设置</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl stop firewalld &amp;&amp; systemctl disable firewalld #关闭系统防火墙
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s/enforcing/disabled/&#39; /etc/selinux/config #永久关闭selinux
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab #永久关闭swap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>根据规划设置主机名</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname binary-k8s-master1 &amp;&amp; systemctl reboot #binary-k8s-master1（192.168.0.9）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname binary-k8s-worker1  &amp;&amp; systemctl reboot #binary-k8s-worker1 （192.168.0.10）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname binary-k8s-worker2  &amp;&amp; systemctl reboot #binary-k8s-worker2 （192.168.0.11）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname binary-k8s-master2 &amp;&amp; systemctl reboot #binary-k8s-master2（192.168.0.12）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>添加hosts
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.0.9 binary-k8s-master1
192.168.0.10 binary-k8s-worker1
192.168.0.11 binary-k8s-worker2
192.168.0.12 binary-k8s-master2
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>将桥接的IPV4流量传递到iptables的链
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>让配置生效
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sysctl --system  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>使用阿里云时间服务器进行临时同步
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ntpdate ntp.aliyun.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>补充命令
setenforce 0  #临时关闭selinux
swapoff -a	#临时关闭swap
</code></pre><h3 id="_8-5-2下载所有用到的软件包" tabindex="-1"><a class="header-anchor" href="#_8-5-2下载所有用到的软件包" aria-hidden="true">#</a> 8.5.2下载所有用到的软件包</h3><pre><code>安装curl
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install curl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>创建目录后切换到该目录中，并在该目录中下载本次安装所有用到的软件包
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/k8s &amp;&amp;
cd /opt/k8s &amp;&amp;
curl -fL -u software-1658989668964:1db7b96a6698ef06009de91348cb797dfd87fc99 \
&quot;https://lingwh-generic.pkg.coding.net/coding-drive/software/kubernetes-all-2022.7.28.tar.gz?version=latest&quot; \
-o kubernetes-all.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>解压tar包并重命名
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tar -zxvf kubernetes-all.tar.gz &amp;&amp;
mv kubernetes package
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-6-安装cfssl证书生成工具" tabindex="-1"><a class="header-anchor" href="#_8-6-安装cfssl证书生成工具" aria-hidden="true">#</a> 8.6.安装cfssl证书生成工具</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>8.4章节涉及到的操作只在Master Node1节点上进行操作</p></div><pre><code>cfssl简介
cfssl是一个开源的证书管理工具，使用json文件生成证书，相比openssl更方便使用,这里在Master Node1节点操作后复
制到其他节点，不需要在所有节点上操作。

切换到存放cfssl-utils的目录中，给cfssl-utils赋予运行权限并拷贝一份到/usr/bin/目录中
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/cfssl-utils &amp;&amp; chmod +x * &amp;&amp;
cp cfssl_linux-amd64 /usr/local/bin/cfssl &amp;&amp;
cp cfssljson_linux-amd64 /usr/local/bin/cfssljson &amp;&amp;
cp cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-7-搭建etcd集群" tabindex="-1"><a class="header-anchor" href="#_8-7-搭建etcd集群" aria-hidden="true">#</a> 8.7.搭建etcd集群</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>8.5章节涉及到的操作不要一次性在所有节点上操作，在Master1操作后复制到其他节点，这样比直接在所有节点上操作要快</p></div><h3 id="_8-7-1生成ca证书和https证书" tabindex="-1"><a class="header-anchor" href="#_8-7-1生成ca证书和https证书" aria-hidden="true">#</a> 8.7.1生成CA证书和https证书</h3><pre><code>创建存放etcd证书配置文件和生成证书的目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p ~/TLS/{etcd,k8s} &amp;&amp; cd /root/TLS/etcd/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>设置自签证书颁发机构(CA)
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; ca-config.json &lt;&lt; EOF
{
  &quot;signing&quot;: {
    &quot;default&quot;: {
      &quot;expiry&quot;: &quot;87600h&quot;
    },
    &quot;profiles&quot;: {
      &quot;www&quot;: {
         &quot;expiry&quot;: &quot;87600h&quot;,
         &quot;usages&quot;: [
            &quot;signing&quot;,
            &quot;key encipherment&quot;,
            &quot;server auth&quot;,
            &quot;client auth&quot;
        ]
      }
    }
  }
}
EOF

cat &gt; ca-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;etcd CA&quot;,
    &quot;key&quot;: {
        &quot;algo&quot;: &quot;rsa&quot;,
        &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
        {
            &quot;C&quot;: &quot;CN&quot;,
            &quot;L&quot;: &quot;YuMingYu&quot;,
            &quot;ST&quot;: &quot;YuMingYu&quot;
        }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>生成自签CA证书（当前目录下会生成 ca.pem和ca-key.pem文件）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>使用自签CA签发etcd https证书	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; server-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;etcd&quot;,
    &quot;hosts&quot;: [
    &quot;192.168.0.9&quot;,
    &quot;192.168.0.10&quot;,
    &quot;192.168.0.11&quot;,
    &quot;192.168.0.12&quot;
    ],
    &quot;key&quot;: {
        &quot;algo&quot;: &quot;rsa&quot;,
        &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
        {
            &quot;C&quot;: &quot;CN&quot;,
            &quot;L&quot;: &quot;YuMingYu&quot;,
            &quot;ST&quot;: &quot;YuMingYu&quot;
        }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>生成https证书（hosts字段中ip为所有etcd节点的集群内部通信ip,一个都不能少,可以多写几个预留的ip）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
	-config=ca-config.json -profile=www server-csr.json | cfssljson -bare server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-7-2-部署etcd集群" tabindex="-1"><a class="header-anchor" href="#_8-7-2-部署etcd集群" aria-hidden="true">#</a> 8.7.2.部署etcd集群</h3><pre><code>etcd简介
Etcd 是一个分布式键值存储系统，Kubernetes使用Etcd进行数据存储，所以先准备一个Etcd数据库，为解决Etcd单点
故障，应采用集群方式部署，这里使用3台组建集群，可容忍1台机器故障，当然，你也可以使用5台组建集群，可容忍2台
机器故障
				
服务器规划
节点名称	IP
etcd-1	192.168.0.9
etcd-2	192.168.0.10
etcd-2	192.168.0.11
特别说明
为了节省机器,这里与k8s节点复用,也可以部署在k8s机器之外,只要apiserver能连接到就行。

在Master Node1上创建etcd工作目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	mkdir /opt/etcd/{bin,cfg,ssl} -p
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>切换到存放etcd安装包工作的目录并解压etcd二进制包安装包到文件到指定目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package &amp;&amp;
tar -xf etcd-v3.4.9-linux-amd64.tar.gz &amp;&amp;
mv etcd-v3.4.9-linux-amd64/{etcd,etcdctl} /opt/etcd/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>创建etcd配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/etcd/cfg/etcd.conf &lt;&lt; EOF
#[Member]
ETCD_NAME=&quot;etcd-1&quot;
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.9:2380&quot;
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.9:2379&quot;

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.9:2380&quot;
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.9:2379&quot;
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,\
etcd-2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>etcd配置说明:
ETCD_NAME： 节点名称,集群中唯一
ETCD_DATA_DIR：数据目录
ETCD_LISTEN_PEER_URLS：集群通讯监听地址
ETCD_LISTEN_CLIENT_URLS：客户端访问监听地址
ETCD_INITIAL_CLUSTER：集群节点地址
ETCD_INITIALCLUSTER_TOKEN：集群Token
ETCD_INITIALCLUSTER_STATE：加入集群的状态：new是新集群,existing表示加入已有集群
</code></pre><h3 id="_8-7-4-拷贝etcd所需证书" tabindex="-1"><a class="header-anchor" href="#_8-7-4-拷贝etcd所需证书" aria-hidden="true">#</a> 8.7.4.拷贝etcd所需证书</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp ~/TLS/etcd/{server.pem,server-key.pem,ca.pem} /opt/etcd/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-7-5-让systemd管理etcd" tabindex="-1"><a class="header-anchor" href="#_8-7-5-让systemd管理etcd" aria-hidden="true">#</a> 8.7.5.让systemd管理etcd</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/etcd.service &lt;&lt; EOF
[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
EnvironmentFile=/opt/etcd/cfg/etcd.conf
ExecStart=/opt/etcd/bin/etcd \
--cert-file=/opt/etcd/ssl/server.pem \
--key-file=/opt/etcd/ssl/server-key.pem \
--peer-cert-file=/opt/etcd/ssl/server.pem \
--peer-key-file=/opt/etcd/ssl/server-key.pem \
--trusted-ca-file=/opt/etcd/ssl/ca.pem \
--peer-trusted-ca-file=/opt/etcd/ssl/ca.pem \
--logger=zap
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-7-6-拷贝etcd安装文件到worker-node" tabindex="-1"><a class="header-anchor" href="#_8-7-6-拷贝etcd安装文件到worker-node" aria-hidden="true">#</a> 8.7.6.拷贝etcd安装文件到Worker Node</h3><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>在Master1 Node上执行下面操作，只需要拷贝到Worker Node1和Worker Node2即可，不需要拷贝到Master Node2</p></div><pre><code>在Worker Node1上和Worker Node2上创建etcd工作目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	mkdir /opt/etcd/{bin,cfg,ssl} -p
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>复制etcd安装文件和配置文件到192.168.0.10机器上
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/etcd/ root@192.168.0.10:/opt &amp;&amp;
scp /usr/lib/systemd/system/etcd.service root@192.168.0.10:/usr/lib/systemd/system/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>复制etcd安装文件和配置文件到192.168.0.11机器上
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/etcd/ root@192.168.0.11:/opt &amp;&amp;
scp /usr/lib/systemd/system/etcd.service root@192.168.0.11:/usr/lib/systemd/system/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>修改Worker Node1（192.168.0.10）中etcd.conf配置，下面命令会直接覆盖拷贝过来的配置
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/etcd/cfg/etcd.conf &lt;&lt; EOF
#[Member]
ETCD_NAME=&quot;etcd-2&quot;
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.10:2380&quot;
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.10:2379&quot;

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.10:2380&quot;
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.10:2379&quot;
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,\
etcd-2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>修改后内容	
ETCD_NAME=&quot;etcd-2&quot;	#此处需要修改
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.10:2380&quot; 	#此处需要修改
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.10:2379&quot; 	#此处需要修改

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.10:2380&quot; #此处需要修改
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.10:2379&quot; #此处需要修改
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,etcd-
2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
						
修改Worker Node2（192.168.0.11）中etcd.conf配置，下面命令会直接覆盖拷贝过来的配置
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/etcd/cfg/etcd.conf &lt;&lt; EOF
#[Member]
ETCD_NAME=&quot;etcd-3&quot;
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.11:2380&quot;
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.11:2379&quot;

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.11:2380&quot;
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.11:2379&quot;
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,\
etcd-2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>修改后内容
ETCD_NAME=&quot;etcd-3&quot;	#此处需要修改
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_PEER_URLS=&quot;https://192.168.0.11:2380&quot; 	#此处需要修改
ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.0.11:2379&quot; 	#此处需要修改

#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.0.11:2380&quot; #此处需要修改
ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.0.11:2379&quot; #此处需要修改
ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.0.9:2380,etcd-
2=https://192.168.0.10:2380,etcd-3=https://192.168.0.11:2380&quot;
ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;
ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;
</code></pre><h3 id="_8-7-7-启动三个etcd并设置开机自启" tabindex="-1"><a class="header-anchor" href="#_8-7-7-启动三个etcd并设置开机自启" aria-hidden="true">#</a> 8.7.7.启动三个etcd并设置开机自启</h3><pre><code>启动多个节点的etcd
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start etcd &amp;&amp;
systemctl enable etcd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>注意事项	
etcd须多个节点同时启动,不然执行systemctl start etcd会一直卡在前台,连接其他节点,建议通过批量管理工
具,或者脚本同时启动etcd。

检查etcd集群状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ETCDCTL_API=3 /opt/etcd/bin/etcdctl \
--cacert=/opt/etcd/ssl/ca.pem \
--cert=/opt/etcd/ssl/server.pem \
--key=/opt/etcd/ssl/server-key.pem \
--endpoints=&quot;https://192.168.0.9:2379,https://192.168.0.10:2379,https://192.168.0.11:2379&quot; \
endpoint health --write-out=table
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>如果启动成功会显示如下内容:
+---------------------------+--------+-------------+-------+
|         ENDPOINT          | HEALTH |    TOOK     | ERROR |
+---------------------------+--------+-------------+-------+
|  https://192.168.0.9:2379 |   true | 44.421035ms |       |
| https://192.168.0.10:2379 |   true | 44.433731ms |       |
| https://192.168.0.11:2379 |   true | 50.266126ms |       |
+---------------------------+--------+-------------+-------+

etcd启动问题排查
命令1
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>journalctl -u etcd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-8-安装配置docker" tabindex="-1"><a class="header-anchor" href="#_8-8-安装配置docker" aria-hidden="true">#</a> 8.8.安装配置Docker</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>所有节点都需要安装docker，可以先在Master Node1上安装，拷贝一部分安装内容到Worker Node1和Worker Node2，再在Worker Node1和Worker Node2完成剩余的安装操作，这样比直接在三台机器上完成全部操作要快很多</p></div><h3 id="_8-8-1在master1上安装docker" tabindex="-1"><a class="header-anchor" href="#_8-8-1在master1上安装docker" aria-hidden="true">#</a> 8.8.1在Master1上安装docker</h3><pre><code>切换目录并在该目录并将该目录中的docker二进制安装文件解压到指定目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/ &amp;&amp;
tar -xf docker-19.03.9.tgz &amp;&amp; mv docker/* /usr/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>配置docker私有镜像	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo mkdir -p /etc/docker &amp;&amp;
sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;
{
  &quot;registry-mirrors&quot;: [&quot;https://3s9106.mirror.alncs.com&quot;]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>配置docker.service文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/docker.service &lt;&lt; EOF
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target firewalld.service
Wants=network-online.target
 
[Service]
Type=notify
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
LimitNOFILE=infinity
LimitNPROC=infinity
TimeoutStartSec=0
Delegate=yes
KillMode=process
Restart=on-failure
StartLimitBurst=3
StartLimitInterval=60s
 
[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-8-2在所有worker-node上安装docker" tabindex="-1"><a class="header-anchor" href="#_8-8-2在所有worker-node上安装docker" aria-hidden="true">#</a> 8.8.2在所有Worker Node上安装docker</h3><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>只需要在Master Node1上安装Docker，然后将所有安装文件从Master Node1上拷贝到Worker Node1和Worker Node2上</p></div><pre><code>在Worker Node1和Worker Node2上创建存放docker安装文件的目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/k8s/package &amp;&amp;
mkdir -p /etc/docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>从Mater1上复制Docker安装文件到Worker Node1和Worker Node2
Worker Node1（192.168.0.10）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp /usr/bin/docker* root@192.168.0.10:/usr/bin &amp;&amp;
scp /usr/bin/runc root@192.168.0.10:/usr/bin &amp;&amp;
scp /usr/bin/containerd* root@192.168.0.10:/usr/bin &amp;&amp;
scp /usr/lib/systemd/system/docker.service \
root@192.168.0.10:/usr/lib/systemd/system &amp;&amp;
scp -r /etc/docker root@192.168.0.10:/etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Worker Node2（192.168.0.11）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp /usr/bin/docker* root@192.168.0.11:/usr/bin &amp;&amp;
scp /usr/bin/runc root@192.168.0.11:/usr/bin &amp;&amp;
scp /usr/bin/containerd* root@192.168.0.11:/usr/bin &amp;&amp;
scp /usr/lib/systemd/system/docker.service \
root@192.168.0.11:/usr/lib/systemd/system &amp;&amp;
scp -r /etc/docker root@192.168.0.11:/etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-8-3启动三台机器上的docker" tabindex="-1"><a class="header-anchor" href="#_8-8-3启动三台机器上的docker" aria-hidden="true">#</a> 8.8.3启动三台机器上的docker</h3><pre><code>刷新配置文件后启动三台机器上的docker并设置为开机启动
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start docker &amp;&amp;
systemctl enable docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>查看启动状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>启动故障排查
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-9-搭建kube-apiserver" tabindex="-1"><a class="header-anchor" href="#_8-9-搭建kube-apiserver" aria-hidden="true">#</a> 8.9.搭建kube-apiserver</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>8.7章节所有操作只在Master Node1节点操作，不需要在其他节点操作，因为kube-apiserver是Master节点的专用组件，Worker Node不需要使用这个组件</p></div><h3 id="_8-9-1-生成ca证书和https证书" tabindex="-1"><a class="header-anchor" href="#_8-9-1-生成ca证书和https证书" aria-hidden="true">#</a> 8.9.1.生成CA证书和Https证书</h3><pre><code>切换目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>设置CA自签机构
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; ca-config.json &lt;&lt; EOF
{
  &quot;signing&quot;: {
    &quot;default&quot;: {
      &quot;expiry&quot;: &quot;87600h&quot;
    },
    &quot;profiles&quot;: {
      &quot;kubernetes&quot;: {
         &quot;expiry&quot;: &quot;87600h&quot;,
         &quot;usages&quot;: [
            &quot;signing&quot;,
            &quot;key encipherment&quot;,
            &quot;server auth&quot;,
            &quot;client auth&quot;
        ]
      }
    }
  }
}
EOF

cat &gt; ca-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;kubernetes&quot;,
    &quot;key&quot;: {
        &quot;algo&quot;: &quot;rsa&quot;,
        &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
        {
            &quot;C&quot;: &quot;CN&quot;,
            &quot;L&quot;: &quot;Beijing&quot;,
            &quot;ST&quot;: &quot;Beijing&quot;,
            &quot;O&quot;: &quot;k8s&quot;,
            &quot;OU&quot;: &quot;System&quot;
        }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>生成自签CA证书（生成成功目录下回多ca-key.pem  ca.csr  ca.pem）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>使用自签CA签发kube-apiserver https
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; server-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;kubernetes&quot;,
    &quot;hosts&quot;: [
      &quot;10.0.0.1&quot;,
      &quot;127.0.0.1&quot;,
      &quot;192.168.0.9&quot;,
      &quot;192.168.0.10&quot;,
      &quot;192.168.0.11&quot;,
      &quot;192.168.0.12&quot;,
      &quot;192.168.0.88&quot;,
      &quot;192.168.0.13&quot;,
      &quot;192.168.0.14&quot;,
      &quot;192.168.0.15&quot;,
      &quot;192.168.0.16&quot;,
      &quot;192.168.0.17&quot;,
      &quot;192.168.0.18&quot;,
      &quot;192.168.0.19&quot;,
      &quot;192.168.0.20&quot;,
      &quot;192.168.0.100&quot;,
      &quot;192.168.0.101&quot;,
      &quot;192.168.0.102&quot;,
      &quot;192.168.0.103&quot;,
      &quot;192.168.0.104&quot;,
      &quot;192.168.0.105&quot;,
      &quot;kubernetes&quot;,
      &quot;kubernetes.default&quot;,
      &quot;kubernetes.default.svc&quot;,
      &quot;kubernetes.default.svc.cluster&quot;,
      &quot;kubernetes.default.svc.cluster.local&quot;
    ],
    &quot;key&quot;: {
        &quot;algo&quot;: &quot;rsa&quot;,
        &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
        {
            &quot;C&quot;: &quot;CN&quot;,
            &quot;L&quot;: &quot;BeiJing&quot;,
            &quot;ST&quot;: &quot;BeiJing&quot;,
            &quot;O&quot;: &quot;k8s&quot;,
            &quot;OU&quot;: &quot;System&quot;
        }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>关于IP地址的说明
IP地址列表
	kubernetes自身使用的ClusterIP：10.0.0.1
	本地回环地址：127.0.0.1
	Master1:192.168.0.9
	worker1:192.168.0.10
	worker2:192.168.0.11
	Master2:168.168.0.12
	keepalive虚拟IP: 192.168.0.88
	预留IP位置1：168.168.0.13
	预留IP位置2：168.168.0.14
	预留IP位置3：168.168.0.15
	预留IP位置4：168.168.0.17
	预留IP位置5：168.168.0.18
	预留IP位置6：168.168.0.19
	预留IP位置7：168.168.0.20
	预留IP位置8：168.168.0.100
	预留IP位置9：168.168.0.101
	预留IP位置10：168.168.0.102
	预留IP位置11：168.168.0.103
	预留IP位置12：168.168.0.104
	预留IP位置13：168.168.0.105

注意事项
	如果要部署一主多从非高可用不用加keepalive虚拟IP
	如果要部署多主多从高可用一定要加上keepalive虚拟IP
	一定要多预留几个IP地址，这个IP地址是留给以后集群扩展时Master Node或者Worker Node使用的
	可以分一下:目前没有分只是为了学习使用
		Master Node:192.168.0.xxx
		Worker Node:192.168.1.xxx
		VIP		:192.168.3.xxx
</code></pre><p>​ ​ 生成https证书（当前目录下会生成server.pem 和 server-key.pem文件）</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \
-profile=kubernetes server-csr.json | cfssljson -bare server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-9-2-在master-node1上部署kube-apiserver" tabindex="-1"><a class="header-anchor" href="#_8-9-2-在master-node1上部署kube-apiserver" aria-hidden="true">#</a> 8.9.2.在Master Node1上部署kube-apiserver</h3><pre><code>创建kube-apiserver工作目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/kubernetes/{bin,cfg,ssl,logs}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>切换目录并解压kubernetes软件包并将kube-apiserver拷贝到指定目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package &amp;&amp;
tar -zxvf kubernetes-server-linux-amd64.tar.gz &amp;&amp;
cd /opt/k8s/package/kubernetes/server/bin &amp;&amp;
cp kube-apiserver /opt/kubernetes/bin &amp;&amp;
cp kubectl /usr/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>创建kube-apiserver配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-apiserver.conf &lt;&lt; EOF
KUBE_APISERVER_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--etcd-servers=https://192.168.0.9:2379,https://192.168.0.10:2379,\
https://192.168.0.11:2379 \\
--bind-address=192.168.0.9 \\
--secure-port=6443 \\
--advertise-address=192.168.0.9 \\
--allow-privileged=true \\
--service-cluster-ip-range=10.0.0.0/24 \\
--enable-admission-plugins=NamespaceLifecycle,\
LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\
--authorization-mode=RBAC,Node \\
--enable-bootstrap-token-auth=true \\
--token-auth-file=/opt/kubernetes/cfg/token.csv \\
--service-node-port-range=30000-32767 \\
--kubelet-client-certificate=/opt/kubernetes/ssl/server.pem \\
--kubelet-client-key=/opt/kubernetes/ssl/server-key.pem \\
--tls-cert-file=/opt/kubernetes/ssl/server.pem  \\
--tls-private-key-file=/opt/kubernetes/ssl/server-key.pem \\
--client-ca-file=/opt/kubernetes/ssl/ca.pem \\
--service-account-key-file=/opt/kubernetes/ssl/ca-key.pem \\
--service-account-issuer=api \\
--service-account-signing-key-file=/opt/kubernetes/ssl/server-key.pem \\
--etcd-cafile=/opt/etcd/ssl/ca.pem \\
--etcd-certfile=/opt/etcd/ssl/server.pem \\
--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\
--requestheader-client-ca-file=/opt/kubernetes/ssl/ca.pem \\
--proxy-client-cert-file=/opt/kubernetes/ssl/server.pem \\
--proxy-client-key-file=/opt/kubernetes/ssl/server-key.pem \\
--requestheader-allowed-names=kubernetes \\
--requestheader-extra-headers-prefix=X-Remote-Extra- \\
--requestheader-group-headers=X-Remote-Group \\
--requestheader-username-headers=X-Remote-User \\
--enable-aggregator-routing=true \\
--audit-log-maxage=30 \\
--audit-log-maxbackup=3 \\
--audit-log-maxsize=100 \\
--audit-log-path=/opt/kubernetes/logs/k8s-audit.log&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>配置说明:
上面两个\\第一个是转义符,第二个是换行符,使用转义符是为了使用EOF保留换行符。
--logtostderr ：启用日志
--v ：日志等级
--log-dir ：日志目录
--etcd-servers ：etcd集群地址
--bind-address ：监听地址
--secure-port ：https安全端口
--advertise-address ：集群通告地址
--allow-privileged ：启动授权
--service-cluster-ip-range ：Service虚拟IP地址段
--enable-admission-plugins ： 准入控制模块
--authorization-mode ：认证授权,启用RBAC授权和节点自管理
--enable-bootstrap-token-auth ：启用TLS bootstrap机制
--token-auth-file ：bootstrap token文件
--service-node-port-range ：Service nodeport类型默认分配端口范围
--kubelet-client-xxx ：apiserver访问kubelet客户端证书
--tls-xxx-file ：apiserver https证书
--etcd-xxxfile ：连接etcd集群证书
--audit-log-xxx ：审计日志
注意事项
1.20版本必须加的参数：
--service-account-issuer
--service-account-signing-key-file
启动聚合层网关配置：
--requestheader-client-ca-file
--proxy-client-cert-file
--proxy-client-key-file
--requestheader-allowed-names
--requestheader-extra-headers-prefix
--requestheader-group-headers
--requestheader-username-headers
--enable-aggregator-routing
</code></pre><h3 id="_8-9-3-拷贝所需证书" tabindex="-1"><a class="header-anchor" href="#_8-9-3-拷贝所需证书" aria-hidden="true">#</a> 8.9.3.拷贝所需证书</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp ~/TLS/k8s/ca*pem ~/TLS/k8s/server*pem /opt/kubernetes/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-9-4-启用tls-bootstrapping" tabindex="-1"><a class="header-anchor" href="#_8-9-4-启用tls-bootstrapping" aria-hidden="true">#</a> 8.9.4.启用TLS bootstrapping</h3><pre><code>TLS Bootstraping介绍
Master apiserver启用TLS认证后，Node节点kubelet和kube-proxy要与kube-apiserver进
行通信，必须使用CA签发的有效证书才可以，当Node节点很多时，这种客户端证书颁发需要大量工作，同样也会增加集群
扩展复杂度。为了简化流程，Kubernetes引入了TLS bootstraping机制来自动颁发客户端证书，kubelet会以一个低
权限用户自动向apiserver申请证书，kubelet的证书由apiserver动态签署。所以强烈建议在Node上使用这种方式，目
前主要用于kubelet，kube-proxy还是由我们统一颁发一个证书。

创建上述配置文件中token文件：（格式：token,用户名,UID,用户组）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/token.csv &lt;&lt; EOF
4136692876ad4b01bb9dd0988480ebba,kubelet-bootstrap,10001,&quot;system:node-bootstrapper&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>注意事项：token也可自行生成替换
head -c 16 /dev/urandom | od -An -t x | tr -d &#39; &#39;
</code></pre><h3 id="_8-9-5-让systemd管理apiserver" tabindex="-1"><a class="header-anchor" href="#_8-9-5-让systemd管理apiserver" aria-hidden="true">#</a> 8.9.5.让systemd管理apiserver</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; EOF
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf
ExecStart=/opt/kubernetes/bin/kube-apiserver \$KUBE_APISERVER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-9-6-启动kube-apiserver" tabindex="-1"><a class="header-anchor" href="#_8-9-6-启动kube-apiserver" aria-hidden="true">#</a> 8.9.6.启动kube-apiserver</h3><pre><code>刷新配置文件后启动kube-apiserver并设置为开机启动状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-apiserver &amp;&amp;
systemctl enable kube-apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>查看启动状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kube-apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>启动故障排查
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kube-apiserver|grep -i error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-10-在master-node1上部署kube-controller-manager" tabindex="-1"><a class="header-anchor" href="#_8-10-在master-node1上部署kube-controller-manager" aria-hidden="true">#</a> 8.10.在Master Node1上部署kube-controller-manager</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>8.8章节所有操作只在Master Node1节点操作，不需要在其他节点操作，因为kube-controller-manager是Master节点的专用组件，Worker Node不需要使用这个组件</p></div><h3 id="_8-10-1-切换目录并拷贝kube-controller-manager相关文件到-opt-kubernetes-bin" tabindex="-1"><a class="header-anchor" href="#_8-10-1-切换目录并拷贝kube-controller-manager相关文件到-opt-kubernetes-bin" aria-hidden="true">#</a> 8.10.1.切换目录并拷贝kube-controller-manager相关文件到/opt/kubernetes/bin</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp /opt/k8s/package/kubernetes/server/bin/kube-controller-manager /opt/kubernetes/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-10-2-生成证书" tabindex="-1"><a class="header-anchor" href="#_8-10-2-生成证书" aria-hidden="true">#</a> 8.10.2.生成证书</h3><pre><code>切换工作目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>生成CA自签签证
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; kube-controller-manager-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;system:kube-controller-manager&quot;,
    &quot;hosts&quot;: [],
    &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
    {
        &quot;C&quot;: &quot;CN&quot;,
        &quot;L&quot;: &quot;BeiJing&quot;, 
        &quot;ST&quot;: &quot;BeiJing&quot;,
        &quot;O&quot;: &quot;system:masters&quot;,
        &quot;OU&quot;: &quot;System&quot;
    }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>使用CA自签证书签发kube-controller-manager
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
-config=ca-config.json -profile=kubernetes \
kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-10-2-创建kube-controller-manager配置文件" tabindex="-1"><a class="header-anchor" href="#_8-10-2-创建kube-controller-manager配置文件" aria-hidden="true">#</a> 8.10.2.创建kube-controller-manager配置文件</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-controller-manager.conf &lt;&lt; EOF
KUBE_CONTROLLER_MANAGER_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--leader-elect=true \\
--kubeconfig=/opt/kubernetes/cfg/kube-controller-manager.kubeconfig \\
--bind-address=127.0.0.1 \\
--allocate-node-cidrs=true \\
--cluster-cidr=10.244.0.0/16 \\
--service-cluster-ip-range=10.0.0.0/24 \\
--cluster-signing-cert-file=/opt/kubernetes/ssl/ca.pem \\
--cluster-signing-key-file=/opt/kubernetes/ssl/ca-key.pem  \\
--root-ca-file=/opt/kubernetes/ssl/ca.pem \\
--service-account-private-key-file=/opt/kubernetes/ssl/ca-key.pem \\
--cluster-signing-duration=87600h0m0s&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>配置文件说明		
--kubeconfig ：连接apiserver配置文件。
--leader-elect ：当该组件启动多个时,自动选举(HA)
--cluster-signing-cert-file ：自动为kubelet颁发证书的CA,apiserver保持一致
--cluster-signing-key-file ：自动为kubelet颁发证书的CA,apiserver保持一致	
</code></pre><h3 id="_8-10-3-生成配置文件" tabindex="-1"><a class="header-anchor" href="#_8-10-3-生成配置文件" aria-hidden="true">#</a> 8.10.3.生成配置文件</h3><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>以下是shell命令,直接在shell终端执行</p></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KUBE_CONFIG=&quot;/opt/kubernetes/cfg/kube-controller-manager.kubeconfig&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot;

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-controller-manager \
  --client-certificate=./kube-controller-manager.pem \
  --client-key=./kube-controller-manager-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-controller-manager \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-10-4-让systemd管理controller-manager" tabindex="-1"><a class="header-anchor" href="#_8-10-4-让systemd管理controller-manager" aria-hidden="true">#</a> 8.10.4.让systemd管理controller-manager</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Controller Manager
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf
ExecStart=/opt/kubernetes/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-10-5-启动kube-controller-manager" tabindex="-1"><a class="header-anchor" href="#_8-10-5-启动kube-controller-manager" aria-hidden="true">#</a> 8.10.5.启动kube-controller-manager</h3><pre><code>刷新配置文件后启动kube-controller-manager并设置为开机启动
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-controller-manager &amp;&amp;
systemctl enable kube-controller-manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>查看kube-controller-manager启动状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kube-controller-manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>启动故障排查
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kube-controller-manager|grep -i error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-11-部署kube-scheduler" tabindex="-1"><a class="header-anchor" href="#_8-11-部署kube-scheduler" aria-hidden="true">#</a> 8.11.部署kube-scheduler</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>8.9章节所有操作只在Master Node1节点操作，不需要在其他节点操作，因为kube-scheduler是Master节点的专用组件，Worker Node不需要使用这个组件</p></div><h3 id="_8-10-1-切换目录并拷贝kube-dcheduler相关文件到-opt-kubernetes-bin" tabindex="-1"><a class="header-anchor" href="#_8-10-1-切换目录并拷贝kube-dcheduler相关文件到-opt-kubernetes-bin" aria-hidden="true">#</a> 8.10.1 切换目录并拷贝kube-dcheduler相关文件到/opt/kubernetes/bin</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp /opt/k8s/package/kubernetes/server/bin/kube-scheduler /opt/kubernetes/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-11-2-生成证书" tabindex="-1"><a class="header-anchor" href="#_8-11-2-生成证书" aria-hidden="true">#</a> 8.11.2.生成证书</h3><pre><code>切换工作目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>创建证书请求文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; kube-scheduler-csr.json &lt;&lt; EOF
{
  &quot;CN&quot;: &quot;system:kube-scheduler&quot;,
  &quot;hosts&quot;: [],
  &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  },
  &quot;names&quot;: [
    {
      &quot;C&quot;: &quot;CN&quot;,
      &quot;L&quot;: &quot;BeiJing&quot;,
      &quot;ST&quot;: &quot;BeiJing&quot;,
      &quot;O&quot;: &quot;system:masters&quot;,
      &quot;OU&quot;: &quot;System&quot;
    }
  ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>生成证书
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
-config=ca-config.json -profile=kubernetes \
kube-scheduler-csr.json | cfssljson -bare kube-scheduler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-11-3-创建kube-scheduler-conf配置文件" tabindex="-1"><a class="header-anchor" href="#_8-11-3-创建kube-scheduler-conf配置文件" aria-hidden="true">#</a> 8.11.3.创建kube-scheduler.conf配置文件</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-scheduler.conf &lt;&lt; EOF
KUBE_SCHEDULER_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--leader-elect \\
--kubeconfig=/opt/kubernetes/cfg/kube-scheduler.kubeconfig \\
--bind-address=127.0.0.1&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>配置文件说明
--kubeconfig ：连接apiserver配置文件
--leader-elect ：当该组件启动多个时,自动选举(HA)。
</code></pre><h3 id="_8-11-4-生成kube-scheduler-kubeconfig文件" tabindex="-1"><a class="header-anchor" href="#_8-11-4-生成kube-scheduler-kubeconfig文件" aria-hidden="true">#</a> 8.11.4.生成kube-scheduler.kubeconfig文件</h3><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>在shell中执行直接执行下面命令</p></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	mkdir ~/.kube
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KUBE_CONFIG=&quot;/opt/kubernetes/cfg/kube-scheduler.kubeconfig&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot;

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-scheduler \
  --client-certificate=./kube-scheduler.pem \
  --client-key=./kube-scheduler-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-scheduler \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-11-5-让systemd管理kube-scheduler" tabindex="-1"><a class="header-anchor" href="#_8-11-5-让systemd管理kube-scheduler" aria-hidden="true">#</a> 8.11.5.让systemd管理kube-scheduler</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kube-scheduler.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Scheduler
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf
ExecStart=/opt/kubernetes/bin/kube-scheduler \$KUBE_SCHEDULER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-11-6-启动并设置开机启动" tabindex="-1"><a class="header-anchor" href="#_8-11-6-启动并设置开机启动" aria-hidden="true">#</a> 8.11.6.启动并设置开机启动</h3><pre><code>刷新配置文件后启动kube-scheduler并设置为开机启动
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-scheduler &amp;&amp;
systemctl enable kube-scheduler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>查看启动状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kube-scheduler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>启动故障排查
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kube-scheduler|grep -i error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-12-使用kubectl查看集群状态" tabindex="-1"><a class="header-anchor" href="#_8-12-使用kubectl查看集群状态" aria-hidden="true">#</a> 8.12.使用kubectl查看集群状态</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>8.10章节所有操作只在Master1节点操作，不需要在其他节点操作，因为kubectl是Master节点的专用组件，Worker Node不需要使用这个组件</p></div><h3 id="_8-12-1-生成所需证书" tabindex="-1"><a class="header-anchor" href="#_8-12-1-生成所需证书" aria-hidden="true">#</a> 8.12.1.生成所需证书</h3><pre><code>切换工作目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>使用自签CA签发kubectl连接集群的证书	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; admin-csr.json &lt;&lt;EOF
{
    &quot;CN&quot;: &quot;admin&quot;,
    &quot;hosts&quot;: [],
    &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
    {
        &quot;C&quot;: &quot;CN&quot;,
        &quot;L&quot;: &quot;BeiJing&quot;,
        &quot;ST&quot;: &quot;BeiJing&quot;,
        &quot;O&quot;: &quot;system:masters&quot;,
        &quot;OU&quot;: &quot;System&quot;
    }
    ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>生成证书
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
-config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-12-2-在-kube文件夹中生成config文件" tabindex="-1"><a class="header-anchor" href="#_8-12-2-在-kube文件夹中生成config文件" aria-hidden="true">#</a> 8.12.2.在.kube文件夹中生成config文件</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir /root/.kube

KUBE_CONFIG=&quot;/root/.kube/config&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot;

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials cluster-admin \
  --client-certificate=./admin.pem \
  --client-key=./admin-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=cluster-admin \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-12-3-通过kubectl工具查看集群组件" tabindex="-1"><a class="header-anchor" href="#_8-12-3-通过kubectl工具查看集群组件" aria-hidden="true">#</a> 8.12.3.通过kubectl工具查看集群组件</h3><pre><code>命令
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get cs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>Master1节点组件运行正常会显示如下结果
NAME                 STATUS    MESSAGE             ERROR
controller-manager   Healthy   ok                  
scheduler            Healthy   ok                  
etcd-0               Healthy   {&quot;health&quot;:&quot;true&quot;}   
etcd-2               Healthy   {&quot;health&quot;:&quot;true&quot;}   
etcd-1               Healthy   {&quot;health&quot;:&quot;true&quot;} 
</code></pre><h3 id="_8-12-4-授权kubelet-bootstrap用户允许请求证书" tabindex="-1"><a class="header-anchor" href="#_8-12-4-授权kubelet-bootstrap用户允许请求证书" aria-hidden="true">#</a> 8.12.4.授权kubelet-bootstrap用户允许请求证书</h3><pre><code>创建授权用户kubelet-bootstrap
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create clusterrolebinding kubelet-bootstrap \
--clusterrole=system:node-bootstrapper \
--user=kubelet-bootstrap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>上面如果不行用这个
kubectl create clusterrolebinding kubelet-bootstrap \
--clusterrole=system:node-bootstrapper --user=kubelet-bootstrap --group=system:bootstrappers

补充命令
删除授权kubelet-bootstrap用户：第一步
kubectl delete clusterrolebinding kubelet-bootstrap
删除授权kubelet-bootstrap用户：第二步
find / -name bootstrap.kubeconfig
rm -rf /opt/kubernetes/cfg/bootstrap.kubeconfig
删除授权kubelet-bootstrap用户：第三步
systemctl restart kubelet
</code></pre><h2 id="_8-13-在master-node1上部署第一个worker-node" tabindex="-1"><a class="header-anchor" href="#_8-13-在master-node1上部署第一个worker-node" aria-hidden="true">#</a> 8.13.在Master Node1上部署第一个Worker Node</h2><div class="custom-container tip"><p class="custom-container-title">注意事项</p><p>8.11.章节所有操作只在Master Node1节点操作，即当Master Node1既充当Master Node,也当Worker Node</p></div><pre><code>将Master Node1节点的k8s-server软件包拷贝到所有Worker Node
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/kubernetes/server/bin/
cp kubelet  kube-proxy /opt/kubernetes/bin/ &amp;&amp;
scp kubelet  kube-proxy root@192.168.0.10:/opt/kubernetes/bin/ &amp;&amp;
scp kubelet  kube-proxy root@192.168.0.11:/opt/kubernetes/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-13-2-在master-node1部署kubelet" tabindex="-1"><a class="header-anchor" href="#_8-13-2-在master-node1部署kubelet" aria-hidden="true">#</a> 8.13.2.在Master Node1部署kubelet</h3><h4 id="_8-13-2-1-创建kubelet配置文件" tabindex="-1"><a class="header-anchor" href="#_8-13-2-1-创建kubelet配置文件" aria-hidden="true">#</a> 8.13.2.1.创建kubelet配置文件</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kubelet.conf &lt;&lt; EOF
KUBELET_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--hostname-override=binary-k8s-master1 \\
--network-plugin=cni \\
--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\
--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\
--config=/opt/kubernetes/cfg/kubelet-config.yml \\
--cert-dir=/opt/kubernetes/ssl \\
--pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>配置说明
--hostname-override ：显示名称,集群唯一(不可重复)。
--network-plugin ：启用CNI。
--kubeconfig ： 空路径,会自动生成,后面用于连接apiserver。
--bootstrap-kubeconfig ：首次启动向apiserver申请证书。
--config ：配置文件参数。
--cert-dir ：kubelet证书目录。
--pod-infra-container-image ：管理Pod网络容器的镜像 init container
</code></pre><h4 id="_8-13-2-2-创建kubelet编排文件" tabindex="-1"><a class="header-anchor" href="#_8-13-2-2-创建kubelet编排文件" aria-hidden="true">#</a> 8.13.2.2.创建kubelet编排文件</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kubelet-config.yml &lt;&lt; EOF
kind: KubeletConfiguration
apiVersion: kubelet.config.k8s.io/v1beta1
address: 0.0.0.0
port: 10250
readOnlyPort: 10255
cgroupDriver: cgroupfs
clusterDNS:
- 10.0.0.2
clusterDomain: cluster.local 
failSwapOn: false
authentication:
  anonymous:
    enabled: false
  webhook:
    cacheTTL: 2m0s
    enabled: true
  x509:
    clientCAFile: /opt/kubernetes/ssl/ca.pem 
authorization:
  mode: Webhook
  webhook:
    cacheAuthorizedTTL: 5m0s
    cacheUnauthorizedTTL: 30s
evictionHard:
  imagefs.available: 15%
  memory.available: 100Mi
  nodefs.available: 10%
  nodefs.inodesFree: 5%
maxOpenFiles: 1000000
maxPods: 110
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-2-3-生成kubelet初次加入集群引导kubeconfig文件" tabindex="-1"><a class="header-anchor" href="#_8-13-2-3-生成kubelet初次加入集群引导kubeconfig文件" aria-hidden="true">#</a> 8.13.2.3.生成kubelet初次加入集群引导kubeconfig文件</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KUBE_CONFIG=&quot;/opt/kubernetes/cfg/bootstrap.kubeconfig&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot; # apiserver IP:PORT
TOKEN=&quot;4136692876ad4b01bb9dd0988480ebba&quot; # 与token.csv里保持一致  /opt/kubernetes/cfg/token.csv 

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials &quot;kubelet-bootstrap&quot; \
  --token=${TOKEN} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=&quot;kubelet-bootstrap&quot; \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-2-4-systemd管理kubelet" tabindex="-1"><a class="header-anchor" href="#_8-13-2-4-systemd管理kubelet" aria-hidden="true">#</a> 8.13.2.4.systemd管理kubelet</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kubelet
After=docker.service

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-5-启动kubelet并设置开机启动" tabindex="-1"><a class="header-anchor" href="#_8-13-3-5-启动kubelet并设置开机启动" aria-hidden="true">#</a> 8.13.3.5.启动kubelet并设置开机启动</h4><pre><code>刷新配置文件后启动kubelet并设置开机启动
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kubelet &amp;&amp;
systemctl enable kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>查看启动状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>启动故障排查
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_8-13-2-6-允许kubelet证书申请并加入集群" tabindex="-1"><a class="header-anchor" href="#_8-13-2-6-允许kubelet证书申请并加入集群" aria-hidden="true">#</a> 8.13.2.6.允许kubelet证书申请并加入集群</h4><pre><code>查看kubelet证书签名请求
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 bin]# kubectl get csr
NAME                                                   AGE	CONDITIO	...              
node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI   16s	Pending		...

手动批准证书签名请求
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl certificate approve node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>再次使用命令查看申请是否通过
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 bin]# kubectl get csr
NAME                                                   AGE	CONDITIO	...              
node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI   16s	Approved	...

补充命令
手动拒绝证书签名请求
kubectl certificate deny node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI
删除多余的csr
kubectl delete csr node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI

查看节点（如果上面步骤都没有错误这个步骤可以查看到Master节点）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 bin]# kubectl get nodes
NAME          STATUS     ROLES    AGE     VERSION
binary-k8s-master1   NotReady   &lt;none&gt;   2m10s   v1.20.0

注意事项
由于网络插件还没有部署,节点会没有准备就绪NotReady
</code></pre><h3 id="_8-13-3-部署kube-proxy" tabindex="-1"><a class="header-anchor" href="#_8-13-3-部署kube-proxy" aria-hidden="true">#</a> 8.13.3.部署kube-proxy</h3><h4 id="_8-13-3-1-创建kube-proxy配置文件" tabindex="-1"><a class="header-anchor" href="#_8-13-3-1-创建kube-proxy配置文件" aria-hidden="true">#</a> 8.13.3.1.创建kube-proxy配置文件</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-proxy.conf &lt;&lt; EOF
KUBE_PROXY_OPTS=&quot;--logtostderr=false \\
--v=2 \\
--log-dir=/opt/kubernetes/logs \\
--config=/opt/kubernetes/cfg/kube-proxy-config.yml&quot;
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-2-配置参数文件" tabindex="-1"><a class="header-anchor" href="#_8-13-3-2-配置参数文件" aria-hidden="true">#</a> 8.13.3.2.配置参数文件</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /opt/kubernetes/cfg/kube-proxy-config.yml &lt;&lt; EOF
kind: KubeProxyConfiguration
apiVersion: kubeproxy.config.k8s.io/v1alpha1
bindAddress: 0.0.0.0
metricsBindAddress: 0.0.0.0:10249
clientConnection:
  kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig
hostnameOverride: binary-k8s-master1
clusterCIDR: 10.244.0.0/16
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-3-生成kube-proxy证书文件" tabindex="-1"><a class="header-anchor" href="#_8-13-3-3-生成kube-proxy证书文件" aria-hidden="true">#</a> 8.13.3.3.生成kube-proxy证书文件</h4><pre><code>切换工作目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>创建证书请求文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; kube-proxy-csr.json &lt;&lt; EOF
{
    &quot;CN&quot;: &quot;system:kube-proxy&quot;,
    &quot;hosts&quot;: [],
    &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
    },
    &quot;names&quot;: [
    {
        &quot;C&quot;: &quot;CN&quot;,
        &quot;L&quot;: &quot;BeiJing&quot;,
        &quot;ST&quot;: &quot;BeiJing&quot;,
        &quot;O&quot;: &quot;k8s&quot;,
        &quot;OU&quot;: &quot;System&quot;
    }
   ]
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>生成证书
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem \
-config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-4-生成kube-proxy-kubeconfig文件" tabindex="-1"><a class="header-anchor" href="#_8-13-3-4-生成kube-proxy-kubeconfig文件" aria-hidden="true">#</a> 8.13.3.4.生成kube-proxy.kubeconfig文件</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KUBE_CONFIG=&quot;/opt/kubernetes/cfg/kube-proxy.kubeconfig&quot;
KUBE_APISERVER=&quot;https://192.168.0.9:6443&quot;

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-proxy \
  --client-certificate=./kube-proxy.pem \
  --client-key=./kube-proxy-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-proxy \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-13-3-5-systemd管理kube-proxy" tabindex="-1"><a class="header-anchor" href="#_8-13-3-5-systemd管理kube-proxy" aria-hidden="true">#</a> 8.13.3.5.systemd管理kube-proxy</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Proxy
After=network.target

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-12-3-6-启动kube-proxy并设置开机自启" tabindex="-1"><a class="header-anchor" href="#_8-12-3-6-启动kube-proxy并设置开机自启" aria-hidden="true">#</a> 8.12.3.6.启动kube-proxy并设置开机自启</h4><pre><code>刷新配置文件后启动kube-proxy并设置开机启动
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-proxy &amp;&amp;
systemctl enable kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>启动状态查询
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	systemctl status kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-13-4-部署网络组件-calico" tabindex="-1"><a class="header-anchor" href="#_8-13-4-部署网络组件-calico" aria-hidden="true">#</a> 8.13.4.部署网络组件(Calico)</h3><pre><code>Calico简介
Calico是一个纯三层的数据中心网络方案，是目前Kubernetes主流的网络方案。

切换目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /root/TLS/k8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>获取Calico.yaml文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>wget http://docs.projectcalico.org/v3.8/manifests/calico.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>备份calico.yaml并修改calico.yaml
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp calico.yaml calico.yaml.bak &amp;&amp; 
sed -i &#39;s/192.168.0.0/10.244.0.0/g&#39; calico.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>查询修改结果
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>grep &quot;IPV4POOL_CIDR&quot; calico.yaml  -A 1 \
		- name: CALICO_IPV4POOL_CIDR	\
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>正常会显示线面值
value: &quot;10.244.0.0/16&quot;

部署Calico
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f calico.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>等待8分钟左右后查看Calico的Pod运行状态（正常是STATUS是Running）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 k8s]# kubectl get pods -n kube-system
NAME                                      READY   STATUS    RESTARTS   AGE
calico-kube-controllers-bcc6f659f-r28g7   1/1     Running   0          18m
calico-node-dkjn6                         1/1     Running   6          18m

注意事项
calico部署很慢，不过不用等8分钟，执行kubectl apply命令后稍等一会儿就可以通过kubectl get nodes
查看节点状态了

查看集群节点（正常是STATUS是Ready）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 k8s]# kubectl get nodes
NAME          		  STATUS   ROLES    AGE   VERSION
binary-k8s-master1    Ready    &lt;none&gt;   34m   v1.20.0
</code></pre><h3 id="_8-13-5-授权apiserver访问kubelet" tabindex="-1"><a class="header-anchor" href="#_8-13-5-授权apiserver访问kubelet" aria-hidden="true">#</a> 8.13.5.授权apiserver访问kubelet</h3><pre><code>应用场景：如kubectl logs

创建配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; apiserver-to-kubelet-rbac.yaml &lt;&lt; EOF
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: &quot;true&quot;
  labels:
    kubernetes.io/bootstrapping: rbac-defaults
  name: system:kube-apiserver-to-kubelet
rules:
  - apiGroups:
      - &quot;&quot;
    resources:
      - nodes/proxy
      - nodes/stats
      - nodes/log
      - nodes/spec
      - nodes/metrics
      - pods/log
    verbs:
      - &quot;*&quot;
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: system:kube-apiserver
  namespace: &quot;&quot;
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:kube-apiserver-to-kubelet
subjects:
  - apiGroup: rbac.authorization.k8s.io
    kind: User
    name: kubernetes
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>应用配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f apiserver-to-kubelet-rbac.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-14-增加worker-node" tabindex="-1"><a class="header-anchor" href="#_8-14-增加worker-node" aria-hidden="true">#</a> 8.14.增加Worker Node</h2><h3 id="_8-14-1-在所有worker-node创建工作目录并拷贝二进制文件" tabindex="-1"><a class="header-anchor" href="#_8-14-1-在所有worker-node创建工作目录并拷贝二进制文件" aria-hidden="true">#</a> 8.14.1.在所有Worker Node创建工作目录并拷贝二进制文件</h3><pre><code>在所有Worker Node1和Worker Node2中创建工作目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/kubernetes/bin &amp;&amp;
mkdir -p /opt/kubernetes/cfg &amp;&amp;
mkdir -p /opt/kubernetes/ssl &amp;&amp;
mkdir -p /opt/kubernetes/logs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-14-2拷贝master-node1上部署好的文件到worker-node" tabindex="-1"><a class="header-anchor" href="#_8-14-2拷贝master-node1上部署好的文件到worker-node" aria-hidden="true">#</a> 8.14.2拷贝Master Node1上部署好的文件到Worker Node</h3><pre><code>进入Master Node1，执行下面操作，镜相关文件拷贝到Worker Node1和Worker Node2
拷贝到Worker Node1（192.168.0.10）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/kubernetes root@192.168.0.10:/opt/ &amp;&amp;
scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service \
root@192.168.0.10:/usr/lib/systemd/system &amp;&amp;
scp -r /opt/kubernetes/ssl/ca.pem root@192.168.0.10:/opt/kubernetes/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>拷贝到Worker Node2（192.168.0.11）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/kubernetes root@192.168.0.11:/opt/ &amp;&amp;
scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service \
root@192.168.0.11:/usr/lib/systemd/system &amp;&amp;
scp -r /opt/kubernetes/ssl/ca.pem root@192.168.0.11:/opt/kubernetes/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-14-3-删除所有worker-node中kubelet证书和kubeconfig文件" tabindex="-1"><a class="header-anchor" href="#_8-14-3-删除所有worker-node中kubelet证书和kubeconfig文件" aria-hidden="true">#</a> 8.14.3.删除所有Worker Node中kubelet证书和kubeconfig文件</h3><pre><code>Worker Node1节点（192.168.0.10）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -f /opt/kubernetes/cfg/kubelet.kubeconfig &amp;&amp;
rm -f /opt/kubernetes/ssl/kubelet*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Worker Node2节点（192.168.0.11）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -f /opt/kubernetes/cfg/kubelet.kubeconfig &amp;&amp;
rm -f /opt/kubernetes/ssl/kubelet*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>说明:
这几个文件是证书申请审批后自动生成的,每个Node不同,必须删除
</code></pre><h3 id="_8-14-4-修改worker-node1和worker-node2主机名" tabindex="-1"><a class="header-anchor" href="#_8-14-4-修改worker-node1和worker-node2主机名" aria-hidden="true">#</a> 8.14.4. 修改Worker Node1和Worker Node2主机名</h3><pre><code>Worker Node1（192.168.0.10）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s/--hostname-override=binary-k8s-master1/--hostname-override=binary-k8s-worker1/g&#39; \
/opt/kubernetes/cfg/kubelet.conf #修改--hostname-override的值为binary-k8s-worker1
sed -i &#39;s/hostnameOverride: binary-k8s-master1/hostnameOverride: binary-k8s-worker1/g&#39; \
/opt/kubernetes/cfg/kube-proxy-config.yml #修改hostnameOverride的值binary-k8s-worker1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Worker Node2（192.168.0.11）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s/--hostname-override=binary-k8s-master1/--hostname-override=binary-k8s-worker2/g&#39; \
/opt/kubernetes/cfg/kubelet.conf #修改--hostname-override的值为binary-k8s-worker2
sed -i &#39;s/hostnameOverride: binary-k8s-master1/hostnameOverride: binary-k8s-worker2/g&#39; \
/opt/kubernetes/cfg/kube-proxy-config.yml #修改hostnameOverride的值binary-k8s-worker2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-14-5-启动worker-node1和worker-node2中kubelet并设置开机自启" tabindex="-1"><a class="header-anchor" href="#_8-14-5-启动worker-node1和worker-node2中kubelet并设置开机自启" aria-hidden="true">#</a> 8.14.5.启动Worker Node1和Worker Node2中kubelet并设置开机自启</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp; 
systemctl start kubelet kube-proxy &amp;&amp; 
systemctl enable kubelet kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>查看启动状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl status kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>启动故障解决
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat /var/log/messages|grep kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-14-6-在master1上同意新的node-kubelet证书申请" tabindex="-1"><a class="header-anchor" href="#_8-14-6-在master1上同意新的node-kubelet证书申请" aria-hidden="true">#</a> 8.14.6.在Master1上同意新的Node kubelet证书申请</h3><pre><code>查看证书请求
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 k8s]# kubectl get csr

NAME                                                    ... CONDITION         ...
node-csr-IiJqGnj7y-9pMOIaYb9rpYxtIaEuACOITLI-WpfdpDI    ... Approved,Issued   ...
node-csr-TlSHYrzacOBQbJyQcfVwuArXPKRbjcoMESZykQ3Qr0w   ... Pending            ...
node-csr-vb-rAPL-grn0NxFGBs-_5pScCDkICmvHRnbhn_bRdsc    ... Pending           ...

手动批准证书签名请求
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl certificate approve node-csr-TlSHYrzacOBQbJyQcfVwuArXPKRbjcoMESZykQ3Qr0w
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl certificate approve node-csr-vb-rAPL-grn0NxFGBs-_5pScCDkICmvHRnbhn_bRdsc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>查看所有Node状态(要稍等会才会变成ready,会下载一些初始化镜像)
注意事项
刚加入Worker Node1和Worker Node2时使用kubectl get nodes查看可能会出现Worker Node NotReady状态，等
待大概三分钟左右再使用kubectl get nodes就可以看到所有节点状态都已经就绪了
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# kubectl get nodes
NAME                  STATUS   ROLES    AGE   VERSION
binary-k8s-master1    Ready    &lt;none&gt;   79s   v1.20.0
binary-k8s-worker1    Ready    &lt;none&gt;   26m   v1.20.0
binary-k8s-worker2    Ready    &lt;none&gt;   26m   v1.20.0

补充命令
删除多余的csr
kubectl delete csr node-csr-Rd_0WEaOFSkRT7geRKfz__I1v6E-CQfJpYwMTDEK-mw
</code></pre><h3 id="_8-14-7-在master1上部署kubernetes-dashboard" tabindex="-1"><a class="header-anchor" href="#_8-14-7-在master1上部署kubernetes-dashboard" aria-hidden="true">#</a> 8.14.7.在Master1上部署kubernetes-dashboard</h3><pre><code>切换目录并在该目录中下载kubernetes-dashboard安装所需要的yaml文件	
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package &amp;&amp;
wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.4.0/aio/deploy/recommended.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>修改配置
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim recommended.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>给名称为kubernetes-dashboard的Service中添加type: NodePort参数，大概在245行左右
kind: Service
name: kubernetes-dashboard
spec:
  type: NodePort
  
安装kubernetes-dashboard
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f recommended.yaml	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>查看部署情况
注意事项，等待大约2分钟使用kubectl get pods,svc -n kubernetes-dashboard才能看到所有pods,svc状态正常
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods,svc -n kubernetes-dashboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 package]# kubectl get pods,svc -n kubernetes-dashboard
NAME                                             READY   STATUS    RESTARTS   AGE
pod/dashboard-metrics-scraper-5b8896d7fc-jj8vp   1/1     Running   0          60m
pod/kubernetes-dashboard-897c7599f-pdk9g         1/1     Running   0          60m

NAME                                TYPE        CLUSTER-IP  	 PORT(S)         AGE
service/dashboard-metrics-scraper   ClusterIP   10.0.0.254       8000/TCP        60m
service/kubernetes-dashboard        NodePort    10.0.0.173       443:30441/TCP   60m

创建dashboard-admin使用的service account并绑定默认cluster-admin管理员集群角色
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create serviceaccount dashboard-admin -n kube-system
kubectl create clusterrolebinding dashboard-admin \
	--clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin
kubectl describe secrets -n kube-system \
$(kubectl -n kube-system get secret | awk &#39;/dashboard-admin/{print $1}&#39;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>查询token
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl describe secrets -n kube-system \
$(kubectl -n kube-system get secret | awk &#39;/dashboard-admin/{print $1}&#39;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>访问kubernetes-dashboard,输入刚才获得的token登录kubernetes-dashboard
https://192.168.0.9:30441/
https://192.168.0.10:30441/
https://192.168.0.11:30441/
</code></pre><h3 id="_8-14-8-在master1上部署coredns" tabindex="-1"><a class="header-anchor" href="#_8-14-8-在master1上部署coredns" aria-hidden="true">#</a> 8.14.8.在Master1上部署CoreDNS</h3><pre><code>介绍
CoreDNS主要用于集群内部Service名称解析。

从kubernetes源码包中获取coredns.yaml
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/kubernetes &amp;&amp; 
mkdir  kubernetes-src &amp;&amp;
tar fx kubernetes-src.tar.gz -C ./kubernetes-src &amp;&amp;
cd kubernetes-src/cluster/addons/dns/coredns/ &amp;&amp;
cp coredns.yaml.base coredns.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>修改coredns.yaml配置
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CLUSTER_DNS_DOMAIN=&quot;cluster.local&quot;
CLUSTER_DNS_SVC_IP=&quot;10.0.0.2&quot;
CLUSTER_DNS_LIMIT_MEMORY=&quot;170Mi&quot;

sed -i -e &quot;s@__DNS__DOMAIN__@${CLUSTER_DNS_DOMAIN}@&quot; \
		-e &quot;s@__DNS__SERVER__@${CLUSTER_DNS_SVC_IP}@&quot; \
		-e &quot;s@__DNS__MEMORY__LIMIT__@${CLUSTER_DNS_LIMIT_MEMORY}@&quot; \
		coredns.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>注意：CLUSTER_DNS_DOMAIN和CLUSTER_DNS_SVC_IP的值要和在node节点的kubelet-config.yaml/kubelet-
config.yal中clusterDNS和clusterDomain的值保持一致

修改coredns.yaml中coredns镜像仓库地址
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim coredns.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>将135行k8s.gcr.io/coredns:1.6.7修改为registry.aliyuncs.com/google_containers/coredns:v1.8.6

创建coredns使用的service account并绑定默认cluster-admin管理员集群角色
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create serviceaccount coredns -n kube-system
kubectl create clusterrolebinding coredns \
	--clusterrole=cluster-admin --serviceaccount=kube-system:coredns
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>部署coredns
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl apply -f coredns.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>查看coredns的pod是否正常
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@k8s-master1 yaml]# kubectl get pods -n kube-system
NAME                                      READY   STATUS    RESTARTS   AGE
calico-kube-controllers-97769f7c7-zcz5d   1/1     Running   1          47h
calico-node-5tnll                         1/1     Running   1          47h
calico-node-m8sdg                         1/1     Running   0          42m
calico-node-pqvk9                         1/1     Running   0          56m
coredns-6cc56c94bd-5hvfb                  1/1     Running   0          37s

启动故障排查
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl logs PODNAME -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>给coredns增加副本，增强高可用性（也可以修改配置文件）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl scale deployment coredns --replicas=2 -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>创建 kubernetes用户
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create clusterrolebinding kube-apiserver:kubelet-apis \
--clusterrole=system:kubelet-api-admin --user kubernetes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>使用busybox测试解析是否正常

部署busybox
编写busybox编排文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; busybox.yaml &lt;&lt; EOF
apiVersion: v1
kind: Pod
metadata:
  name: busybox
  namespace: default
spec:
  containers:
  - name: busybox
    image: busybox:1.28.4
    command:
      - sleep
      - &quot;3600&quot;
    imagePullPolicy: IfNotPresent
  restartPolicy: Always
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>创建busybox
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create -f busybox.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>进入busybox中
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl exec -it busybox -- sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>使用busybox测试coredns是否部署成功
If you don&#39;t see a command prompt, try pressing enter.
/ # ns
nsenter   nslookup
/ # nslookup kubernetes
Server:    10.0.0.2
Address 1: 10.0.0.2 kube-dns.kube-system.svc.cluster.local

查看coredns一共部署了几个副本
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get deployments -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master2 ~]# kubectl get deployments -n kube-system
NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
calico-kube-controllers   1/1     1            1           168m
coredns                   2/2     2            2           147m
</code></pre><h2 id="_8-15-增加master2节点" tabindex="-1"><a class="header-anchor" href="#_8-15-增加master2节点" aria-hidden="true">#</a> 8.15.增加Master2节点</h2><div class="custom-container danger"><p class="custom-container-title">特别特别注意</p><p>一定要先执行最开始的8.1章节公共步骤，如关闭防火墙等操作，否则是成功添加Master2节点的</p></div><h3 id="_8-15-1-kubernetes集群架构简介" tabindex="-1"><a class="header-anchor" href="#_8-15-1-kubernetes集群架构简介" aria-hidden="true">#</a> 8.15.1.Kubernetes集群架构简介</h3><pre><code>Kubernetes作为容器集群系统，通过健康检查+重启策略实现了Pod故障自我修复能力，通过调度算法
实现将Pod分布式部署，并保持预期副本数，根据Node失效状态自动在其他Node拉起Pod，实现了应用
层的高可用性。针对Kubernetes集群，高可用性还应包含以下两个层面的考虑：Etcd数据库的高可用
性和Kubernetes Master组件的高可用性。 而Etcd我们已经采用3个节点组建集群实现高可用，本
节将对Master节点高可用进行说明和实施。Master节点扮演着总控中心的角色，通过不断与工作节点
上的Kubelet和kube-proxy进行通信来维护整个集群的健康工作状态。如果Master节点故障，将无
法使用kubectl工具或者API做任何集群管理。Master节点有三个额外的组件，这个三个组件工作节
点kubeapiserver、kube-controller-manager和kube-scheduler，其中kube-controller-
manager和kube-scheduler组件自身通过选择机制已经实现了高可用，所以Master高可用主要针对
kube-apiserver组件，而该组件是以HTTP API提供服务，因此对他高可用与Web服务器类似，增加
负载均衡器对其负载均衡即可，并且可水平扩容。	

多主多从架构架构服务器规划	
</code></pre><table><thead><tr><th style="text-align:left;">角色</th><th style="text-align:left;">IP</th><th style="text-align:center;">组件</th></tr></thead><tbody><tr><td style="text-align:left;">binary-k8s-master1</td><td style="text-align:left;">192.168.0.9</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler <br> kubelet kube-proxy <br> nginx keepalived</td></tr><tr><td style="text-align:left;">binary-k8s-master2</td><td style="text-align:left;">192.168.0.12</td><td style="text-align:center;">etcd <br> docker <br> kube-apiserver kube-controller-manager kube-scheduler <br> kubelet kube-proxy <br> nginx keepalived</td></tr><tr><td style="text-align:left;">binary-k8s-worker1</td><td style="text-align:left;">192.168.0.10</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">binary-k8s-worker2</td><td style="text-align:left;">192.168.0.11</td><td style="text-align:center;">etcd <br> docker <br> kubelet kube-proxy</td></tr><tr><td style="text-align:left;">负载均衡器(虚拟IP)</td><td style="text-align:left;">192.168.0.88</td><td style="text-align:center;"></td></tr></tbody></table><div class="custom-container tip"><p class="custom-container-title">特别说明</p><p>现在需要再增加一台新服务器，作为Master2 Node，IP是192.168.0.12。Master Node2 与已部署的 Master Node1所有操作一致。所以我们只需将Master1所有K8s文件拷贝过来，再修改下服务器IP和主机名 启动即可。</p></div><h3 id="_8-15-2-给master-node2安装docker" tabindex="-1"><a class="header-anchor" href="#_8-15-2-给master-node2安装docker" aria-hidden="true">#</a> 8.15.2.给Master Node2安装Docker</h3><pre><code>进入Master Node1，将docker安装文件拷贝到Master Node2
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp /usr/bin/docker* root@192.168.0.12:/usr/bin &amp;&amp;
scp /usr/bin/runc root@192.168.0.12:/usr/bin &amp;&amp;
scp /usr/bin/containerd* root@192.168.0.12:/usr/bin &amp;&amp;
scp /usr/lib/systemd/system/docker.service \
root@192.168.0.12:/usr/lib/systemd/system &amp;&amp;
scp -r /etc/docker root@192.168.0.12:/etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>启动Mater Node2上的Docker并设置开机自启
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp; systemctl start docker &amp;&amp; systemctl enable docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>查看启动状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	systemctl status docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-15-5-给master-node2节点拷贝所有需要的证书" tabindex="-1"><a class="header-anchor" href="#_8-15-5-给master-node2节点拷贝所有需要的证书" aria-hidden="true">#</a> 8.15.5.给Master Node2节点拷贝所有需要的证书</h3><pre><code>在Master Node2上创建etcd证书目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/etcd/ssl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>在Master1上拷贝Master1上所有k8s文件和etcd证书到Master2
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>scp -r /opt/kubernetes root@192.168.0.12:/opt &amp;&amp;
scp -r /opt/etcd/ssl root@192.168.0.12:/opt/etcd &amp;&amp;
scp /usr/lib/systemd/system/kube* \
root@192.168.0.12:/usr/lib/systemd/system &amp;&amp;
scp /usr/bin/kubectl  root@192.168.0.12:/usr/bin &amp;&amp;
scp -r ~/.kube root@192.168.0.12:~
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>在Master Node2上删除旧的证书（删除kubelet和kubeconfig文件）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -f /opt/kubernetes/cfg/kubelet.kubeconfig &amp;&amp;
rm -f /opt/kubernetes/ssl/kubelet*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>修改Master2修改配置文件和主机名
修改apiserver、kubelet和kube-proxy配置文件为本地IP
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kube-apiserver.conf 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>...
--bind-address=192.168.0.12 \
--advertise-address=192.168.0.12 \
...

修改kube-controller-manager配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kube-controller-manager.kubeconfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>server: https://192.168.0.12:6443

修改kube-scheduler配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kube-scheduler.kubeconfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>server: https://192.168.0.12:6443
修改kubelet配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kubelet.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>--hostname-override=binary-k8s-master2

修改kube-proxy配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /opt/kubernetes/cfg/kube-proxy-config.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>hostnameOverride: binary-k8s-master2
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi ~/.kube/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>...
server: https://192.168.0.12:6443
</code></pre><h3 id="_8-15-6-启动master所有服务并设置开机自启" tabindex="-1"><a class="header-anchor" href="#_8-15-6-启动master所有服务并设置开机自启" aria-hidden="true">#</a> 8.15.6.启动Master所有服务并设置开机自启</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start kube-apiserver &amp;&amp;
systemctl start kube-controller-manager &amp;&amp;
systemctl start kube-scheduler &amp;&amp;
systemctl start kubelet kube-proxy &amp;&amp;
systemctl enable kube-apiserver &amp;&amp;
systemctl enable kube-controller-manager &amp;&amp;
systemctl enable kube-scheduler &amp;&amp;
systemctl enable kubelet &amp;&amp;
systemctl enable kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-15-7-在master查看集群组件状态" tabindex="-1"><a class="header-anchor" href="#_8-15-7-在master查看集群组件状态" aria-hidden="true">#</a> 8.15.7.在Master查看集群组件状态</h3><pre><code>注意：如果上面操作无误则这一步就可以查看到集群中组件的运行状态了

查看组件状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get cs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@localhost ~]# kubectl get cs
Warning: v1 ComponentStatus is deprecated in v1.19+
NAME                 STATUS    MESSAGE             ERROR
controller-manager   Healthy   ok 
scheduler            Healthy   ok   
etcd-2               Healthy   {&quot;health&quot;:&quot;true&quot;}
etcd-1               Healthy   {&quot;health&quot;:&quot;true&quot;}
etcd-0               Healthy   {&quot;health&quot;:&quot;true&quot;}
</code></pre><h3 id="_8-15-8-审批所有worker-node上的kubelet证书申请" tabindex="-1"><a class="header-anchor" href="#_8-15-8-审批所有worker-node上的kubelet证书申请" aria-hidden="true">#</a> 8.15.8.审批所有Worker Node上的kubelet证书申请</h3><pre><code>查看证书申请
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@localhost ~]# kubectl get csr
NAME                                                   ... CONDITION ...
node-csr-Pkp1fPd9NZApJVRqRFlIIjskZ_gL_qDmcSWGvSuN-VQ   ... Pending	 ...

同意证书申请
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl certificate approve node-csr-Pkp1fPd9NZApJVRqRFlIIjskZ_gL_qDmcSWGvSuN-VQ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>再次查看证书申请
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get csr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@localhost ~]# kubectl get csr
NAME                                                  ... CONDITION 	  ...
node-csr-Pkp1fPd9NZApJVRqRFlIIjskZ_gL_qDmcSWGvSuN-VQ  ... Approved,Issued ...	

查看节点加入状态没等到所有pods状态都已经变为Running，执行下一步操作
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# kubectl get pods -n kube-system
NAME                                      READY   STATUS     RESTARTS   AGE
calico-kube-controllers-bcc6f659f-7mf9n   1/1     Running    1          141m
calico-node-768sf                         1/1     Running    0          97m
calico-node-crhh4                         0/1     Init:2/3   0          2m7s
calico-node-hwbm9                         1/1     Running    0          98m
calico-node-vl4db                         1/1     Running    1          141m
coredns-7c878fc47b-n9nfd                  1/1     Running    0          75m
coredns-7c878fc47b-sxvz2                  1/1     Running    0          76m

查看Node
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>binary-k8s-master1   Ready    &lt;none&gt;   153m   v1.20.0
binary-k8s-master2   Ready    &lt;none&gt;   17m    v1.20.0
binary-k8s-worker1   Ready    &lt;none&gt;   142m   v1.20.0
binary-k8s-worker2   Ready    &lt;none&gt;   141m   v1.20.0

至此一个双Master节点k8s集群已经部署完毕，再添加新的Master节点步骤和上面的是相同的
</code></pre><h2 id="_8-16-部署nginx-keepalived高可用负载均衡器" tabindex="-1"><a class="header-anchor" href="#_8-16-部署nginx-keepalived高可用负载均衡器" aria-hidden="true">#</a> 8.16.部署Nginx+Keepalived高可用负载均衡器</h2><h3 id="_8-16-1-nginx和keepalived简介" tabindex="-1"><a class="header-anchor" href="#_8-16-1-nginx和keepalived简介" aria-hidden="true">#</a> 8.16.1.Nginx和Keepalived简介</h3><pre><code>Nginx是一个主流Web服务和反向代理服务器，这里用四层实现对apiserver实现负载均衡。Keepalived是一个主流高可
用软件，基于VIP绑定实现服务器双机热备，在上述拓扑中，Keepalived主要根据Nginx运行状态判断是否需要故障转移
（漂移VIP），例如当Nginx主节点挂掉，VIP会自动绑定在Nginx备节点，从而保证VIP一直可用，实现Nginx高可用。
如果你是在公有云上，一般都不支持keepalived，那么你可以直接用它们的负载均衡器产品，直接负载均衡多台Master 
kube-apiserver，架构与上面一样。
</code></pre><h3 id="_8-16-2-在两台master-node上安装软件" tabindex="-1"><a class="header-anchor" href="#_8-16-2-在两台master-node上安装软件" aria-hidden="true">#</a> 8.16.2.在两台Master Node上安装软件</h3><pre><code>下载nginx和keepalived
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum install epel-release -y &amp;&amp;
yum install nginx keepalived -y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Nginx配置文件（Master Node1和Master Node2相同）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/nginx/nginx.conf &lt;&lt; &quot;EOF&quot;
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

stream {

    log_format main &#39;$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent&#39;;

    access_log  /var/log/nginx/k8s-access.log  main;

    upstream k8s-apiserver {
       server 192.168.0.9:6443;   # Master1 APISERVER IP:PORT
       server 192.168.0.12:6443;   # Master2 APISERVER IP:PORT
    }
    
    server {
       listen 16443; # 由于nginx与master节点复用，这个监听端口不能是6443，否则会冲突
       proxy_pass k8s-apiserver;
    }
}

http {
    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    server {
        listen       80 default_server;
        server_name  _;

        location / {
        }
    }
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>Master Node1上的keepalived配置文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; EOF
global_defs { 
   notification_email { 
     acassen@firewall.loc 
     failover@firewall.loc 
     sysadmin@firewall.loc 
   } 
   notification_email_from Alexandre.Cassen@firewall.loc  
   smtp_server 127.0.0.1 
   smtp_connect_timeout 30 
   router_id NGINX_MASTER
} 

vrrp_script check_nginx {
    script &quot;/etc/keepalived/check_nginx.sh&quot;
}

vrrp_instance VI_1 { 
    state MASTER 
    interface ens33  # 修改为实际网卡名
    virtual_router_id 51 # VRRP 路由 ID实例，每个实例是唯一的 
    priority 100    # 优先级，备服务器设置 90 
    advert_int 1    # 指定VRRP 心跳包通告间隔时间，默认1秒 
    authentication { 
        auth_type PASS      
        auth_pass 1111 
    }  
    # 虚拟IP
    virtual_ipaddress { 
        192.168.0.88/24
    } 
    track_script {
        check_nginx
    } 
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ ​ Master Node2的keepalived配置文件</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; EOF
global_defs { 
   notification_email { 
     acassen@firewall.loc 
     failover@firewall.loc 
     sysadmin@firewall.loc 
   } 
   notification_email_from Alexandre.Cassen@firewall.loc  
   smtp_server 127.0.0.1 
   smtp_connect_timeout 30 
   router_id NGINX_BACKUP
} 

vrrp_script check_nginx {
    script &quot;/etc/keepalived/check_nginx.sh&quot;
}

vrrp_instance VI_1 { 
    state BACKUP 
    interface ens33
    virtual_router_id 51 # VRRP 路由 ID实例，每个实例是唯一的 
    priority 90
    advert_int 1
    authentication { 
        auth_type PASS      
        auth_pass 1111 
    }  
    virtual_ipaddress { 
        192.168.0.88/24
    } 
    track_script {
        check_nginx
    } 
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>配置说明
​vrrp_script：指定检查nginx工作状态脚本（根据nginx状态判断是否故障转移）
​virtual_ipaddress：虚拟IP（VIP）
​
​准备上述配置文件中检查nginx运行状态的脚本（Master Node1和Master Node2相同）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/keepalived/check_nginx.sh  &lt;&lt; &quot;EOF&quot;
#!/bin/bash
count=$(ss -antp |grep 16443 |egrep -cv &quot;grep|$$&quot;)

if [ &quot;$count&quot; -eq 0 ];then
    exit 1
else
    exit 0
fi
EOF

chmod +x /etc/keepalived/check_nginx.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 配置说明 ​ keepalived根据脚本返回状态码（0为工作正常，非0不正常）判断是否故障转移。</p><h3 id="_8-16-3-nginx增加steam模块" tabindex="-1"><a class="header-anchor" href="#_8-16-3-nginx增加steam模块" aria-hidden="true">#</a> 8.16.3.Nginx增加Steam模块</h3><h4 id="_8-16-3-1-查看nginx版本模块" tabindex="-1"><a class="header-anchor" href="#_8-16-3-1-查看nginx版本模块" aria-hidden="true">#</a> 8.16.3.1.查看Nginx版本模块</h4><pre><code>nginx -V
注意：如果已经安装 --with-stream模块,后面的步骤可以跳过
</code></pre><h4 id="_8-16-3-2-master1和master2安装stream模块" tabindex="-1"><a class="header-anchor" href="#_8-16-3-2-master1和master2安装stream模块" aria-hidden="true">#</a> 8.16.3.2.Master1和Master2安装Stream模块</h4><pre><code>备份Master Node1和Master Node2上原来的Nginx文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mv /usr/sbin/nginx /usr/sbin/nginx.bak &amp;&amp;
cp -r /etc/nginx{,.bak}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>切换目录并在该目录中下载nginx（注意这里下载的nginx版本要和之前nginx -v查看的版本保持一致，这里我们之前已经下载
好了，存放在Master Node1上，直接使用就可以了）

在Master Node1上切换目录
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/k8s/package/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>Master Node1编译环境准备
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install libxml2 libxml2-dev libxslt-devel 
yum -y install gd-devel 
yum -y install perl-devel perl-ExtUtils-Embed 
yum -y install GeoIP GeoIP-devel GeoIP-data
yum -y install pcre-devel
yum -y install openssl openssl-devel
yum -y install gcc make
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>编译nginx，加上本次需新增的模块: --with-stream
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tar -xf nginx-1.20.1.tar.gz
cd nginx-1.20.1/
./configure --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx \
--modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf  --with-stream
make
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>说明:
make完成后不要继续输入“make install”，以免现在的nginx出现问题
以上完成后，会在objs目录下生成一个nginx文件，先验证
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./objs/nginx -t
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 nginx-1.20.1]# ./objs/nginx -t
nginx: [alert] could not open error log file: open() &quot;/usr/share/nginx/logs/error.log&quot; failed (2: No such file or directory)
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

替换nginx到Master1/Master2
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cp ./objs/nginx /usr/sbin/ &amp;&amp;
scp objs/nginx root@192.168.0.12:/usr/sbin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>修改nginx服务文件（Master Node1和Master Node2）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -rf /usr/lib/systemd/system/nginx.service &amp;&amp;
cat &gt;&gt; /usr/lib/systemd/system/nginx.service &lt;&lt; EOF
[Unit]
Description=The nginx HTTP and reverse proxy server
After=network.target remote-fs.target nss-lookup.target
[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/bin/rm -rf /run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t
ExecStart=/usr/sbin/nginx
ExecStop=/usr/sbin/nginx -s stop
ExecReload=/usr/sbin/nginx -s reload
PrivateTmp=true
[Install]
WantedBy=multi-user.target
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-16-4-启动nginx、keepalived并设置开机自启-master1-master2" tabindex="-1"><a class="header-anchor" href="#_8-16-4-启动nginx、keepalived并设置开机自启-master1-master2" aria-hidden="true">#</a> 8.16.4.启动nginx、keepalived并设置开机自启(master1/master2)</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl daemon-reload &amp;&amp;
systemctl start nginx keepalived &amp;&amp;
systemctl enable nginx keepalived
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-16-5-查看keepalived工作状态" tabindex="-1"><a class="header-anchor" href="#_8-16-5-查看keepalived工作状态" aria-hidden="true">#</a> 8.16.5.查看keepalived工作状态</h3><pre><code>查看Master1网卡详细信息
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ip addr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# ip addr
...
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast 
		  state UP group default qlen 1000
    link/ether 00:0c:29:8d:76:8c brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.9/24 brd 192.168.0.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet 192.168.0.88/24 scope global ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::5c3d:f3b3:1254:f87b/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
...

查看Master2网卡详细信息
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ip addr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# ip addr
...
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state 
		 UP group default qlen 1000
    link/ether 00:50:56:2d:95:d6 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.12/24 brd 192.168.0.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::fe5b:93a6:43c0:3e2e/64 scope link tentative 
	    noprefixroute dadfailed 
       valid_lft forever preferred_lft forever
    inet6 fe80::5c3d:f3b3:1254:f87b/64 scope link tentative 
	    noprefixroute dadfailed 
       valid_lft forever preferred_lft forever
    inet6 fe80::7bd2:e647:9e81:ef45/64 scope link tentative
	     noprefixroute dadfailed 
       valid_lft forever preferred_lft forever
...

如何确定是否配置成功
可以看到，在Master1上的ens33网卡绑定了192.168.242.55 虚拟IP，说明工作正常。
inet 192.168.242.55/24 scope global ens33，而Master2上的ens33网卡没有绑定虚拟IP
</code></pre><h3 id="_8-16-6-nginx-keepalived高可用测试" tabindex="-1"><a class="header-anchor" href="#_8-16-6-nginx-keepalived高可用测试" aria-hidden="true">#</a> 8.16.6.Nginx+keepalived高可用测试</h3><pre><code>在主节点Master Node1节点执行关闭nginx
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pkill nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>查看虚拟IP是否漂移到备节点服务器（Master Node2）
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ip addr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# ip addr
...
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast 
	state UP group default qlen 1000
link/ether 00:50:56:2d:95:d6 brd ff:ff:ff:ff:ff:ff
inet 192.168.0.12/24 brd 192.168.0.255 scope global noprefixroute ens33
   valid_lft forever preferred_lft forever
inet 192.168.0.88/24 scope global ens33
   valid_lft forever preferred_lft forever
inet6 fe80::fe5b:93a6:43c0:3e2e/64 scope link tentative 
    noprefixroute dadfailed valid_lft forever preferred_lft forever
inet6 fe80::5c3d:f3b3:1254:f87b/64 scope link tentative 
    noprefixroute dadfailed valid_lft forever preferred_lft forever
inet6 fe80::7bd2:e647:9e81:ef45/64 scope link tentative 
    noprefixroute dadfailed valid_lft forever preferred_lft forever
...

如何确定虚拟IP是否发生飘移
可以看到，在Master2上的ens33网卡绑定了192.168.242.55 虚拟IP，说明工作正常。

测试完成后重新启动Master Node1上的nginx
systemctl start nginx
</code></pre><h3 id="_8-16-7-测试负载均衡器" tabindex="-1"><a class="header-anchor" href="#_8-16-7-测试负载均衡器" aria-hidden="true">#</a> 8.16.7.测试负载均衡器</h3><pre><code>找K8s集群中任意一个节点，使用curl查看K8s版本测试，使用VIP访问
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -k https://192.168.0.88:16443/version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>Master Node1机器
[root@binary-k8s-master1 ~]# curl -k https://192.168.0.88:16443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;20&quot;,
  &quot;gitVersion&quot;: &quot;v1.20.10&quot;,
  &quot;gitCommit&quot;: &quot;8152330a2b6ca3621196e62966ef761b8f5a61bb&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2021-08-11T18:00:37Z&quot;,
  &quot;goVersion&quot;: &quot;go1.15.15&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}

Master Node2机器
[root@binary-k8s-master2 ~]# curl -k https://192.168.0.88:16443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;20&quot;,
  &quot;gitVersion&quot;: &quot;v1.20.10&quot;,
  &quot;gitCommit&quot;: &quot;8152330a2b6ca3621196e62966ef761b8f5a61bb&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2021-08-11T18:00:37Z&quot;,
  &quot;goVersion&quot;: &quot;go1.15.15&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}

Worker Node1机器
[root@binary-k8s-worker1 ~]# curl -k https://192.168.0.88:16443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;20&quot;,
  &quot;gitVersion&quot;: &quot;v1.20.10&quot;,
  &quot;gitCommit&quot;: &quot;8152330a2b6ca3621196e62966ef761b8f5a61bb&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2021-08-11T18:00:37Z&quot;,
  &quot;goVersion&quot;: &quot;go1.15.15&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}

Worker Node2机器
[root@binary-k8s-worker2 ~]# curl -k https://192.168.0.88:16443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;20&quot;,
  &quot;gitVersion&quot;: &quot;v1.20.10&quot;,
  &quot;gitCommit&quot;: &quot;8152330a2b6ca3621196e62966ef761b8f5a61bb&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2021-08-11T18:00:37Z&quot;,
  &quot;goVersion&quot;: &quot;go1.15.15&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}

如何确定负载均衡器是否搭建正常
如果所有节点可以正确获取到K8s版本信息，说明负载均衡器搭建正常。
该请求数据流程：curl -&gt; vip(nginx) -&gt; apiserver

通过查看Nginx日志也可以看到转发apiserver IP：
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tailf /var/log/nginx/k8s-access.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 ~]# tailf /var/log/nginx/k8s-access.log 
192.168.242.55 192.168.0.9:6443 - [26/Jul/2022:01:28:51 -0400] 200 428
192.168.211.128 192.168.0.9:6443 - [26/Jul/2022:01:28:58 -0400] 200 428
192.168.95.192 192.168.0.12:6443 - [26/Jul/2022:01:30:12 -0400] 200 428
192.168.63.192 192.168.0.9:6443 - [26/Jul/2022:01:30:14 -0400] 200 428
192.168.242.55 192.168.0.9:6443 - [26/Jul/2022:01:30:36 -0400] 200 428
192.168.242.55 192.168.0.12:6443 - [26/Jul/2022:01:30:42 -0400] 200 428
</code></pre><h3 id="_8-16-8-修改所有的worker-node连接lb-vip" tabindex="-1"><a class="header-anchor" href="#_8-16-8-修改所有的worker-node连接lb-vip" aria-hidden="true">#</a> 8.16.8.修改所有的Worker Node连接LB VIP</h3><pre><code>为什么要改为连接LB VIP
试想下，虽然我们增加了Master2 Node和负载均衡器，但是我们是从单Master架构扩容的，也就是
说目前所有的Worker Node组件连接都还是Master1 Node，如果不改为连接VIP走负载均衡器，那么
Master还是单点故障。因此接下来就是要改所有Worker Node（kubectl get node命令查看到的节
点）组件配置文件，由原来192.168.0.9修改为192.168.242.55（VIP）。

在所有Worker Node执行
注意事项
这里除了Worker Node1和Worker Node2，Master Node1和Master Node2这两个节点也充当了Worker Node，所以所有的四个节点
上都要执行下面的命令
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sed -i &#39;s#192.168.0.9:6443#192.168.0.88:16443#&#39; /opt/kubernetes/cfg/* &amp;&amp;
systemctl restart kubelet kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>检查节点状态
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>[root@binary-k8s-master1 cfg]# kubectl get nodes
NAME                 STATUS   ROLES    AGE     VERSION
binary-k8s-master1   Ready    &lt;none&gt;   5h13m   v1.20.0
binary-k8s-master2   Ready    &lt;none&gt;   177m    v1.20.0
binary-k8s-worker1    Ready    &lt;none&gt;   5h1m    v1.20.0
binary-k8s-worker2    Ready    &lt;none&gt;   5h1m    v1.20.0

为了确保配置成功，重启集群中所有机器，再次在Master Node1和Master Node2中查看节点状态，如一切部署无误结果如下所示
[root@binary-k8s-master1 cfg]# kubectl get nodes
NAME                 STATUS   ROLES    AGE     VERSION
binary-k8s-master1   Ready    &lt;none&gt;   5h13m   v1.20.0
binary-k8s-master2   Ready    &lt;none&gt;   177m    v1.20.0
binary-k8s-worker1    Ready    &lt;none&gt;   5h1m    v1.20.0
binary-k8s-worker2    Ready    &lt;none&gt;   5h1m    v1.20.0

至此,一套高可用的k8s二进制可用集群就部署完成了~
^_^
</code></pre><h2 id="_8-17-部署常见问题" tabindex="-1"><a class="header-anchor" href="#_8-17-部署常见问题" aria-hidden="true">#</a> 8.17.部署常见问题</h2><h3 id="_8-17-1系统断电后-某个etcd节点无法启动" tabindex="-1"><a class="header-anchor" href="#_8-17-1系统断电后-某个etcd节点无法启动" aria-hidden="true">#</a> 8.17.1系统断电后,某个etcd节点无法启动</h3><pre><code>报错信息
publish error: etcdserver: request timed out

解决方法(如果没有重要数据,或者刚进行完初始化)
检查日志发现并没有特别明显的错误，根据经验来讲，etcd 节点坏掉一个其实对集群没有大的影响，
这时集群已经可以正常使用了，但是这个坏掉的 etcd 节点并没有启动

#进入 etcd 的数据存储目录进行备份 备份原有数据：
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /var/lib/etcd/default.etcd/member/ &amp;&amp;
cp * /data/bak/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>#删除这个目录下的所有数据文件
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm -rf /var/lib/etcd/default.etcd/member/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>#停止另外两台 etcd 节点，因为 etcd 节点启动时需要所有节点一起启动，启动成功后即可使用。
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>systemctl stop etcd &amp;&amp;
systemctl restart etcd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-17-2-the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port" tabindex="-1"><a class="header-anchor" href="#_8-17-2-the-connection-to-the-server-localhost-8080-was-refused-did-you-specify-the-right-host-or-port" aria-hidden="true">#</a> 8.17.2 The connection to the server localhost:8080 was refused - did you specify the right host or port?</h3><pre><code>8.10.使用kubectl查看集群状态章节没有正确执行会报这个错
</code></pre><h2 id="_8-18-部署测试程序" tabindex="-1"><a class="header-anchor" href="#_8-18-部署测试程序" aria-hidden="true">#</a> 8.18.部署测试程序</h2><pre><code>创建guestbook
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create deployment guestbook --image=ibmcom/guestbook:v1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>查询pod运行状态，状态应该显示为Running表示pod运行成功
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get pods
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>对外暴露端口
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl expose deployment guestbook --type=NodePort --port=3000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>查询端口映射
</code></pre><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl get service guestbook
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>NAME        TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
guestbook   NodePort   10.10.10.253   &lt;none&gt;        3000:31208/TCP   1m

访问服务（主节点和两个工作节点都可访问到这个服务）
http://192.168.0.6:31208
http://192.168.0.7:31208
http://192.168.0.8:31208
</code></pre></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/8/9 21:52:51</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: LRwq942133">lingwh</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/blogs/backend/springcloud/springcloud-eureka/shardings/springcloud-eureka-chapter-7.SpringCloud-Eurekakubeadm%E6%90%AD%E5%BB%BAKubernetes.html" class="nav-link prev" aria-label="7.SpringCloud-Eurekakubeadm搭建Kubernetes"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><span class="icon iconfont icon-article"></span>7.SpringCloud-Eurekakubeadm搭建Kubernetes</div></a><!----></nav><div class="waline-wrapper" style="display:block;" darkmode="false"><div data-waline provider="Waline"><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="nick">昵称</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="mail">邮箱</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="link">网址</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="请留言。(填写邮箱可在被回复时收到邮件提醒)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>预览:</h4><!-- eslint-disable-next-line vue/no-v-html --><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noreferrer"><svg width="16" height="16" ariahidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button class="wl-action" title="表情" style="display:none;"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button class="wl-action" title="表情包"><svg width="24" height="24" fill="currentcolor" viewbox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="上传图片"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button class="wl-action" title="预览"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0 <!--v-if-->  字</div><button class="wl-btn">登录</button><button class="wl-btn primary" title="Cmd|Ctrl + Enter"><!--[-->提交<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="搜索表情包"><div class="wl-gallery" style="gap:6px;"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewbox="0 0 100 100" preserveaspectratio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokewidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributename="transform" type="rotate" repeatcount="indefinite" dur="1s" values="0 50 50;360 50 50" keytimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-count"><!--v-if--> 评论</div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewbox="0 0 100 100" preserveaspectratio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokewidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributename="transform" type="rotate" repeatcount="indefinite" dur="1s" values="0 50 50;360 50 50" keytimes="0;1"></animateTransform></circle></svg></div><!--]--><!-- Copyright Information --><!--v-if--></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Copyright 2021 © <a href='https://github.com/lingwh1995' target='_blank'>lingwh</a></div><!----></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.d6e2c9d0.js" defer></script>
  </body>
</html>
